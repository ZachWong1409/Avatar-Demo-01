var eet=Object.defineProperty;var net=(s,r,a)=>r in s?eet(s,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[r]=a;var fe=(s,r,a)=>(net(s,typeof r!="symbol"?r+"":r,a),a);(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))d(h);new MutationObserver(h=>{for(const f of h)if(f.type==="childList")for(const g of f.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&d(g)}).observe(document,{childList:!0,subtree:!0});function a(h){const f={};return h.integrity&&(f.integrity=h.integrity),h.referrerPolicy&&(f.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?f.credentials="include":h.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function d(h){if(h.ep)return;h.ep=!0;const f=a(h);fetch(h.href,f)}})();var Pg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Tj(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var yj={exports:{}},cS={},Rj={exports:{}},Fe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wf=Symbol.for("react.element"),iet=Symbol.for("react.portal"),ret=Symbol.for("react.fragment"),set=Symbol.for("react.strict_mode"),oet=Symbol.for("react.profiler"),aet=Symbol.for("react.provider"),cet=Symbol.for("react.context"),det=Symbol.for("react.forward_ref"),uet=Symbol.for("react.suspense"),het=Symbol.for("react.memo"),pet=Symbol.for("react.lazy"),ZV=Symbol.iterator;function fet(s){return s===null||typeof s!="object"?null:(s=ZV&&s[ZV]||s["@@iterator"],typeof s=="function"?s:null)}var Cj={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},bj=Object.assign,Ij={};function ju(s,r,a){this.props=s,this.context=r,this.refs=Ij,this.updater=a||Cj}ju.prototype.isReactComponent={};ju.prototype.setState=function(s,r){if(typeof s!="object"&&typeof s!="function"&&s!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,s,r,"setState")};ju.prototype.forceUpdate=function(s){this.updater.enqueueForceUpdate(this,s,"forceUpdate")};function wj(){}wj.prototype=ju.prototype;function Nb(s,r,a){this.props=s,this.context=r,this.refs=Ij,this.updater=a||Cj}var Db=Nb.prototype=new wj;Db.constructor=Nb;bj(Db,ju.prototype);Db.isPureReactComponent=!0;var $V=Array.isArray,Aj=Object.prototype.hasOwnProperty,Pb={current:null},Oj={key:!0,ref:!0,__self:!0,__source:!0};function Nj(s,r,a){var d,h={},f=null,g=null;if(r!=null)for(d in r.ref!==void 0&&(g=r.ref),r.key!==void 0&&(f=""+r.key),r)Aj.call(r,d)&&!Oj.hasOwnProperty(d)&&(h[d]=r[d]);var v=arguments.length-2;if(v===1)h.children=a;else if(1<v){for(var y=Array(v),C=0;C<v;C++)y[C]=arguments[C+2];h.children=y}if(s&&s.defaultProps)for(d in v=s.defaultProps,v)h[d]===void 0&&(h[d]=v[d]);return{$$typeof:wf,type:s,key:f,ref:g,props:h,_owner:Pb.current}}function met(s,r){return{$$typeof:wf,type:s.type,key:r,ref:s.ref,props:s.props,_owner:s._owner}}function kb(s){return typeof s=="object"&&s!==null&&s.$$typeof===wf}function _et(s){var r={"=":"=0",":":"=2"};return"$"+s.replace(/[=:]/g,function(a){return r[a]})}var tF=/\/+/g;function zR(s,r){return typeof s=="object"&&s!==null&&s.key!=null?_et(""+s.key):r.toString(36)}function uE(s,r,a,d,h){var f=typeof s;(f==="undefined"||f==="boolean")&&(s=null);var g=!1;if(s===null)g=!0;else switch(f){case"string":case"number":g=!0;break;case"object":switch(s.$$typeof){case wf:case iet:g=!0}}if(g)return g=s,h=h(g),s=d===""?"."+zR(g,0):d,$V(h)?(a="",s!=null&&(a=s.replace(tF,"$&/")+"/"),uE(h,r,a,"",function(C){return C})):h!=null&&(kb(h)&&(h=met(h,a+(!h.key||g&&g.key===h.key?"":(""+h.key).replace(tF,"$&/")+"/")+s)),r.push(h)),1;if(g=0,d=d===""?".":d+":",$V(s))for(var v=0;v<s.length;v++){f=s[v];var y=d+zR(f,v);g+=uE(f,r,a,y,h)}else if(y=fet(s),typeof y=="function")for(s=y.call(s),v=0;!(f=s.next()).done;)f=f.value,y=d+zR(f,v++),g+=uE(f,r,a,y,h);else if(f==="object")throw r=String(s),Error("Objects are not valid as a React child (found: "+(r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return g}function kg(s,r,a){if(s==null)return s;var d=[],h=0;return uE(s,d,"","",function(f){return r.call(a,f,h++)}),d}function get(s){if(s._status===-1){var r=s._result;r=r(),r.then(function(a){(s._status===0||s._status===-1)&&(s._status=1,s._result=a)},function(a){(s._status===0||s._status===-1)&&(s._status=2,s._result=a)}),s._status===-1&&(s._status=0,s._result=r)}if(s._status===1)return s._result.default;throw s._result}var dr={current:null},hE={transition:null},Eet={ReactCurrentDispatcher:dr,ReactCurrentBatchConfig:hE,ReactCurrentOwner:Pb};function Dj(){throw Error("act(...) is not supported in production builds of React.")}Fe.Children={map:kg,forEach:function(s,r,a){kg(s,function(){r.apply(this,arguments)},a)},count:function(s){var r=0;return kg(s,function(){r++}),r},toArray:function(s){return kg(s,function(r){return r})||[]},only:function(s){if(!kb(s))throw Error("React.Children.only expected to receive a single React element child.");return s}};Fe.Component=ju;Fe.Fragment=ret;Fe.Profiler=oet;Fe.PureComponent=Nb;Fe.StrictMode=set;Fe.Suspense=uet;Fe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Eet;Fe.act=Dj;Fe.cloneElement=function(s,r,a){if(s==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+s+".");var d=bj({},s.props),h=s.key,f=s.ref,g=s._owner;if(r!=null){if(r.ref!==void 0&&(f=r.ref,g=Pb.current),r.key!==void 0&&(h=""+r.key),s.type&&s.type.defaultProps)var v=s.type.defaultProps;for(y in r)Aj.call(r,y)&&!Oj.hasOwnProperty(y)&&(d[y]=r[y]===void 0&&v!==void 0?v[y]:r[y])}var y=arguments.length-2;if(y===1)d.children=a;else if(1<y){v=Array(y);for(var C=0;C<y;C++)v[C]=arguments[C+2];d.children=v}return{$$typeof:wf,type:s.type,key:h,ref:f,props:d,_owner:g}};Fe.createContext=function(s){return s={$$typeof:cet,_currentValue:s,_currentValue2:s,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},s.Provider={$$typeof:aet,_context:s},s.Consumer=s};Fe.createElement=Nj;Fe.createFactory=function(s){var r=Nj.bind(null,s);return r.type=s,r};Fe.createRef=function(){return{current:null}};Fe.forwardRef=function(s){return{$$typeof:det,render:s}};Fe.isValidElement=kb;Fe.lazy=function(s){return{$$typeof:pet,_payload:{_status:-1,_result:s},_init:get}};Fe.memo=function(s,r){return{$$typeof:het,type:s,compare:r===void 0?null:r}};Fe.startTransition=function(s){var r=hE.transition;hE.transition={};try{s()}finally{hE.transition=r}};Fe.unstable_act=Dj;Fe.useCallback=function(s,r){return dr.current.useCallback(s,r)};Fe.useContext=function(s){return dr.current.useContext(s)};Fe.useDebugValue=function(){};Fe.useDeferredValue=function(s){return dr.current.useDeferredValue(s)};Fe.useEffect=function(s,r){return dr.current.useEffect(s,r)};Fe.useId=function(){return dr.current.useId()};Fe.useImperativeHandle=function(s,r,a){return dr.current.useImperativeHandle(s,r,a)};Fe.useInsertionEffect=function(s,r){return dr.current.useInsertionEffect(s,r)};Fe.useLayoutEffect=function(s,r){return dr.current.useLayoutEffect(s,r)};Fe.useMemo=function(s,r){return dr.current.useMemo(s,r)};Fe.useReducer=function(s,r,a){return dr.current.useReducer(s,r,a)};Fe.useRef=function(s){return dr.current.useRef(s)};Fe.useState=function(s){return dr.current.useState(s)};Fe.useSyncExternalStore=function(s,r,a){return dr.current.useSyncExternalStore(s,r,a)};Fe.useTransition=function(){return dr.current.useTransition()};Fe.version="18.3.1";Rj.exports=Fe;var Rt=Rj.exports;const Lb=Tj(Rt);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vet=Rt,Tet=Symbol.for("react.element"),yet=Symbol.for("react.fragment"),Ret=Object.prototype.hasOwnProperty,Cet=vet.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,bet={key:!0,ref:!0,__self:!0,__source:!0};function Pj(s,r,a){var d,h={},f=null,g=null;a!==void 0&&(f=""+a),r.key!==void 0&&(f=""+r.key),r.ref!==void 0&&(g=r.ref);for(d in r)Ret.call(r,d)&&!bet.hasOwnProperty(d)&&(h[d]=r[d]);if(s&&s.defaultProps)for(d in r=s.defaultProps,r)h[d]===void 0&&(h[d]=r[d]);return{$$typeof:Tet,type:s,key:f,ref:g,props:h,_owner:Cet.current}}cS.Fragment=yet;cS.jsx=Pj;cS.jsxs=Pj;yj.exports=cS;var ht=yj.exports,IC={},kj={exports:{}},es={},Lj={exports:{}},Mj={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(s){function r(Lt,Jt){var $t=Lt.length;Lt.push(Jt);t:for(;0<$t;){var Ve=$t-1>>>1,Pe=Lt[Ve];if(0<h(Pe,Jt))Lt[Ve]=Jt,Lt[$t]=Pe,$t=Ve;else break t}}function a(Lt){return Lt.length===0?null:Lt[0]}function d(Lt){if(Lt.length===0)return null;var Jt=Lt[0],$t=Lt.pop();if($t!==Jt){Lt[0]=$t;t:for(var Ve=0,Pe=Lt.length,ui=Pe>>>1;Ve<ui;){var hn=2*(Ve+1)-1,de=Lt[hn],Ne=hn+1,On=Lt[Ne];if(0>h(de,$t))Ne<Pe&&0>h(On,de)?(Lt[Ve]=On,Lt[Ne]=$t,Ve=Ne):(Lt[Ve]=de,Lt[hn]=$t,Ve=hn);else if(Ne<Pe&&0>h(On,$t))Lt[Ve]=On,Lt[Ne]=$t,Ve=Ne;else break t}}return Jt}function h(Lt,Jt){var $t=Lt.sortIndex-Jt.sortIndex;return $t!==0?$t:Lt.id-Jt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;s.unstable_now=function(){return f.now()}}else{var g=Date,v=g.now();s.unstable_now=function(){return g.now()-v}}var y=[],C=[],O=1,k=null,M=3,j=!1,z=!1,Y=!1,Z=typeof setTimeout=="function"?setTimeout:null,H=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function q(Lt){for(var Jt=a(C);Jt!==null;){if(Jt.callback===null)d(C);else if(Jt.startTime<=Lt)d(C),Jt.sortIndex=Jt.expirationTime,r(y,Jt);else break;Jt=a(C)}}function it(Lt){if(Y=!1,q(Lt),!z)if(a(y)!==null)z=!0,Se(ot);else{var Jt=a(C);Jt!==null&&le(it,Jt.startTime-Lt)}}function ot(Lt,Jt){z=!1,Y&&(Y=!1,H(lt),lt=-1),j=!0;var $t=M;try{for(q(Jt),k=a(y);k!==null&&(!(k.expirationTime>Jt)||Lt&&!qt());){var Ve=k.callback;if(typeof Ve=="function"){k.callback=null,M=k.priorityLevel;var Pe=Ve(k.expirationTime<=Jt);Jt=s.unstable_now(),typeof Pe=="function"?k.callback=Pe:k===a(y)&&d(y),q(Jt)}else d(y);k=a(y)}if(k!==null)var ui=!0;else{var hn=a(C);hn!==null&&le(it,hn.startTime-Jt),ui=!1}return ui}finally{k=null,M=$t,j=!1}}var _t=!1,ft=null,lt=-1,kt=5,At=-1;function qt(){return!(s.unstable_now()-At<kt)}function vt(){if(ft!==null){var Lt=s.unstable_now();At=Lt;var Jt=!0;try{Jt=ft(!0,Lt)}finally{Jt?xt():(_t=!1,ft=null)}}else _t=!1}var xt;if(typeof K=="function")xt=function(){K(vt)};else if(typeof MessageChannel<"u"){var Ot=new MessageChannel,zt=Ot.port2;Ot.port1.onmessage=vt,xt=function(){zt.postMessage(null)}}else xt=function(){Z(vt,0)};function Se(Lt){ft=Lt,_t||(_t=!0,xt())}function le(Lt,Jt){lt=Z(function(){Lt(s.unstable_now())},Jt)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(Lt){Lt.callback=null},s.unstable_continueExecution=function(){z||j||(z=!0,Se(ot))},s.unstable_forceFrameRate=function(Lt){0>Lt||125<Lt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):kt=0<Lt?Math.floor(1e3/Lt):5},s.unstable_getCurrentPriorityLevel=function(){return M},s.unstable_getFirstCallbackNode=function(){return a(y)},s.unstable_next=function(Lt){switch(M){case 1:case 2:case 3:var Jt=3;break;default:Jt=M}var $t=M;M=Jt;try{return Lt()}finally{M=$t}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(Lt,Jt){switch(Lt){case 1:case 2:case 3:case 4:case 5:break;default:Lt=3}var $t=M;M=Lt;try{return Jt()}finally{M=$t}},s.unstable_scheduleCallback=function(Lt,Jt,$t){var Ve=s.unstable_now();switch(typeof $t=="object"&&$t!==null?($t=$t.delay,$t=typeof $t=="number"&&0<$t?Ve+$t:Ve):$t=Ve,Lt){case 1:var Pe=-1;break;case 2:Pe=250;break;case 5:Pe=1073741823;break;case 4:Pe=1e4;break;default:Pe=5e3}return Pe=$t+Pe,Lt={id:O++,callback:Jt,priorityLevel:Lt,startTime:$t,expirationTime:Pe,sortIndex:-1},$t>Ve?(Lt.sortIndex=$t,r(C,Lt),a(y)===null&&Lt===a(C)&&(Y?(H(lt),lt=-1):Y=!0,le(it,$t-Ve))):(Lt.sortIndex=Pe,r(y,Lt),z||j||(z=!0,Se(ot))),Lt},s.unstable_shouldYield=qt,s.unstable_wrapCallback=function(Lt){var Jt=M;return function(){var $t=M;M=Jt;try{return Lt.apply(this,arguments)}finally{M=$t}}}})(Mj);Lj.exports=Mj;var Iet=Lj.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wet=Rt,ts=Iet;function wt(s){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+s,a=1;a<arguments.length;a++)r+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+s+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var xj=new Set,sf={};function Vd(s,r){Du(s,r),Du(s+"Capture",r)}function Du(s,r){for(sf[s]=r,s=0;s<r.length;s++)xj.add(r[s])}var _a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),wC=Object.prototype.hasOwnProperty,Aet=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,eF={},nF={};function Oet(s){return wC.call(nF,s)?!0:wC.call(eF,s)?!1:Aet.test(s)?nF[s]=!0:(eF[s]=!0,!1)}function Net(s,r,a,d){if(a!==null&&a.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return d?!1:a!==null?!a.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function Det(s,r,a,d){if(r===null||typeof r>"u"||Net(s,r,a,d))return!0;if(d)return!1;if(a!==null)switch(a.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function lr(s,r,a,d,h,f,g){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=d,this.attributeNamespace=h,this.mustUseProperty=a,this.propertyName=s,this.type=r,this.sanitizeURL=f,this.removeEmptyString=g}var xi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){xi[s]=new lr(s,0,!1,s,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var r=s[0];xi[r]=new lr(r,1,!1,s[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(s){xi[s]=new lr(s,2,!1,s.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){xi[s]=new lr(s,2,!1,s,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){xi[s]=new lr(s,3,!1,s.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(s){xi[s]=new lr(s,3,!0,s,null,!1,!1)});["capture","download"].forEach(function(s){xi[s]=new lr(s,4,!1,s,null,!1,!1)});["cols","rows","size","span"].forEach(function(s){xi[s]=new lr(s,6,!1,s,null,!1,!1)});["rowSpan","start"].forEach(function(s){xi[s]=new lr(s,5,!1,s.toLowerCase(),null,!1,!1)});var Mb=/[\-:]([a-z])/g;function xb(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var r=s.replace(Mb,xb);xi[r]=new lr(r,1,!1,s,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var r=s.replace(Mb,xb);xi[r]=new lr(r,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(s){var r=s.replace(Mb,xb);xi[r]=new lr(r,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(s){xi[s]=new lr(s,1,!1,s.toLowerCase(),null,!1,!1)});xi.xlinkHref=new lr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(s){xi[s]=new lr(s,1,!1,s.toLowerCase(),null,!0,!0)});function Ub(s,r,a,d){var h=xi.hasOwnProperty(r)?xi[r]:null;(h!==null?h.type!==0:d||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(Det(r,a,h,d)&&(a=null),d||h===null?Oet(r)&&(a===null?s.removeAttribute(r):s.setAttribute(r,""+a)):h.mustUseProperty?s[h.propertyName]=a===null?h.type===3?!1:"":a:(r=h.attributeName,d=h.attributeNamespace,a===null?s.removeAttribute(r):(h=h.type,a=h===3||h===4&&a===!0?"":""+a,d?s.setAttributeNS(d,r,a):s.setAttribute(r,a))))}var Ta=wet.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Lg=Symbol.for("react.element"),uu=Symbol.for("react.portal"),hu=Symbol.for("react.fragment"),Vb=Symbol.for("react.strict_mode"),AC=Symbol.for("react.profiler"),Uj=Symbol.for("react.provider"),Vj=Symbol.for("react.context"),Fb=Symbol.for("react.forward_ref"),OC=Symbol.for("react.suspense"),NC=Symbol.for("react.suspense_list"),Bb=Symbol.for("react.memo"),rc=Symbol.for("react.lazy"),Fj=Symbol.for("react.offscreen"),iF=Symbol.iterator;function Sp(s){return s===null||typeof s!="object"?null:(s=iF&&s[iF]||s["@@iterator"],typeof s=="function"?s:null)}var Gn=Object.assign,KR;function Pp(s){if(KR===void 0)try{throw Error()}catch(a){var r=a.stack.trim().match(/\n( *(at )?)/);KR=r&&r[1]||""}return`
`+KR+s}var YR=!1;function qR(s,r){if(!s||YR)return"";YR=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(C){var d=C}Reflect.construct(s,[],r)}else{try{r.call()}catch(C){d=C}s.call(r.prototype)}else{try{throw Error()}catch(C){d=C}s()}}catch(C){if(C&&d&&typeof C.stack=="string"){for(var h=C.stack.split(`
`),f=d.stack.split(`
`),g=h.length-1,v=f.length-1;1<=g&&0<=v&&h[g]!==f[v];)v--;for(;1<=g&&0<=v;g--,v--)if(h[g]!==f[v]){if(g!==1||v!==1)do if(g--,v--,0>v||h[g]!==f[v]){var y=`
`+h[g].replace(" at new "," at ");return s.displayName&&y.includes("<anonymous>")&&(y=y.replace("<anonymous>",s.displayName)),y}while(1<=g&&0<=v);break}}}finally{YR=!1,Error.prepareStackTrace=a}return(s=s?s.displayName||s.name:"")?Pp(s):""}function Pet(s){switch(s.tag){case 5:return Pp(s.type);case 16:return Pp("Lazy");case 13:return Pp("Suspense");case 19:return Pp("SuspenseList");case 0:case 2:case 15:return s=qR(s.type,!1),s;case 11:return s=qR(s.type.render,!1),s;case 1:return s=qR(s.type,!0),s;default:return""}}function DC(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case hu:return"Fragment";case uu:return"Portal";case AC:return"Profiler";case Vb:return"StrictMode";case OC:return"Suspense";case NC:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case Vj:return(s.displayName||"Context")+".Consumer";case Uj:return(s._context.displayName||"Context")+".Provider";case Fb:var r=s.render;return s=s.displayName,s||(s=r.displayName||r.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case Bb:return r=s.displayName||null,r!==null?r:DC(s.type)||"Memo";case rc:r=s._payload,s=s._init;try{return DC(s(r))}catch{}}return null}function ket(s){var r=s.type;switch(s.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=r.render,s=s.displayName||s.name||"",r.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return DC(r);case 8:return r===Vb?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function yc(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Bj(s){var r=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function Let(s){var r=Bj(s)?"checked":"value",a=Object.getOwnPropertyDescriptor(s.constructor.prototype,r),d=""+s[r];if(!s.hasOwnProperty(r)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var h=a.get,f=a.set;return Object.defineProperty(s,r,{configurable:!0,get:function(){return h.call(this)},set:function(g){d=""+g,f.call(this,g)}}),Object.defineProperty(s,r,{enumerable:a.enumerable}),{getValue:function(){return d},setValue:function(g){d=""+g},stopTracking:function(){s._valueTracker=null,delete s[r]}}}}function Mg(s){s._valueTracker||(s._valueTracker=Let(s))}function jj(s){if(!s)return!1;var r=s._valueTracker;if(!r)return!0;var a=r.getValue(),d="";return s&&(d=Bj(s)?s.checked?"true":"false":s.value),s=d,s!==a?(r.setValue(s),!0):!1}function wE(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function PC(s,r){var a=r.checked;return Gn({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??s._wrapperState.initialChecked})}function rF(s,r){var a=r.defaultValue==null?"":r.defaultValue,d=r.checked!=null?r.checked:r.defaultChecked;a=yc(r.value!=null?r.value:a),s._wrapperState={initialChecked:d,initialValue:a,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function Wj(s,r){r=r.checked,r!=null&&Ub(s,"checked",r,!1)}function kC(s,r){Wj(s,r);var a=yc(r.value),d=r.type;if(a!=null)d==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+a):s.value!==""+a&&(s.value=""+a);else if(d==="submit"||d==="reset"){s.removeAttribute("value");return}r.hasOwnProperty("value")?LC(s,r.type,a):r.hasOwnProperty("defaultValue")&&LC(s,r.type,yc(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(s.defaultChecked=!!r.defaultChecked)}function sF(s,r,a){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var d=r.type;if(!(d!=="submit"&&d!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+s._wrapperState.initialValue,a||r===s.value||(s.value=r),s.defaultValue=r}a=s.name,a!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,a!==""&&(s.name=a)}function LC(s,r,a){(r!=="number"||wE(s.ownerDocument)!==s)&&(a==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+a&&(s.defaultValue=""+a))}var kp=Array.isArray;function Ru(s,r,a,d){if(s=s.options,r){r={};for(var h=0;h<a.length;h++)r["$"+a[h]]=!0;for(a=0;a<s.length;a++)h=r.hasOwnProperty("$"+s[a].value),s[a].selected!==h&&(s[a].selected=h),h&&d&&(s[a].defaultSelected=!0)}else{for(a=""+yc(a),r=null,h=0;h<s.length;h++){if(s[h].value===a){s[h].selected=!0,d&&(s[h].defaultSelected=!0);return}r!==null||s[h].disabled||(r=s[h])}r!==null&&(r.selected=!0)}}function MC(s,r){if(r.dangerouslySetInnerHTML!=null)throw Error(wt(91));return Gn({},r,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function oF(s,r){var a=r.value;if(a==null){if(a=r.children,r=r.defaultValue,a!=null){if(r!=null)throw Error(wt(92));if(kp(a)){if(1<a.length)throw Error(wt(93));a=a[0]}r=a}r==null&&(r=""),a=r}s._wrapperState={initialValue:yc(a)}}function Gj(s,r){var a=yc(r.value),d=yc(r.defaultValue);a!=null&&(a=""+a,a!==s.value&&(s.value=a),r.defaultValue==null&&s.defaultValue!==a&&(s.defaultValue=a)),d!=null&&(s.defaultValue=""+d)}function aF(s){var r=s.textContent;r===s._wrapperState.initialValue&&r!==""&&r!==null&&(s.value=r)}function Hj(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function xC(s,r){return s==null||s==="http://www.w3.org/1999/xhtml"?Hj(r):s==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var xg,zj=function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,a,d,h){MSApp.execUnsafeLocalFunction(function(){return s(r,a,d,h)})}:s}(function(s,r){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=r;else{for(xg=xg||document.createElement("div"),xg.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=xg.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;r.firstChild;)s.appendChild(r.firstChild)}});function of(s,r){if(r){var a=s.firstChild;if(a&&a===s.lastChild&&a.nodeType===3){a.nodeValue=r;return}}s.textContent=r}var Hp={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Met=["Webkit","ms","Moz","O"];Object.keys(Hp).forEach(function(s){Met.forEach(function(r){r=r+s.charAt(0).toUpperCase()+s.substring(1),Hp[r]=Hp[s]})});function Kj(s,r,a){return r==null||typeof r=="boolean"||r===""?"":a||typeof r!="number"||r===0||Hp.hasOwnProperty(s)&&Hp[s]?(""+r).trim():r+"px"}function Yj(s,r){s=s.style;for(var a in r)if(r.hasOwnProperty(a)){var d=a.indexOf("--")===0,h=Kj(a,r[a],d);a==="float"&&(a="cssFloat"),d?s.setProperty(a,h):s[a]=h}}var xet=Gn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function UC(s,r){if(r){if(xet[s]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(wt(137,s));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(wt(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(wt(61))}if(r.style!=null&&typeof r.style!="object")throw Error(wt(62))}}function VC(s,r){if(s.indexOf("-")===-1)return typeof r.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var FC=null;function jb(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var BC=null,Cu=null,bu=null;function cF(s){if(s=Nf(s)){if(typeof BC!="function")throw Error(wt(280));var r=s.stateNode;r&&(r=pS(r),BC(s.stateNode,s.type,r))}}function qj(s){Cu?bu?bu.push(s):bu=[s]:Cu=s}function Xj(){if(Cu){var s=Cu,r=bu;if(bu=Cu=null,cF(s),r)for(s=0;s<r.length;s++)cF(r[s])}}function Jj(s,r){return s(r)}function Qj(){}var XR=!1;function Zj(s,r,a){if(XR)return s(r,a);XR=!0;try{return Jj(s,r,a)}finally{XR=!1,(Cu!==null||bu!==null)&&(Qj(),Xj())}}function af(s,r){var a=s.stateNode;if(a===null)return null;var d=pS(a);if(d===null)return null;a=d[r];t:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(s=s.type,d=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!d;break t;default:s=!1}if(s)return null;if(a&&typeof a!="function")throw Error(wt(231,r,typeof a));return a}var jC=!1;if(_a)try{var vp={};Object.defineProperty(vp,"passive",{get:function(){jC=!0}}),window.addEventListener("test",vp,vp),window.removeEventListener("test",vp,vp)}catch{jC=!1}function Uet(s,r,a,d,h,f,g,v,y){var C=Array.prototype.slice.call(arguments,3);try{r.apply(a,C)}catch(O){this.onError(O)}}var zp=!1,AE=null,OE=!1,WC=null,Vet={onError:function(s){zp=!0,AE=s}};function Fet(s,r,a,d,h,f,g,v,y){zp=!1,AE=null,Uet.apply(Vet,arguments)}function Bet(s,r,a,d,h,f,g,v,y){if(Fet.apply(this,arguments),zp){if(zp){var C=AE;zp=!1,AE=null}else throw Error(wt(198));OE||(OE=!0,WC=C)}}function Fd(s){var r=s,a=s;if(s.alternate)for(;r.return;)r=r.return;else{s=r;do r=s,r.flags&4098&&(a=r.return),s=r.return;while(s)}return r.tag===3?a:null}function $j(s){if(s.tag===13){var r=s.memoizedState;if(r===null&&(s=s.alternate,s!==null&&(r=s.memoizedState)),r!==null)return r.dehydrated}return null}function dF(s){if(Fd(s)!==s)throw Error(wt(188))}function jet(s){var r=s.alternate;if(!r){if(r=Fd(s),r===null)throw Error(wt(188));return r!==s?null:s}for(var a=s,d=r;;){var h=a.return;if(h===null)break;var f=h.alternate;if(f===null){if(d=h.return,d!==null){a=d;continue}break}if(h.child===f.child){for(f=h.child;f;){if(f===a)return dF(h),s;if(f===d)return dF(h),r;f=f.sibling}throw Error(wt(188))}if(a.return!==d.return)a=h,d=f;else{for(var g=!1,v=h.child;v;){if(v===a){g=!0,a=h,d=f;break}if(v===d){g=!0,d=h,a=f;break}v=v.sibling}if(!g){for(v=f.child;v;){if(v===a){g=!0,a=f,d=h;break}if(v===d){g=!0,d=f,a=h;break}v=v.sibling}if(!g)throw Error(wt(189))}}if(a.alternate!==d)throw Error(wt(190))}if(a.tag!==3)throw Error(wt(188));return a.stateNode.current===a?s:r}function t3(s){return s=jet(s),s!==null?e3(s):null}function e3(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var r=e3(s);if(r!==null)return r;s=s.sibling}return null}var n3=ts.unstable_scheduleCallback,lF=ts.unstable_cancelCallback,Wet=ts.unstable_shouldYield,Get=ts.unstable_requestPaint,ii=ts.unstable_now,Het=ts.unstable_getCurrentPriorityLevel,Wb=ts.unstable_ImmediatePriority,i3=ts.unstable_UserBlockingPriority,NE=ts.unstable_NormalPriority,zet=ts.unstable_LowPriority,r3=ts.unstable_IdlePriority,dS=null,jo=null;function Ket(s){if(jo&&typeof jo.onCommitFiberRoot=="function")try{jo.onCommitFiberRoot(dS,s,void 0,(s.current.flags&128)===128)}catch{}}var co=Math.clz32?Math.clz32:Xet,Yet=Math.log,qet=Math.LN2;function Xet(s){return s>>>=0,s===0?32:31-(Yet(s)/qet|0)|0}var Ug=64,Vg=4194304;function Lp(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function DE(s,r){var a=s.pendingLanes;if(a===0)return 0;var d=0,h=s.suspendedLanes,f=s.pingedLanes,g=a&268435455;if(g!==0){var v=g&~h;v!==0?d=Lp(v):(f&=g,f!==0&&(d=Lp(f)))}else g=a&~h,g!==0?d=Lp(g):f!==0&&(d=Lp(f));if(d===0)return 0;if(r!==0&&r!==d&&!(r&h)&&(h=d&-d,f=r&-r,h>=f||h===16&&(f&4194240)!==0))return r;if(d&4&&(d|=a&16),r=s.entangledLanes,r!==0)for(s=s.entanglements,r&=d;0<r;)a=31-co(r),h=1<<a,d|=s[a],r&=~h;return d}function Jet(s,r){switch(s){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Qet(s,r){for(var a=s.suspendedLanes,d=s.pingedLanes,h=s.expirationTimes,f=s.pendingLanes;0<f;){var g=31-co(f),v=1<<g,y=h[g];y===-1?(!(v&a)||v&d)&&(h[g]=Jet(v,r)):y<=r&&(s.expiredLanes|=v),f&=~v}}function GC(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function s3(){var s=Ug;return Ug<<=1,!(Ug&4194240)&&(Ug=64),s}function JR(s){for(var r=[],a=0;31>a;a++)r.push(s);return r}function Af(s,r,a){s.pendingLanes|=r,r!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,r=31-co(r),s[r]=a}function Zet(s,r){var a=s.pendingLanes&~r;s.pendingLanes=r,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=r,s.mutableReadLanes&=r,s.entangledLanes&=r,r=s.entanglements;var d=s.eventTimes;for(s=s.expirationTimes;0<a;){var h=31-co(a),f=1<<h;r[h]=0,d[h]=-1,s[h]=-1,a&=~f}}function Gb(s,r){var a=s.entangledLanes|=r;for(s=s.entanglements;a;){var d=31-co(a),h=1<<d;h&r|s[d]&r&&(s[d]|=r),a&=~h}}var un=0;function o3(s){return s&=-s,1<s?4<s?s&268435455?16:536870912:4:1}var a3,Hb,c3,d3,l3,HC=!1,Fg=[],pc=null,fc=null,mc=null,cf=new Map,df=new Map,oc=[],$et="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function uF(s,r){switch(s){case"focusin":case"focusout":pc=null;break;case"dragenter":case"dragleave":fc=null;break;case"mouseover":case"mouseout":mc=null;break;case"pointerover":case"pointerout":cf.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":df.delete(r.pointerId)}}function Tp(s,r,a,d,h,f){return s===null||s.nativeEvent!==f?(s={blockedOn:r,domEventName:a,eventSystemFlags:d,nativeEvent:f,targetContainers:[h]},r!==null&&(r=Nf(r),r!==null&&Hb(r)),s):(s.eventSystemFlags|=d,r=s.targetContainers,h!==null&&r.indexOf(h)===-1&&r.push(h),s)}function tnt(s,r,a,d,h){switch(r){case"focusin":return pc=Tp(pc,s,r,a,d,h),!0;case"dragenter":return fc=Tp(fc,s,r,a,d,h),!0;case"mouseover":return mc=Tp(mc,s,r,a,d,h),!0;case"pointerover":var f=h.pointerId;return cf.set(f,Tp(cf.get(f)||null,s,r,a,d,h)),!0;case"gotpointercapture":return f=h.pointerId,df.set(f,Tp(df.get(f)||null,s,r,a,d,h)),!0}return!1}function u3(s){var r=Cd(s.target);if(r!==null){var a=Fd(r);if(a!==null){if(r=a.tag,r===13){if(r=$j(a),r!==null){s.blockedOn=r,l3(s.priority,function(){c3(a)});return}}else if(r===3&&a.stateNode.current.memoizedState.isDehydrated){s.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}s.blockedOn=null}function pE(s){if(s.blockedOn!==null)return!1;for(var r=s.targetContainers;0<r.length;){var a=zC(s.domEventName,s.eventSystemFlags,r[0],s.nativeEvent);if(a===null){a=s.nativeEvent;var d=new a.constructor(a.type,a);FC=d,a.target.dispatchEvent(d),FC=null}else return r=Nf(a),r!==null&&Hb(r),s.blockedOn=a,!1;r.shift()}return!0}function hF(s,r,a){pE(s)&&a.delete(r)}function ent(){HC=!1,pc!==null&&pE(pc)&&(pc=null),fc!==null&&pE(fc)&&(fc=null),mc!==null&&pE(mc)&&(mc=null),cf.forEach(hF),df.forEach(hF)}function yp(s,r){s.blockedOn===r&&(s.blockedOn=null,HC||(HC=!0,ts.unstable_scheduleCallback(ts.unstable_NormalPriority,ent)))}function lf(s){function r(h){return yp(h,s)}if(0<Fg.length){yp(Fg[0],s);for(var a=1;a<Fg.length;a++){var d=Fg[a];d.blockedOn===s&&(d.blockedOn=null)}}for(pc!==null&&yp(pc,s),fc!==null&&yp(fc,s),mc!==null&&yp(mc,s),cf.forEach(r),df.forEach(r),a=0;a<oc.length;a++)d=oc[a],d.blockedOn===s&&(d.blockedOn=null);for(;0<oc.length&&(a=oc[0],a.blockedOn===null);)u3(a),a.blockedOn===null&&oc.shift()}var Iu=Ta.ReactCurrentBatchConfig,PE=!0;function nnt(s,r,a,d){var h=un,f=Iu.transition;Iu.transition=null;try{un=1,zb(s,r,a,d)}finally{un=h,Iu.transition=f}}function int(s,r,a,d){var h=un,f=Iu.transition;Iu.transition=null;try{un=4,zb(s,r,a,d)}finally{un=h,Iu.transition=f}}function zb(s,r,a,d){if(PE){var h=zC(s,r,a,d);if(h===null)oC(s,r,d,kE,a),uF(s,d);else if(tnt(h,s,r,a,d))d.stopPropagation();else if(uF(s,d),r&4&&-1<$et.indexOf(s)){for(;h!==null;){var f=Nf(h);if(f!==null&&a3(f),f=zC(s,r,a,d),f===null&&oC(s,r,d,kE,a),f===h)break;h=f}h!==null&&d.stopPropagation()}else oC(s,r,d,null,a)}}var kE=null;function zC(s,r,a,d){if(kE=null,s=jb(d),s=Cd(s),s!==null)if(r=Fd(s),r===null)s=null;else if(a=r.tag,a===13){if(s=$j(r),s!==null)return s;s=null}else if(a===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;s=null}else r!==s&&(s=null);return kE=s,null}function h3(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Het()){case Wb:return 1;case i3:return 4;case NE:case zet:return 16;case r3:return 536870912;default:return 16}default:return 16}}var cc=null,Kb=null,fE=null;function p3(){if(fE)return fE;var s,r=Kb,a=r.length,d,h="value"in cc?cc.value:cc.textContent,f=h.length;for(s=0;s<a&&r[s]===h[s];s++);var g=a-s;for(d=1;d<=g&&r[a-d]===h[f-d];d++);return fE=h.slice(s,1<d?1-d:void 0)}function mE(s){var r=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&r===13&&(s=13)):s=r,s===10&&(s=13),32<=s||s===13?s:0}function Bg(){return!0}function pF(){return!1}function ns(s){function r(a,d,h,f,g){this._reactName=a,this._targetInst=h,this.type=d,this.nativeEvent=f,this.target=g,this.currentTarget=null;for(var v in s)s.hasOwnProperty(v)&&(a=s[v],this[v]=a?a(f):f[v]);return this.isDefaultPrevented=(f.defaultPrevented!=null?f.defaultPrevented:f.returnValue===!1)?Bg:pF,this.isPropagationStopped=pF,this}return Gn(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Bg)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Bg)},persist:function(){},isPersistent:Bg}),r}var Wu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Yb=ns(Wu),Of=Gn({},Wu,{view:0,detail:0}),rnt=ns(Of),QR,ZR,Rp,lS=Gn({},Of,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:qb,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Rp&&(Rp&&s.type==="mousemove"?(QR=s.screenX-Rp.screenX,ZR=s.screenY-Rp.screenY):ZR=QR=0,Rp=s),QR)},movementY:function(s){return"movementY"in s?s.movementY:ZR}}),fF=ns(lS),snt=Gn({},lS,{dataTransfer:0}),ont=ns(snt),ant=Gn({},Of,{relatedTarget:0}),$R=ns(ant),cnt=Gn({},Wu,{animationName:0,elapsedTime:0,pseudoElement:0}),dnt=ns(cnt),lnt=Gn({},Wu,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),unt=ns(lnt),hnt=Gn({},Wu,{data:0}),mF=ns(hnt),pnt={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fnt={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mnt={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _nt(s){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(s):(s=mnt[s])?!!r[s]:!1}function qb(){return _nt}var gnt=Gn({},Of,{key:function(s){if(s.key){var r=pnt[s.key]||s.key;if(r!=="Unidentified")return r}return s.type==="keypress"?(s=mE(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?fnt[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:qb,charCode:function(s){return s.type==="keypress"?mE(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?mE(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Ent=ns(gnt),Snt=Gn({},lS,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_F=ns(Snt),vnt=Gn({},Of,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:qb}),Tnt=ns(vnt),ynt=Gn({},Wu,{propertyName:0,elapsedTime:0,pseudoElement:0}),Rnt=ns(ynt),Cnt=Gn({},lS,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),bnt=ns(Cnt),Int=[9,13,27,32],Xb=_a&&"CompositionEvent"in window,Kp=null;_a&&"documentMode"in document&&(Kp=document.documentMode);var wnt=_a&&"TextEvent"in window&&!Kp,f3=_a&&(!Xb||Kp&&8<Kp&&11>=Kp),gF=String.fromCharCode(32),EF=!1;function m3(s,r){switch(s){case"keyup":return Int.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _3(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var pu=!1;function Ant(s,r){switch(s){case"compositionend":return _3(r);case"keypress":return r.which!==32?null:(EF=!0,gF);case"textInput":return s=r.data,s===gF&&EF?null:s;default:return null}}function Ont(s,r){if(pu)return s==="compositionend"||!Xb&&m3(s,r)?(s=p3(),fE=Kb=cc=null,pu=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return f3&&r.locale!=="ko"?null:r.data;default:return null}}var Nnt={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function SF(s){var r=s&&s.nodeName&&s.nodeName.toLowerCase();return r==="input"?!!Nnt[s.type]:r==="textarea"}function g3(s,r,a,d){qj(d),r=LE(r,"onChange"),0<r.length&&(a=new Yb("onChange","change",null,a,d),s.push({event:a,listeners:r}))}var Yp=null,uf=null;function Dnt(s){A3(s,0)}function uS(s){var r=_u(s);if(jj(r))return s}function Pnt(s,r){if(s==="change")return r}var E3=!1;if(_a){var tC;if(_a){var eC="oninput"in document;if(!eC){var vF=document.createElement("div");vF.setAttribute("oninput","return;"),eC=typeof vF.oninput=="function"}tC=eC}else tC=!1;E3=tC&&(!document.documentMode||9<document.documentMode)}function TF(){Yp&&(Yp.detachEvent("onpropertychange",S3),uf=Yp=null)}function S3(s){if(s.propertyName==="value"&&uS(uf)){var r=[];g3(r,uf,s,jb(s)),Zj(Dnt,r)}}function knt(s,r,a){s==="focusin"?(TF(),Yp=r,uf=a,Yp.attachEvent("onpropertychange",S3)):s==="focusout"&&TF()}function Lnt(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return uS(uf)}function Mnt(s,r){if(s==="click")return uS(r)}function xnt(s,r){if(s==="input"||s==="change")return uS(r)}function Unt(s,r){return s===r&&(s!==0||1/s===1/r)||s!==s&&r!==r}var uo=typeof Object.is=="function"?Object.is:Unt;function hf(s,r){if(uo(s,r))return!0;if(typeof s!="object"||s===null||typeof r!="object"||r===null)return!1;var a=Object.keys(s),d=Object.keys(r);if(a.length!==d.length)return!1;for(d=0;d<a.length;d++){var h=a[d];if(!wC.call(r,h)||!uo(s[h],r[h]))return!1}return!0}function yF(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function RF(s,r){var a=yF(s);s=0;for(var d;a;){if(a.nodeType===3){if(d=s+a.textContent.length,s<=r&&d>=r)return{node:a,offset:r-s};s=d}t:{for(;a;){if(a.nextSibling){a=a.nextSibling;break t}a=a.parentNode}a=void 0}a=yF(a)}}function v3(s,r){return s&&r?s===r?!0:s&&s.nodeType===3?!1:r&&r.nodeType===3?v3(s,r.parentNode):"contains"in s?s.contains(r):s.compareDocumentPosition?!!(s.compareDocumentPosition(r)&16):!1:!1}function T3(){for(var s=window,r=wE();r instanceof s.HTMLIFrameElement;){try{var a=typeof r.contentWindow.location.href=="string"}catch{a=!1}if(a)s=r.contentWindow;else break;r=wE(s.document)}return r}function Jb(s){var r=s&&s.nodeName&&s.nodeName.toLowerCase();return r&&(r==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||r==="textarea"||s.contentEditable==="true")}function Vnt(s){var r=T3(),a=s.focusedElem,d=s.selectionRange;if(r!==a&&a&&a.ownerDocument&&v3(a.ownerDocument.documentElement,a)){if(d!==null&&Jb(a)){if(r=d.start,s=d.end,s===void 0&&(s=r),"selectionStart"in a)a.selectionStart=r,a.selectionEnd=Math.min(s,a.value.length);else if(s=(r=a.ownerDocument||document)&&r.defaultView||window,s.getSelection){s=s.getSelection();var h=a.textContent.length,f=Math.min(d.start,h);d=d.end===void 0?f:Math.min(d.end,h),!s.extend&&f>d&&(h=d,d=f,f=h),h=RF(a,f);var g=RF(a,d);h&&g&&(s.rangeCount!==1||s.anchorNode!==h.node||s.anchorOffset!==h.offset||s.focusNode!==g.node||s.focusOffset!==g.offset)&&(r=r.createRange(),r.setStart(h.node,h.offset),s.removeAllRanges(),f>d?(s.addRange(r),s.extend(g.node,g.offset)):(r.setEnd(g.node,g.offset),s.addRange(r)))}}for(r=[],s=a;s=s.parentNode;)s.nodeType===1&&r.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<r.length;a++)s=r[a],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var Fnt=_a&&"documentMode"in document&&11>=document.documentMode,fu=null,KC=null,qp=null,YC=!1;function CF(s,r,a){var d=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;YC||fu==null||fu!==wE(d)||(d=fu,"selectionStart"in d&&Jb(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),qp&&hf(qp,d)||(qp=d,d=LE(KC,"onSelect"),0<d.length&&(r=new Yb("onSelect","select",null,r,a),s.push({event:r,listeners:d}),r.target=fu)))}function jg(s,r){var a={};return a[s.toLowerCase()]=r.toLowerCase(),a["Webkit"+s]="webkit"+r,a["Moz"+s]="moz"+r,a}var mu={animationend:jg("Animation","AnimationEnd"),animationiteration:jg("Animation","AnimationIteration"),animationstart:jg("Animation","AnimationStart"),transitionend:jg("Transition","TransitionEnd")},nC={},y3={};_a&&(y3=document.createElement("div").style,"AnimationEvent"in window||(delete mu.animationend.animation,delete mu.animationiteration.animation,delete mu.animationstart.animation),"TransitionEvent"in window||delete mu.transitionend.transition);function hS(s){if(nC[s])return nC[s];if(!mu[s])return s;var r=mu[s],a;for(a in r)if(r.hasOwnProperty(a)&&a in y3)return nC[s]=r[a];return s}var R3=hS("animationend"),C3=hS("animationiteration"),b3=hS("animationstart"),I3=hS("transitionend"),w3=new Map,bF="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function bc(s,r){w3.set(s,r),Vd(r,[s])}for(var iC=0;iC<bF.length;iC++){var rC=bF[iC],Bnt=rC.toLowerCase(),jnt=rC[0].toUpperCase()+rC.slice(1);bc(Bnt,"on"+jnt)}bc(R3,"onAnimationEnd");bc(C3,"onAnimationIteration");bc(b3,"onAnimationStart");bc("dblclick","onDoubleClick");bc("focusin","onFocus");bc("focusout","onBlur");bc(I3,"onTransitionEnd");Du("onMouseEnter",["mouseout","mouseover"]);Du("onMouseLeave",["mouseout","mouseover"]);Du("onPointerEnter",["pointerout","pointerover"]);Du("onPointerLeave",["pointerout","pointerover"]);Vd("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Vd("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Vd("onBeforeInput",["compositionend","keypress","textInput","paste"]);Vd("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Vd("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Vd("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Mp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Wnt=new Set("cancel close invalid load scroll toggle".split(" ").concat(Mp));function IF(s,r,a){var d=s.type||"unknown-event";s.currentTarget=a,Bet(d,r,void 0,s),s.currentTarget=null}function A3(s,r){r=(r&4)!==0;for(var a=0;a<s.length;a++){var d=s[a],h=d.event;d=d.listeners;t:{var f=void 0;if(r)for(var g=d.length-1;0<=g;g--){var v=d[g],y=v.instance,C=v.currentTarget;if(v=v.listener,y!==f&&h.isPropagationStopped())break t;IF(h,v,C),f=y}else for(g=0;g<d.length;g++){if(v=d[g],y=v.instance,C=v.currentTarget,v=v.listener,y!==f&&h.isPropagationStopped())break t;IF(h,v,C),f=y}}}if(OE)throw s=WC,OE=!1,WC=null,s}function wn(s,r){var a=r[ZC];a===void 0&&(a=r[ZC]=new Set);var d=s+"__bubble";a.has(d)||(O3(r,s,2,!1),a.add(d))}function sC(s,r,a){var d=0;r&&(d|=4),O3(a,s,d,r)}var Wg="_reactListening"+Math.random().toString(36).slice(2);function pf(s){if(!s[Wg]){s[Wg]=!0,xj.forEach(function(a){a!=="selectionchange"&&(Wnt.has(a)||sC(a,!1,s),sC(a,!0,s))});var r=s.nodeType===9?s:s.ownerDocument;r===null||r[Wg]||(r[Wg]=!0,sC("selectionchange",!1,r))}}function O3(s,r,a,d){switch(h3(r)){case 1:var h=nnt;break;case 4:h=int;break;default:h=zb}a=h.bind(null,r,a,s),h=void 0,!jC||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(h=!0),d?h!==void 0?s.addEventListener(r,a,{capture:!0,passive:h}):s.addEventListener(r,a,!0):h!==void 0?s.addEventListener(r,a,{passive:h}):s.addEventListener(r,a,!1)}function oC(s,r,a,d,h){var f=d;if(!(r&1)&&!(r&2)&&d!==null)t:for(;;){if(d===null)return;var g=d.tag;if(g===3||g===4){var v=d.stateNode.containerInfo;if(v===h||v.nodeType===8&&v.parentNode===h)break;if(g===4)for(g=d.return;g!==null;){var y=g.tag;if((y===3||y===4)&&(y=g.stateNode.containerInfo,y===h||y.nodeType===8&&y.parentNode===h))return;g=g.return}for(;v!==null;){if(g=Cd(v),g===null)return;if(y=g.tag,y===5||y===6){d=f=g;continue t}v=v.parentNode}}d=d.return}Zj(function(){var C=f,O=jb(a),k=[];t:{var M=w3.get(s);if(M!==void 0){var j=Yb,z=s;switch(s){case"keypress":if(mE(a)===0)break t;case"keydown":case"keyup":j=Ent;break;case"focusin":z="focus",j=$R;break;case"focusout":z="blur",j=$R;break;case"beforeblur":case"afterblur":j=$R;break;case"click":if(a.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":j=fF;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":j=ont;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":j=Tnt;break;case R3:case C3:case b3:j=dnt;break;case I3:j=Rnt;break;case"scroll":j=rnt;break;case"wheel":j=bnt;break;case"copy":case"cut":case"paste":j=unt;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":j=_F}var Y=(r&4)!==0,Z=!Y&&s==="scroll",H=Y?M!==null?M+"Capture":null:M;Y=[];for(var K=C,q;K!==null;){q=K;var it=q.stateNode;if(q.tag===5&&it!==null&&(q=it,H!==null&&(it=af(K,H),it!=null&&Y.push(ff(K,it,q)))),Z)break;K=K.return}0<Y.length&&(M=new j(M,z,null,a,O),k.push({event:M,listeners:Y}))}}if(!(r&7)){t:{if(M=s==="mouseover"||s==="pointerover",j=s==="mouseout"||s==="pointerout",M&&a!==FC&&(z=a.relatedTarget||a.fromElement)&&(Cd(z)||z[ga]))break t;if((j||M)&&(M=O.window===O?O:(M=O.ownerDocument)?M.defaultView||M.parentWindow:window,j?(z=a.relatedTarget||a.toElement,j=C,z=z?Cd(z):null,z!==null&&(Z=Fd(z),z!==Z||z.tag!==5&&z.tag!==6)&&(z=null)):(j=null,z=C),j!==z)){if(Y=fF,it="onMouseLeave",H="onMouseEnter",K="mouse",(s==="pointerout"||s==="pointerover")&&(Y=_F,it="onPointerLeave",H="onPointerEnter",K="pointer"),Z=j==null?M:_u(j),q=z==null?M:_u(z),M=new Y(it,K+"leave",j,a,O),M.target=Z,M.relatedTarget=q,it=null,Cd(O)===C&&(Y=new Y(H,K+"enter",z,a,O),Y.target=q,Y.relatedTarget=Z,it=Y),Z=it,j&&z)e:{for(Y=j,H=z,K=0,q=Y;q;q=cu(q))K++;for(q=0,it=H;it;it=cu(it))q++;for(;0<K-q;)Y=cu(Y),K--;for(;0<q-K;)H=cu(H),q--;for(;K--;){if(Y===H||H!==null&&Y===H.alternate)break e;Y=cu(Y),H=cu(H)}Y=null}else Y=null;j!==null&&wF(k,M,j,Y,!1),z!==null&&Z!==null&&wF(k,Z,z,Y,!0)}}t:{if(M=C?_u(C):window,j=M.nodeName&&M.nodeName.toLowerCase(),j==="select"||j==="input"&&M.type==="file")var ot=Pnt;else if(SF(M))if(E3)ot=xnt;else{ot=Lnt;var _t=knt}else(j=M.nodeName)&&j.toLowerCase()==="input"&&(M.type==="checkbox"||M.type==="radio")&&(ot=Mnt);if(ot&&(ot=ot(s,C))){g3(k,ot,a,O);break t}_t&&_t(s,M,C),s==="focusout"&&(_t=M._wrapperState)&&_t.controlled&&M.type==="number"&&LC(M,"number",M.value)}switch(_t=C?_u(C):window,s){case"focusin":(SF(_t)||_t.contentEditable==="true")&&(fu=_t,KC=C,qp=null);break;case"focusout":qp=KC=fu=null;break;case"mousedown":YC=!0;break;case"contextmenu":case"mouseup":case"dragend":YC=!1,CF(k,a,O);break;case"selectionchange":if(Fnt)break;case"keydown":case"keyup":CF(k,a,O)}var ft;if(Xb)t:{switch(s){case"compositionstart":var lt="onCompositionStart";break t;case"compositionend":lt="onCompositionEnd";break t;case"compositionupdate":lt="onCompositionUpdate";break t}lt=void 0}else pu?m3(s,a)&&(lt="onCompositionEnd"):s==="keydown"&&a.keyCode===229&&(lt="onCompositionStart");lt&&(f3&&a.locale!=="ko"&&(pu||lt!=="onCompositionStart"?lt==="onCompositionEnd"&&pu&&(ft=p3()):(cc=O,Kb="value"in cc?cc.value:cc.textContent,pu=!0)),_t=LE(C,lt),0<_t.length&&(lt=new mF(lt,s,null,a,O),k.push({event:lt,listeners:_t}),ft?lt.data=ft:(ft=_3(a),ft!==null&&(lt.data=ft)))),(ft=wnt?Ant(s,a):Ont(s,a))&&(C=LE(C,"onBeforeInput"),0<C.length&&(O=new mF("onBeforeInput","beforeinput",null,a,O),k.push({event:O,listeners:C}),O.data=ft))}A3(k,r)})}function ff(s,r,a){return{instance:s,listener:r,currentTarget:a}}function LE(s,r){for(var a=r+"Capture",d=[];s!==null;){var h=s,f=h.stateNode;h.tag===5&&f!==null&&(h=f,f=af(s,a),f!=null&&d.unshift(ff(s,f,h)),f=af(s,r),f!=null&&d.push(ff(s,f,h))),s=s.return}return d}function cu(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function wF(s,r,a,d,h){for(var f=r._reactName,g=[];a!==null&&a!==d;){var v=a,y=v.alternate,C=v.stateNode;if(y!==null&&y===d)break;v.tag===5&&C!==null&&(v=C,h?(y=af(a,f),y!=null&&g.unshift(ff(a,y,v))):h||(y=af(a,f),y!=null&&g.push(ff(a,y,v)))),a=a.return}g.length!==0&&s.push({event:r,listeners:g})}var Gnt=/\r\n?/g,Hnt=/\u0000|\uFFFD/g;function AF(s){return(typeof s=="string"?s:""+s).replace(Gnt,`
`).replace(Hnt,"")}function Gg(s,r,a){if(r=AF(r),AF(s)!==r&&a)throw Error(wt(425))}function ME(){}var qC=null,XC=null;function JC(s,r){return s==="textarea"||s==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var QC=typeof setTimeout=="function"?setTimeout:void 0,znt=typeof clearTimeout=="function"?clearTimeout:void 0,OF=typeof Promise=="function"?Promise:void 0,Knt=typeof queueMicrotask=="function"?queueMicrotask:typeof OF<"u"?function(s){return OF.resolve(null).then(s).catch(Ynt)}:QC;function Ynt(s){setTimeout(function(){throw s})}function aC(s,r){var a=r,d=0;do{var h=a.nextSibling;if(s.removeChild(a),h&&h.nodeType===8)if(a=h.data,a==="/$"){if(d===0){s.removeChild(h),lf(r);return}d--}else a!=="$"&&a!=="$?"&&a!=="$!"||d++;a=h}while(a);lf(r)}function _c(s){for(;s!=null;s=s.nextSibling){var r=s.nodeType;if(r===1||r===3)break;if(r===8){if(r=s.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return s}function NF(s){s=s.previousSibling;for(var r=0;s;){if(s.nodeType===8){var a=s.data;if(a==="$"||a==="$!"||a==="$?"){if(r===0)return s;r--}else a==="/$"&&r++}s=s.previousSibling}return null}var Gu=Math.random().toString(36).slice(2),Bo="__reactFiber$"+Gu,mf="__reactProps$"+Gu,ga="__reactContainer$"+Gu,ZC="__reactEvents$"+Gu,qnt="__reactListeners$"+Gu,Xnt="__reactHandles$"+Gu;function Cd(s){var r=s[Bo];if(r)return r;for(var a=s.parentNode;a;){if(r=a[ga]||a[Bo]){if(a=r.alternate,r.child!==null||a!==null&&a.child!==null)for(s=NF(s);s!==null;){if(a=s[Bo])return a;s=NF(s)}return r}s=a,a=s.parentNode}return null}function Nf(s){return s=s[Bo]||s[ga],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function _u(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(wt(33))}function pS(s){return s[mf]||null}var $C=[],gu=-1;function Ic(s){return{current:s}}function An(s){0>gu||(s.current=$C[gu],$C[gu]=null,gu--)}function Cn(s,r){gu++,$C[gu]=s.current,s.current=r}var Rc={},$i=Ic(Rc),Dr=Ic(!1),Dd=Rc;function Pu(s,r){var a=s.type.contextTypes;if(!a)return Rc;var d=s.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===r)return d.__reactInternalMemoizedMaskedChildContext;var h={},f;for(f in a)h[f]=r[f];return d&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=r,s.__reactInternalMemoizedMaskedChildContext=h),h}function Pr(s){return s=s.childContextTypes,s!=null}function xE(){An(Dr),An($i)}function DF(s,r,a){if($i.current!==Rc)throw Error(wt(168));Cn($i,r),Cn(Dr,a)}function N3(s,r,a){var d=s.stateNode;if(r=r.childContextTypes,typeof d.getChildContext!="function")return a;d=d.getChildContext();for(var h in d)if(!(h in r))throw Error(wt(108,ket(s)||"Unknown",h));return Gn({},a,d)}function UE(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||Rc,Dd=$i.current,Cn($i,s),Cn(Dr,Dr.current),!0}function PF(s,r,a){var d=s.stateNode;if(!d)throw Error(wt(169));a?(s=N3(s,r,Dd),d.__reactInternalMemoizedMergedChildContext=s,An(Dr),An($i),Cn($i,s)):An(Dr),Cn(Dr,a)}var la=null,fS=!1,cC=!1;function D3(s){la===null?la=[s]:la.push(s)}function Jnt(s){fS=!0,D3(s)}function wc(){if(!cC&&la!==null){cC=!0;var s=0,r=un;try{var a=la;for(un=1;s<a.length;s++){var d=a[s];do d=d(!0);while(d!==null)}la=null,fS=!1}catch(h){throw la!==null&&(la=la.slice(s+1)),n3(Wb,wc),h}finally{un=r,cC=!1}}return null}var Eu=[],Su=0,VE=null,FE=0,As=[],Os=0,Pd=null,ha=1,pa="";function Sd(s,r){Eu[Su++]=FE,Eu[Su++]=VE,VE=s,FE=r}function P3(s,r,a){As[Os++]=ha,As[Os++]=pa,As[Os++]=Pd,Pd=s;var d=ha;s=pa;var h=32-co(d)-1;d&=~(1<<h),a+=1;var f=32-co(r)+h;if(30<f){var g=h-h%5;f=(d&(1<<g)-1).toString(32),d>>=g,h-=g,ha=1<<32-co(r)+h|a<<h|d,pa=f+s}else ha=1<<f|a<<h|d,pa=s}function Qb(s){s.return!==null&&(Sd(s,1),P3(s,1,0))}function Zb(s){for(;s===VE;)VE=Eu[--Su],Eu[Su]=null,FE=Eu[--Su],Eu[Su]=null;for(;s===Pd;)Pd=As[--Os],As[Os]=null,pa=As[--Os],As[Os]=null,ha=As[--Os],As[Os]=null}var $r=null,Qr=null,kn=!1,ao=null;function k3(s,r){var a=Ns(5,null,null,0);a.elementType="DELETED",a.stateNode=r,a.return=s,r=s.deletions,r===null?(s.deletions=[a],s.flags|=16):r.push(a)}function kF(s,r){switch(s.tag){case 5:var a=s.type;return r=r.nodeType!==1||a.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(s.stateNode=r,$r=s,Qr=_c(r.firstChild),!0):!1;case 6:return r=s.pendingProps===""||r.nodeType!==3?null:r,r!==null?(s.stateNode=r,$r=s,Qr=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(a=Pd!==null?{id:ha,overflow:pa}:null,s.memoizedState={dehydrated:r,treeContext:a,retryLane:1073741824},a=Ns(18,null,null,0),a.stateNode=r,a.return=s,s.child=a,$r=s,Qr=null,!0):!1;default:return!1}}function tb(s){return(s.mode&1)!==0&&(s.flags&128)===0}function eb(s){if(kn){var r=Qr;if(r){var a=r;if(!kF(s,r)){if(tb(s))throw Error(wt(418));r=_c(a.nextSibling);var d=$r;r&&kF(s,r)?k3(d,a):(s.flags=s.flags&-4097|2,kn=!1,$r=s)}}else{if(tb(s))throw Error(wt(418));s.flags=s.flags&-4097|2,kn=!1,$r=s}}}function LF(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;$r=s}function Hg(s){if(s!==$r)return!1;if(!kn)return LF(s),kn=!0,!1;var r;if((r=s.tag!==3)&&!(r=s.tag!==5)&&(r=s.type,r=r!=="head"&&r!=="body"&&!JC(s.type,s.memoizedProps)),r&&(r=Qr)){if(tb(s))throw L3(),Error(wt(418));for(;r;)k3(s,r),r=_c(r.nextSibling)}if(LF(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(wt(317));t:{for(s=s.nextSibling,r=0;s;){if(s.nodeType===8){var a=s.data;if(a==="/$"){if(r===0){Qr=_c(s.nextSibling);break t}r--}else a!=="$"&&a!=="$!"&&a!=="$?"||r++}s=s.nextSibling}Qr=null}}else Qr=$r?_c(s.stateNode.nextSibling):null;return!0}function L3(){for(var s=Qr;s;)s=_c(s.nextSibling)}function ku(){Qr=$r=null,kn=!1}function $b(s){ao===null?ao=[s]:ao.push(s)}var Qnt=Ta.ReactCurrentBatchConfig;function Cp(s,r,a){if(s=a.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(wt(309));var d=a.stateNode}if(!d)throw Error(wt(147,s));var h=d,f=""+s;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===f?r.ref:(r=function(g){var v=h.refs;g===null?delete v[f]:v[f]=g},r._stringRef=f,r)}if(typeof s!="string")throw Error(wt(284));if(!a._owner)throw Error(wt(290,s))}return s}function zg(s,r){throw s=Object.prototype.toString.call(r),Error(wt(31,s==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":s))}function MF(s){var r=s._init;return r(s._payload)}function M3(s){function r(H,K){if(s){var q=H.deletions;q===null?(H.deletions=[K],H.flags|=16):q.push(K)}}function a(H,K){if(!s)return null;for(;K!==null;)r(H,K),K=K.sibling;return null}function d(H,K){for(H=new Map;K!==null;)K.key!==null?H.set(K.key,K):H.set(K.index,K),K=K.sibling;return H}function h(H,K){return H=vc(H,K),H.index=0,H.sibling=null,H}function f(H,K,q){return H.index=q,s?(q=H.alternate,q!==null?(q=q.index,q<K?(H.flags|=2,K):q):(H.flags|=2,K)):(H.flags|=1048576,K)}function g(H){return s&&H.alternate===null&&(H.flags|=2),H}function v(H,K,q,it){return K===null||K.tag!==6?(K=mC(q,H.mode,it),K.return=H,K):(K=h(K,q),K.return=H,K)}function y(H,K,q,it){var ot=q.type;return ot===hu?O(H,K,q.props.children,it,q.key):K!==null&&(K.elementType===ot||typeof ot=="object"&&ot!==null&&ot.$$typeof===rc&&MF(ot)===K.type)?(it=h(K,q.props),it.ref=Cp(H,K,q),it.return=H,it):(it=yE(q.type,q.key,q.props,null,H.mode,it),it.ref=Cp(H,K,q),it.return=H,it)}function C(H,K,q,it){return K===null||K.tag!==4||K.stateNode.containerInfo!==q.containerInfo||K.stateNode.implementation!==q.implementation?(K=_C(q,H.mode,it),K.return=H,K):(K=h(K,q.children||[]),K.return=H,K)}function O(H,K,q,it,ot){return K===null||K.tag!==7?(K=Od(q,H.mode,it,ot),K.return=H,K):(K=h(K,q),K.return=H,K)}function k(H,K,q){if(typeof K=="string"&&K!==""||typeof K=="number")return K=mC(""+K,H.mode,q),K.return=H,K;if(typeof K=="object"&&K!==null){switch(K.$$typeof){case Lg:return q=yE(K.type,K.key,K.props,null,H.mode,q),q.ref=Cp(H,null,K),q.return=H,q;case uu:return K=_C(K,H.mode,q),K.return=H,K;case rc:var it=K._init;return k(H,it(K._payload),q)}if(kp(K)||Sp(K))return K=Od(K,H.mode,q,null),K.return=H,K;zg(H,K)}return null}function M(H,K,q,it){var ot=K!==null?K.key:null;if(typeof q=="string"&&q!==""||typeof q=="number")return ot!==null?null:v(H,K,""+q,it);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case Lg:return q.key===ot?y(H,K,q,it):null;case uu:return q.key===ot?C(H,K,q,it):null;case rc:return ot=q._init,M(H,K,ot(q._payload),it)}if(kp(q)||Sp(q))return ot!==null?null:O(H,K,q,it,null);zg(H,q)}return null}function j(H,K,q,it,ot){if(typeof it=="string"&&it!==""||typeof it=="number")return H=H.get(q)||null,v(K,H,""+it,ot);if(typeof it=="object"&&it!==null){switch(it.$$typeof){case Lg:return H=H.get(it.key===null?q:it.key)||null,y(K,H,it,ot);case uu:return H=H.get(it.key===null?q:it.key)||null,C(K,H,it,ot);case rc:var _t=it._init;return j(H,K,q,_t(it._payload),ot)}if(kp(it)||Sp(it))return H=H.get(q)||null,O(K,H,it,ot,null);zg(K,it)}return null}function z(H,K,q,it){for(var ot=null,_t=null,ft=K,lt=K=0,kt=null;ft!==null&&lt<q.length;lt++){ft.index>lt?(kt=ft,ft=null):kt=ft.sibling;var At=M(H,ft,q[lt],it);if(At===null){ft===null&&(ft=kt);break}s&&ft&&At.alternate===null&&r(H,ft),K=f(At,K,lt),_t===null?ot=At:_t.sibling=At,_t=At,ft=kt}if(lt===q.length)return a(H,ft),kn&&Sd(H,lt),ot;if(ft===null){for(;lt<q.length;lt++)ft=k(H,q[lt],it),ft!==null&&(K=f(ft,K,lt),_t===null?ot=ft:_t.sibling=ft,_t=ft);return kn&&Sd(H,lt),ot}for(ft=d(H,ft);lt<q.length;lt++)kt=j(ft,H,lt,q[lt],it),kt!==null&&(s&&kt.alternate!==null&&ft.delete(kt.key===null?lt:kt.key),K=f(kt,K,lt),_t===null?ot=kt:_t.sibling=kt,_t=kt);return s&&ft.forEach(function(qt){return r(H,qt)}),kn&&Sd(H,lt),ot}function Y(H,K,q,it){var ot=Sp(q);if(typeof ot!="function")throw Error(wt(150));if(q=ot.call(q),q==null)throw Error(wt(151));for(var _t=ot=null,ft=K,lt=K=0,kt=null,At=q.next();ft!==null&&!At.done;lt++,At=q.next()){ft.index>lt?(kt=ft,ft=null):kt=ft.sibling;var qt=M(H,ft,At.value,it);if(qt===null){ft===null&&(ft=kt);break}s&&ft&&qt.alternate===null&&r(H,ft),K=f(qt,K,lt),_t===null?ot=qt:_t.sibling=qt,_t=qt,ft=kt}if(At.done)return a(H,ft),kn&&Sd(H,lt),ot;if(ft===null){for(;!At.done;lt++,At=q.next())At=k(H,At.value,it),At!==null&&(K=f(At,K,lt),_t===null?ot=At:_t.sibling=At,_t=At);return kn&&Sd(H,lt),ot}for(ft=d(H,ft);!At.done;lt++,At=q.next())At=j(ft,H,lt,At.value,it),At!==null&&(s&&At.alternate!==null&&ft.delete(At.key===null?lt:At.key),K=f(At,K,lt),_t===null?ot=At:_t.sibling=At,_t=At);return s&&ft.forEach(function(vt){return r(H,vt)}),kn&&Sd(H,lt),ot}function Z(H,K,q,it){if(typeof q=="object"&&q!==null&&q.type===hu&&q.key===null&&(q=q.props.children),typeof q=="object"&&q!==null){switch(q.$$typeof){case Lg:t:{for(var ot=q.key,_t=K;_t!==null;){if(_t.key===ot){if(ot=q.type,ot===hu){if(_t.tag===7){a(H,_t.sibling),K=h(_t,q.props.children),K.return=H,H=K;break t}}else if(_t.elementType===ot||typeof ot=="object"&&ot!==null&&ot.$$typeof===rc&&MF(ot)===_t.type){a(H,_t.sibling),K=h(_t,q.props),K.ref=Cp(H,_t,q),K.return=H,H=K;break t}a(H,_t);break}else r(H,_t);_t=_t.sibling}q.type===hu?(K=Od(q.props.children,H.mode,it,q.key),K.return=H,H=K):(it=yE(q.type,q.key,q.props,null,H.mode,it),it.ref=Cp(H,K,q),it.return=H,H=it)}return g(H);case uu:t:{for(_t=q.key;K!==null;){if(K.key===_t)if(K.tag===4&&K.stateNode.containerInfo===q.containerInfo&&K.stateNode.implementation===q.implementation){a(H,K.sibling),K=h(K,q.children||[]),K.return=H,H=K;break t}else{a(H,K);break}else r(H,K);K=K.sibling}K=_C(q,H.mode,it),K.return=H,H=K}return g(H);case rc:return _t=q._init,Z(H,K,_t(q._payload),it)}if(kp(q))return z(H,K,q,it);if(Sp(q))return Y(H,K,q,it);zg(H,q)}return typeof q=="string"&&q!==""||typeof q=="number"?(q=""+q,K!==null&&K.tag===6?(a(H,K.sibling),K=h(K,q),K.return=H,H=K):(a(H,K),K=mC(q,H.mode,it),K.return=H,H=K),g(H)):a(H,K)}return Z}var Lu=M3(!0),x3=M3(!1),BE=Ic(null),jE=null,vu=null,tI=null;function eI(){tI=vu=jE=null}function nI(s){var r=BE.current;An(BE),s._currentValue=r}function nb(s,r,a){for(;s!==null;){var d=s.alternate;if((s.childLanes&r)!==r?(s.childLanes|=r,d!==null&&(d.childLanes|=r)):d!==null&&(d.childLanes&r)!==r&&(d.childLanes|=r),s===a)break;s=s.return}}function wu(s,r){jE=s,tI=vu=null,s=s.dependencies,s!==null&&s.firstContext!==null&&(s.lanes&r&&(Nr=!0),s.firstContext=null)}function Ms(s){var r=s._currentValue;if(tI!==s)if(s={context:s,memoizedValue:r,next:null},vu===null){if(jE===null)throw Error(wt(308));vu=s,jE.dependencies={lanes:0,firstContext:s}}else vu=vu.next=s;return r}var bd=null;function iI(s){bd===null?bd=[s]:bd.push(s)}function U3(s,r,a,d){var h=r.interleaved;return h===null?(a.next=a,iI(r)):(a.next=h.next,h.next=a),r.interleaved=a,Ea(s,d)}function Ea(s,r){s.lanes|=r;var a=s.alternate;for(a!==null&&(a.lanes|=r),a=s,s=s.return;s!==null;)s.childLanes|=r,a=s.alternate,a!==null&&(a.childLanes|=r),a=s,s=s.return;return a.tag===3?a.stateNode:null}var sc=!1;function rI(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function V3(s,r){s=s.updateQueue,r.updateQueue===s&&(r.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function ma(s,r){return{eventTime:s,lane:r,tag:0,payload:null,callback:null,next:null}}function gc(s,r,a){var d=s.updateQueue;if(d===null)return null;if(d=d.shared,Qe&2){var h=d.pending;return h===null?r.next=r:(r.next=h.next,h.next=r),d.pending=r,Ea(s,a)}return h=d.interleaved,h===null?(r.next=r,iI(d)):(r.next=h.next,h.next=r),d.interleaved=r,Ea(s,a)}function _E(s,r,a){if(r=r.updateQueue,r!==null&&(r=r.shared,(a&4194240)!==0)){var d=r.lanes;d&=s.pendingLanes,a|=d,r.lanes=a,Gb(s,a)}}function xF(s,r){var a=s.updateQueue,d=s.alternate;if(d!==null&&(d=d.updateQueue,a===d)){var h=null,f=null;if(a=a.firstBaseUpdate,a!==null){do{var g={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};f===null?h=f=g:f=f.next=g,a=a.next}while(a!==null);f===null?h=f=r:f=f.next=r}else h=f=r;a={baseState:d.baseState,firstBaseUpdate:h,lastBaseUpdate:f,shared:d.shared,effects:d.effects},s.updateQueue=a;return}s=a.lastBaseUpdate,s===null?a.firstBaseUpdate=r:s.next=r,a.lastBaseUpdate=r}function WE(s,r,a,d){var h=s.updateQueue;sc=!1;var f=h.firstBaseUpdate,g=h.lastBaseUpdate,v=h.shared.pending;if(v!==null){h.shared.pending=null;var y=v,C=y.next;y.next=null,g===null?f=C:g.next=C,g=y;var O=s.alternate;O!==null&&(O=O.updateQueue,v=O.lastBaseUpdate,v!==g&&(v===null?O.firstBaseUpdate=C:v.next=C,O.lastBaseUpdate=y))}if(f!==null){var k=h.baseState;g=0,O=C=y=null,v=f;do{var M=v.lane,j=v.eventTime;if((d&M)===M){O!==null&&(O=O.next={eventTime:j,lane:0,tag:v.tag,payload:v.payload,callback:v.callback,next:null});t:{var z=s,Y=v;switch(M=r,j=a,Y.tag){case 1:if(z=Y.payload,typeof z=="function"){k=z.call(j,k,M);break t}k=z;break t;case 3:z.flags=z.flags&-65537|128;case 0:if(z=Y.payload,M=typeof z=="function"?z.call(j,k,M):z,M==null)break t;k=Gn({},k,M);break t;case 2:sc=!0}}v.callback!==null&&v.lane!==0&&(s.flags|=64,M=h.effects,M===null?h.effects=[v]:M.push(v))}else j={eventTime:j,lane:M,tag:v.tag,payload:v.payload,callback:v.callback,next:null},O===null?(C=O=j,y=k):O=O.next=j,g|=M;if(v=v.next,v===null){if(v=h.shared.pending,v===null)break;M=v,v=M.next,M.next=null,h.lastBaseUpdate=M,h.shared.pending=null}}while(1);if(O===null&&(y=k),h.baseState=y,h.firstBaseUpdate=C,h.lastBaseUpdate=O,r=h.shared.interleaved,r!==null){h=r;do g|=h.lane,h=h.next;while(h!==r)}else f===null&&(h.shared.lanes=0);Ld|=g,s.lanes=g,s.memoizedState=k}}function UF(s,r,a){if(s=r.effects,r.effects=null,s!==null)for(r=0;r<s.length;r++){var d=s[r],h=d.callback;if(h!==null){if(d.callback=null,d=a,typeof h!="function")throw Error(wt(191,h));h.call(d)}}}var Df={},Wo=Ic(Df),_f=Ic(Df),gf=Ic(Df);function Id(s){if(s===Df)throw Error(wt(174));return s}function sI(s,r){switch(Cn(gf,r),Cn(_f,s),Cn(Wo,Df),s=r.nodeType,s){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:xC(null,"");break;default:s=s===8?r.parentNode:r,r=s.namespaceURI||null,s=s.tagName,r=xC(r,s)}An(Wo),Cn(Wo,r)}function Mu(){An(Wo),An(_f),An(gf)}function F3(s){Id(gf.current);var r=Id(Wo.current),a=xC(r,s.type);r!==a&&(Cn(_f,s),Cn(Wo,a))}function oI(s){_f.current===s&&(An(Wo),An(_f))}var Bn=Ic(0);function GE(s){for(var r=s;r!==null;){if(r.tag===13){var a=r.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if(r.flags&128)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break;for(;r.sibling===null;){if(r.return===null||r.return===s)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var dC=[];function aI(){for(var s=0;s<dC.length;s++)dC[s]._workInProgressVersionPrimary=null;dC.length=0}var gE=Ta.ReactCurrentDispatcher,lC=Ta.ReactCurrentBatchConfig,kd=0,Wn=null,_i=null,bi=null,HE=!1,Xp=!1,Ef=0,Znt=0;function qi(){throw Error(wt(321))}function cI(s,r){if(r===null)return!1;for(var a=0;a<r.length&&a<s.length;a++)if(!uo(s[a],r[a]))return!1;return!0}function dI(s,r,a,d,h,f){if(kd=f,Wn=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,gE.current=s===null||s.memoizedState===null?nit:iit,s=a(d,h),Xp){f=0;do{if(Xp=!1,Ef=0,25<=f)throw Error(wt(301));f+=1,bi=_i=null,r.updateQueue=null,gE.current=rit,s=a(d,h)}while(Xp)}if(gE.current=zE,r=_i!==null&&_i.next!==null,kd=0,bi=_i=Wn=null,HE=!1,r)throw Error(wt(300));return s}function lI(){var s=Ef!==0;return Ef=0,s}function Vo(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bi===null?Wn.memoizedState=bi=s:bi=bi.next=s,bi}function xs(){if(_i===null){var s=Wn.alternate;s=s!==null?s.memoizedState:null}else s=_i.next;var r=bi===null?Wn.memoizedState:bi.next;if(r!==null)bi=r,_i=s;else{if(s===null)throw Error(wt(310));_i=s,s={memoizedState:_i.memoizedState,baseState:_i.baseState,baseQueue:_i.baseQueue,queue:_i.queue,next:null},bi===null?Wn.memoizedState=bi=s:bi=bi.next=s}return bi}function Sf(s,r){return typeof r=="function"?r(s):r}function uC(s){var r=xs(),a=r.queue;if(a===null)throw Error(wt(311));a.lastRenderedReducer=s;var d=_i,h=d.baseQueue,f=a.pending;if(f!==null){if(h!==null){var g=h.next;h.next=f.next,f.next=g}d.baseQueue=h=f,a.pending=null}if(h!==null){f=h.next,d=d.baseState;var v=g=null,y=null,C=f;do{var O=C.lane;if((kd&O)===O)y!==null&&(y=y.next={lane:0,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null}),d=C.hasEagerState?C.eagerState:s(d,C.action);else{var k={lane:O,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null};y===null?(v=y=k,g=d):y=y.next=k,Wn.lanes|=O,Ld|=O}C=C.next}while(C!==null&&C!==f);y===null?g=d:y.next=v,uo(d,r.memoizedState)||(Nr=!0),r.memoizedState=d,r.baseState=g,r.baseQueue=y,a.lastRenderedState=d}if(s=a.interleaved,s!==null){h=s;do f=h.lane,Wn.lanes|=f,Ld|=f,h=h.next;while(h!==s)}else h===null&&(a.lanes=0);return[r.memoizedState,a.dispatch]}function hC(s){var r=xs(),a=r.queue;if(a===null)throw Error(wt(311));a.lastRenderedReducer=s;var d=a.dispatch,h=a.pending,f=r.memoizedState;if(h!==null){a.pending=null;var g=h=h.next;do f=s(f,g.action),g=g.next;while(g!==h);uo(f,r.memoizedState)||(Nr=!0),r.memoizedState=f,r.baseQueue===null&&(r.baseState=f),a.lastRenderedState=f}return[f,d]}function B3(){}function j3(s,r){var a=Wn,d=xs(),h=r(),f=!uo(d.memoizedState,h);if(f&&(d.memoizedState=h,Nr=!0),d=d.queue,uI(H3.bind(null,a,d,s),[s]),d.getSnapshot!==r||f||bi!==null&&bi.memoizedState.tag&1){if(a.flags|=2048,vf(9,G3.bind(null,a,d,h,r),void 0,null),wi===null)throw Error(wt(349));kd&30||W3(a,r,h)}return h}function W3(s,r,a){s.flags|=16384,s={getSnapshot:r,value:a},r=Wn.updateQueue,r===null?(r={lastEffect:null,stores:null},Wn.updateQueue=r,r.stores=[s]):(a=r.stores,a===null?r.stores=[s]:a.push(s))}function G3(s,r,a,d){r.value=a,r.getSnapshot=d,z3(r)&&K3(s)}function H3(s,r,a){return a(function(){z3(r)&&K3(s)})}function z3(s){var r=s.getSnapshot;s=s.value;try{var a=r();return!uo(s,a)}catch{return!0}}function K3(s){var r=Ea(s,1);r!==null&&lo(r,s,1,-1)}function VF(s){var r=Vo();return typeof s=="function"&&(s=s()),r.memoizedState=r.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Sf,lastRenderedState:s},r.queue=s,s=s.dispatch=eit.bind(null,Wn,s),[r.memoizedState,s]}function vf(s,r,a,d){return s={tag:s,create:r,destroy:a,deps:d,next:null},r=Wn.updateQueue,r===null?(r={lastEffect:null,stores:null},Wn.updateQueue=r,r.lastEffect=s.next=s):(a=r.lastEffect,a===null?r.lastEffect=s.next=s:(d=a.next,a.next=s,s.next=d,r.lastEffect=s)),s}function Y3(){return xs().memoizedState}function EE(s,r,a,d){var h=Vo();Wn.flags|=s,h.memoizedState=vf(1|r,a,void 0,d===void 0?null:d)}function mS(s,r,a,d){var h=xs();d=d===void 0?null:d;var f=void 0;if(_i!==null){var g=_i.memoizedState;if(f=g.destroy,d!==null&&cI(d,g.deps)){h.memoizedState=vf(r,a,f,d);return}}Wn.flags|=s,h.memoizedState=vf(1|r,a,f,d)}function FF(s,r){return EE(8390656,8,s,r)}function uI(s,r){return mS(2048,8,s,r)}function q3(s,r){return mS(4,2,s,r)}function X3(s,r){return mS(4,4,s,r)}function J3(s,r){if(typeof r=="function")return s=s(),r(s),function(){r(null)};if(r!=null)return s=s(),r.current=s,function(){r.current=null}}function Q3(s,r,a){return a=a!=null?a.concat([s]):null,mS(4,4,J3.bind(null,r,s),a)}function hI(){}function Z3(s,r){var a=xs();r=r===void 0?null:r;var d=a.memoizedState;return d!==null&&r!==null&&cI(r,d[1])?d[0]:(a.memoizedState=[s,r],s)}function $3(s,r){var a=xs();r=r===void 0?null:r;var d=a.memoizedState;return d!==null&&r!==null&&cI(r,d[1])?d[0]:(s=s(),a.memoizedState=[s,r],s)}function t5(s,r,a){return kd&21?(uo(a,r)||(a=s3(),Wn.lanes|=a,Ld|=a,s.baseState=!0),r):(s.baseState&&(s.baseState=!1,Nr=!0),s.memoizedState=a)}function $nt(s,r){var a=un;un=a!==0&&4>a?a:4,s(!0);var d=lC.transition;lC.transition={};try{s(!1),r()}finally{un=a,lC.transition=d}}function e5(){return xs().memoizedState}function tit(s,r,a){var d=Sc(s);if(a={lane:d,action:a,hasEagerState:!1,eagerState:null,next:null},n5(s))i5(r,a);else if(a=U3(s,r,a,d),a!==null){var h=cr();lo(a,s,d,h),r5(a,r,d)}}function eit(s,r,a){var d=Sc(s),h={lane:d,action:a,hasEagerState:!1,eagerState:null,next:null};if(n5(s))i5(r,h);else{var f=s.alternate;if(s.lanes===0&&(f===null||f.lanes===0)&&(f=r.lastRenderedReducer,f!==null))try{var g=r.lastRenderedState,v=f(g,a);if(h.hasEagerState=!0,h.eagerState=v,uo(v,g)){var y=r.interleaved;y===null?(h.next=h,iI(r)):(h.next=y.next,y.next=h),r.interleaved=h;return}}catch{}finally{}a=U3(s,r,h,d),a!==null&&(h=cr(),lo(a,s,d,h),r5(a,r,d))}}function n5(s){var r=s.alternate;return s===Wn||r!==null&&r===Wn}function i5(s,r){Xp=HE=!0;var a=s.pending;a===null?r.next=r:(r.next=a.next,a.next=r),s.pending=r}function r5(s,r,a){if(a&4194240){var d=r.lanes;d&=s.pendingLanes,a|=d,r.lanes=a,Gb(s,a)}}var zE={readContext:Ms,useCallback:qi,useContext:qi,useEffect:qi,useImperativeHandle:qi,useInsertionEffect:qi,useLayoutEffect:qi,useMemo:qi,useReducer:qi,useRef:qi,useState:qi,useDebugValue:qi,useDeferredValue:qi,useTransition:qi,useMutableSource:qi,useSyncExternalStore:qi,useId:qi,unstable_isNewReconciler:!1},nit={readContext:Ms,useCallback:function(s,r){return Vo().memoizedState=[s,r===void 0?null:r],s},useContext:Ms,useEffect:FF,useImperativeHandle:function(s,r,a){return a=a!=null?a.concat([s]):null,EE(4194308,4,J3.bind(null,r,s),a)},useLayoutEffect:function(s,r){return EE(4194308,4,s,r)},useInsertionEffect:function(s,r){return EE(4,2,s,r)},useMemo:function(s,r){var a=Vo();return r=r===void 0?null:r,s=s(),a.memoizedState=[s,r],s},useReducer:function(s,r,a){var d=Vo();return r=a!==void 0?a(r):r,d.memoizedState=d.baseState=r,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:r},d.queue=s,s=s.dispatch=tit.bind(null,Wn,s),[d.memoizedState,s]},useRef:function(s){var r=Vo();return s={current:s},r.memoizedState=s},useState:VF,useDebugValue:hI,useDeferredValue:function(s){return Vo().memoizedState=s},useTransition:function(){var s=VF(!1),r=s[0];return s=$nt.bind(null,s[1]),Vo().memoizedState=s,[r,s]},useMutableSource:function(){},useSyncExternalStore:function(s,r,a){var d=Wn,h=Vo();if(kn){if(a===void 0)throw Error(wt(407));a=a()}else{if(a=r(),wi===null)throw Error(wt(349));kd&30||W3(d,r,a)}h.memoizedState=a;var f={value:a,getSnapshot:r};return h.queue=f,FF(H3.bind(null,d,f,s),[s]),d.flags|=2048,vf(9,G3.bind(null,d,f,a,r),void 0,null),a},useId:function(){var s=Vo(),r=wi.identifierPrefix;if(kn){var a=pa,d=ha;a=(d&~(1<<32-co(d)-1)).toString(32)+a,r=":"+r+"R"+a,a=Ef++,0<a&&(r+="H"+a.toString(32)),r+=":"}else a=Znt++,r=":"+r+"r"+a.toString(32)+":";return s.memoizedState=r},unstable_isNewReconciler:!1},iit={readContext:Ms,useCallback:Z3,useContext:Ms,useEffect:uI,useImperativeHandle:Q3,useInsertionEffect:q3,useLayoutEffect:X3,useMemo:$3,useReducer:uC,useRef:Y3,useState:function(){return uC(Sf)},useDebugValue:hI,useDeferredValue:function(s){var r=xs();return t5(r,_i.memoizedState,s)},useTransition:function(){var s=uC(Sf)[0],r=xs().memoizedState;return[s,r]},useMutableSource:B3,useSyncExternalStore:j3,useId:e5,unstable_isNewReconciler:!1},rit={readContext:Ms,useCallback:Z3,useContext:Ms,useEffect:uI,useImperativeHandle:Q3,useInsertionEffect:q3,useLayoutEffect:X3,useMemo:$3,useReducer:hC,useRef:Y3,useState:function(){return hC(Sf)},useDebugValue:hI,useDeferredValue:function(s){var r=xs();return _i===null?r.memoizedState=s:t5(r,_i.memoizedState,s)},useTransition:function(){var s=hC(Sf)[0],r=xs().memoizedState;return[s,r]},useMutableSource:B3,useSyncExternalStore:j3,useId:e5,unstable_isNewReconciler:!1};function ro(s,r){if(s&&s.defaultProps){r=Gn({},r),s=s.defaultProps;for(var a in s)r[a]===void 0&&(r[a]=s[a]);return r}return r}function ib(s,r,a,d){r=s.memoizedState,a=a(d,r),a=a==null?r:Gn({},r,a),s.memoizedState=a,s.lanes===0&&(s.updateQueue.baseState=a)}var _S={isMounted:function(s){return(s=s._reactInternals)?Fd(s)===s:!1},enqueueSetState:function(s,r,a){s=s._reactInternals;var d=cr(),h=Sc(s),f=ma(d,h);f.payload=r,a!=null&&(f.callback=a),r=gc(s,f,h),r!==null&&(lo(r,s,h,d),_E(r,s,h))},enqueueReplaceState:function(s,r,a){s=s._reactInternals;var d=cr(),h=Sc(s),f=ma(d,h);f.tag=1,f.payload=r,a!=null&&(f.callback=a),r=gc(s,f,h),r!==null&&(lo(r,s,h,d),_E(r,s,h))},enqueueForceUpdate:function(s,r){s=s._reactInternals;var a=cr(),d=Sc(s),h=ma(a,d);h.tag=2,r!=null&&(h.callback=r),r=gc(s,h,d),r!==null&&(lo(r,s,d,a),_E(r,s,d))}};function BF(s,r,a,d,h,f,g){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(d,f,g):r.prototype&&r.prototype.isPureReactComponent?!hf(a,d)||!hf(h,f):!0}function s5(s,r,a){var d=!1,h=Rc,f=r.contextType;return typeof f=="object"&&f!==null?f=Ms(f):(h=Pr(r)?Dd:$i.current,d=r.contextTypes,f=(d=d!=null)?Pu(s,h):Rc),r=new r(a,f),s.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=_S,s.stateNode=r,r._reactInternals=s,d&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=h,s.__reactInternalMemoizedMaskedChildContext=f),r}function jF(s,r,a,d){s=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(a,d),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(a,d),r.state!==s&&_S.enqueueReplaceState(r,r.state,null)}function rb(s,r,a,d){var h=s.stateNode;h.props=a,h.state=s.memoizedState,h.refs={},rI(s);var f=r.contextType;typeof f=="object"&&f!==null?h.context=Ms(f):(f=Pr(r)?Dd:$i.current,h.context=Pu(s,f)),h.state=s.memoizedState,f=r.getDerivedStateFromProps,typeof f=="function"&&(ib(s,r,f,a),h.state=s.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(r=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),r!==h.state&&_S.enqueueReplaceState(h,h.state,null),WE(s,a,h,d),h.state=s.memoizedState),typeof h.componentDidMount=="function"&&(s.flags|=4194308)}function xu(s,r){try{var a="",d=r;do a+=Pet(d),d=d.return;while(d);var h=a}catch(f){h=`
Error generating stack: `+f.message+`
`+f.stack}return{value:s,source:r,stack:h,digest:null}}function pC(s,r,a){return{value:s,source:null,stack:a??null,digest:r??null}}function sb(s,r){try{console.error(r.value)}catch(a){setTimeout(function(){throw a})}}var sit=typeof WeakMap=="function"?WeakMap:Map;function o5(s,r,a){a=ma(-1,a),a.tag=3,a.payload={element:null};var d=r.value;return a.callback=function(){YE||(YE=!0,mb=d),sb(s,r)},a}function a5(s,r,a){a=ma(-1,a),a.tag=3;var d=s.type.getDerivedStateFromError;if(typeof d=="function"){var h=r.value;a.payload=function(){return d(h)},a.callback=function(){sb(s,r)}}var f=s.stateNode;return f!==null&&typeof f.componentDidCatch=="function"&&(a.callback=function(){sb(s,r),typeof d!="function"&&(Ec===null?Ec=new Set([this]):Ec.add(this));var g=r.stack;this.componentDidCatch(r.value,{componentStack:g!==null?g:""})}),a}function WF(s,r,a){var d=s.pingCache;if(d===null){d=s.pingCache=new sit;var h=new Set;d.set(r,h)}else h=d.get(r),h===void 0&&(h=new Set,d.set(r,h));h.has(a)||(h.add(a),s=Sit.bind(null,s,r,a),r.then(s,s))}function GF(s){do{var r;if((r=s.tag===13)&&(r=s.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return s;s=s.return}while(s!==null);return null}function HF(s,r,a,d,h){return s.mode&1?(s.flags|=65536,s.lanes=h,s):(s===r?s.flags|=65536:(s.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(r=ma(-1,1),r.tag=2,gc(a,r,1))),a.lanes|=1),s)}var oit=Ta.ReactCurrentOwner,Nr=!1;function ar(s,r,a,d){r.child=s===null?x3(r,null,a,d):Lu(r,s.child,a,d)}function zF(s,r,a,d,h){a=a.render;var f=r.ref;return wu(r,h),d=dI(s,r,a,d,f,h),a=lI(),s!==null&&!Nr?(r.updateQueue=s.updateQueue,r.flags&=-2053,s.lanes&=~h,Sa(s,r,h)):(kn&&a&&Qb(r),r.flags|=1,ar(s,r,d,h),r.child)}function KF(s,r,a,d,h){if(s===null){var f=a.type;return typeof f=="function"&&!vI(f)&&f.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(r.tag=15,r.type=f,c5(s,r,f,d,h)):(s=yE(a.type,null,d,r,r.mode,h),s.ref=r.ref,s.return=r,r.child=s)}if(f=s.child,!(s.lanes&h)){var g=f.memoizedProps;if(a=a.compare,a=a!==null?a:hf,a(g,d)&&s.ref===r.ref)return Sa(s,r,h)}return r.flags|=1,s=vc(f,d),s.ref=r.ref,s.return=r,r.child=s}function c5(s,r,a,d,h){if(s!==null){var f=s.memoizedProps;if(hf(f,d)&&s.ref===r.ref)if(Nr=!1,r.pendingProps=d=f,(s.lanes&h)!==0)s.flags&131072&&(Nr=!0);else return r.lanes=s.lanes,Sa(s,r,h)}return ob(s,r,a,d,h)}function d5(s,r,a){var d=r.pendingProps,h=d.children,f=s!==null?s.memoizedState:null;if(d.mode==="hidden")if(!(r.mode&1))r.memoizedState={baseLanes:0,cachePool:null,transitions:null},Cn(yu,Jr),Jr|=a;else{if(!(a&1073741824))return s=f!==null?f.baseLanes|a:a,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:s,cachePool:null,transitions:null},r.updateQueue=null,Cn(yu,Jr),Jr|=s,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=f!==null?f.baseLanes:a,Cn(yu,Jr),Jr|=d}else f!==null?(d=f.baseLanes|a,r.memoizedState=null):d=a,Cn(yu,Jr),Jr|=d;return ar(s,r,h,a),r.child}function l5(s,r){var a=r.ref;(s===null&&a!==null||s!==null&&s.ref!==a)&&(r.flags|=512,r.flags|=2097152)}function ob(s,r,a,d,h){var f=Pr(a)?Dd:$i.current;return f=Pu(r,f),wu(r,h),a=dI(s,r,a,d,f,h),d=lI(),s!==null&&!Nr?(r.updateQueue=s.updateQueue,r.flags&=-2053,s.lanes&=~h,Sa(s,r,h)):(kn&&d&&Qb(r),r.flags|=1,ar(s,r,a,h),r.child)}function YF(s,r,a,d,h){if(Pr(a)){var f=!0;UE(r)}else f=!1;if(wu(r,h),r.stateNode===null)SE(s,r),s5(r,a,d),rb(r,a,d,h),d=!0;else if(s===null){var g=r.stateNode,v=r.memoizedProps;g.props=v;var y=g.context,C=a.contextType;typeof C=="object"&&C!==null?C=Ms(C):(C=Pr(a)?Dd:$i.current,C=Pu(r,C));var O=a.getDerivedStateFromProps,k=typeof O=="function"||typeof g.getSnapshotBeforeUpdate=="function";k||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(v!==d||y!==C)&&jF(r,g,d,C),sc=!1;var M=r.memoizedState;g.state=M,WE(r,d,g,h),y=r.memoizedState,v!==d||M!==y||Dr.current||sc?(typeof O=="function"&&(ib(r,a,O,d),y=r.memoizedState),(v=sc||BF(r,a,v,d,M,y,C))?(k||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(r.flags|=4194308)):(typeof g.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=d,r.memoizedState=y),g.props=d,g.state=y,g.context=C,d=v):(typeof g.componentDidMount=="function"&&(r.flags|=4194308),d=!1)}else{g=r.stateNode,V3(s,r),v=r.memoizedProps,C=r.type===r.elementType?v:ro(r.type,v),g.props=C,k=r.pendingProps,M=g.context,y=a.contextType,typeof y=="object"&&y!==null?y=Ms(y):(y=Pr(a)?Dd:$i.current,y=Pu(r,y));var j=a.getDerivedStateFromProps;(O=typeof j=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(v!==k||M!==y)&&jF(r,g,d,y),sc=!1,M=r.memoizedState,g.state=M,WE(r,d,g,h);var z=r.memoizedState;v!==k||M!==z||Dr.current||sc?(typeof j=="function"&&(ib(r,a,j,d),z=r.memoizedState),(C=sc||BF(r,a,C,d,M,z,y)||!1)?(O||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(d,z,y),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(d,z,y)),typeof g.componentDidUpdate=="function"&&(r.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof g.componentDidUpdate!="function"||v===s.memoizedProps&&M===s.memoizedState||(r.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||v===s.memoizedProps&&M===s.memoizedState||(r.flags|=1024),r.memoizedProps=d,r.memoizedState=z),g.props=d,g.state=z,g.context=y,d=C):(typeof g.componentDidUpdate!="function"||v===s.memoizedProps&&M===s.memoizedState||(r.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||v===s.memoizedProps&&M===s.memoizedState||(r.flags|=1024),d=!1)}return ab(s,r,a,d,f,h)}function ab(s,r,a,d,h,f){l5(s,r);var g=(r.flags&128)!==0;if(!d&&!g)return h&&PF(r,a,!1),Sa(s,r,f);d=r.stateNode,oit.current=r;var v=g&&typeof a.getDerivedStateFromError!="function"?null:d.render();return r.flags|=1,s!==null&&g?(r.child=Lu(r,s.child,null,f),r.child=Lu(r,null,v,f)):ar(s,r,v,f),r.memoizedState=d.state,h&&PF(r,a,!0),r.child}function u5(s){var r=s.stateNode;r.pendingContext?DF(s,r.pendingContext,r.pendingContext!==r.context):r.context&&DF(s,r.context,!1),sI(s,r.containerInfo)}function qF(s,r,a,d,h){return ku(),$b(h),r.flags|=256,ar(s,r,a,d),r.child}var cb={dehydrated:null,treeContext:null,retryLane:0};function db(s){return{baseLanes:s,cachePool:null,transitions:null}}function h5(s,r,a){var d=r.pendingProps,h=Bn.current,f=!1,g=(r.flags&128)!==0,v;if((v=g)||(v=s!==null&&s.memoizedState===null?!1:(h&2)!==0),v?(f=!0,r.flags&=-129):(s===null||s.memoizedState!==null)&&(h|=1),Cn(Bn,h&1),s===null)return eb(r),s=r.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?(r.mode&1?s.data==="$!"?r.lanes=8:r.lanes=1073741824:r.lanes=1,null):(g=d.children,s=d.fallback,f?(d=r.mode,f=r.child,g={mode:"hidden",children:g},!(d&1)&&f!==null?(f.childLanes=0,f.pendingProps=g):f=SS(g,d,0,null),s=Od(s,d,a,null),f.return=r,s.return=r,f.sibling=s,r.child=f,r.child.memoizedState=db(a),r.memoizedState=cb,s):pI(r,g));if(h=s.memoizedState,h!==null&&(v=h.dehydrated,v!==null))return ait(s,r,g,d,v,h,a);if(f){f=d.fallback,g=r.mode,h=s.child,v=h.sibling;var y={mode:"hidden",children:d.children};return!(g&1)&&r.child!==h?(d=r.child,d.childLanes=0,d.pendingProps=y,r.deletions=null):(d=vc(h,y),d.subtreeFlags=h.subtreeFlags&14680064),v!==null?f=vc(v,f):(f=Od(f,g,a,null),f.flags|=2),f.return=r,d.return=r,d.sibling=f,r.child=d,d=f,f=r.child,g=s.child.memoizedState,g=g===null?db(a):{baseLanes:g.baseLanes|a,cachePool:null,transitions:g.transitions},f.memoizedState=g,f.childLanes=s.childLanes&~a,r.memoizedState=cb,d}return f=s.child,s=f.sibling,d=vc(f,{mode:"visible",children:d.children}),!(r.mode&1)&&(d.lanes=a),d.return=r,d.sibling=null,s!==null&&(a=r.deletions,a===null?(r.deletions=[s],r.flags|=16):a.push(s)),r.child=d,r.memoizedState=null,d}function pI(s,r){return r=SS({mode:"visible",children:r},s.mode,0,null),r.return=s,s.child=r}function Kg(s,r,a,d){return d!==null&&$b(d),Lu(r,s.child,null,a),s=pI(r,r.pendingProps.children),s.flags|=2,r.memoizedState=null,s}function ait(s,r,a,d,h,f,g){if(a)return r.flags&256?(r.flags&=-257,d=pC(Error(wt(422))),Kg(s,r,g,d)):r.memoizedState!==null?(r.child=s.child,r.flags|=128,null):(f=d.fallback,h=r.mode,d=SS({mode:"visible",children:d.children},h,0,null),f=Od(f,h,g,null),f.flags|=2,d.return=r,f.return=r,d.sibling=f,r.child=d,r.mode&1&&Lu(r,s.child,null,g),r.child.memoizedState=db(g),r.memoizedState=cb,f);if(!(r.mode&1))return Kg(s,r,g,null);if(h.data==="$!"){if(d=h.nextSibling&&h.nextSibling.dataset,d)var v=d.dgst;return d=v,f=Error(wt(419)),d=pC(f,d,void 0),Kg(s,r,g,d)}if(v=(g&s.childLanes)!==0,Nr||v){if(d=wi,d!==null){switch(g&-g){case 4:h=2;break;case 16:h=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:h=32;break;case 536870912:h=268435456;break;default:h=0}h=h&(d.suspendedLanes|g)?0:h,h!==0&&h!==f.retryLane&&(f.retryLane=h,Ea(s,h),lo(d,s,h,-1))}return SI(),d=pC(Error(wt(421))),Kg(s,r,g,d)}return h.data==="$?"?(r.flags|=128,r.child=s.child,r=vit.bind(null,s),h._reactRetry=r,null):(s=f.treeContext,Qr=_c(h.nextSibling),$r=r,kn=!0,ao=null,s!==null&&(As[Os++]=ha,As[Os++]=pa,As[Os++]=Pd,ha=s.id,pa=s.overflow,Pd=r),r=pI(r,d.children),r.flags|=4096,r)}function XF(s,r,a){s.lanes|=r;var d=s.alternate;d!==null&&(d.lanes|=r),nb(s.return,r,a)}function fC(s,r,a,d,h){var f=s.memoizedState;f===null?s.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:d,tail:a,tailMode:h}:(f.isBackwards=r,f.rendering=null,f.renderingStartTime=0,f.last=d,f.tail=a,f.tailMode=h)}function p5(s,r,a){var d=r.pendingProps,h=d.revealOrder,f=d.tail;if(ar(s,r,d.children,a),d=Bn.current,d&2)d=d&1|2,r.flags|=128;else{if(s!==null&&s.flags&128)t:for(s=r.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&XF(s,a,r);else if(s.tag===19)XF(s,a,r);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break t;for(;s.sibling===null;){if(s.return===null||s.return===r)break t;s=s.return}s.sibling.return=s.return,s=s.sibling}d&=1}if(Cn(Bn,d),!(r.mode&1))r.memoizedState=null;else switch(h){case"forwards":for(a=r.child,h=null;a!==null;)s=a.alternate,s!==null&&GE(s)===null&&(h=a),a=a.sibling;a=h,a===null?(h=r.child,r.child=null):(h=a.sibling,a.sibling=null),fC(r,!1,h,a,f);break;case"backwards":for(a=null,h=r.child,r.child=null;h!==null;){if(s=h.alternate,s!==null&&GE(s)===null){r.child=h;break}s=h.sibling,h.sibling=a,a=h,h=s}fC(r,!0,a,null,f);break;case"together":fC(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function SE(s,r){!(r.mode&1)&&s!==null&&(s.alternate=null,r.alternate=null,r.flags|=2)}function Sa(s,r,a){if(s!==null&&(r.dependencies=s.dependencies),Ld|=r.lanes,!(a&r.childLanes))return null;if(s!==null&&r.child!==s.child)throw Error(wt(153));if(r.child!==null){for(s=r.child,a=vc(s,s.pendingProps),r.child=a,a.return=r;s.sibling!==null;)s=s.sibling,a=a.sibling=vc(s,s.pendingProps),a.return=r;a.sibling=null}return r.child}function cit(s,r,a){switch(r.tag){case 3:u5(r),ku();break;case 5:F3(r);break;case 1:Pr(r.type)&&UE(r);break;case 4:sI(r,r.stateNode.containerInfo);break;case 10:var d=r.type._context,h=r.memoizedProps.value;Cn(BE,d._currentValue),d._currentValue=h;break;case 13:if(d=r.memoizedState,d!==null)return d.dehydrated!==null?(Cn(Bn,Bn.current&1),r.flags|=128,null):a&r.child.childLanes?h5(s,r,a):(Cn(Bn,Bn.current&1),s=Sa(s,r,a),s!==null?s.sibling:null);Cn(Bn,Bn.current&1);break;case 19:if(d=(a&r.childLanes)!==0,s.flags&128){if(d)return p5(s,r,a);r.flags|=128}if(h=r.memoizedState,h!==null&&(h.rendering=null,h.tail=null,h.lastEffect=null),Cn(Bn,Bn.current),d)break;return null;case 22:case 23:return r.lanes=0,d5(s,r,a)}return Sa(s,r,a)}var f5,lb,m5,_5;f5=function(s,r){for(var a=r.child;a!==null;){if(a.tag===5||a.tag===6)s.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};lb=function(){};m5=function(s,r,a,d){var h=s.memoizedProps;if(h!==d){s=r.stateNode,Id(Wo.current);var f=null;switch(a){case"input":h=PC(s,h),d=PC(s,d),f=[];break;case"select":h=Gn({},h,{value:void 0}),d=Gn({},d,{value:void 0}),f=[];break;case"textarea":h=MC(s,h),d=MC(s,d),f=[];break;default:typeof h.onClick!="function"&&typeof d.onClick=="function"&&(s.onclick=ME)}UC(a,d);var g;a=null;for(C in h)if(!d.hasOwnProperty(C)&&h.hasOwnProperty(C)&&h[C]!=null)if(C==="style"){var v=h[C];for(g in v)v.hasOwnProperty(g)&&(a||(a={}),a[g]="")}else C!=="dangerouslySetInnerHTML"&&C!=="children"&&C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&C!=="autoFocus"&&(sf.hasOwnProperty(C)?f||(f=[]):(f=f||[]).push(C,null));for(C in d){var y=d[C];if(v=h!=null?h[C]:void 0,d.hasOwnProperty(C)&&y!==v&&(y!=null||v!=null))if(C==="style")if(v){for(g in v)!v.hasOwnProperty(g)||y&&y.hasOwnProperty(g)||(a||(a={}),a[g]="");for(g in y)y.hasOwnProperty(g)&&v[g]!==y[g]&&(a||(a={}),a[g]=y[g])}else a||(f||(f=[]),f.push(C,a)),a=y;else C==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,v=v?v.__html:void 0,y!=null&&v!==y&&(f=f||[]).push(C,y)):C==="children"?typeof y!="string"&&typeof y!="number"||(f=f||[]).push(C,""+y):C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&(sf.hasOwnProperty(C)?(y!=null&&C==="onScroll"&&wn("scroll",s),f||v===y||(f=[])):(f=f||[]).push(C,y))}a&&(f=f||[]).push("style",a);var C=f;(r.updateQueue=C)&&(r.flags|=4)}};_5=function(s,r,a,d){a!==d&&(r.flags|=4)};function bp(s,r){if(!kn)switch(s.tailMode){case"hidden":r=s.tail;for(var a=null;r!==null;)r.alternate!==null&&(a=r),r=r.sibling;a===null?s.tail=null:a.sibling=null;break;case"collapsed":a=s.tail;for(var d=null;a!==null;)a.alternate!==null&&(d=a),a=a.sibling;d===null?r||s.tail===null?s.tail=null:s.tail.sibling=null:d.sibling=null}}function Xi(s){var r=s.alternate!==null&&s.alternate.child===s.child,a=0,d=0;if(r)for(var h=s.child;h!==null;)a|=h.lanes|h.childLanes,d|=h.subtreeFlags&14680064,d|=h.flags&14680064,h.return=s,h=h.sibling;else for(h=s.child;h!==null;)a|=h.lanes|h.childLanes,d|=h.subtreeFlags,d|=h.flags,h.return=s,h=h.sibling;return s.subtreeFlags|=d,s.childLanes=a,r}function dit(s,r,a){var d=r.pendingProps;switch(Zb(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xi(r),null;case 1:return Pr(r.type)&&xE(),Xi(r),null;case 3:return d=r.stateNode,Mu(),An(Dr),An($i),aI(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(s===null||s.child===null)&&(Hg(r)?r.flags|=4:s===null||s.memoizedState.isDehydrated&&!(r.flags&256)||(r.flags|=1024,ao!==null&&(Eb(ao),ao=null))),lb(s,r),Xi(r),null;case 5:oI(r);var h=Id(gf.current);if(a=r.type,s!==null&&r.stateNode!=null)m5(s,r,a,d,h),s.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!d){if(r.stateNode===null)throw Error(wt(166));return Xi(r),null}if(s=Id(Wo.current),Hg(r)){d=r.stateNode,a=r.type;var f=r.memoizedProps;switch(d[Bo]=r,d[mf]=f,s=(r.mode&1)!==0,a){case"dialog":wn("cancel",d),wn("close",d);break;case"iframe":case"object":case"embed":wn("load",d);break;case"video":case"audio":for(h=0;h<Mp.length;h++)wn(Mp[h],d);break;case"source":wn("error",d);break;case"img":case"image":case"link":wn("error",d),wn("load",d);break;case"details":wn("toggle",d);break;case"input":rF(d,f),wn("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!f.multiple},wn("invalid",d);break;case"textarea":oF(d,f),wn("invalid",d)}UC(a,f),h=null;for(var g in f)if(f.hasOwnProperty(g)){var v=f[g];g==="children"?typeof v=="string"?d.textContent!==v&&(f.suppressHydrationWarning!==!0&&Gg(d.textContent,v,s),h=["children",v]):typeof v=="number"&&d.textContent!==""+v&&(f.suppressHydrationWarning!==!0&&Gg(d.textContent,v,s),h=["children",""+v]):sf.hasOwnProperty(g)&&v!=null&&g==="onScroll"&&wn("scroll",d)}switch(a){case"input":Mg(d),sF(d,f,!0);break;case"textarea":Mg(d),aF(d);break;case"select":case"option":break;default:typeof f.onClick=="function"&&(d.onclick=ME)}d=h,r.updateQueue=d,d!==null&&(r.flags|=4)}else{g=h.nodeType===9?h:h.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=Hj(a)),s==="http://www.w3.org/1999/xhtml"?a==="script"?(s=g.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof d.is=="string"?s=g.createElement(a,{is:d.is}):(s=g.createElement(a),a==="select"&&(g=s,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):s=g.createElementNS(s,a),s[Bo]=r,s[mf]=d,f5(s,r,!1,!1),r.stateNode=s;t:{switch(g=VC(a,d),a){case"dialog":wn("cancel",s),wn("close",s),h=d;break;case"iframe":case"object":case"embed":wn("load",s),h=d;break;case"video":case"audio":for(h=0;h<Mp.length;h++)wn(Mp[h],s);h=d;break;case"source":wn("error",s),h=d;break;case"img":case"image":case"link":wn("error",s),wn("load",s),h=d;break;case"details":wn("toggle",s),h=d;break;case"input":rF(s,d),h=PC(s,d),wn("invalid",s);break;case"option":h=d;break;case"select":s._wrapperState={wasMultiple:!!d.multiple},h=Gn({},d,{value:void 0}),wn("invalid",s);break;case"textarea":oF(s,d),h=MC(s,d),wn("invalid",s);break;default:h=d}UC(a,h),v=h;for(f in v)if(v.hasOwnProperty(f)){var y=v[f];f==="style"?Yj(s,y):f==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,y!=null&&zj(s,y)):f==="children"?typeof y=="string"?(a!=="textarea"||y!=="")&&of(s,y):typeof y=="number"&&of(s,""+y):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(sf.hasOwnProperty(f)?y!=null&&f==="onScroll"&&wn("scroll",s):y!=null&&Ub(s,f,y,g))}switch(a){case"input":Mg(s),sF(s,d,!1);break;case"textarea":Mg(s),aF(s);break;case"option":d.value!=null&&s.setAttribute("value",""+yc(d.value));break;case"select":s.multiple=!!d.multiple,f=d.value,f!=null?Ru(s,!!d.multiple,f,!1):d.defaultValue!=null&&Ru(s,!!d.multiple,d.defaultValue,!0);break;default:typeof h.onClick=="function"&&(s.onclick=ME)}switch(a){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break t;case"img":d=!0;break t;default:d=!1}}d&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return Xi(r),null;case 6:if(s&&r.stateNode!=null)_5(s,r,s.memoizedProps,d);else{if(typeof d!="string"&&r.stateNode===null)throw Error(wt(166));if(a=Id(gf.current),Id(Wo.current),Hg(r)){if(d=r.stateNode,a=r.memoizedProps,d[Bo]=r,(f=d.nodeValue!==a)&&(s=$r,s!==null))switch(s.tag){case 3:Gg(d.nodeValue,a,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&Gg(d.nodeValue,a,(s.mode&1)!==0)}f&&(r.flags|=4)}else d=(a.nodeType===9?a:a.ownerDocument).createTextNode(d),d[Bo]=r,r.stateNode=d}return Xi(r),null;case 13:if(An(Bn),d=r.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(kn&&Qr!==null&&r.mode&1&&!(r.flags&128))L3(),ku(),r.flags|=98560,f=!1;else if(f=Hg(r),d!==null&&d.dehydrated!==null){if(s===null){if(!f)throw Error(wt(318));if(f=r.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(wt(317));f[Bo]=r}else ku(),!(r.flags&128)&&(r.memoizedState=null),r.flags|=4;Xi(r),f=!1}else ao!==null&&(Eb(ao),ao=null),f=!0;if(!f)return r.flags&65536?r:null}return r.flags&128?(r.lanes=a,r):(d=d!==null,d!==(s!==null&&s.memoizedState!==null)&&d&&(r.child.flags|=8192,r.mode&1&&(s===null||Bn.current&1?gi===0&&(gi=3):SI())),r.updateQueue!==null&&(r.flags|=4),Xi(r),null);case 4:return Mu(),lb(s,r),s===null&&pf(r.stateNode.containerInfo),Xi(r),null;case 10:return nI(r.type._context),Xi(r),null;case 17:return Pr(r.type)&&xE(),Xi(r),null;case 19:if(An(Bn),f=r.memoizedState,f===null)return Xi(r),null;if(d=(r.flags&128)!==0,g=f.rendering,g===null)if(d)bp(f,!1);else{if(gi!==0||s!==null&&s.flags&128)for(s=r.child;s!==null;){if(g=GE(s),g!==null){for(r.flags|=128,bp(f,!1),d=g.updateQueue,d!==null&&(r.updateQueue=d,r.flags|=4),r.subtreeFlags=0,d=a,a=r.child;a!==null;)f=a,s=d,f.flags&=14680066,g=f.alternate,g===null?(f.childLanes=0,f.lanes=s,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=g.childLanes,f.lanes=g.lanes,f.child=g.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=g.memoizedProps,f.memoizedState=g.memoizedState,f.updateQueue=g.updateQueue,f.type=g.type,s=g.dependencies,f.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),a=a.sibling;return Cn(Bn,Bn.current&1|2),r.child}s=s.sibling}f.tail!==null&&ii()>Uu&&(r.flags|=128,d=!0,bp(f,!1),r.lanes=4194304)}else{if(!d)if(s=GE(g),s!==null){if(r.flags|=128,d=!0,a=s.updateQueue,a!==null&&(r.updateQueue=a,r.flags|=4),bp(f,!0),f.tail===null&&f.tailMode==="hidden"&&!g.alternate&&!kn)return Xi(r),null}else 2*ii()-f.renderingStartTime>Uu&&a!==1073741824&&(r.flags|=128,d=!0,bp(f,!1),r.lanes=4194304);f.isBackwards?(g.sibling=r.child,r.child=g):(a=f.last,a!==null?a.sibling=g:r.child=g,f.last=g)}return f.tail!==null?(r=f.tail,f.rendering=r,f.tail=r.sibling,f.renderingStartTime=ii(),r.sibling=null,a=Bn.current,Cn(Bn,d?a&1|2:a&1),r):(Xi(r),null);case 22:case 23:return EI(),d=r.memoizedState!==null,s!==null&&s.memoizedState!==null!==d&&(r.flags|=8192),d&&r.mode&1?Jr&1073741824&&(Xi(r),r.subtreeFlags&6&&(r.flags|=8192)):Xi(r),null;case 24:return null;case 25:return null}throw Error(wt(156,r.tag))}function lit(s,r){switch(Zb(r),r.tag){case 1:return Pr(r.type)&&xE(),s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 3:return Mu(),An(Dr),An($i),aI(),s=r.flags,s&65536&&!(s&128)?(r.flags=s&-65537|128,r):null;case 5:return oI(r),null;case 13:if(An(Bn),s=r.memoizedState,s!==null&&s.dehydrated!==null){if(r.alternate===null)throw Error(wt(340));ku()}return s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 19:return An(Bn),null;case 4:return Mu(),null;case 10:return nI(r.type._context),null;case 22:case 23:return EI(),null;case 24:return null;default:return null}}var Yg=!1,Zi=!1,uit=typeof WeakSet=="function"?WeakSet:Set,Yt=null;function Tu(s,r){var a=s.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(d){Xn(s,r,d)}else a.current=null}function ub(s,r,a){try{a()}catch(d){Xn(s,r,d)}}var JF=!1;function hit(s,r){if(qC=PE,s=T3(),Jb(s)){if("selectionStart"in s)var a={start:s.selectionStart,end:s.selectionEnd};else t:{a=(a=s.ownerDocument)&&a.defaultView||window;var d=a.getSelection&&a.getSelection();if(d&&d.rangeCount!==0){a=d.anchorNode;var h=d.anchorOffset,f=d.focusNode;d=d.focusOffset;try{a.nodeType,f.nodeType}catch{a=null;break t}var g=0,v=-1,y=-1,C=0,O=0,k=s,M=null;e:for(;;){for(var j;k!==a||h!==0&&k.nodeType!==3||(v=g+h),k!==f||d!==0&&k.nodeType!==3||(y=g+d),k.nodeType===3&&(g+=k.nodeValue.length),(j=k.firstChild)!==null;)M=k,k=j;for(;;){if(k===s)break e;if(M===a&&++C===h&&(v=g),M===f&&++O===d&&(y=g),(j=k.nextSibling)!==null)break;k=M,M=k.parentNode}k=j}a=v===-1||y===-1?null:{start:v,end:y}}else a=null}a=a||{start:0,end:0}}else a=null;for(XC={focusedElem:s,selectionRange:a},PE=!1,Yt=r;Yt!==null;)if(r=Yt,s=r.child,(r.subtreeFlags&1028)!==0&&s!==null)s.return=r,Yt=s;else for(;Yt!==null;){r=Yt;try{var z=r.alternate;if(r.flags&1024)switch(r.tag){case 0:case 11:case 15:break;case 1:if(z!==null){var Y=z.memoizedProps,Z=z.memoizedState,H=r.stateNode,K=H.getSnapshotBeforeUpdate(r.elementType===r.type?Y:ro(r.type,Y),Z);H.__reactInternalSnapshotBeforeUpdate=K}break;case 3:var q=r.stateNode.containerInfo;q.nodeType===1?q.textContent="":q.nodeType===9&&q.documentElement&&q.removeChild(q.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(wt(163))}}catch(it){Xn(r,r.return,it)}if(s=r.sibling,s!==null){s.return=r.return,Yt=s;break}Yt=r.return}return z=JF,JF=!1,z}function Jp(s,r,a){var d=r.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var h=d=d.next;do{if((h.tag&s)===s){var f=h.destroy;h.destroy=void 0,f!==void 0&&ub(r,a,f)}h=h.next}while(h!==d)}}function gS(s,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&s)===s){var d=a.create;a.destroy=d()}a=a.next}while(a!==r)}}function hb(s){var r=s.ref;if(r!==null){var a=s.stateNode;switch(s.tag){case 5:s=a;break;default:s=a}typeof r=="function"?r(s):r.current=s}}function g5(s){var r=s.alternate;r!==null&&(s.alternate=null,g5(r)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(r=s.stateNode,r!==null&&(delete r[Bo],delete r[mf],delete r[ZC],delete r[qnt],delete r[Xnt])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function E5(s){return s.tag===5||s.tag===3||s.tag===4}function QF(s){t:for(;;){for(;s.sibling===null;){if(s.return===null||E5(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue t;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function pb(s,r,a){var d=s.tag;if(d===5||d===6)s=s.stateNode,r?a.nodeType===8?a.parentNode.insertBefore(s,r):a.insertBefore(s,r):(a.nodeType===8?(r=a.parentNode,r.insertBefore(s,a)):(r=a,r.appendChild(s)),a=a._reactRootContainer,a!=null||r.onclick!==null||(r.onclick=ME));else if(d!==4&&(s=s.child,s!==null))for(pb(s,r,a),s=s.sibling;s!==null;)pb(s,r,a),s=s.sibling}function fb(s,r,a){var d=s.tag;if(d===5||d===6)s=s.stateNode,r?a.insertBefore(s,r):a.appendChild(s);else if(d!==4&&(s=s.child,s!==null))for(fb(s,r,a),s=s.sibling;s!==null;)fb(s,r,a),s=s.sibling}var Li=null,so=!1;function nc(s,r,a){for(a=a.child;a!==null;)S5(s,r,a),a=a.sibling}function S5(s,r,a){if(jo&&typeof jo.onCommitFiberUnmount=="function")try{jo.onCommitFiberUnmount(dS,a)}catch{}switch(a.tag){case 5:Zi||Tu(a,r);case 6:var d=Li,h=so;Li=null,nc(s,r,a),Li=d,so=h,Li!==null&&(so?(s=Li,a=a.stateNode,s.nodeType===8?s.parentNode.removeChild(a):s.removeChild(a)):Li.removeChild(a.stateNode));break;case 18:Li!==null&&(so?(s=Li,a=a.stateNode,s.nodeType===8?aC(s.parentNode,a):s.nodeType===1&&aC(s,a),lf(s)):aC(Li,a.stateNode));break;case 4:d=Li,h=so,Li=a.stateNode.containerInfo,so=!0,nc(s,r,a),Li=d,so=h;break;case 0:case 11:case 14:case 15:if(!Zi&&(d=a.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){h=d=d.next;do{var f=h,g=f.destroy;f=f.tag,g!==void 0&&(f&2||f&4)&&ub(a,r,g),h=h.next}while(h!==d)}nc(s,r,a);break;case 1:if(!Zi&&(Tu(a,r),d=a.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=a.memoizedProps,d.state=a.memoizedState,d.componentWillUnmount()}catch(v){Xn(a,r,v)}nc(s,r,a);break;case 21:nc(s,r,a);break;case 22:a.mode&1?(Zi=(d=Zi)||a.memoizedState!==null,nc(s,r,a),Zi=d):nc(s,r,a);break;default:nc(s,r,a)}}function ZF(s){var r=s.updateQueue;if(r!==null){s.updateQueue=null;var a=s.stateNode;a===null&&(a=s.stateNode=new uit),r.forEach(function(d){var h=Tit.bind(null,s,d);a.has(d)||(a.add(d),d.then(h,h))})}}function io(s,r){var a=r.deletions;if(a!==null)for(var d=0;d<a.length;d++){var h=a[d];try{var f=s,g=r,v=g;t:for(;v!==null;){switch(v.tag){case 5:Li=v.stateNode,so=!1;break t;case 3:Li=v.stateNode.containerInfo,so=!0;break t;case 4:Li=v.stateNode.containerInfo,so=!0;break t}v=v.return}if(Li===null)throw Error(wt(160));S5(f,g,h),Li=null,so=!1;var y=h.alternate;y!==null&&(y.return=null),h.return=null}catch(C){Xn(h,r,C)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)v5(r,s),r=r.sibling}function v5(s,r){var a=s.alternate,d=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(io(r,s),xo(s),d&4){try{Jp(3,s,s.return),gS(3,s)}catch(Y){Xn(s,s.return,Y)}try{Jp(5,s,s.return)}catch(Y){Xn(s,s.return,Y)}}break;case 1:io(r,s),xo(s),d&512&&a!==null&&Tu(a,a.return);break;case 5:if(io(r,s),xo(s),d&512&&a!==null&&Tu(a,a.return),s.flags&32){var h=s.stateNode;try{of(h,"")}catch(Y){Xn(s,s.return,Y)}}if(d&4&&(h=s.stateNode,h!=null)){var f=s.memoizedProps,g=a!==null?a.memoizedProps:f,v=s.type,y=s.updateQueue;if(s.updateQueue=null,y!==null)try{v==="input"&&f.type==="radio"&&f.name!=null&&Wj(h,f),VC(v,g);var C=VC(v,f);for(g=0;g<y.length;g+=2){var O=y[g],k=y[g+1];O==="style"?Yj(h,k):O==="dangerouslySetInnerHTML"?zj(h,k):O==="children"?of(h,k):Ub(h,O,k,C)}switch(v){case"input":kC(h,f);break;case"textarea":Gj(h,f);break;case"select":var M=h._wrapperState.wasMultiple;h._wrapperState.wasMultiple=!!f.multiple;var j=f.value;j!=null?Ru(h,!!f.multiple,j,!1):M!==!!f.multiple&&(f.defaultValue!=null?Ru(h,!!f.multiple,f.defaultValue,!0):Ru(h,!!f.multiple,f.multiple?[]:"",!1))}h[mf]=f}catch(Y){Xn(s,s.return,Y)}}break;case 6:if(io(r,s),xo(s),d&4){if(s.stateNode===null)throw Error(wt(162));h=s.stateNode,f=s.memoizedProps;try{h.nodeValue=f}catch(Y){Xn(s,s.return,Y)}}break;case 3:if(io(r,s),xo(s),d&4&&a!==null&&a.memoizedState.isDehydrated)try{lf(r.containerInfo)}catch(Y){Xn(s,s.return,Y)}break;case 4:io(r,s),xo(s);break;case 13:io(r,s),xo(s),h=s.child,h.flags&8192&&(f=h.memoizedState!==null,h.stateNode.isHidden=f,!f||h.alternate!==null&&h.alternate.memoizedState!==null||(_I=ii())),d&4&&ZF(s);break;case 22:if(O=a!==null&&a.memoizedState!==null,s.mode&1?(Zi=(C=Zi)||O,io(r,s),Zi=C):io(r,s),xo(s),d&8192){if(C=s.memoizedState!==null,(s.stateNode.isHidden=C)&&!O&&s.mode&1)for(Yt=s,O=s.child;O!==null;){for(k=Yt=O;Yt!==null;){switch(M=Yt,j=M.child,M.tag){case 0:case 11:case 14:case 15:Jp(4,M,M.return);break;case 1:Tu(M,M.return);var z=M.stateNode;if(typeof z.componentWillUnmount=="function"){d=M,a=M.return;try{r=d,z.props=r.memoizedProps,z.state=r.memoizedState,z.componentWillUnmount()}catch(Y){Xn(d,a,Y)}}break;case 5:Tu(M,M.return);break;case 22:if(M.memoizedState!==null){tB(k);continue}}j!==null?(j.return=M,Yt=j):tB(k)}O=O.sibling}t:for(O=null,k=s;;){if(k.tag===5){if(O===null){O=k;try{h=k.stateNode,C?(f=h.style,typeof f.setProperty=="function"?f.setProperty("display","none","important"):f.display="none"):(v=k.stateNode,y=k.memoizedProps.style,g=y!=null&&y.hasOwnProperty("display")?y.display:null,v.style.display=Kj("display",g))}catch(Y){Xn(s,s.return,Y)}}}else if(k.tag===6){if(O===null)try{k.stateNode.nodeValue=C?"":k.memoizedProps}catch(Y){Xn(s,s.return,Y)}}else if((k.tag!==22&&k.tag!==23||k.memoizedState===null||k===s)&&k.child!==null){k.child.return=k,k=k.child;continue}if(k===s)break t;for(;k.sibling===null;){if(k.return===null||k.return===s)break t;O===k&&(O=null),k=k.return}O===k&&(O=null),k.sibling.return=k.return,k=k.sibling}}break;case 19:io(r,s),xo(s),d&4&&ZF(s);break;case 21:break;default:io(r,s),xo(s)}}function xo(s){var r=s.flags;if(r&2){try{t:{for(var a=s.return;a!==null;){if(E5(a)){var d=a;break t}a=a.return}throw Error(wt(160))}switch(d.tag){case 5:var h=d.stateNode;d.flags&32&&(of(h,""),d.flags&=-33);var f=QF(s);fb(s,f,h);break;case 3:case 4:var g=d.stateNode.containerInfo,v=QF(s);pb(s,v,g);break;default:throw Error(wt(161))}}catch(y){Xn(s,s.return,y)}s.flags&=-3}r&4096&&(s.flags&=-4097)}function pit(s,r,a){Yt=s,T5(s)}function T5(s,r,a){for(var d=(s.mode&1)!==0;Yt!==null;){var h=Yt,f=h.child;if(h.tag===22&&d){var g=h.memoizedState!==null||Yg;if(!g){var v=h.alternate,y=v!==null&&v.memoizedState!==null||Zi;v=Yg;var C=Zi;if(Yg=g,(Zi=y)&&!C)for(Yt=h;Yt!==null;)g=Yt,y=g.child,g.tag===22&&g.memoizedState!==null?eB(h):y!==null?(y.return=g,Yt=y):eB(h);for(;f!==null;)Yt=f,T5(f),f=f.sibling;Yt=h,Yg=v,Zi=C}$F(s)}else h.subtreeFlags&8772&&f!==null?(f.return=h,Yt=f):$F(s)}}function $F(s){for(;Yt!==null;){var r=Yt;if(r.flags&8772){var a=r.alternate;try{if(r.flags&8772)switch(r.tag){case 0:case 11:case 15:Zi||gS(5,r);break;case 1:var d=r.stateNode;if(r.flags&4&&!Zi)if(a===null)d.componentDidMount();else{var h=r.elementType===r.type?a.memoizedProps:ro(r.type,a.memoizedProps);d.componentDidUpdate(h,a.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var f=r.updateQueue;f!==null&&UF(r,f,d);break;case 3:var g=r.updateQueue;if(g!==null){if(a=null,r.child!==null)switch(r.child.tag){case 5:a=r.child.stateNode;break;case 1:a=r.child.stateNode}UF(r,g,a)}break;case 5:var v=r.stateNode;if(a===null&&r.flags&4){a=v;var y=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":y.autoFocus&&a.focus();break;case"img":y.src&&(a.src=y.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var C=r.alternate;if(C!==null){var O=C.memoizedState;if(O!==null){var k=O.dehydrated;k!==null&&lf(k)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(wt(163))}Zi||r.flags&512&&hb(r)}catch(M){Xn(r,r.return,M)}}if(r===s){Yt=null;break}if(a=r.sibling,a!==null){a.return=r.return,Yt=a;break}Yt=r.return}}function tB(s){for(;Yt!==null;){var r=Yt;if(r===s){Yt=null;break}var a=r.sibling;if(a!==null){a.return=r.return,Yt=a;break}Yt=r.return}}function eB(s){for(;Yt!==null;){var r=Yt;try{switch(r.tag){case 0:case 11:case 15:var a=r.return;try{gS(4,r)}catch(y){Xn(r,a,y)}break;case 1:var d=r.stateNode;if(typeof d.componentDidMount=="function"){var h=r.return;try{d.componentDidMount()}catch(y){Xn(r,h,y)}}var f=r.return;try{hb(r)}catch(y){Xn(r,f,y)}break;case 5:var g=r.return;try{hb(r)}catch(y){Xn(r,g,y)}}}catch(y){Xn(r,r.return,y)}if(r===s){Yt=null;break}var v=r.sibling;if(v!==null){v.return=r.return,Yt=v;break}Yt=r.return}}var fit=Math.ceil,KE=Ta.ReactCurrentDispatcher,fI=Ta.ReactCurrentOwner,ks=Ta.ReactCurrentBatchConfig,Qe=0,wi=null,di=null,Mi=0,Jr=0,yu=Ic(0),gi=0,Tf=null,Ld=0,ES=0,mI=0,Qp=null,Ar=null,_I=0,Uu=1/0,da=null,YE=!1,mb=null,Ec=null,qg=!1,dc=null,qE=0,Zp=0,_b=null,vE=-1,TE=0;function cr(){return Qe&6?ii():vE!==-1?vE:vE=ii()}function Sc(s){return s.mode&1?Qe&2&&Mi!==0?Mi&-Mi:Qnt.transition!==null?(TE===0&&(TE=s3()),TE):(s=un,s!==0||(s=window.event,s=s===void 0?16:h3(s.type)),s):1}function lo(s,r,a,d){if(50<Zp)throw Zp=0,_b=null,Error(wt(185));Af(s,a,d),(!(Qe&2)||s!==wi)&&(s===wi&&(!(Qe&2)&&(ES|=a),gi===4&&ac(s,Mi)),kr(s,d),a===1&&Qe===0&&!(r.mode&1)&&(Uu=ii()+500,fS&&wc()))}function kr(s,r){var a=s.callbackNode;Qet(s,r);var d=DE(s,s===wi?Mi:0);if(d===0)a!==null&&lF(a),s.callbackNode=null,s.callbackPriority=0;else if(r=d&-d,s.callbackPriority!==r){if(a!=null&&lF(a),r===1)s.tag===0?Jnt(nB.bind(null,s)):D3(nB.bind(null,s)),Knt(function(){!(Qe&6)&&wc()}),a=null;else{switch(o3(d)){case 1:a=Wb;break;case 4:a=i3;break;case 16:a=NE;break;case 536870912:a=r3;break;default:a=NE}a=O5(a,y5.bind(null,s))}s.callbackPriority=r,s.callbackNode=a}}function y5(s,r){if(vE=-1,TE=0,Qe&6)throw Error(wt(327));var a=s.callbackNode;if(Au()&&s.callbackNode!==a)return null;var d=DE(s,s===wi?Mi:0);if(d===0)return null;if(d&30||d&s.expiredLanes||r)r=XE(s,d);else{r=d;var h=Qe;Qe|=2;var f=C5();(wi!==s||Mi!==r)&&(da=null,Uu=ii()+500,Ad(s,r));do try{git();break}catch(v){R5(s,v)}while(1);eI(),KE.current=f,Qe=h,di!==null?r=0:(wi=null,Mi=0,r=gi)}if(r!==0){if(r===2&&(h=GC(s),h!==0&&(d=h,r=gb(s,h))),r===1)throw a=Tf,Ad(s,0),ac(s,d),kr(s,ii()),a;if(r===6)ac(s,d);else{if(h=s.current.alternate,!(d&30)&&!mit(h)&&(r=XE(s,d),r===2&&(f=GC(s),f!==0&&(d=f,r=gb(s,f))),r===1))throw a=Tf,Ad(s,0),ac(s,d),kr(s,ii()),a;switch(s.finishedWork=h,s.finishedLanes=d,r){case 0:case 1:throw Error(wt(345));case 2:vd(s,Ar,da);break;case 3:if(ac(s,d),(d&130023424)===d&&(r=_I+500-ii(),10<r)){if(DE(s,0)!==0)break;if(h=s.suspendedLanes,(h&d)!==d){cr(),s.pingedLanes|=s.suspendedLanes&h;break}s.timeoutHandle=QC(vd.bind(null,s,Ar,da),r);break}vd(s,Ar,da);break;case 4:if(ac(s,d),(d&4194240)===d)break;for(r=s.eventTimes,h=-1;0<d;){var g=31-co(d);f=1<<g,g=r[g],g>h&&(h=g),d&=~f}if(d=h,d=ii()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*fit(d/1960))-d,10<d){s.timeoutHandle=QC(vd.bind(null,s,Ar,da),d);break}vd(s,Ar,da);break;case 5:vd(s,Ar,da);break;default:throw Error(wt(329))}}}return kr(s,ii()),s.callbackNode===a?y5.bind(null,s):null}function gb(s,r){var a=Qp;return s.current.memoizedState.isDehydrated&&(Ad(s,r).flags|=256),s=XE(s,r),s!==2&&(r=Ar,Ar=a,r!==null&&Eb(r)),s}function Eb(s){Ar===null?Ar=s:Ar.push.apply(Ar,s)}function mit(s){for(var r=s;;){if(r.flags&16384){var a=r.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var d=0;d<a.length;d++){var h=a[d],f=h.getSnapshot;h=h.value;try{if(!uo(f(),h))return!1}catch{return!1}}}if(a=r.child,r.subtreeFlags&16384&&a!==null)a.return=r,r=a;else{if(r===s)break;for(;r.sibling===null;){if(r.return===null||r.return===s)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function ac(s,r){for(r&=~mI,r&=~ES,s.suspendedLanes|=r,s.pingedLanes&=~r,s=s.expirationTimes;0<r;){var a=31-co(r),d=1<<a;s[a]=-1,r&=~d}}function nB(s){if(Qe&6)throw Error(wt(327));Au();var r=DE(s,0);if(!(r&1))return kr(s,ii()),null;var a=XE(s,r);if(s.tag!==0&&a===2){var d=GC(s);d!==0&&(r=d,a=gb(s,d))}if(a===1)throw a=Tf,Ad(s,0),ac(s,r),kr(s,ii()),a;if(a===6)throw Error(wt(345));return s.finishedWork=s.current.alternate,s.finishedLanes=r,vd(s,Ar,da),kr(s,ii()),null}function gI(s,r){var a=Qe;Qe|=1;try{return s(r)}finally{Qe=a,Qe===0&&(Uu=ii()+500,fS&&wc())}}function Md(s){dc!==null&&dc.tag===0&&!(Qe&6)&&Au();var r=Qe;Qe|=1;var a=ks.transition,d=un;try{if(ks.transition=null,un=1,s)return s()}finally{un=d,ks.transition=a,Qe=r,!(Qe&6)&&wc()}}function EI(){Jr=yu.current,An(yu)}function Ad(s,r){s.finishedWork=null,s.finishedLanes=0;var a=s.timeoutHandle;if(a!==-1&&(s.timeoutHandle=-1,znt(a)),di!==null)for(a=di.return;a!==null;){var d=a;switch(Zb(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&xE();break;case 3:Mu(),An(Dr),An($i),aI();break;case 5:oI(d);break;case 4:Mu();break;case 13:An(Bn);break;case 19:An(Bn);break;case 10:nI(d.type._context);break;case 22:case 23:EI()}a=a.return}if(wi=s,di=s=vc(s.current,null),Mi=Jr=r,gi=0,Tf=null,mI=ES=Ld=0,Ar=Qp=null,bd!==null){for(r=0;r<bd.length;r++)if(a=bd[r],d=a.interleaved,d!==null){a.interleaved=null;var h=d.next,f=a.pending;if(f!==null){var g=f.next;f.next=h,d.next=g}a.pending=d}bd=null}return s}function R5(s,r){do{var a=di;try{if(eI(),gE.current=zE,HE){for(var d=Wn.memoizedState;d!==null;){var h=d.queue;h!==null&&(h.pending=null),d=d.next}HE=!1}if(kd=0,bi=_i=Wn=null,Xp=!1,Ef=0,fI.current=null,a===null||a.return===null){gi=1,Tf=r,di=null;break}t:{var f=s,g=a.return,v=a,y=r;if(r=Mi,v.flags|=32768,y!==null&&typeof y=="object"&&typeof y.then=="function"){var C=y,O=v,k=O.tag;if(!(O.mode&1)&&(k===0||k===11||k===15)){var M=O.alternate;M?(O.updateQueue=M.updateQueue,O.memoizedState=M.memoizedState,O.lanes=M.lanes):(O.updateQueue=null,O.memoizedState=null)}var j=GF(g);if(j!==null){j.flags&=-257,HF(j,g,v,f,r),j.mode&1&&WF(f,C,r),r=j,y=C;var z=r.updateQueue;if(z===null){var Y=new Set;Y.add(y),r.updateQueue=Y}else z.add(y);break t}else{if(!(r&1)){WF(f,C,r),SI();break t}y=Error(wt(426))}}else if(kn&&v.mode&1){var Z=GF(g);if(Z!==null){!(Z.flags&65536)&&(Z.flags|=256),HF(Z,g,v,f,r),$b(xu(y,v));break t}}f=y=xu(y,v),gi!==4&&(gi=2),Qp===null?Qp=[f]:Qp.push(f),f=g;do{switch(f.tag){case 3:f.flags|=65536,r&=-r,f.lanes|=r;var H=o5(f,y,r);xF(f,H);break t;case 1:v=y;var K=f.type,q=f.stateNode;if(!(f.flags&128)&&(typeof K.getDerivedStateFromError=="function"||q!==null&&typeof q.componentDidCatch=="function"&&(Ec===null||!Ec.has(q)))){f.flags|=65536,r&=-r,f.lanes|=r;var it=a5(f,v,r);xF(f,it);break t}}f=f.return}while(f!==null)}I5(a)}catch(ot){r=ot,di===a&&a!==null&&(di=a=a.return);continue}break}while(1)}function C5(){var s=KE.current;return KE.current=zE,s===null?zE:s}function SI(){(gi===0||gi===3||gi===2)&&(gi=4),wi===null||!(Ld&268435455)&&!(ES&268435455)||ac(wi,Mi)}function XE(s,r){var a=Qe;Qe|=2;var d=C5();(wi!==s||Mi!==r)&&(da=null,Ad(s,r));do try{_it();break}catch(h){R5(s,h)}while(1);if(eI(),Qe=a,KE.current=d,di!==null)throw Error(wt(261));return wi=null,Mi=0,gi}function _it(){for(;di!==null;)b5(di)}function git(){for(;di!==null&&!Wet();)b5(di)}function b5(s){var r=A5(s.alternate,s,Jr);s.memoizedProps=s.pendingProps,r===null?I5(s):di=r,fI.current=null}function I5(s){var r=s;do{var a=r.alternate;if(s=r.return,r.flags&32768){if(a=lit(a,r),a!==null){a.flags&=32767,di=a;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{gi=6,di=null;return}}else if(a=dit(a,r,Jr),a!==null){di=a;return}if(r=r.sibling,r!==null){di=r;return}di=r=s}while(r!==null);gi===0&&(gi=5)}function vd(s,r,a){var d=un,h=ks.transition;try{ks.transition=null,un=1,Eit(s,r,a,d)}finally{ks.transition=h,un=d}return null}function Eit(s,r,a,d){do Au();while(dc!==null);if(Qe&6)throw Error(wt(327));a=s.finishedWork;var h=s.finishedLanes;if(a===null)return null;if(s.finishedWork=null,s.finishedLanes=0,a===s.current)throw Error(wt(177));s.callbackNode=null,s.callbackPriority=0;var f=a.lanes|a.childLanes;if(Zet(s,f),s===wi&&(di=wi=null,Mi=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||qg||(qg=!0,O5(NE,function(){return Au(),null})),f=(a.flags&15990)!==0,a.subtreeFlags&15990||f){f=ks.transition,ks.transition=null;var g=un;un=1;var v=Qe;Qe|=4,fI.current=null,hit(s,a),v5(a,s),Vnt(XC),PE=!!qC,XC=qC=null,s.current=a,pit(a),Get(),Qe=v,un=g,ks.transition=f}else s.current=a;if(qg&&(qg=!1,dc=s,qE=h),f=s.pendingLanes,f===0&&(Ec=null),Ket(a.stateNode),kr(s,ii()),r!==null)for(d=s.onRecoverableError,a=0;a<r.length;a++)h=r[a],d(h.value,{componentStack:h.stack,digest:h.digest});if(YE)throw YE=!1,s=mb,mb=null,s;return qE&1&&s.tag!==0&&Au(),f=s.pendingLanes,f&1?s===_b?Zp++:(Zp=0,_b=s):Zp=0,wc(),null}function Au(){if(dc!==null){var s=o3(qE),r=ks.transition,a=un;try{if(ks.transition=null,un=16>s?16:s,dc===null)var d=!1;else{if(s=dc,dc=null,qE=0,Qe&6)throw Error(wt(331));var h=Qe;for(Qe|=4,Yt=s.current;Yt!==null;){var f=Yt,g=f.child;if(Yt.flags&16){var v=f.deletions;if(v!==null){for(var y=0;y<v.length;y++){var C=v[y];for(Yt=C;Yt!==null;){var O=Yt;switch(O.tag){case 0:case 11:case 15:Jp(8,O,f)}var k=O.child;if(k!==null)k.return=O,Yt=k;else for(;Yt!==null;){O=Yt;var M=O.sibling,j=O.return;if(g5(O),O===C){Yt=null;break}if(M!==null){M.return=j,Yt=M;break}Yt=j}}}var z=f.alternate;if(z!==null){var Y=z.child;if(Y!==null){z.child=null;do{var Z=Y.sibling;Y.sibling=null,Y=Z}while(Y!==null)}}Yt=f}}if(f.subtreeFlags&2064&&g!==null)g.return=f,Yt=g;else t:for(;Yt!==null;){if(f=Yt,f.flags&2048)switch(f.tag){case 0:case 11:case 15:Jp(9,f,f.return)}var H=f.sibling;if(H!==null){H.return=f.return,Yt=H;break t}Yt=f.return}}var K=s.current;for(Yt=K;Yt!==null;){g=Yt;var q=g.child;if(g.subtreeFlags&2064&&q!==null)q.return=g,Yt=q;else t:for(g=K;Yt!==null;){if(v=Yt,v.flags&2048)try{switch(v.tag){case 0:case 11:case 15:gS(9,v)}}catch(ot){Xn(v,v.return,ot)}if(v===g){Yt=null;break t}var it=v.sibling;if(it!==null){it.return=v.return,Yt=it;break t}Yt=v.return}}if(Qe=h,wc(),jo&&typeof jo.onPostCommitFiberRoot=="function")try{jo.onPostCommitFiberRoot(dS,s)}catch{}d=!0}return d}finally{un=a,ks.transition=r}}return!1}function iB(s,r,a){r=xu(a,r),r=o5(s,r,1),s=gc(s,r,1),r=cr(),s!==null&&(Af(s,1,r),kr(s,r))}function Xn(s,r,a){if(s.tag===3)iB(s,s,a);else for(;r!==null;){if(r.tag===3){iB(r,s,a);break}else if(r.tag===1){var d=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Ec===null||!Ec.has(d))){s=xu(a,s),s=a5(r,s,1),r=gc(r,s,1),s=cr(),r!==null&&(Af(r,1,s),kr(r,s));break}}r=r.return}}function Sit(s,r,a){var d=s.pingCache;d!==null&&d.delete(r),r=cr(),s.pingedLanes|=s.suspendedLanes&a,wi===s&&(Mi&a)===a&&(gi===4||gi===3&&(Mi&130023424)===Mi&&500>ii()-_I?Ad(s,0):mI|=a),kr(s,r)}function w5(s,r){r===0&&(s.mode&1?(r=Vg,Vg<<=1,!(Vg&130023424)&&(Vg=4194304)):r=1);var a=cr();s=Ea(s,r),s!==null&&(Af(s,r,a),kr(s,a))}function vit(s){var r=s.memoizedState,a=0;r!==null&&(a=r.retryLane),w5(s,a)}function Tit(s,r){var a=0;switch(s.tag){case 13:var d=s.stateNode,h=s.memoizedState;h!==null&&(a=h.retryLane);break;case 19:d=s.stateNode;break;default:throw Error(wt(314))}d!==null&&d.delete(r),w5(s,a)}var A5;A5=function(s,r,a){if(s!==null)if(s.memoizedProps!==r.pendingProps||Dr.current)Nr=!0;else{if(!(s.lanes&a)&&!(r.flags&128))return Nr=!1,cit(s,r,a);Nr=!!(s.flags&131072)}else Nr=!1,kn&&r.flags&1048576&&P3(r,FE,r.index);switch(r.lanes=0,r.tag){case 2:var d=r.type;SE(s,r),s=r.pendingProps;var h=Pu(r,$i.current);wu(r,a),h=dI(null,r,d,s,h,a);var f=lI();return r.flags|=1,typeof h=="object"&&h!==null&&typeof h.render=="function"&&h.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,Pr(d)?(f=!0,UE(r)):f=!1,r.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,rI(r),h.updater=_S,r.stateNode=h,h._reactInternals=r,rb(r,d,s,a),r=ab(null,r,d,!0,f,a)):(r.tag=0,kn&&f&&Qb(r),ar(null,r,h,a),r=r.child),r;case 16:d=r.elementType;t:{switch(SE(s,r),s=r.pendingProps,h=d._init,d=h(d._payload),r.type=d,h=r.tag=Rit(d),s=ro(d,s),h){case 0:r=ob(null,r,d,s,a);break t;case 1:r=YF(null,r,d,s,a);break t;case 11:r=zF(null,r,d,s,a);break t;case 14:r=KF(null,r,d,ro(d.type,s),a);break t}throw Error(wt(306,d,""))}return r;case 0:return d=r.type,h=r.pendingProps,h=r.elementType===d?h:ro(d,h),ob(s,r,d,h,a);case 1:return d=r.type,h=r.pendingProps,h=r.elementType===d?h:ro(d,h),YF(s,r,d,h,a);case 3:t:{if(u5(r),s===null)throw Error(wt(387));d=r.pendingProps,f=r.memoizedState,h=f.element,V3(s,r),WE(r,d,null,a);var g=r.memoizedState;if(d=g.element,f.isDehydrated)if(f={element:d,isDehydrated:!1,cache:g.cache,pendingSuspenseBoundaries:g.pendingSuspenseBoundaries,transitions:g.transitions},r.updateQueue.baseState=f,r.memoizedState=f,r.flags&256){h=xu(Error(wt(423)),r),r=qF(s,r,d,a,h);break t}else if(d!==h){h=xu(Error(wt(424)),r),r=qF(s,r,d,a,h);break t}else for(Qr=_c(r.stateNode.containerInfo.firstChild),$r=r,kn=!0,ao=null,a=x3(r,null,d,a),r.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(ku(),d===h){r=Sa(s,r,a);break t}ar(s,r,d,a)}r=r.child}return r;case 5:return F3(r),s===null&&eb(r),d=r.type,h=r.pendingProps,f=s!==null?s.memoizedProps:null,g=h.children,JC(d,h)?g=null:f!==null&&JC(d,f)&&(r.flags|=32),l5(s,r),ar(s,r,g,a),r.child;case 6:return s===null&&eb(r),null;case 13:return h5(s,r,a);case 4:return sI(r,r.stateNode.containerInfo),d=r.pendingProps,s===null?r.child=Lu(r,null,d,a):ar(s,r,d,a),r.child;case 11:return d=r.type,h=r.pendingProps,h=r.elementType===d?h:ro(d,h),zF(s,r,d,h,a);case 7:return ar(s,r,r.pendingProps,a),r.child;case 8:return ar(s,r,r.pendingProps.children,a),r.child;case 12:return ar(s,r,r.pendingProps.children,a),r.child;case 10:t:{if(d=r.type._context,h=r.pendingProps,f=r.memoizedProps,g=h.value,Cn(BE,d._currentValue),d._currentValue=g,f!==null)if(uo(f.value,g)){if(f.children===h.children&&!Dr.current){r=Sa(s,r,a);break t}}else for(f=r.child,f!==null&&(f.return=r);f!==null;){var v=f.dependencies;if(v!==null){g=f.child;for(var y=v.firstContext;y!==null;){if(y.context===d){if(f.tag===1){y=ma(-1,a&-a),y.tag=2;var C=f.updateQueue;if(C!==null){C=C.shared;var O=C.pending;O===null?y.next=y:(y.next=O.next,O.next=y),C.pending=y}}f.lanes|=a,y=f.alternate,y!==null&&(y.lanes|=a),nb(f.return,a,r),v.lanes|=a;break}y=y.next}}else if(f.tag===10)g=f.type===r.type?null:f.child;else if(f.tag===18){if(g=f.return,g===null)throw Error(wt(341));g.lanes|=a,v=g.alternate,v!==null&&(v.lanes|=a),nb(g,a,r),g=f.sibling}else g=f.child;if(g!==null)g.return=f;else for(g=f;g!==null;){if(g===r){g=null;break}if(f=g.sibling,f!==null){f.return=g.return,g=f;break}g=g.return}f=g}ar(s,r,h.children,a),r=r.child}return r;case 9:return h=r.type,d=r.pendingProps.children,wu(r,a),h=Ms(h),d=d(h),r.flags|=1,ar(s,r,d,a),r.child;case 14:return d=r.type,h=ro(d,r.pendingProps),h=ro(d.type,h),KF(s,r,d,h,a);case 15:return c5(s,r,r.type,r.pendingProps,a);case 17:return d=r.type,h=r.pendingProps,h=r.elementType===d?h:ro(d,h),SE(s,r),r.tag=1,Pr(d)?(s=!0,UE(r)):s=!1,wu(r,a),s5(r,d,h),rb(r,d,h,a),ab(null,r,d,!0,s,a);case 19:return p5(s,r,a);case 22:return d5(s,r,a)}throw Error(wt(156,r.tag))};function O5(s,r){return n3(s,r)}function yit(s,r,a,d){this.tag=s,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ns(s,r,a,d){return new yit(s,r,a,d)}function vI(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Rit(s){if(typeof s=="function")return vI(s)?1:0;if(s!=null){if(s=s.$$typeof,s===Fb)return 11;if(s===Bb)return 14}return 2}function vc(s,r){var a=s.alternate;return a===null?(a=Ns(s.tag,r,s.key,s.mode),a.elementType=s.elementType,a.type=s.type,a.stateNode=s.stateNode,a.alternate=s,s.alternate=a):(a.pendingProps=r,a.type=s.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=s.flags&14680064,a.childLanes=s.childLanes,a.lanes=s.lanes,a.child=s.child,a.memoizedProps=s.memoizedProps,a.memoizedState=s.memoizedState,a.updateQueue=s.updateQueue,r=s.dependencies,a.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},a.sibling=s.sibling,a.index=s.index,a.ref=s.ref,a}function yE(s,r,a,d,h,f){var g=2;if(d=s,typeof s=="function")vI(s)&&(g=1);else if(typeof s=="string")g=5;else t:switch(s){case hu:return Od(a.children,h,f,r);case Vb:g=8,h|=8;break;case AC:return s=Ns(12,a,r,h|2),s.elementType=AC,s.lanes=f,s;case OC:return s=Ns(13,a,r,h),s.elementType=OC,s.lanes=f,s;case NC:return s=Ns(19,a,r,h),s.elementType=NC,s.lanes=f,s;case Fj:return SS(a,h,f,r);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case Uj:g=10;break t;case Vj:g=9;break t;case Fb:g=11;break t;case Bb:g=14;break t;case rc:g=16,d=null;break t}throw Error(wt(130,s==null?s:typeof s,""))}return r=Ns(g,a,r,h),r.elementType=s,r.type=d,r.lanes=f,r}function Od(s,r,a,d){return s=Ns(7,s,d,r),s.lanes=a,s}function SS(s,r,a,d){return s=Ns(22,s,d,r),s.elementType=Fj,s.lanes=a,s.stateNode={isHidden:!1},s}function mC(s,r,a){return s=Ns(6,s,null,r),s.lanes=a,s}function _C(s,r,a){return r=Ns(4,s.children!==null?s.children:[],s.key,r),r.lanes=a,r.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},r}function Cit(s,r,a,d,h){this.tag=r,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=JR(0),this.expirationTimes=JR(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=JR(0),this.identifierPrefix=d,this.onRecoverableError=h,this.mutableSourceEagerHydrationData=null}function TI(s,r,a,d,h,f,g,v,y){return s=new Cit(s,r,a,v,y),r===1?(r=1,f===!0&&(r|=8)):r=0,f=Ns(3,null,null,r),s.current=f,f.stateNode=s,f.memoizedState={element:d,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},rI(f),s}function bit(s,r,a){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:uu,key:d==null?null:""+d,children:s,containerInfo:r,implementation:a}}function N5(s){if(!s)return Rc;s=s._reactInternals;t:{if(Fd(s)!==s||s.tag!==1)throw Error(wt(170));var r=s;do{switch(r.tag){case 3:r=r.stateNode.context;break t;case 1:if(Pr(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break t}}r=r.return}while(r!==null);throw Error(wt(171))}if(s.tag===1){var a=s.type;if(Pr(a))return N3(s,a,r)}return r}function D5(s,r,a,d,h,f,g,v,y){return s=TI(a,d,!0,s,h,f,g,v,y),s.context=N5(null),a=s.current,d=cr(),h=Sc(a),f=ma(d,h),f.callback=r??null,gc(a,f,h),s.current.lanes=h,Af(s,h,d),kr(s,d),s}function vS(s,r,a,d){var h=r.current,f=cr(),g=Sc(h);return a=N5(a),r.context===null?r.context=a:r.pendingContext=a,r=ma(f,g),r.payload={element:s},d=d===void 0?null:d,d!==null&&(r.callback=d),s=gc(h,r,g),s!==null&&(lo(s,h,g,f),_E(s,h,g)),g}function JE(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function rB(s,r){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var a=s.retryLane;s.retryLane=a!==0&&a<r?a:r}}function yI(s,r){rB(s,r),(s=s.alternate)&&rB(s,r)}function Iit(){return null}var P5=typeof reportError=="function"?reportError:function(s){console.error(s)};function RI(s){this._internalRoot=s}TS.prototype.render=RI.prototype.render=function(s){var r=this._internalRoot;if(r===null)throw Error(wt(409));vS(s,r,null,null)};TS.prototype.unmount=RI.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var r=s.containerInfo;Md(function(){vS(null,s,null,null)}),r[ga]=null}};function TS(s){this._internalRoot=s}TS.prototype.unstable_scheduleHydration=function(s){if(s){var r=d3();s={blockedOn:null,target:s,priority:r};for(var a=0;a<oc.length&&r!==0&&r<oc[a].priority;a++);oc.splice(a,0,s),a===0&&u3(s)}};function CI(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function yS(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function sB(){}function wit(s,r,a,d,h){if(h){if(typeof d=="function"){var f=d;d=function(){var C=JE(g);f.call(C)}}var g=D5(r,d,s,0,null,!1,!1,"",sB);return s._reactRootContainer=g,s[ga]=g.current,pf(s.nodeType===8?s.parentNode:s),Md(),g}for(;h=s.lastChild;)s.removeChild(h);if(typeof d=="function"){var v=d;d=function(){var C=JE(y);v.call(C)}}var y=TI(s,0,!1,null,null,!1,!1,"",sB);return s._reactRootContainer=y,s[ga]=y.current,pf(s.nodeType===8?s.parentNode:s),Md(function(){vS(r,y,a,d)}),y}function RS(s,r,a,d,h){var f=a._reactRootContainer;if(f){var g=f;if(typeof h=="function"){var v=h;h=function(){var y=JE(g);v.call(y)}}vS(r,g,s,h)}else g=wit(a,r,s,h,d);return JE(g)}a3=function(s){switch(s.tag){case 3:var r=s.stateNode;if(r.current.memoizedState.isDehydrated){var a=Lp(r.pendingLanes);a!==0&&(Gb(r,a|1),kr(r,ii()),!(Qe&6)&&(Uu=ii()+500,wc()))}break;case 13:Md(function(){var d=Ea(s,1);if(d!==null){var h=cr();lo(d,s,1,h)}}),yI(s,1)}};Hb=function(s){if(s.tag===13){var r=Ea(s,134217728);if(r!==null){var a=cr();lo(r,s,134217728,a)}yI(s,134217728)}};c3=function(s){if(s.tag===13){var r=Sc(s),a=Ea(s,r);if(a!==null){var d=cr();lo(a,s,r,d)}yI(s,r)}};d3=function(){return un};l3=function(s,r){var a=un;try{return un=s,r()}finally{un=a}};BC=function(s,r,a){switch(r){case"input":if(kC(s,a),r=a.name,a.type==="radio"&&r!=null){for(a=s;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<a.length;r++){var d=a[r];if(d!==s&&d.form===s.form){var h=pS(d);if(!h)throw Error(wt(90));jj(d),kC(d,h)}}}break;case"textarea":Gj(s,a);break;case"select":r=a.value,r!=null&&Ru(s,!!a.multiple,r,!1)}};Jj=gI;Qj=Md;var Ait={usingClientEntryPoint:!1,Events:[Nf,_u,pS,qj,Xj,gI]},Ip={findFiberByHostInstance:Cd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Oit={bundleType:Ip.bundleType,version:Ip.version,rendererPackageName:Ip.rendererPackageName,rendererConfig:Ip.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ta.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=t3(s),s===null?null:s.stateNode},findFiberByHostInstance:Ip.findFiberByHostInstance||Iit,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Xg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Xg.isDisabled&&Xg.supportsFiber)try{dS=Xg.inject(Oit),jo=Xg}catch{}}es.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ait;es.createPortal=function(s,r){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!CI(r))throw Error(wt(200));return bit(s,r,null,a)};es.createRoot=function(s,r){if(!CI(s))throw Error(wt(299));var a=!1,d="",h=P5;return r!=null&&(r.unstable_strictMode===!0&&(a=!0),r.identifierPrefix!==void 0&&(d=r.identifierPrefix),r.onRecoverableError!==void 0&&(h=r.onRecoverableError)),r=TI(s,1,!1,null,null,a,!1,d,h),s[ga]=r.current,pf(s.nodeType===8?s.parentNode:s),new RI(r)};es.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var r=s._reactInternals;if(r===void 0)throw typeof s.render=="function"?Error(wt(188)):(s=Object.keys(s).join(","),Error(wt(268,s)));return s=t3(r),s=s===null?null:s.stateNode,s};es.flushSync=function(s){return Md(s)};es.hydrate=function(s,r,a){if(!yS(r))throw Error(wt(200));return RS(null,s,r,!0,a)};es.hydrateRoot=function(s,r,a){if(!CI(s))throw Error(wt(405));var d=a!=null&&a.hydratedSources||null,h=!1,f="",g=P5;if(a!=null&&(a.unstable_strictMode===!0&&(h=!0),a.identifierPrefix!==void 0&&(f=a.identifierPrefix),a.onRecoverableError!==void 0&&(g=a.onRecoverableError)),r=D5(r,null,s,1,a??null,h,!1,f,g),s[ga]=r.current,pf(s),d)for(s=0;s<d.length;s++)a=d[s],h=a._getVersion,h=h(a._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[a,h]:r.mutableSourceEagerHydrationData.push(a,h);return new TS(r)};es.render=function(s,r,a){if(!yS(r))throw Error(wt(200));return RS(null,s,r,!1,a)};es.unmountComponentAtNode=function(s){if(!yS(s))throw Error(wt(40));return s._reactRootContainer?(Md(function(){RS(null,null,s,!1,function(){s._reactRootContainer=null,s[ga]=null})}),!0):!1};es.unstable_batchedUpdates=gI;es.unstable_renderSubtreeIntoContainer=function(s,r,a,d){if(!yS(a))throw Error(wt(200));if(s==null||s._reactInternals===void 0)throw Error(wt(38));return RS(s,r,a,!1,d)};es.version="18.3.1-next-f1338f8080-20240426";function k5(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(k5)}catch(s){console.error(s)}}k5(),kj.exports=es;var Nit=kj.exports,oB=Nit;IC.createRoot=oB.createRoot,IC.hydrateRoot=oB.hydrateRoot;class Dit{constructor(r,a){fe(this,"openapiHost");fe(this,"openapiToken");this.openapiHost=r,this.openapiToken=a}async fetchApi(r,a,d){const f=await(await fetch(`${this.openapiHost}${r}`,{method:a,headers:{Authorization:`Bearer ${this.openapiToken}`,"Content-Type":"application/json"},body:d?JSON.stringify(d):void 0})).json();if(f.code!=1e3)throw alert(f.msg),new Error(f.msg);return f.data}async createSession(r){return this.fetchApi("/api/open/v4/liveAvatar/session/create","POST",r)}async closeSession(r){return this.fetchApi("/api/open/v4/liveAvatar/session/close","POST",{id:r})}async getLangList(){const r=await this.fetchApi("/api/open/v3/language/list","GET");return r==null?void 0:r.lang_list}async getKnowledgeList(){const r=await this.fetchApi("/api/open/v4/knowledge/list","GET");return r==null?void 0:r.knowledge_list}async getVoiceList(){return this.fetchApi("/api/open/v3/voice/list?from=3","GET")}async getAvatarList(){const r=await this.fetchApi("/api/open/v4/liveAvatar/avatar/list?page=1&size=100","GET");return r==null?void 0:r.result}}function Pit({api:s,isJoined:r,avatarId:a,setAvatarId:d,setAvatarVideoUrl:h,startStreaming:f,closeStreaming:g}){const[v,y]=Rt.useState([]),[C,O]=Rt.useState(!1),[k,M]=Rt.useState(!1),[j,z]=Rt.useState(!0),[Y,Z]=Rt.useState(!1);Rt.useEffect(()=>{(async()=>{if(!(!s||C)){O(!0);try{const it=await s.getAvatarList();y(it)}catch(it){console.error("Error fetching avatars:",it)}finally{O(!1)}}})()},[s,C]);const H=q=>{d(q);const it=v.find(ot=>ot.avatar_id===q);it&&h(it.url)},K=async()=>{Z(!0);try{await f()}catch(q){console.error("Error starting streaming:",q)}finally{Z(!1)}};return ht.jsxs("div",{className:"left-side",children:[ht.jsx("h3",{children:"Streaming Avatar Demo"}),ht.jsxs("div",{className:"config-group",children:[ht.jsxs("div",{className:"group-header collapsible",onClick:()=>M(!k),children:[ht.jsx("span",{children:"Configuration"}),ht.jsx("span",{className:`collapse-arrow ${k?"expanded":""}`,children:""})]}),k&&ht.jsxs("div",{className:"config-display",children:[ht.jsxs("div",{className:"config-item",children:[ht.jsx("strong",{children:"Host:"})," ","https://openapi.akool.com"]}),ht.jsxs("div",{className:"config-item",children:[ht.jsx("strong",{children:"Language:"})," ","en"]}),ht.jsxs("div",{className:"config-item",children:[ht.jsx("strong",{children:"Mode Type:"})," ","2"," (Dialogue)"]}),ht.jsxs("div",{className:"config-item",children:[ht.jsx("strong",{children:"Session Duration:"})," 10 minutes"]}),ht.jsxs("div",{className:"config-item",children:[ht.jsx("strong",{children:"Voice ID:"})," ","Xb7hH8MSUJpSbSDYk0k2"]})]})]}),ht.jsxs("div",{className:"config-group",children:[ht.jsxs("div",{className:"group-header collapsible",onClick:()=>z(!j),children:[ht.jsx("span",{children:"Avatar Selection"}),ht.jsx("span",{className:`collapse-arrow ${j?"expanded":""}`,children:""})]}),j&&ht.jsxs("div",{children:[ht.jsxs("label",{children:["Choose Avatar:",ht.jsxs("select",{value:a,onChange:q=>H(q.target.value),disabled:!v.length||r,className:"avatar-select",children:[ht.jsx("option",{value:"",children:"Select an avatar"}),ht.jsx("optgroup",{label:"Official Avatars",children:v.filter(q=>q.from!==3).map((q,it)=>ht.jsxs("option",{value:q.avatar_id,className:q.available?"available":"unavailable",children:[q.available?"":""," ",q.name]},it))}),ht.jsx("optgroup",{label:"Custom Avatars",children:v.filter(q=>q.from===3).map((q,it)=>ht.jsxs("option",{value:q.avatar_id,className:q.available?"available":"unavailable",children:[q.available?"":""," ",q.name]},it))})]}),C&&ht.jsx("span",{className:"loading-text",children:"Loading avatars..."})]}),a&&ht.jsxs("div",{className:"config-item",style:{marginTop:"8px"},children:[ht.jsx("strong",{children:"Selected Avatar ID:"})," ",a]})]})]}),ht.jsx("div",{className:"config-group",children:ht.jsx("div",{className:"streaming-actions",children:r?ht.jsx("button",{className:"stop-streaming-button",onClick:g,children:"Stop Streaming"}):ht.jsx("button",{className:"start-streaming-button",onClick:K,disabled:Y,children:Y?"Starting...":"Start Streaming"})})})]})}/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Pf(s){return s+.5|0}const lc=(s,r,a)=>Math.max(Math.min(s,a),r);function xp(s){return lc(Pf(s*2.55),0,255)}function Tc(s){return lc(Pf(s*255),0,255)}function ua(s){return lc(Pf(s/2.55)/100,0,1)}function aB(s){return lc(Pf(s*100),0,100)}const ws={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Sb=[..."0123456789ABCDEF"],kit=s=>Sb[s&15],Lit=s=>Sb[(s&240)>>4]+Sb[s&15],Jg=s=>(s&240)>>4===(s&15),Mit=s=>Jg(s.r)&&Jg(s.g)&&Jg(s.b)&&Jg(s.a);function xit(s){var r=s.length,a;return s[0]==="#"&&(r===4||r===5?a={r:255&ws[s[1]]*17,g:255&ws[s[2]]*17,b:255&ws[s[3]]*17,a:r===5?ws[s[4]]*17:255}:(r===7||r===9)&&(a={r:ws[s[1]]<<4|ws[s[2]],g:ws[s[3]]<<4|ws[s[4]],b:ws[s[5]]<<4|ws[s[6]],a:r===9?ws[s[7]]<<4|ws[s[8]]:255})),a}const Uit=(s,r)=>s<255?r(s):"";function Vit(s){var r=Mit(s)?kit:Lit;return s?"#"+r(s.r)+r(s.g)+r(s.b)+Uit(s.a,r):void 0}const Fit=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function L5(s,r,a){const d=r*Math.min(a,1-a),h=(f,g=(f+s/30)%12)=>a-d*Math.max(Math.min(g-3,9-g,1),-1);return[h(0),h(8),h(4)]}function Bit(s,r,a){const d=(h,f=(h+s/60)%6)=>a-a*r*Math.max(Math.min(f,4-f,1),0);return[d(5),d(3),d(1)]}function jit(s,r,a){const d=L5(s,1,.5);let h;for(r+a>1&&(h=1/(r+a),r*=h,a*=h),h=0;h<3;h++)d[h]*=1-r-a,d[h]+=r;return d}function Wit(s,r,a,d,h){return s===h?(r-a)/d+(r<a?6:0):r===h?(a-s)/d+2:(s-r)/d+4}function bI(s){const a=s.r/255,d=s.g/255,h=s.b/255,f=Math.max(a,d,h),g=Math.min(a,d,h),v=(f+g)/2;let y,C,O;return f!==g&&(O=f-g,C=v>.5?O/(2-f-g):O/(f+g),y=Wit(a,d,h,O,f),y=y*60+.5),[y|0,C||0,v]}function II(s,r,a,d){return(Array.isArray(r)?s(r[0],r[1],r[2]):s(r,a,d)).map(Tc)}function wI(s,r,a){return II(L5,s,r,a)}function Git(s,r,a){return II(jit,s,r,a)}function Hit(s,r,a){return II(Bit,s,r,a)}function M5(s){return(s%360+360)%360}function zit(s){const r=Fit.exec(s);let a=255,d;if(!r)return;r[5]!==d&&(a=r[6]?xp(+r[5]):Tc(+r[5]));const h=M5(+r[2]),f=+r[3]/100,g=+r[4]/100;return r[1]==="hwb"?d=Git(h,f,g):r[1]==="hsv"?d=Hit(h,f,g):d=wI(h,f,g),{r:d[0],g:d[1],b:d[2],a}}function Kit(s,r){var a=bI(s);a[0]=M5(a[0]+r),a=wI(a),s.r=a[0],s.g=a[1],s.b=a[2]}function Yit(s){if(!s)return;const r=bI(s),a=r[0],d=aB(r[1]),h=aB(r[2]);return s.a<255?`hsla(${a}, ${d}%, ${h}%, ${ua(s.a)})`:`hsl(${a}, ${d}%, ${h}%)`}const cB={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},dB={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function qit(){const s={},r=Object.keys(dB),a=Object.keys(cB);let d,h,f,g,v;for(d=0;d<r.length;d++){for(g=v=r[d],h=0;h<a.length;h++)f=a[h],v=v.replace(f,cB[f]);f=parseInt(dB[g],16),s[v]=[f>>16&255,f>>8&255,f&255]}return s}let Qg;function Xit(s){Qg||(Qg=qit(),Qg.transparent=[0,0,0,0]);const r=Qg[s.toLowerCase()];return r&&{r:r[0],g:r[1],b:r[2],a:r.length===4?r[3]:255}}const Jit=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Qit(s){const r=Jit.exec(s);let a=255,d,h,f;if(r){if(r[7]!==d){const g=+r[7];a=r[8]?xp(g):lc(g*255,0,255)}return d=+r[1],h=+r[3],f=+r[5],d=255&(r[2]?xp(d):lc(d,0,255)),h=255&(r[4]?xp(h):lc(h,0,255)),f=255&(r[6]?xp(f):lc(f,0,255)),{r:d,g:h,b:f,a}}}function Zit(s){return s&&(s.a<255?`rgba(${s.r}, ${s.g}, ${s.b}, ${ua(s.a)})`:`rgb(${s.r}, ${s.g}, ${s.b})`)}const gC=s=>s<=.0031308?s*12.92:Math.pow(s,1/2.4)*1.055-.055,du=s=>s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4);function $it(s,r,a){const d=du(ua(s.r)),h=du(ua(s.g)),f=du(ua(s.b));return{r:Tc(gC(d+a*(du(ua(r.r))-d))),g:Tc(gC(h+a*(du(ua(r.g))-h))),b:Tc(gC(f+a*(du(ua(r.b))-f))),a:s.a+a*(r.a-s.a)}}function Zg(s,r,a){if(s){let d=bI(s);d[r]=Math.max(0,Math.min(d[r]+d[r]*a,r===0?360:1)),d=wI(d),s.r=d[0],s.g=d[1],s.b=d[2]}}function x5(s,r){return s&&Object.assign(r||{},s)}function lB(s){var r={r:0,g:0,b:0,a:255};return Array.isArray(s)?s.length>=3&&(r={r:s[0],g:s[1],b:s[2],a:255},s.length>3&&(r.a=Tc(s[3]))):(r=x5(s,{r:0,g:0,b:0,a:1}),r.a=Tc(r.a)),r}function trt(s){return s.charAt(0)==="r"?Qit(s):zit(s)}class yf{constructor(r){if(r instanceof yf)return r;const a=typeof r;let d;a==="object"?d=lB(r):a==="string"&&(d=xit(r)||Xit(r)||trt(r)),this._rgb=d,this._valid=!!d}get valid(){return this._valid}get rgb(){var r=x5(this._rgb);return r&&(r.a=ua(r.a)),r}set rgb(r){this._rgb=lB(r)}rgbString(){return this._valid?Zit(this._rgb):void 0}hexString(){return this._valid?Vit(this._rgb):void 0}hslString(){return this._valid?Yit(this._rgb):void 0}mix(r,a){if(r){const d=this.rgb,h=r.rgb;let f;const g=a===f?.5:a,v=2*g-1,y=d.a-h.a,C=((v*y===-1?v:(v+y)/(1+v*y))+1)/2;f=1-C,d.r=255&C*d.r+f*h.r+.5,d.g=255&C*d.g+f*h.g+.5,d.b=255&C*d.b+f*h.b+.5,d.a=g*d.a+(1-g)*h.a,this.rgb=d}return this}interpolate(r,a){return r&&(this._rgb=$it(this._rgb,r._rgb,a)),this}clone(){return new yf(this.rgb)}alpha(r){return this._rgb.a=Tc(r),this}clearer(r){const a=this._rgb;return a.a*=1-r,this}greyscale(){const r=this._rgb,a=Pf(r.r*.3+r.g*.59+r.b*.11);return r.r=r.g=r.b=a,this}opaquer(r){const a=this._rgb;return a.a*=1+r,this}negate(){const r=this._rgb;return r.r=255-r.r,r.g=255-r.g,r.b=255-r.b,this}lighten(r){return Zg(this._rgb,2,r),this}darken(r){return Zg(this._rgb,2,-r),this}saturate(r){return Zg(this._rgb,1,r),this}desaturate(r){return Zg(this._rgb,1,-r),this}rotate(r){return Kit(this._rgb,r),this}}/*!
 * Chart.js v4.5.0
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function oa(){}const ert=(()=>{let s=0;return()=>s++})();function ln(s){return s==null}function jn(s){if(Array.isArray&&Array.isArray(s))return!0;const r=Object.prototype.toString.call(s);return r.slice(0,7)==="[object"&&r.slice(-6)==="Array]"}function nn(s){return s!==null&&Object.prototype.toString.call(s)==="[object Object]"}function Ii(s){return(typeof s=="number"||s instanceof Number)&&isFinite(+s)}function Xr(s,r){return Ii(s)?s:r}function ze(s,r){return typeof s>"u"?r:s}const nrt=(s,r)=>typeof s=="string"&&s.endsWith("%")?parseFloat(s)/100*r:+s;function Rn(s,r,a){if(s&&typeof s.call=="function")return s.apply(a,r)}function dn(s,r,a,d){let h,f,g;if(jn(s))if(f=s.length,d)for(h=f-1;h>=0;h--)r.call(a,s[h],h);else for(h=0;h<f;h++)r.call(a,s[h],h);else if(nn(s))for(g=Object.keys(s),f=g.length,h=0;h<f;h++)r.call(a,s[g[h]],g[h])}function QE(s,r){let a,d,h,f;if(!s||!r||s.length!==r.length)return!1;for(a=0,d=s.length;a<d;++a)if(h=s[a],f=r[a],h.datasetIndex!==f.datasetIndex||h.index!==f.index)return!1;return!0}function ZE(s){if(jn(s))return s.map(ZE);if(nn(s)){const r=Object.create(null),a=Object.keys(s),d=a.length;let h=0;for(;h<d;++h)r[a[h]]=ZE(s[a[h]]);return r}return s}function U5(s){return["__proto__","prototype","constructor"].indexOf(s)===-1}function irt(s,r,a,d){if(!U5(s))return;const h=r[s],f=a[s];nn(h)&&nn(f)?Rf(h,f,d):r[s]=ZE(f)}function Rf(s,r,a){const d=jn(r)?r:[r],h=d.length;if(!nn(s))return s;a=a||{};const f=a.merger||irt;let g;for(let v=0;v<h;++v){if(g=d[v],!nn(g))continue;const y=Object.keys(g);for(let C=0,O=y.length;C<O;++C)f(y[C],s,g,a)}return s}function $p(s,r){return Rf(s,r,{merger:rrt})}function rrt(s,r,a){if(!U5(s))return;const d=r[s],h=a[s];nn(d)&&nn(h)?$p(d,h):Object.prototype.hasOwnProperty.call(r,s)||(r[s]=ZE(h))}const uB={"":s=>s,x:s=>s.x,y:s=>s.y};function srt(s){const r=s.split("."),a=[];let d="";for(const h of r)d+=h,d.endsWith("\\")?d=d.slice(0,-1)+".":(a.push(d),d="");return a}function ort(s){const r=srt(s);return a=>{for(const d of r){if(d==="")break;a=a&&a[d]}return a}}function $E(s,r){return(uB[r]||(uB[r]=ort(r)))(s)}function AI(s){return s.charAt(0).toUpperCase()+s.slice(1)}const tS=s=>typeof s<"u",Cc=s=>typeof s=="function",hB=(s,r)=>{if(s.size!==r.size)return!1;for(const a of s)if(!r.has(a))return!1;return!0};function art(s){return s.type==="mouseup"||s.type==="click"||s.type==="contextmenu"}const li=Math.PI,Ls=2*li,crt=Ls+li,eS=Number.POSITIVE_INFINITY,drt=li/180,Zr=li/2,md=li/4,pB=li*2/3,uc=Math.log10,Vu=Math.sign;function tf(s,r,a){return Math.abs(s-r)<a}function fB(s){const r=Math.round(s);s=tf(s,r,s/1e3)?r:s;const a=Math.pow(10,Math.floor(uc(s))),d=s/a;return(d<=1?1:d<=2?2:d<=5?5:10)*a}function lrt(s){const r=[],a=Math.sqrt(s);let d;for(d=1;d<a;d++)s%d===0&&(r.push(d),r.push(s/d));return a===(a|0)&&r.push(a),r.sort((h,f)=>h-f).pop(),r}function urt(s){return typeof s=="symbol"||typeof s=="object"&&s!==null&&!(Symbol.toPrimitive in s||"toString"in s||"valueOf"in s)}function Cf(s){return!urt(s)&&!isNaN(parseFloat(s))&&isFinite(s)}function hrt(s,r){const a=Math.round(s);return a-r<=s&&a+r>=s}function V5(s,r,a){let d,h,f;for(d=0,h=s.length;d<h;d++)f=s[d][a],isNaN(f)||(r.min=Math.min(r.min,f),r.max=Math.max(r.max,f))}function hc(s){return s*(li/180)}function OI(s){return s*(180/li)}function mB(s){if(!Ii(s))return;let r=1,a=0;for(;Math.round(s*r)/r!==s;)r*=10,a++;return a}function prt(s,r){const a=r.x-s.x,d=r.y-s.y,h=Math.sqrt(a*a+d*d);let f=Math.atan2(d,a);return f<-.5*li&&(f+=Ls),{angle:f,distance:h}}function vb(s,r){return Math.sqrt(Math.pow(r.x-s.x,2)+Math.pow(r.y-s.y,2))}function frt(s,r){return(s-r+crt)%Ls-li}function oo(s){return(s%Ls+Ls)%Ls}function F5(s,r,a,d){const h=oo(s),f=oo(r),g=oo(a),v=oo(f-h),y=oo(g-h),C=oo(h-f),O=oo(h-g);return h===f||h===g||d&&f===g||v>y&&C<O}function Ds(s,r,a){return Math.max(r,Math.min(a,s))}function mrt(s){return Ds(s,-32768,32767)}function Up(s,r,a,d=1e-6){return s>=Math.min(r,a)-d&&s<=Math.max(r,a)+d}function NI(s,r,a){a=a||(g=>s[g]<r);let d=s.length-1,h=0,f;for(;d-h>1;)f=h+d>>1,a(f)?h=f:d=f;return{lo:h,hi:d}}const wd=(s,r,a,d)=>NI(s,a,d?h=>{const f=s[h][r];return f<a||f===a&&s[h+1][r]===a}:h=>s[h][r]<a),_rt=(s,r,a)=>NI(s,a,d=>s[d][r]>=a);function grt(s,r,a){let d=0,h=s.length;for(;d<h&&s[d]<r;)d++;for(;h>d&&s[h-1]>a;)h--;return d>0||h<s.length?s.slice(d,h):s}const B5=["push","pop","shift","splice","unshift"];function Ert(s,r){if(s._chartjs){s._chartjs.listeners.push(r);return}Object.defineProperty(s,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[r]}}),B5.forEach(a=>{const d="_onData"+AI(a),h=s[a];Object.defineProperty(s,a,{configurable:!0,enumerable:!1,value(...f){const g=h.apply(this,f);return s._chartjs.listeners.forEach(v=>{typeof v[d]=="function"&&v[d](...f)}),g}})})}function _B(s,r){const a=s._chartjs;if(!a)return;const d=a.listeners,h=d.indexOf(r);h!==-1&&d.splice(h,1),!(d.length>0)&&(B5.forEach(f=>{delete s[f]}),delete s._chartjs)}function Srt(s){const r=new Set(s);return r.size===s.length?s:Array.from(r)}const j5=function(){return typeof window>"u"?function(s){return s()}:window.requestAnimationFrame}();function W5(s,r){let a=[],d=!1;return function(...h){a=h,d||(d=!0,j5.call(window,()=>{d=!1,s.apply(r,a)}))}}function vrt(s,r){let a;return function(...d){return r?(clearTimeout(a),a=setTimeout(s,r,d)):s.apply(this,d),r}}const DI=s=>s==="start"?"left":s==="end"?"right":"center",Ji=(s,r,a)=>s==="start"?r:s==="end"?a:(r+a)/2,Trt=(s,r,a,d)=>s===(d?"left":"right")?a:s==="center"?(r+a)/2:r;function yrt(s,r,a){const d=r.length;let h=0,f=d;if(s._sorted){const{iScale:g,vScale:v,_parsed:y}=s,C=s.dataset&&s.dataset.options?s.dataset.options.spanGaps:null,O=g.axis,{min:k,max:M,minDefined:j,maxDefined:z}=g.getUserBounds();if(j){if(h=Math.min(wd(y,O,k).lo,a?d:wd(r,O,g.getPixelForValue(k)).lo),C){const Y=y.slice(0,h+1).reverse().findIndex(Z=>!ln(Z[v.axis]));h-=Math.max(0,Y)}h=Ds(h,0,d-1)}if(z){let Y=Math.max(wd(y,g.axis,M,!0).hi+1,a?0:wd(r,O,g.getPixelForValue(M),!0).hi+1);if(C){const Z=y.slice(Y-1).findIndex(H=>!ln(H[v.axis]));Y+=Math.max(0,Z)}f=Ds(Y,h,d)-h}else f=d-h}return{start:h,count:f}}function Rrt(s){const{xScale:r,yScale:a,_scaleRanges:d}=s,h={xmin:r.min,xmax:r.max,ymin:a.min,ymax:a.max};if(!d)return s._scaleRanges=h,!0;const f=d.xmin!==r.min||d.xmax!==r.max||d.ymin!==a.min||d.ymax!==a.max;return Object.assign(d,h),f}const $g=s=>s===0||s===1,gB=(s,r,a)=>-(Math.pow(2,10*(s-=1))*Math.sin((s-r)*Ls/a)),EB=(s,r,a)=>Math.pow(2,-10*s)*Math.sin((s-r)*Ls/a)+1,ef={linear:s=>s,easeInQuad:s=>s*s,easeOutQuad:s=>-s*(s-2),easeInOutQuad:s=>(s/=.5)<1?.5*s*s:-.5*(--s*(s-2)-1),easeInCubic:s=>s*s*s,easeOutCubic:s=>(s-=1)*s*s+1,easeInOutCubic:s=>(s/=.5)<1?.5*s*s*s:.5*((s-=2)*s*s+2),easeInQuart:s=>s*s*s*s,easeOutQuart:s=>-((s-=1)*s*s*s-1),easeInOutQuart:s=>(s/=.5)<1?.5*s*s*s*s:-.5*((s-=2)*s*s*s-2),easeInQuint:s=>s*s*s*s*s,easeOutQuint:s=>(s-=1)*s*s*s*s+1,easeInOutQuint:s=>(s/=.5)<1?.5*s*s*s*s*s:.5*((s-=2)*s*s*s*s+2),easeInSine:s=>-Math.cos(s*Zr)+1,easeOutSine:s=>Math.sin(s*Zr),easeInOutSine:s=>-.5*(Math.cos(li*s)-1),easeInExpo:s=>s===0?0:Math.pow(2,10*(s-1)),easeOutExpo:s=>s===1?1:-Math.pow(2,-10*s)+1,easeInOutExpo:s=>$g(s)?s:s<.5?.5*Math.pow(2,10*(s*2-1)):.5*(-Math.pow(2,-10*(s*2-1))+2),easeInCirc:s=>s>=1?s:-(Math.sqrt(1-s*s)-1),easeOutCirc:s=>Math.sqrt(1-(s-=1)*s),easeInOutCirc:s=>(s/=.5)<1?-.5*(Math.sqrt(1-s*s)-1):.5*(Math.sqrt(1-(s-=2)*s)+1),easeInElastic:s=>$g(s)?s:gB(s,.075,.3),easeOutElastic:s=>$g(s)?s:EB(s,.075,.3),easeInOutElastic(s){return $g(s)?s:s<.5?.5*gB(s*2,.1125,.45):.5+.5*EB(s*2-1,.1125,.45)},easeInBack(s){return s*s*((1.70158+1)*s-1.70158)},easeOutBack(s){return(s-=1)*s*((1.70158+1)*s+1.70158)+1},easeInOutBack(s){let r=1.70158;return(s/=.5)<1?.5*(s*s*(((r*=1.525)+1)*s-r)):.5*((s-=2)*s*(((r*=1.525)+1)*s+r)+2)},easeInBounce:s=>1-ef.easeOutBounce(1-s),easeOutBounce(s){return s<1/2.75?7.5625*s*s:s<2/2.75?7.5625*(s-=1.5/2.75)*s+.75:s<2.5/2.75?7.5625*(s-=2.25/2.75)*s+.9375:7.5625*(s-=2.625/2.75)*s+.984375},easeInOutBounce:s=>s<.5?ef.easeInBounce(s*2)*.5:ef.easeOutBounce(s*2-1)*.5+.5};function PI(s){if(s&&typeof s=="object"){const r=s.toString();return r==="[object CanvasPattern]"||r==="[object CanvasGradient]"}return!1}function SB(s){return PI(s)?s:new yf(s)}function EC(s){return PI(s)?s:new yf(s).saturate(.5).darken(.1).hexString()}const Crt=["x","y","borderWidth","radius","tension"],brt=["color","borderColor","backgroundColor"];function Irt(s){s.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),s.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:r=>r!=="onProgress"&&r!=="onComplete"&&r!=="fn"}),s.set("animations",{colors:{type:"color",properties:brt},numbers:{type:"number",properties:Crt}}),s.describe("animations",{_fallback:"animation"}),s.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:r=>r|0}}}})}function wrt(s){s.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const vB=new Map;function Art(s,r){r=r||{};const a=s+JSON.stringify(r);let d=vB.get(a);return d||(d=new Intl.NumberFormat(s,r),vB.set(a,d)),d}function kI(s,r,a){return Art(r,a).format(s)}const G5={values(s){return jn(s)?s:""+s},numeric(s,r,a){if(s===0)return"0";const d=this.chart.options.locale;let h,f=s;if(a.length>1){const C=Math.max(Math.abs(a[0].value),Math.abs(a[a.length-1].value));(C<1e-4||C>1e15)&&(h="scientific"),f=Ort(s,a)}const g=uc(Math.abs(f)),v=isNaN(g)?1:Math.max(Math.min(-1*Math.floor(g),20),0),y={notation:h,minimumFractionDigits:v,maximumFractionDigits:v};return Object.assign(y,this.options.ticks.format),kI(s,d,y)},logarithmic(s,r,a){if(s===0)return"0";const d=a[r].significand||s/Math.pow(10,Math.floor(uc(s)));return[1,2,3,5,10,15].includes(d)||r>.8*a.length?G5.numeric.call(this,s,r,a):""}};function Ort(s,r){let a=r.length>3?r[2].value-r[1].value:r[1].value-r[0].value;return Math.abs(a)>=1&&s!==Math.floor(s)&&(a=s-Math.floor(s)),a}var CS={formatters:G5};function Nrt(s){s.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(r,a)=>a.lineWidth,tickColor:(r,a)=>a.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:CS.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),s.route("scale.ticks","color","","color"),s.route("scale.grid","color","","borderColor"),s.route("scale.border","color","","borderColor"),s.route("scale.title","color","","color"),s.describe("scale",{_fallback:!1,_scriptable:r=>!r.startsWith("before")&&!r.startsWith("after")&&r!=="callback"&&r!=="parser",_indexable:r=>r!=="borderDash"&&r!=="tickBorderDash"&&r!=="dash"}),s.describe("scales",{_fallback:"scale"}),s.describe("scale.ticks",{_scriptable:r=>r!=="backdropPadding"&&r!=="callback",_indexable:r=>r!=="backdropPadding"})}const xd=Object.create(null),Tb=Object.create(null);function nf(s,r){if(!r)return s;const a=r.split(".");for(let d=0,h=a.length;d<h;++d){const f=a[d];s=s[f]||(s[f]=Object.create(null))}return s}function SC(s,r,a){return typeof r=="string"?Rf(nf(s,r),a):Rf(nf(s,""),r)}class Drt{constructor(r,a){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=d=>d.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(d,h)=>EC(h.backgroundColor),this.hoverBorderColor=(d,h)=>EC(h.borderColor),this.hoverColor=(d,h)=>EC(h.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(r),this.apply(a)}set(r,a){return SC(this,r,a)}get(r){return nf(this,r)}describe(r,a){return SC(Tb,r,a)}override(r,a){return SC(xd,r,a)}route(r,a,d,h){const f=nf(this,r),g=nf(this,d),v="_"+a;Object.defineProperties(f,{[v]:{value:f[a],writable:!0},[a]:{enumerable:!0,get(){const y=this[v],C=g[h];return nn(y)?Object.assign({},C,y):ze(y,C)},set(y){this[v]=y}}})}apply(r){r.forEach(a=>a(this))}}var Jn=new Drt({_scriptable:s=>!s.startsWith("on"),_indexable:s=>s!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Irt,wrt,Nrt]);function Prt(s){return!s||ln(s.size)||ln(s.family)?null:(s.style?s.style+" ":"")+(s.weight?s.weight+" ":"")+s.size+"px "+s.family}function nS(s,r,a,d,h){let f=r[h];return f||(f=r[h]=s.measureText(h).width,a.push(h)),f>d&&(d=f),d}function krt(s,r,a,d){d=d||{};let h=d.data=d.data||{},f=d.garbageCollect=d.garbageCollect||[];d.font!==r&&(h=d.data={},f=d.garbageCollect=[],d.font=r),s.save(),s.font=r;let g=0;const v=a.length;let y,C,O,k,M;for(y=0;y<v;y++)if(k=a[y],k!=null&&!jn(k))g=nS(s,h,f,g,k);else if(jn(k))for(C=0,O=k.length;C<O;C++)M=k[C],M!=null&&!jn(M)&&(g=nS(s,h,f,g,M));s.restore();const j=f.length/2;if(j>a.length){for(y=0;y<j;y++)delete h[f[y]];f.splice(0,j)}return g}function _d(s,r,a){const d=s.currentDevicePixelRatio,h=a!==0?Math.max(a/2,.5):0;return Math.round((r-h)*d)/d+h}function TB(s,r){!r&&!s||(r=r||s.getContext("2d"),r.save(),r.resetTransform(),r.clearRect(0,0,s.width,s.height),r.restore())}function yb(s,r,a,d){H5(s,r,a,d,null)}function H5(s,r,a,d,h){let f,g,v,y,C,O,k,M;const j=r.pointStyle,z=r.rotation,Y=r.radius;let Z=(z||0)*drt;if(j&&typeof j=="object"&&(f=j.toString(),f==="[object HTMLImageElement]"||f==="[object HTMLCanvasElement]")){s.save(),s.translate(a,d),s.rotate(Z),s.drawImage(j,-j.width/2,-j.height/2,j.width,j.height),s.restore();return}if(!(isNaN(Y)||Y<=0)){switch(s.beginPath(),j){default:h?s.ellipse(a,d,h/2,Y,0,0,Ls):s.arc(a,d,Y,0,Ls),s.closePath();break;case"triangle":O=h?h/2:Y,s.moveTo(a+Math.sin(Z)*O,d-Math.cos(Z)*Y),Z+=pB,s.lineTo(a+Math.sin(Z)*O,d-Math.cos(Z)*Y),Z+=pB,s.lineTo(a+Math.sin(Z)*O,d-Math.cos(Z)*Y),s.closePath();break;case"rectRounded":C=Y*.516,y=Y-C,g=Math.cos(Z+md)*y,k=Math.cos(Z+md)*(h?h/2-C:y),v=Math.sin(Z+md)*y,M=Math.sin(Z+md)*(h?h/2-C:y),s.arc(a-k,d-v,C,Z-li,Z-Zr),s.arc(a+M,d-g,C,Z-Zr,Z),s.arc(a+k,d+v,C,Z,Z+Zr),s.arc(a-M,d+g,C,Z+Zr,Z+li),s.closePath();break;case"rect":if(!z){y=Math.SQRT1_2*Y,O=h?h/2:y,s.rect(a-O,d-y,2*O,2*y);break}Z+=md;case"rectRot":k=Math.cos(Z)*(h?h/2:Y),g=Math.cos(Z)*Y,v=Math.sin(Z)*Y,M=Math.sin(Z)*(h?h/2:Y),s.moveTo(a-k,d-v),s.lineTo(a+M,d-g),s.lineTo(a+k,d+v),s.lineTo(a-M,d+g),s.closePath();break;case"crossRot":Z+=md;case"cross":k=Math.cos(Z)*(h?h/2:Y),g=Math.cos(Z)*Y,v=Math.sin(Z)*Y,M=Math.sin(Z)*(h?h/2:Y),s.moveTo(a-k,d-v),s.lineTo(a+k,d+v),s.moveTo(a+M,d-g),s.lineTo(a-M,d+g);break;case"star":k=Math.cos(Z)*(h?h/2:Y),g=Math.cos(Z)*Y,v=Math.sin(Z)*Y,M=Math.sin(Z)*(h?h/2:Y),s.moveTo(a-k,d-v),s.lineTo(a+k,d+v),s.moveTo(a+M,d-g),s.lineTo(a-M,d+g),Z+=md,k=Math.cos(Z)*(h?h/2:Y),g=Math.cos(Z)*Y,v=Math.sin(Z)*Y,M=Math.sin(Z)*(h?h/2:Y),s.moveTo(a-k,d-v),s.lineTo(a+k,d+v),s.moveTo(a+M,d-g),s.lineTo(a-M,d+g);break;case"line":g=h?h/2:Math.cos(Z)*Y,v=Math.sin(Z)*Y,s.moveTo(a-g,d-v),s.lineTo(a+g,d+v);break;case"dash":s.moveTo(a,d),s.lineTo(a+Math.cos(Z)*(h?h/2:Y),d+Math.sin(Z)*Y);break;case!1:s.closePath();break}s.fill(),r.borderWidth>0&&s.stroke()}}function fa(s,r,a){return a=a||.5,!r||s&&s.x>r.left-a&&s.x<r.right+a&&s.y>r.top-a&&s.y<r.bottom+a}function LI(s,r){s.save(),s.beginPath(),s.rect(r.left,r.top,r.right-r.left,r.bottom-r.top),s.clip()}function MI(s){s.restore()}function Lrt(s,r,a,d,h){if(!r)return s.lineTo(a.x,a.y);if(h==="middle"){const f=(r.x+a.x)/2;s.lineTo(f,r.y),s.lineTo(f,a.y)}else h==="after"!=!!d?s.lineTo(r.x,a.y):s.lineTo(a.x,r.y);s.lineTo(a.x,a.y)}function Mrt(s,r,a,d){if(!r)return s.lineTo(a.x,a.y);s.bezierCurveTo(d?r.cp1x:r.cp2x,d?r.cp1y:r.cp2y,d?a.cp2x:a.cp1x,d?a.cp2y:a.cp1y,a.x,a.y)}function xrt(s,r){r.translation&&s.translate(r.translation[0],r.translation[1]),ln(r.rotation)||s.rotate(r.rotation),r.color&&(s.fillStyle=r.color),r.textAlign&&(s.textAlign=r.textAlign),r.textBaseline&&(s.textBaseline=r.textBaseline)}function Urt(s,r,a,d,h){if(h.strikethrough||h.underline){const f=s.measureText(d),g=r-f.actualBoundingBoxLeft,v=r+f.actualBoundingBoxRight,y=a-f.actualBoundingBoxAscent,C=a+f.actualBoundingBoxDescent,O=h.strikethrough?(y+C)/2:C;s.strokeStyle=s.fillStyle,s.beginPath(),s.lineWidth=h.decorationWidth||2,s.moveTo(g,O),s.lineTo(v,O),s.stroke()}}function Vrt(s,r){const a=s.fillStyle;s.fillStyle=r.color,s.fillRect(r.left,r.top,r.width,r.height),s.fillStyle=a}function Ud(s,r,a,d,h,f={}){const g=jn(r)?r:[r],v=f.strokeWidth>0&&f.strokeColor!=="";let y,C;for(s.save(),s.font=h.string,xrt(s,f),y=0;y<g.length;++y)C=g[y],f.backdrop&&Vrt(s,f.backdrop),v&&(f.strokeColor&&(s.strokeStyle=f.strokeColor),ln(f.strokeWidth)||(s.lineWidth=f.strokeWidth),s.strokeText(C,a,d,f.maxWidth)),s.fillText(C,a,d,f.maxWidth),Urt(s,a,d,C,f),d+=Number(h.lineHeight);s.restore()}function iS(s,r){const{x:a,y:d,w:h,h:f,radius:g}=r;s.arc(a+g.topLeft,d+g.topLeft,g.topLeft,1.5*li,li,!0),s.lineTo(a,d+f-g.bottomLeft),s.arc(a+g.bottomLeft,d+f-g.bottomLeft,g.bottomLeft,li,Zr,!0),s.lineTo(a+h-g.bottomRight,d+f),s.arc(a+h-g.bottomRight,d+f-g.bottomRight,g.bottomRight,Zr,0,!0),s.lineTo(a+h,d+g.topRight),s.arc(a+h-g.topRight,d+g.topRight,g.topRight,0,-Zr,!0),s.lineTo(a+g.topLeft,d)}const Frt=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Brt=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function jrt(s,r){const a=(""+s).match(Frt);if(!a||a[1]==="normal")return r*1.2;switch(s=+a[2],a[3]){case"px":return s;case"%":s/=100;break}return r*s}const Wrt=s=>+s||0;function z5(s,r){const a={},d=nn(r),h=d?Object.keys(r):r,f=nn(s)?d?g=>ze(s[g],s[r[g]]):g=>s[g]:()=>s;for(const g of h)a[g]=Wrt(f(g));return a}function Grt(s){return z5(s,{top:"y",right:"x",bottom:"y",left:"x"})}function Ou(s){return z5(s,["topLeft","topRight","bottomLeft","bottomRight"])}function tr(s){const r=Grt(s);return r.width=r.left+r.right,r.height=r.top+r.bottom,r}function Ei(s,r){s=s||{},r=r||Jn.font;let a=ze(s.size,r.size);typeof a=="string"&&(a=parseInt(a,10));let d=ze(s.style,r.style);d&&!(""+d).match(Brt)&&(console.warn('Invalid font style specified: "'+d+'"'),d=void 0);const h={family:ze(s.family,r.family),lineHeight:jrt(ze(s.lineHeight,r.lineHeight),a),size:a,style:d,weight:ze(s.weight,r.weight),string:""};return h.string=Prt(h),h}function tE(s,r,a,d){let h=!0,f,g,v;for(f=0,g=s.length;f<g;++f)if(v=s[f],v!==void 0&&(r!==void 0&&typeof v=="function"&&(v=v(r),h=!1),a!==void 0&&jn(v)&&(v=v[a%v.length],h=!1),v!==void 0))return d&&!h&&(d.cacheable=!1),v}function Hrt(s,r,a){const{min:d,max:h}=s,f=nrt(r,(h-d)/2),g=(v,y)=>a&&v===0?0:v+y;return{min:g(d,-Math.abs(f)),max:g(h,f)}}function Ac(s,r){return Object.assign(Object.create(s),r)}function xI(s,r=[""],a,d,h=()=>s[0]){const f=a||s;typeof d>"u"&&(d=X5("_fallback",s));const g={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:s,_rootScopes:f,_fallback:d,_getTarget:h,override:v=>xI([v,...s],r,f,d)};return new Proxy(g,{deleteProperty(v,y){return delete v[y],delete v._keys,delete s[0][y],!0},get(v,y){return Y5(v,y,()=>Zrt(y,r,s,v))},getOwnPropertyDescriptor(v,y){return Reflect.getOwnPropertyDescriptor(v._scopes[0],y)},getPrototypeOf(){return Reflect.getPrototypeOf(s[0])},has(v,y){return RB(v).includes(y)},ownKeys(v){return RB(v)},set(v,y,C){const O=v._storage||(v._storage=h());return v[y]=O[y]=C,delete v._keys,!0}})}function Fu(s,r,a,d){const h={_cacheable:!1,_proxy:s,_context:r,_subProxy:a,_stack:new Set,_descriptors:K5(s,d),setContext:f=>Fu(s,f,a,d),override:f=>Fu(s.override(f),r,a,d)};return new Proxy(h,{deleteProperty(f,g){return delete f[g],delete s[g],!0},get(f,g,v){return Y5(f,g,()=>Krt(f,g,v))},getOwnPropertyDescriptor(f,g){return f._descriptors.allKeys?Reflect.has(s,g)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(s,g)},getPrototypeOf(){return Reflect.getPrototypeOf(s)},has(f,g){return Reflect.has(s,g)},ownKeys(){return Reflect.ownKeys(s)},set(f,g,v){return s[g]=v,delete f[g],!0}})}function K5(s,r={scriptable:!0,indexable:!0}){const{_scriptable:a=r.scriptable,_indexable:d=r.indexable,_allKeys:h=r.allKeys}=s;return{allKeys:h,scriptable:a,indexable:d,isScriptable:Cc(a)?a:()=>a,isIndexable:Cc(d)?d:()=>d}}const zrt=(s,r)=>s?s+AI(r):r,UI=(s,r)=>nn(r)&&s!=="adapters"&&(Object.getPrototypeOf(r)===null||r.constructor===Object);function Y5(s,r,a){if(Object.prototype.hasOwnProperty.call(s,r)||r==="constructor")return s[r];const d=a();return s[r]=d,d}function Krt(s,r,a){const{_proxy:d,_context:h,_subProxy:f,_descriptors:g}=s;let v=d[r];return Cc(v)&&g.isScriptable(r)&&(v=Yrt(r,v,s,a)),jn(v)&&v.length&&(v=qrt(r,v,s,g.isIndexable)),UI(r,v)&&(v=Fu(v,h,f&&f[r],g)),v}function Yrt(s,r,a,d){const{_proxy:h,_context:f,_subProxy:g,_stack:v}=a;if(v.has(s))throw new Error("Recursion detected: "+Array.from(v).join("->")+"->"+s);v.add(s);let y=r(f,g||d);return v.delete(s),UI(s,y)&&(y=VI(h._scopes,h,s,y)),y}function qrt(s,r,a,d){const{_proxy:h,_context:f,_subProxy:g,_descriptors:v}=a;if(typeof f.index<"u"&&d(s))return r[f.index%r.length];if(nn(r[0])){const y=r,C=h._scopes.filter(O=>O!==y);r=[];for(const O of y){const k=VI(C,h,s,O);r.push(Fu(k,f,g&&g[s],v))}}return r}function q5(s,r,a){return Cc(s)?s(r,a):s}const Xrt=(s,r)=>s===!0?r:typeof s=="string"?$E(r,s):void 0;function Jrt(s,r,a,d,h){for(const f of r){const g=Xrt(a,f);if(g){s.add(g);const v=q5(g._fallback,a,h);if(typeof v<"u"&&v!==a&&v!==d)return v}else if(g===!1&&typeof d<"u"&&a!==d)return null}return!1}function VI(s,r,a,d){const h=r._rootScopes,f=q5(r._fallback,a,d),g=[...s,...h],v=new Set;v.add(d);let y=yB(v,g,a,f||a,d);return y===null||typeof f<"u"&&f!==a&&(y=yB(v,g,f,y,d),y===null)?!1:xI(Array.from(v),[""],h,f,()=>Qrt(r,a,d))}function yB(s,r,a,d,h){for(;a;)a=Jrt(s,r,a,d,h);return a}function Qrt(s,r,a){const d=s._getTarget();r in d||(d[r]={});const h=d[r];return jn(h)&&nn(a)?a:h||{}}function Zrt(s,r,a,d){let h;for(const f of r)if(h=X5(zrt(f,s),a),typeof h<"u")return UI(s,h)?VI(a,d,s,h):h}function X5(s,r){for(const a of r){if(!a)continue;const d=a[s];if(typeof d<"u")return d}}function RB(s){let r=s._keys;return r||(r=s._keys=$rt(s._scopes)),r}function $rt(s){const r=new Set;for(const a of s)for(const d of Object.keys(a).filter(h=>!h.startsWith("_")))r.add(d);return Array.from(r)}const tst=Number.EPSILON||1e-14,Bu=(s,r)=>r<s.length&&!s[r].skip&&s[r],J5=s=>s==="x"?"y":"x";function est(s,r,a,d){const h=s.skip?r:s,f=r,g=a.skip?r:a,v=vb(f,h),y=vb(g,f);let C=v/(v+y),O=y/(v+y);C=isNaN(C)?0:C,O=isNaN(O)?0:O;const k=d*C,M=d*O;return{previous:{x:f.x-k*(g.x-h.x),y:f.y-k*(g.y-h.y)},next:{x:f.x+M*(g.x-h.x),y:f.y+M*(g.y-h.y)}}}function nst(s,r,a){const d=s.length;let h,f,g,v,y,C=Bu(s,0);for(let O=0;O<d-1;++O)if(y=C,C=Bu(s,O+1),!(!y||!C)){if(tf(r[O],0,tst)){a[O]=a[O+1]=0;continue}h=a[O]/r[O],f=a[O+1]/r[O],v=Math.pow(h,2)+Math.pow(f,2),!(v<=9)&&(g=3/Math.sqrt(v),a[O]=h*g*r[O],a[O+1]=f*g*r[O])}}function ist(s,r,a="x"){const d=J5(a),h=s.length;let f,g,v,y=Bu(s,0);for(let C=0;C<h;++C){if(g=v,v=y,y=Bu(s,C+1),!v)continue;const O=v[a],k=v[d];g&&(f=(O-g[a])/3,v[`cp1${a}`]=O-f,v[`cp1${d}`]=k-f*r[C]),y&&(f=(y[a]-O)/3,v[`cp2${a}`]=O+f,v[`cp2${d}`]=k+f*r[C])}}function rst(s,r="x"){const a=J5(r),d=s.length,h=Array(d).fill(0),f=Array(d);let g,v,y,C=Bu(s,0);for(g=0;g<d;++g)if(v=y,y=C,C=Bu(s,g+1),!!y){if(C){const O=C[r]-y[r];h[g]=O!==0?(C[a]-y[a])/O:0}f[g]=v?C?Vu(h[g-1])!==Vu(h[g])?0:(h[g-1]+h[g])/2:h[g-1]:h[g]}nst(s,h,f),ist(s,f,r)}function eE(s,r,a){return Math.max(Math.min(s,a),r)}function sst(s,r){let a,d,h,f,g,v=fa(s[0],r);for(a=0,d=s.length;a<d;++a)g=f,f=v,v=a<d-1&&fa(s[a+1],r),f&&(h=s[a],g&&(h.cp1x=eE(h.cp1x,r.left,r.right),h.cp1y=eE(h.cp1y,r.top,r.bottom)),v&&(h.cp2x=eE(h.cp2x,r.left,r.right),h.cp2y=eE(h.cp2y,r.top,r.bottom)))}function ost(s,r,a,d,h){let f,g,v,y;if(r.spanGaps&&(s=s.filter(C=>!C.skip)),r.cubicInterpolationMode==="monotone")rst(s,h);else{let C=d?s[s.length-1]:s[0];for(f=0,g=s.length;f<g;++f)v=s[f],y=est(C,v,s[Math.min(f+1,g-(d?0:1))%g],r.tension),v.cp1x=y.previous.x,v.cp1y=y.previous.y,v.cp2x=y.next.x,v.cp2y=y.next.y,C=v}r.capBezierPoints&&sst(s,a)}function FI(){return typeof window<"u"&&typeof document<"u"}function BI(s){let r=s.parentNode;return r&&r.toString()==="[object ShadowRoot]"&&(r=r.host),r}function rS(s,r,a){let d;return typeof s=="string"?(d=parseInt(s,10),s.indexOf("%")!==-1&&(d=d/100*r.parentNode[a])):d=s,d}const bS=s=>s.ownerDocument.defaultView.getComputedStyle(s,null);function ast(s,r){return bS(s).getPropertyValue(r)}const cst=["top","right","bottom","left"];function Nd(s,r,a){const d={};a=a?"-"+a:"";for(let h=0;h<4;h++){const f=cst[h];d[f]=parseFloat(s[r+"-"+f+a])||0}return d.width=d.left+d.right,d.height=d.top+d.bottom,d}const dst=(s,r,a)=>(s>0||r>0)&&(!a||!a.shadowRoot);function lst(s,r){const a=s.touches,d=a&&a.length?a[0]:s,{offsetX:h,offsetY:f}=d;let g=!1,v,y;if(dst(h,f,s.target))v=h,y=f;else{const C=r.getBoundingClientRect();v=d.clientX-C.left,y=d.clientY-C.top,g=!0}return{x:v,y,box:g}}function Td(s,r){if("native"in s)return s;const{canvas:a,currentDevicePixelRatio:d}=r,h=bS(a),f=h.boxSizing==="border-box",g=Nd(h,"padding"),v=Nd(h,"border","width"),{x:y,y:C,box:O}=lst(s,a),k=g.left+(O&&v.left),M=g.top+(O&&v.top);let{width:j,height:z}=r;return f&&(j-=g.width+v.width,z-=g.height+v.height),{x:Math.round((y-k)/j*a.width/d),y:Math.round((C-M)/z*a.height/d)}}function ust(s,r,a){let d,h;if(r===void 0||a===void 0){const f=s&&BI(s);if(!f)r=s.clientWidth,a=s.clientHeight;else{const g=f.getBoundingClientRect(),v=bS(f),y=Nd(v,"border","width"),C=Nd(v,"padding");r=g.width-C.width-y.width,a=g.height-C.height-y.height,d=rS(v.maxWidth,f,"clientWidth"),h=rS(v.maxHeight,f,"clientHeight")}}return{width:r,height:a,maxWidth:d||eS,maxHeight:h||eS}}const nE=s=>Math.round(s*10)/10;function hst(s,r,a,d){const h=bS(s),f=Nd(h,"margin"),g=rS(h.maxWidth,s,"clientWidth")||eS,v=rS(h.maxHeight,s,"clientHeight")||eS,y=ust(s,r,a);let{width:C,height:O}=y;if(h.boxSizing==="content-box"){const M=Nd(h,"border","width"),j=Nd(h,"padding");C-=j.width+M.width,O-=j.height+M.height}return C=Math.max(0,C-f.width),O=Math.max(0,d?C/d:O-f.height),C=nE(Math.min(C,g,y.maxWidth)),O=nE(Math.min(O,v,y.maxHeight)),C&&!O&&(O=nE(C/2)),(r!==void 0||a!==void 0)&&d&&y.height&&O>y.height&&(O=y.height,C=nE(Math.floor(O*d))),{width:C,height:O}}function CB(s,r,a){const d=r||1,h=Math.floor(s.height*d),f=Math.floor(s.width*d);s.height=Math.floor(s.height),s.width=Math.floor(s.width);const g=s.canvas;return g.style&&(a||!g.style.height&&!g.style.width)&&(g.style.height=`${s.height}px`,g.style.width=`${s.width}px`),s.currentDevicePixelRatio!==d||g.height!==h||g.width!==f?(s.currentDevicePixelRatio=d,g.height=h,g.width=f,s.ctx.setTransform(d,0,0,d,0,0),!0):!1}const pst=function(){let s=!1;try{const r={get passive(){return s=!0,!1}};FI()&&(window.addEventListener("test",null,r),window.removeEventListener("test",null,r))}catch{}return s}();function bB(s,r){const a=ast(s,r),d=a&&a.match(/^(\d+)(\.\d+)?px$/);return d?+d[1]:void 0}function yd(s,r,a,d){return{x:s.x+a*(r.x-s.x),y:s.y+a*(r.y-s.y)}}function fst(s,r,a,d){return{x:s.x+a*(r.x-s.x),y:d==="middle"?a<.5?s.y:r.y:d==="after"?a<1?s.y:r.y:a>0?r.y:s.y}}function mst(s,r,a,d){const h={x:s.cp2x,y:s.cp2y},f={x:r.cp1x,y:r.cp1y},g=yd(s,h,a),v=yd(h,f,a),y=yd(f,r,a),C=yd(g,v,a),O=yd(v,y,a);return yd(C,O,a)}const _st=function(s,r){return{x(a){return s+s+r-a},setWidth(a){r=a},textAlign(a){return a==="center"?a:a==="right"?"left":"right"},xPlus(a,d){return a-d},leftForLtr(a,d){return a-d}}},gst=function(){return{x(s){return s},setWidth(s){},textAlign(s){return s},xPlus(s,r){return s+r},leftForLtr(s,r){return s}}};function Nu(s,r,a){return s?_st(r,a):gst()}function Q5(s,r){let a,d;(r==="ltr"||r==="rtl")&&(a=s.canvas.style,d=[a.getPropertyValue("direction"),a.getPropertyPriority("direction")],a.setProperty("direction",r,"important"),s.prevTextDirection=d)}function Z5(s,r){r!==void 0&&(delete s.prevTextDirection,s.canvas.style.setProperty("direction",r[0],r[1]))}function $5(s){return s==="angle"?{between:F5,compare:frt,normalize:oo}:{between:Up,compare:(r,a)=>r-a,normalize:r=>r}}function IB({start:s,end:r,count:a,loop:d,style:h}){return{start:s%a,end:r%a,loop:d&&(r-s+1)%a===0,style:h}}function Est(s,r,a){const{property:d,start:h,end:f}=a,{between:g,normalize:v}=$5(d),y=r.length;let{start:C,end:O,loop:k}=s,M,j;if(k){for(C+=y,O+=y,M=0,j=y;M<j&&g(v(r[C%y][d]),h,f);++M)C--,O--;C%=y,O%=y}return O<C&&(O+=y),{start:C,end:O,loop:k,style:s.style}}function Sst(s,r,a){if(!a)return[s];const{property:d,start:h,end:f}=a,g=r.length,{compare:v,between:y,normalize:C}=$5(d),{start:O,end:k,loop:M,style:j}=Est(s,r,a),z=[];let Y=!1,Z=null,H,K,q;const it=()=>y(h,q,H)&&v(h,q)!==0,ot=()=>v(f,H)===0||y(f,q,H),_t=()=>Y||it(),ft=()=>!Y||ot();for(let lt=O,kt=O;lt<=k;++lt)K=r[lt%g],!K.skip&&(H=C(K[d]),H!==q&&(Y=y(H,h,f),Z===null&&_t()&&(Z=v(H,h)===0?lt:kt),Z!==null&&ft()&&(z.push(IB({start:Z,end:lt,loop:M,count:g,style:j})),Z=null),kt=lt,q=H));return Z!==null&&z.push(IB({start:Z,end:k,loop:M,count:g,style:j})),z}function vst(s,r){const a=[],d=s.segments;for(let h=0;h<d.length;h++){const f=Sst(d[h],s.points,r);f.length&&a.push(...f)}return a}function Tst(s,r,a,d){let h=0,f=r-1;if(a&&!d)for(;h<r&&!s[h].skip;)h++;for(;h<r&&s[h].skip;)h++;for(h%=r,a&&(f+=h);f>h&&s[f%r].skip;)f--;return f%=r,{start:h,end:f}}function yst(s,r,a,d){const h=s.length,f=[];let g=r,v=s[r],y;for(y=r+1;y<=a;++y){const C=s[y%h];C.skip||C.stop?v.skip||(d=!1,f.push({start:r%h,end:(y-1)%h,loop:d}),r=g=C.stop?y:null):(g=y,v.skip&&(r=y)),v=C}return g!==null&&f.push({start:r%h,end:g%h,loop:d}),f}function Rst(s,r){const a=s.points,d=s.options.spanGaps,h=a.length;if(!h)return[];const f=!!s._loop,{start:g,end:v}=Tst(a,h,f,d);if(d===!0)return wB(s,[{start:g,end:v,loop:f}],a,r);const y=v<g?v+h:v,C=!!s._fullLoop&&g===0&&v===h-1;return wB(s,yst(a,g,y,C),a,r)}function wB(s,r,a,d){return!d||!d.setContext||!a?r:Cst(s,r,a,d)}function Cst(s,r,a,d){const h=s._chart.getContext(),f=AB(s.options),{_datasetIndex:g,options:{spanGaps:v}}=s,y=a.length,C=[];let O=f,k=r[0].start,M=k;function j(z,Y,Z,H){const K=v?-1:1;if(z!==Y){for(z+=y;a[z%y].skip;)z-=K;for(;a[Y%y].skip;)Y+=K;z%y!==Y%y&&(C.push({start:z%y,end:Y%y,loop:Z,style:H}),O=H,k=Y%y)}}for(const z of r){k=v?k:z.start;let Y=a[k%y],Z;for(M=k+1;M<=z.end;M++){const H=a[M%y];Z=AB(d.setContext(Ac(h,{type:"segment",p0:Y,p1:H,p0DataIndex:(M-1)%y,p1DataIndex:M%y,datasetIndex:g}))),bst(Z,O)&&j(k,M-1,z.loop,O),Y=H,O=Z}k<M-1&&j(k,M-1,z.loop,O)}return C}function AB(s){return{backgroundColor:s.backgroundColor,borderCapStyle:s.borderCapStyle,borderDash:s.borderDash,borderDashOffset:s.borderDashOffset,borderJoinStyle:s.borderJoinStyle,borderWidth:s.borderWidth,borderColor:s.borderColor}}function bst(s,r){if(!r)return!1;const a=[],d=function(h,f){return PI(f)?(a.includes(f)||a.push(f),a.indexOf(f)):f};return JSON.stringify(s,d)!==JSON.stringify(r,d)}function iE(s,r,a){return s.options.clip?s[a]:r[a]}function Ist(s,r){const{xScale:a,yScale:d}=s;return a&&d?{left:iE(a,r,"left"),right:iE(a,r,"right"),top:iE(d,r,"top"),bottom:iE(d,r,"bottom")}:r}function wst(s,r){const a=r._clip;if(a.disabled)return!1;const d=Ist(r,s.chartArea);return{left:a.left===!1?0:d.left-(a.left===!0?0:a.left),right:a.right===!1?s.width:d.right+(a.right===!0?0:a.right),top:a.top===!1?0:d.top-(a.top===!0?0:a.top),bottom:a.bottom===!1?s.height:d.bottom+(a.bottom===!0?0:a.bottom)}}/*!
 * Chart.js v4.5.0
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class Ast{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(r,a,d,h){const f=a.listeners[h],g=a.duration;f.forEach(v=>v({chart:r,initial:a.initial,numSteps:g,currentStep:Math.min(d-a.start,g)}))}_refresh(){this._request||(this._running=!0,this._request=j5.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(r=Date.now()){let a=0;this._charts.forEach((d,h)=>{if(!d.running||!d.items.length)return;const f=d.items;let g=f.length-1,v=!1,y;for(;g>=0;--g)y=f[g],y._active?(y._total>d.duration&&(d.duration=y._total),y.tick(r),v=!0):(f[g]=f[f.length-1],f.pop());v&&(h.draw(),this._notify(h,d,r,"progress")),f.length||(d.running=!1,this._notify(h,d,r,"complete"),d.initial=!1),a+=f.length}),this._lastDate=r,a===0&&(this._running=!1)}_getAnims(r){const a=this._charts;let d=a.get(r);return d||(d={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},a.set(r,d)),d}listen(r,a,d){this._getAnims(r).listeners[a].push(d)}add(r,a){!a||!a.length||this._getAnims(r).items.push(...a)}has(r){return this._getAnims(r).items.length>0}start(r){const a=this._charts.get(r);a&&(a.running=!0,a.start=Date.now(),a.duration=a.items.reduce((d,h)=>Math.max(d,h._duration),0),this._refresh())}running(r){if(!this._running)return!1;const a=this._charts.get(r);return!(!a||!a.running||!a.items.length)}stop(r){const a=this._charts.get(r);if(!a||!a.items.length)return;const d=a.items;let h=d.length-1;for(;h>=0;--h)d[h].cancel();a.items=[],this._notify(r,a,Date.now(),"complete")}remove(r){return this._charts.delete(r)}}var aa=new Ast;const OB="transparent",Ost={boolean(s,r,a){return a>.5?r:s},color(s,r,a){const d=SB(s||OB),h=d.valid&&SB(r||OB);return h&&h.valid?h.mix(d,a).hexString():r},number(s,r,a){return s+(r-s)*a}};class Nst{constructor(r,a,d,h){const f=a[d];h=tE([r.to,h,f,r.from]);const g=tE([r.from,f,h]);this._active=!0,this._fn=r.fn||Ost[r.type||typeof g],this._easing=ef[r.easing]||ef.linear,this._start=Math.floor(Date.now()+(r.delay||0)),this._duration=this._total=Math.floor(r.duration),this._loop=!!r.loop,this._target=a,this._prop=d,this._from=g,this._to=h,this._promises=void 0}active(){return this._active}update(r,a,d){if(this._active){this._notify(!1);const h=this._target[this._prop],f=d-this._start,g=this._duration-f;this._start=d,this._duration=Math.floor(Math.max(g,r.duration)),this._total+=f,this._loop=!!r.loop,this._to=tE([r.to,a,h,r.from]),this._from=tE([r.from,h,a])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(r){const a=r-this._start,d=this._duration,h=this._prop,f=this._from,g=this._loop,v=this._to;let y;if(this._active=f!==v&&(g||a<d),!this._active){this._target[h]=v,this._notify(!0);return}if(a<0){this._target[h]=f;return}y=a/d%2,y=g&&y>1?2-y:y,y=this._easing(Math.min(1,Math.max(0,y))),this._target[h]=this._fn(f,v,y)}wait(){const r=this._promises||(this._promises=[]);return new Promise((a,d)=>{r.push({res:a,rej:d})})}_notify(r){const a=r?"res":"rej",d=this._promises||[];for(let h=0;h<d.length;h++)d[h][a]()}}class t4{constructor(r,a){this._chart=r,this._properties=new Map,this.configure(a)}configure(r){if(!nn(r))return;const a=Object.keys(Jn.animation),d=this._properties;Object.getOwnPropertyNames(r).forEach(h=>{const f=r[h];if(!nn(f))return;const g={};for(const v of a)g[v]=f[v];(jn(f.properties)&&f.properties||[h]).forEach(v=>{(v===h||!d.has(v))&&d.set(v,g)})})}_animateOptions(r,a){const d=a.options,h=Pst(r,d);if(!h)return[];const f=this._createAnimations(h,d);return d.$shared&&Dst(r.options.$animations,d).then(()=>{r.options=d},()=>{}),f}_createAnimations(r,a){const d=this._properties,h=[],f=r.$animations||(r.$animations={}),g=Object.keys(a),v=Date.now();let y;for(y=g.length-1;y>=0;--y){const C=g[y];if(C.charAt(0)==="$")continue;if(C==="options"){h.push(...this._animateOptions(r,a));continue}const O=a[C];let k=f[C];const M=d.get(C);if(k)if(M&&k.active()){k.update(M,O,v);continue}else k.cancel();if(!M||!M.duration){r[C]=O;continue}f[C]=k=new Nst(M,r,C,O),h.push(k)}return h}update(r,a){if(this._properties.size===0){Object.assign(r,a);return}const d=this._createAnimations(r,a);if(d.length)return aa.add(this._chart,d),!0}}function Dst(s,r){const a=[],d=Object.keys(r);for(let h=0;h<d.length;h++){const f=s[d[h]];f&&f.active()&&a.push(f.wait())}return Promise.all(a)}function Pst(s,r){if(!r)return;let a=s.options;if(!a){s.options=r;return}return a.$shared&&(s.options=a=Object.assign({},a,{$shared:!1,$animations:{}})),a}function NB(s,r){const a=s&&s.options||{},d=a.reverse,h=a.min===void 0?r:0,f=a.max===void 0?r:0;return{start:d?f:h,end:d?h:f}}function kst(s,r,a){if(a===!1)return!1;const d=NB(s,a),h=NB(r,a);return{top:h.end,right:d.end,bottom:h.start,left:d.start}}function Lst(s){let r,a,d,h;return nn(s)?(r=s.top,a=s.right,d=s.bottom,h=s.left):r=a=d=h=s,{top:r,right:a,bottom:d,left:h,disabled:s===!1}}function e4(s,r){const a=[],d=s._getSortedDatasetMetas(r);let h,f;for(h=0,f=d.length;h<f;++h)a.push(d[h].index);return a}function DB(s,r,a,d={}){const h=s.keys,f=d.mode==="single";let g,v,y,C;if(r===null)return;let O=!1;for(g=0,v=h.length;g<v;++g){if(y=+h[g],y===a){if(O=!0,d.all)continue;break}C=s.values[y],Ii(C)&&(f||r===0||Vu(r)===Vu(C))&&(r+=C)}return!O&&!d.all?0:r}function Mst(s,r){const{iScale:a,vScale:d}=r,h=a.axis==="x"?"x":"y",f=d.axis==="x"?"x":"y",g=Object.keys(s),v=new Array(g.length);let y,C,O;for(y=0,C=g.length;y<C;++y)O=g[y],v[y]={[h]:O,[f]:s[O]};return v}function vC(s,r){const a=s&&s.options.stacked;return a||a===void 0&&r.stack!==void 0}function xst(s,r,a){return`${s.id}.${r.id}.${a.stack||a.type}`}function Ust(s){const{min:r,max:a,minDefined:d,maxDefined:h}=s.getUserBounds();return{min:d?r:Number.NEGATIVE_INFINITY,max:h?a:Number.POSITIVE_INFINITY}}function Vst(s,r,a){const d=s[r]||(s[r]={});return d[a]||(d[a]={})}function PB(s,r,a,d){for(const h of r.getMatchingVisibleMetas(d).reverse()){const f=s[h.index];if(a&&f>0||!a&&f<0)return h.index}return null}function kB(s,r){const{chart:a,_cachedMeta:d}=s,h=a._stacks||(a._stacks={}),{iScale:f,vScale:g,index:v}=d,y=f.axis,C=g.axis,O=xst(f,g,d),k=r.length;let M;for(let j=0;j<k;++j){const z=r[j],{[y]:Y,[C]:Z}=z,H=z._stacks||(z._stacks={});M=H[C]=Vst(h,O,Y),M[v]=Z,M._top=PB(M,g,!0,d.type),M._bottom=PB(M,g,!1,d.type);const K=M._visualValues||(M._visualValues={});K[v]=Z}}function TC(s,r){const a=s.scales;return Object.keys(a).filter(d=>a[d].axis===r).shift()}function Fst(s,r){return Ac(s,{active:!1,dataset:void 0,datasetIndex:r,index:r,mode:"default",type:"dataset"})}function Bst(s,r,a){return Ac(s,{active:!1,dataIndex:r,parsed:void 0,raw:void 0,element:a,index:r,mode:"default",type:"data"})}function wp(s,r){const a=s.controller.index,d=s.vScale&&s.vScale.axis;if(d){r=r||s._parsed;for(const h of r){const f=h._stacks;if(!f||f[d]===void 0||f[d][a]===void 0)return;delete f[d][a],f[d]._visualValues!==void 0&&f[d]._visualValues[a]!==void 0&&delete f[d]._visualValues[a]}}}const yC=s=>s==="reset"||s==="none",LB=(s,r)=>r?s:Object.assign({},s),jst=(s,r,a)=>s&&!r.hidden&&r._stacked&&{keys:e4(a,!0),values:null};class rf{constructor(r,a){this.chart=r,this._ctx=r.ctx,this.index=a,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const r=this._cachedMeta;this.configure(),this.linkScales(),r._stacked=vC(r.vScale,r),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(r){this.index!==r&&wp(this._cachedMeta),this.index=r}linkScales(){const r=this.chart,a=this._cachedMeta,d=this.getDataset(),h=(k,M,j,z)=>k==="x"?M:k==="r"?z:j,f=a.xAxisID=ze(d.xAxisID,TC(r,"x")),g=a.yAxisID=ze(d.yAxisID,TC(r,"y")),v=a.rAxisID=ze(d.rAxisID,TC(r,"r")),y=a.indexAxis,C=a.iAxisID=h(y,f,g,v),O=a.vAxisID=h(y,g,f,v);a.xScale=this.getScaleForId(f),a.yScale=this.getScaleForId(g),a.rScale=this.getScaleForId(v),a.iScale=this.getScaleForId(C),a.vScale=this.getScaleForId(O)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(r){return this.chart.scales[r]}_getOtherScale(r){const a=this._cachedMeta;return r===a.iScale?a.vScale:a.iScale}reset(){this._update("reset")}_destroy(){const r=this._cachedMeta;this._data&&_B(this._data,this),r._stacked&&wp(r)}_dataCheck(){const r=this.getDataset(),a=r.data||(r.data=[]),d=this._data;if(nn(a)){const h=this._cachedMeta;this._data=Mst(a,h)}else if(d!==a){if(d){_B(d,this);const h=this._cachedMeta;wp(h),h._parsed=[]}a&&Object.isExtensible(a)&&Ert(a,this),this._syncList=[],this._data=a}}addElements(){const r=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(r.dataset=new this.datasetElementType)}buildOrUpdateElements(r){const a=this._cachedMeta,d=this.getDataset();let h=!1;this._dataCheck();const f=a._stacked;a._stacked=vC(a.vScale,a),a.stack!==d.stack&&(h=!0,wp(a),a.stack=d.stack),this._resyncElements(r),(h||f!==a._stacked)&&(kB(this,a._parsed),a._stacked=vC(a.vScale,a))}configure(){const r=this.chart.config,a=r.datasetScopeKeys(this._type),d=r.getOptionScopes(this.getDataset(),a,!0);this.options=r.createResolver(d,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(r,a){const{_cachedMeta:d,_data:h}=this,{iScale:f,_stacked:g}=d,v=f.axis;let y=r===0&&a===h.length?!0:d._sorted,C=r>0&&d._parsed[r-1],O,k,M;if(this._parsing===!1)d._parsed=h,d._sorted=!0,M=h;else{jn(h[r])?M=this.parseArrayData(d,h,r,a):nn(h[r])?M=this.parseObjectData(d,h,r,a):M=this.parsePrimitiveData(d,h,r,a);const j=()=>k[v]===null||C&&k[v]<C[v];for(O=0;O<a;++O)d._parsed[O+r]=k=M[O],y&&(j()&&(y=!1),C=k);d._sorted=y}g&&kB(this,M)}parsePrimitiveData(r,a,d,h){const{iScale:f,vScale:g}=r,v=f.axis,y=g.axis,C=f.getLabels(),O=f===g,k=new Array(h);let M,j,z;for(M=0,j=h;M<j;++M)z=M+d,k[M]={[v]:O||f.parse(C[z],z),[y]:g.parse(a[z],z)};return k}parseArrayData(r,a,d,h){const{xScale:f,yScale:g}=r,v=new Array(h);let y,C,O,k;for(y=0,C=h;y<C;++y)O=y+d,k=a[O],v[y]={x:f.parse(k[0],O),y:g.parse(k[1],O)};return v}parseObjectData(r,a,d,h){const{xScale:f,yScale:g}=r,{xAxisKey:v="x",yAxisKey:y="y"}=this._parsing,C=new Array(h);let O,k,M,j;for(O=0,k=h;O<k;++O)M=O+d,j=a[M],C[O]={x:f.parse($E(j,v),M),y:g.parse($E(j,y),M)};return C}getParsed(r){return this._cachedMeta._parsed[r]}getDataElement(r){return this._cachedMeta.data[r]}applyStack(r,a,d){const h=this.chart,f=this._cachedMeta,g=a[r.axis],v={keys:e4(h,!0),values:a._stacks[r.axis]._visualValues};return DB(v,g,f.index,{mode:d})}updateRangeFromParsed(r,a,d,h){const f=d[a.axis];let g=f===null?NaN:f;const v=h&&d._stacks[a.axis];h&&v&&(h.values=v,g=DB(h,f,this._cachedMeta.index)),r.min=Math.min(r.min,g),r.max=Math.max(r.max,g)}getMinMax(r,a){const d=this._cachedMeta,h=d._parsed,f=d._sorted&&r===d.iScale,g=h.length,v=this._getOtherScale(r),y=jst(a,d,this.chart),C={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:O,max:k}=Ust(v);let M,j;function z(){j=h[M];const Y=j[v.axis];return!Ii(j[r.axis])||O>Y||k<Y}for(M=0;M<g&&!(!z()&&(this.updateRangeFromParsed(C,r,j,y),f));++M);if(f){for(M=g-1;M>=0;--M)if(!z()){this.updateRangeFromParsed(C,r,j,y);break}}return C}getAllParsedValues(r){const a=this._cachedMeta._parsed,d=[];let h,f,g;for(h=0,f=a.length;h<f;++h)g=a[h][r.axis],Ii(g)&&d.push(g);return d}getMaxOverflow(){return!1}getLabelAndValue(r){const a=this._cachedMeta,d=a.iScale,h=a.vScale,f=this.getParsed(r);return{label:d?""+d.getLabelForValue(f[d.axis]):"",value:h?""+h.getLabelForValue(f[h.axis]):""}}_update(r){const a=this._cachedMeta;this.update(r||"default"),a._clip=Lst(ze(this.options.clip,kst(a.xScale,a.yScale,this.getMaxOverflow())))}update(r){}draw(){const r=this._ctx,a=this.chart,d=this._cachedMeta,h=d.data||[],f=a.chartArea,g=[],v=this._drawStart||0,y=this._drawCount||h.length-v,C=this.options.drawActiveElementsOnTop;let O;for(d.dataset&&d.dataset.draw(r,f,v,y),O=v;O<v+y;++O){const k=h[O];k.hidden||(k.active&&C?g.push(k):k.draw(r,f))}for(O=0;O<g.length;++O)g[O].draw(r,f)}getStyle(r,a){const d=a?"active":"default";return r===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(d):this.resolveDataElementOptions(r||0,d)}getContext(r,a,d){const h=this.getDataset();let f;if(r>=0&&r<this._cachedMeta.data.length){const g=this._cachedMeta.data[r];f=g.$context||(g.$context=Bst(this.getContext(),r,g)),f.parsed=this.getParsed(r),f.raw=h.data[r],f.index=f.dataIndex=r}else f=this.$context||(this.$context=Fst(this.chart.getContext(),this.index)),f.dataset=h,f.index=f.datasetIndex=this.index;return f.active=!!a,f.mode=d,f}resolveDatasetElementOptions(r){return this._resolveElementOptions(this.datasetElementType.id,r)}resolveDataElementOptions(r,a){return this._resolveElementOptions(this.dataElementType.id,a,r)}_resolveElementOptions(r,a="default",d){const h=a==="active",f=this._cachedDataOpts,g=r+"-"+a,v=f[g],y=this.enableOptionSharing&&tS(d);if(v)return LB(v,y);const C=this.chart.config,O=C.datasetElementScopeKeys(this._type,r),k=h?[`${r}Hover`,"hover",r,""]:[r,""],M=C.getOptionScopes(this.getDataset(),O),j=Object.keys(Jn.elements[r]),z=()=>this.getContext(d,h,a),Y=C.resolveNamedOptions(M,j,z,k);return Y.$shared&&(Y.$shared=y,f[g]=Object.freeze(LB(Y,y))),Y}_resolveAnimations(r,a,d){const h=this.chart,f=this._cachedDataOpts,g=`animation-${a}`,v=f[g];if(v)return v;let y;if(h.options.animation!==!1){const O=this.chart.config,k=O.datasetAnimationScopeKeys(this._type,a),M=O.getOptionScopes(this.getDataset(),k);y=O.createResolver(M,this.getContext(r,d,a))}const C=new t4(h,y&&y.animations);return y&&y._cacheable&&(f[g]=Object.freeze(C)),C}getSharedOptions(r){if(r.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},r))}includeOptions(r,a){return!a||yC(r)||this.chart._animationsDisabled}_getSharedOptions(r,a){const d=this.resolveDataElementOptions(r,a),h=this._sharedOptions,f=this.getSharedOptions(d),g=this.includeOptions(a,f)||f!==h;return this.updateSharedOptions(f,a,d),{sharedOptions:f,includeOptions:g}}updateElement(r,a,d,h){yC(h)?Object.assign(r,d):this._resolveAnimations(a,h).update(r,d)}updateSharedOptions(r,a,d){r&&!yC(a)&&this._resolveAnimations(void 0,a).update(r,d)}_setStyle(r,a,d,h){r.active=h;const f=this.getStyle(a,h);this._resolveAnimations(a,d,h).update(r,{options:!h&&this.getSharedOptions(f)||f})}removeHoverStyle(r,a,d){this._setStyle(r,d,"active",!1)}setHoverStyle(r,a,d){this._setStyle(r,d,"active",!0)}_removeDatasetHoverStyle(){const r=this._cachedMeta.dataset;r&&this._setStyle(r,void 0,"active",!1)}_setDatasetHoverStyle(){const r=this._cachedMeta.dataset;r&&this._setStyle(r,void 0,"active",!0)}_resyncElements(r){const a=this._data,d=this._cachedMeta.data;for(const[v,y,C]of this._syncList)this[v](y,C);this._syncList=[];const h=d.length,f=a.length,g=Math.min(f,h);g&&this.parse(0,g),f>h?this._insertElements(h,f-h,r):f<h&&this._removeElements(f,h-f)}_insertElements(r,a,d=!0){const h=this._cachedMeta,f=h.data,g=r+a;let v;const y=C=>{for(C.length+=a,v=C.length-1;v>=g;v--)C[v]=C[v-a]};for(y(f),v=r;v<g;++v)f[v]=new this.dataElementType;this._parsing&&y(h._parsed),this.parse(r,a),d&&this.updateElements(f,r,a,"reset")}updateElements(r,a,d,h){}_removeElements(r,a){const d=this._cachedMeta;if(this._parsing){const h=d._parsed.splice(r,a);d._stacked&&wp(d,h)}d.data.splice(r,a)}_sync(r){if(this._parsing)this._syncList.push(r);else{const[a,d,h]=r;this[a](d,h)}this.chart._dataChanges.push([this.index,...r])}_onDataPush(){const r=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-r,r])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(r,a){a&&this._sync(["_removeElements",r,a]);const d=arguments.length-2;d&&this._sync(["_insertElements",r,d])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}fe(rf,"defaults",{}),fe(rf,"datasetElementType",null),fe(rf,"dataElementType",null);class RE extends rf{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(r){const a=this._cachedMeta,{dataset:d,data:h=[],_dataset:f}=a,g=this.chart._animationsDisabled;let{start:v,count:y}=yrt(a,h,g);this._drawStart=v,this._drawCount=y,Rrt(a)&&(v=0,y=h.length),d._chart=this.chart,d._datasetIndex=this.index,d._decimated=!!f._decimated,d.points=h;const C=this.resolveDatasetElementOptions(r);this.options.showLine||(C.borderWidth=0),C.segment=this.options.segment,this.updateElement(d,void 0,{animated:!g,options:C},r),this.updateElements(h,v,y,r)}updateElements(r,a,d,h){const f=h==="reset",{iScale:g,vScale:v,_stacked:y,_dataset:C}=this._cachedMeta,{sharedOptions:O,includeOptions:k}=this._getSharedOptions(a,h),M=g.axis,j=v.axis,{spanGaps:z,segment:Y}=this.options,Z=Cf(z)?z:Number.POSITIVE_INFINITY,H=this.chart._animationsDisabled||f||h==="none",K=a+d,q=r.length;let it=a>0&&this.getParsed(a-1);for(let ot=0;ot<q;++ot){const _t=r[ot],ft=H?_t:{};if(ot<a||ot>=K){ft.skip=!0;continue}const lt=this.getParsed(ot),kt=ln(lt[j]),At=ft[M]=g.getPixelForValue(lt[M],ot),qt=ft[j]=f||kt?v.getBasePixel():v.getPixelForValue(y?this.applyStack(v,lt,y):lt[j],ot);ft.skip=isNaN(At)||isNaN(qt)||kt,ft.stop=ot>0&&Math.abs(lt[M]-it[M])>Z,Y&&(ft.parsed=lt,ft.raw=C.data[ot]),k&&(ft.options=O||this.resolveDataElementOptions(ot,_t.active?"active":h)),H||this.updateElement(_t,ot,ft,h),it=lt}}getMaxOverflow(){const r=this._cachedMeta,a=r.dataset,d=a.options&&a.options.borderWidth||0,h=r.data||[];if(!h.length)return d;const f=h[0].size(this.resolveDataElementOptions(0)),g=h[h.length-1].size(this.resolveDataElementOptions(h.length-1));return Math.max(d,f,g)/2}draw(){const r=this._cachedMeta;r.dataset.updateControlPoints(this.chart.chartArea,r.iScale.axis),super.draw()}}fe(RE,"id","line"),fe(RE,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),fe(RE,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});function gd(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class jI{constructor(r){fe(this,"options");this.options=r||{}}static override(r){Object.assign(jI.prototype,r)}init(){}formats(){return gd()}parse(){return gd()}format(){return gd()}add(){return gd()}diff(){return gd()}startOf(){return gd()}endOf(){return gd()}}var Wst={_date:jI};function Gst(s,r,a,d){const{controller:h,data:f,_sorted:g}=s,v=h._cachedMeta.iScale,y=s.dataset&&s.dataset.options?s.dataset.options.spanGaps:null;if(v&&r===v.axis&&r!=="r"&&g&&f.length){const C=v._reversePixels?_rt:wd;if(d){if(h._sharedOptions){const O=f[0],k=typeof O.getRange=="function"&&O.getRange(r);if(k){const M=C(f,r,a-k),j=C(f,r,a+k);return{lo:M.lo,hi:j.hi}}}}else{const O=C(f,r,a);if(y){const{vScale:k}=h._cachedMeta,{_parsed:M}=s,j=M.slice(0,O.lo+1).reverse().findIndex(Y=>!ln(Y[k.axis]));O.lo-=Math.max(0,j);const z=M.slice(O.hi).findIndex(Y=>!ln(Y[k.axis]));O.hi+=Math.max(0,z)}return O}}return{lo:0,hi:f.length-1}}function kf(s,r,a,d,h){const f=s.getSortedVisibleDatasetMetas(),g=a[r];for(let v=0,y=f.length;v<y;++v){const{index:C,data:O}=f[v],{lo:k,hi:M}=Gst(f[v],r,g,h);for(let j=k;j<=M;++j){const z=O[j];z.skip||d(z,C,j)}}}function Hst(s){const r=s.indexOf("x")!==-1,a=s.indexOf("y")!==-1;return function(d,h){const f=r?Math.abs(d.x-h.x):0,g=a?Math.abs(d.y-h.y):0;return Math.sqrt(Math.pow(f,2)+Math.pow(g,2))}}function RC(s,r,a,d,h){const f=[];return!h&&!s.isPointInArea(r)||kf(s,a,r,function(v,y,C){!h&&!fa(v,s.chartArea,0)||v.inRange(r.x,r.y,d)&&f.push({element:v,datasetIndex:y,index:C})},!0),f}function zst(s,r,a,d){let h=[];function f(g,v,y){const{startAngle:C,endAngle:O}=g.getProps(["startAngle","endAngle"],d),{angle:k}=prt(g,{x:r.x,y:r.y});F5(k,C,O)&&h.push({element:g,datasetIndex:v,index:y})}return kf(s,a,r,f),h}function Kst(s,r,a,d,h,f){let g=[];const v=Hst(a);let y=Number.POSITIVE_INFINITY;function C(O,k,M){const j=O.inRange(r.x,r.y,h);if(d&&!j)return;const z=O.getCenterPoint(h);if(!(!!f||s.isPointInArea(z))&&!j)return;const Z=v(r,z);Z<y?(g=[{element:O,datasetIndex:k,index:M}],y=Z):Z===y&&g.push({element:O,datasetIndex:k,index:M})}return kf(s,a,r,C),g}function CC(s,r,a,d,h,f){return!f&&!s.isPointInArea(r)?[]:a==="r"&&!d?zst(s,r,a,h):Kst(s,r,a,d,h,f)}function MB(s,r,a,d,h){const f=[],g=a==="x"?"inXRange":"inYRange";let v=!1;return kf(s,a,r,(y,C,O)=>{y[g]&&y[g](r[a],h)&&(f.push({element:y,datasetIndex:C,index:O}),v=v||y.inRange(r.x,r.y,h))}),d&&!v?[]:f}var Yst={evaluateInteractionItems:kf,modes:{index(s,r,a,d){const h=Td(r,s),f=a.axis||"x",g=a.includeInvisible||!1,v=a.intersect?RC(s,h,f,d,g):CC(s,h,f,!1,d,g),y=[];return v.length?(s.getSortedVisibleDatasetMetas().forEach(C=>{const O=v[0].index,k=C.data[O];k&&!k.skip&&y.push({element:k,datasetIndex:C.index,index:O})}),y):[]},dataset(s,r,a,d){const h=Td(r,s),f=a.axis||"xy",g=a.includeInvisible||!1;let v=a.intersect?RC(s,h,f,d,g):CC(s,h,f,!1,d,g);if(v.length>0){const y=v[0].datasetIndex,C=s.getDatasetMeta(y).data;v=[];for(let O=0;O<C.length;++O)v.push({element:C[O],datasetIndex:y,index:O})}return v},point(s,r,a,d){const h=Td(r,s),f=a.axis||"xy",g=a.includeInvisible||!1;return RC(s,h,f,d,g)},nearest(s,r,a,d){const h=Td(r,s),f=a.axis||"xy",g=a.includeInvisible||!1;return CC(s,h,f,a.intersect,d,g)},x(s,r,a,d){const h=Td(r,s);return MB(s,h,"x",a.intersect,d)},y(s,r,a,d){const h=Td(r,s);return MB(s,h,"y",a.intersect,d)}}};const n4=["left","top","right","bottom"];function Ap(s,r){return s.filter(a=>a.pos===r)}function xB(s,r){return s.filter(a=>n4.indexOf(a.pos)===-1&&a.box.axis===r)}function Op(s,r){return s.sort((a,d)=>{const h=r?d:a,f=r?a:d;return h.weight===f.weight?h.index-f.index:h.weight-f.weight})}function qst(s){const r=[];let a,d,h,f,g,v;for(a=0,d=(s||[]).length;a<d;++a)h=s[a],{position:f,options:{stack:g,stackWeight:v=1}}=h,r.push({index:a,box:h,pos:f,horizontal:h.isHorizontal(),weight:h.weight,stack:g&&f+g,stackWeight:v});return r}function Xst(s){const r={};for(const a of s){const{stack:d,pos:h,stackWeight:f}=a;if(!d||!n4.includes(h))continue;const g=r[d]||(r[d]={count:0,placed:0,weight:0,size:0});g.count++,g.weight+=f}return r}function Jst(s,r){const a=Xst(s),{vBoxMaxWidth:d,hBoxMaxHeight:h}=r;let f,g,v;for(f=0,g=s.length;f<g;++f){v=s[f];const{fullSize:y}=v.box,C=a[v.stack],O=C&&v.stackWeight/C.weight;v.horizontal?(v.width=O?O*d:y&&r.availableWidth,v.height=h):(v.width=d,v.height=O?O*h:y&&r.availableHeight)}return a}function Qst(s){const r=qst(s),a=Op(r.filter(C=>C.box.fullSize),!0),d=Op(Ap(r,"left"),!0),h=Op(Ap(r,"right")),f=Op(Ap(r,"top"),!0),g=Op(Ap(r,"bottom")),v=xB(r,"x"),y=xB(r,"y");return{fullSize:a,leftAndTop:d.concat(f),rightAndBottom:h.concat(y).concat(g).concat(v),chartArea:Ap(r,"chartArea"),vertical:d.concat(h).concat(y),horizontal:f.concat(g).concat(v)}}function UB(s,r,a,d){return Math.max(s[a],r[a])+Math.max(s[d],r[d])}function i4(s,r){s.top=Math.max(s.top,r.top),s.left=Math.max(s.left,r.left),s.bottom=Math.max(s.bottom,r.bottom),s.right=Math.max(s.right,r.right)}function Zst(s,r,a,d){const{pos:h,box:f}=a,g=s.maxPadding;if(!nn(h)){a.size&&(s[h]-=a.size);const k=d[a.stack]||{size:0,count:1};k.size=Math.max(k.size,a.horizontal?f.height:f.width),a.size=k.size/k.count,s[h]+=a.size}f.getPadding&&i4(g,f.getPadding());const v=Math.max(0,r.outerWidth-UB(g,s,"left","right")),y=Math.max(0,r.outerHeight-UB(g,s,"top","bottom")),C=v!==s.w,O=y!==s.h;return s.w=v,s.h=y,a.horizontal?{same:C,other:O}:{same:O,other:C}}function $st(s){const r=s.maxPadding;function a(d){const h=Math.max(r[d]-s[d],0);return s[d]+=h,h}s.y+=a("top"),s.x+=a("left"),a("right"),a("bottom")}function tot(s,r){const a=r.maxPadding;function d(h){const f={left:0,top:0,right:0,bottom:0};return h.forEach(g=>{f[g]=Math.max(r[g],a[g])}),f}return d(s?["left","right"]:["top","bottom"])}function Vp(s,r,a,d){const h=[];let f,g,v,y,C,O;for(f=0,g=s.length,C=0;f<g;++f){v=s[f],y=v.box,y.update(v.width||r.w,v.height||r.h,tot(v.horizontal,r));const{same:k,other:M}=Zst(r,a,v,d);C|=k&&h.length,O=O||M,y.fullSize||h.push(v)}return C&&Vp(h,r,a,d)||O}function rE(s,r,a,d,h){s.top=a,s.left=r,s.right=r+d,s.bottom=a+h,s.width=d,s.height=h}function VB(s,r,a,d){const h=a.padding;let{x:f,y:g}=r;for(const v of s){const y=v.box,C=d[v.stack]||{count:1,placed:0,weight:1},O=v.stackWeight/C.weight||1;if(v.horizontal){const k=r.w*O,M=C.size||y.height;tS(C.start)&&(g=C.start),y.fullSize?rE(y,h.left,g,a.outerWidth-h.right-h.left,M):rE(y,r.left+C.placed,g,k,M),C.start=g,C.placed+=k,g=y.bottom}else{const k=r.h*O,M=C.size||y.width;tS(C.start)&&(f=C.start),y.fullSize?rE(y,f,h.top,M,a.outerHeight-h.bottom-h.top):rE(y,f,r.top+C.placed,M,k),C.start=f,C.placed+=k,f=y.right}}r.x=f,r.y=g}var Ps={addBox(s,r){s.boxes||(s.boxes=[]),r.fullSize=r.fullSize||!1,r.position=r.position||"top",r.weight=r.weight||0,r._layers=r._layers||function(){return[{z:0,draw(a){r.draw(a)}}]},s.boxes.push(r)},removeBox(s,r){const a=s.boxes?s.boxes.indexOf(r):-1;a!==-1&&s.boxes.splice(a,1)},configure(s,r,a){r.fullSize=a.fullSize,r.position=a.position,r.weight=a.weight},update(s,r,a,d){if(!s)return;const h=tr(s.options.layout.padding),f=Math.max(r-h.width,0),g=Math.max(a-h.height,0),v=Qst(s.boxes),y=v.vertical,C=v.horizontal;dn(s.boxes,Y=>{typeof Y.beforeLayout=="function"&&Y.beforeLayout()});const O=y.reduce((Y,Z)=>Z.box.options&&Z.box.options.display===!1?Y:Y+1,0)||1,k=Object.freeze({outerWidth:r,outerHeight:a,padding:h,availableWidth:f,availableHeight:g,vBoxMaxWidth:f/2/O,hBoxMaxHeight:g/2}),M=Object.assign({},h);i4(M,tr(d));const j=Object.assign({maxPadding:M,w:f,h:g,x:h.left,y:h.top},h),z=Jst(y.concat(C),k);Vp(v.fullSize,j,k,z),Vp(y,j,k,z),Vp(C,j,k,z)&&Vp(y,j,k,z),$st(j),VB(v.leftAndTop,j,k,z),j.x+=j.w,j.y+=j.h,VB(v.rightAndBottom,j,k,z),s.chartArea={left:j.left,top:j.top,right:j.left+j.w,bottom:j.top+j.h,height:j.h,width:j.w},dn(v.chartArea,Y=>{const Z=Y.box;Object.assign(Z,s.chartArea),Z.update(j.w,j.h,{left:0,top:0,right:0,bottom:0})})}};class r4{acquireContext(r,a){}releaseContext(r){return!1}addEventListener(r,a,d){}removeEventListener(r,a,d){}getDevicePixelRatio(){return 1}getMaximumSize(r,a,d,h){return a=Math.max(0,a||r.width),d=d||r.height,{width:a,height:Math.max(0,h?Math.floor(a/h):d)}}isAttached(r){return!0}updateConfig(r){}}class eot extends r4{acquireContext(r){return r&&r.getContext&&r.getContext("2d")||null}updateConfig(r){r.options.animation=!1}}const CE="$chartjs",not={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},FB=s=>s===null||s==="";function iot(s,r){const a=s.style,d=s.getAttribute("height"),h=s.getAttribute("width");if(s[CE]={initial:{height:d,width:h,style:{display:a.display,height:a.height,width:a.width}}},a.display=a.display||"block",a.boxSizing=a.boxSizing||"border-box",FB(h)){const f=bB(s,"width");f!==void 0&&(s.width=f)}if(FB(d))if(s.style.height==="")s.height=s.width/(r||2);else{const f=bB(s,"height");f!==void 0&&(s.height=f)}return s}const s4=pst?{passive:!0}:!1;function rot(s,r,a){s&&s.addEventListener(r,a,s4)}function sot(s,r,a){s&&s.canvas&&s.canvas.removeEventListener(r,a,s4)}function oot(s,r){const a=not[s.type]||s.type,{x:d,y:h}=Td(s,r);return{type:a,chart:r,native:s,x:d!==void 0?d:null,y:h!==void 0?h:null}}function sS(s,r){for(const a of s)if(a===r||a.contains(r))return!0}function aot(s,r,a){const d=s.canvas,h=new MutationObserver(f=>{let g=!1;for(const v of f)g=g||sS(v.addedNodes,d),g=g&&!sS(v.removedNodes,d);g&&a()});return h.observe(document,{childList:!0,subtree:!0}),h}function cot(s,r,a){const d=s.canvas,h=new MutationObserver(f=>{let g=!1;for(const v of f)g=g||sS(v.removedNodes,d),g=g&&!sS(v.addedNodes,d);g&&a()});return h.observe(document,{childList:!0,subtree:!0}),h}const bf=new Map;let BB=0;function o4(){const s=window.devicePixelRatio;s!==BB&&(BB=s,bf.forEach((r,a)=>{a.currentDevicePixelRatio!==s&&r()}))}function dot(s,r){bf.size||window.addEventListener("resize",o4),bf.set(s,r)}function lot(s){bf.delete(s),bf.size||window.removeEventListener("resize",o4)}function uot(s,r,a){const d=s.canvas,h=d&&BI(d);if(!h)return;const f=W5((v,y)=>{const C=h.clientWidth;a(v,y),C<h.clientWidth&&a()},window),g=new ResizeObserver(v=>{const y=v[0],C=y.contentRect.width,O=y.contentRect.height;C===0&&O===0||f(C,O)});return g.observe(h),dot(s,f),g}function bC(s,r,a){a&&a.disconnect(),r==="resize"&&lot(s)}function hot(s,r,a){const d=s.canvas,h=W5(f=>{s.ctx!==null&&a(oot(f,s))},s);return rot(d,r,h),h}class pot extends r4{acquireContext(r,a){const d=r&&r.getContext&&r.getContext("2d");return d&&d.canvas===r?(iot(r,a),d):null}releaseContext(r){const a=r.canvas;if(!a[CE])return!1;const d=a[CE].initial;["height","width"].forEach(f=>{const g=d[f];ln(g)?a.removeAttribute(f):a.setAttribute(f,g)});const h=d.style||{};return Object.keys(h).forEach(f=>{a.style[f]=h[f]}),a.width=a.width,delete a[CE],!0}addEventListener(r,a,d){this.removeEventListener(r,a);const h=r.$proxies||(r.$proxies={}),g={attach:aot,detach:cot,resize:uot}[a]||hot;h[a]=g(r,a,d)}removeEventListener(r,a){const d=r.$proxies||(r.$proxies={}),h=d[a];if(!h)return;({attach:bC,detach:bC,resize:bC}[a]||sot)(r,a,h),d[a]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(r,a,d,h){return hst(r,a,d,h)}isAttached(r){const a=r&&BI(r);return!!(a&&a.isConnected)}}function fot(s){return!FI()||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas?eot:pot}class va{constructor(){fe(this,"x");fe(this,"y");fe(this,"active",!1);fe(this,"options");fe(this,"$animations")}tooltipPosition(r){const{x:a,y:d}=this.getProps(["x","y"],r);return{x:a,y:d}}hasValue(){return Cf(this.x)&&Cf(this.y)}getProps(r,a){const d=this.$animations;if(!a||!d)return this;const h={};return r.forEach(f=>{h[f]=d[f]&&d[f].active()?d[f]._to:this[f]}),h}}fe(va,"defaults",{}),fe(va,"defaultRoutes");function mot(s,r){const a=s.options.ticks,d=_ot(s),h=Math.min(a.maxTicksLimit||d,d),f=a.major.enabled?Eot(r):[],g=f.length,v=f[0],y=f[g-1],C=[];if(g>h)return Sot(r,C,f,g/h),C;const O=got(f,r,h);if(g>0){let k,M;const j=g>1?Math.round((y-v)/(g-1)):null;for(sE(r,C,O,ln(j)?0:v-j,v),k=0,M=g-1;k<M;k++)sE(r,C,O,f[k],f[k+1]);return sE(r,C,O,y,ln(j)?r.length:y+j),C}return sE(r,C,O),C}function _ot(s){const r=s.options.offset,a=s._tickSize(),d=s._length/a+(r?0:1),h=s._maxLength/a;return Math.floor(Math.min(d,h))}function got(s,r,a){const d=vot(s),h=r.length/a;if(!d)return Math.max(h,1);const f=lrt(d);for(let g=0,v=f.length-1;g<v;g++){const y=f[g];if(y>h)return y}return Math.max(h,1)}function Eot(s){const r=[];let a,d;for(a=0,d=s.length;a<d;a++)s[a].major&&r.push(a);return r}function Sot(s,r,a,d){let h=0,f=a[0],g;for(d=Math.ceil(d),g=0;g<s.length;g++)g===f&&(r.push(s[g]),h++,f=a[h*d])}function sE(s,r,a,d,h){const f=ze(d,0),g=Math.min(ze(h,s.length),s.length);let v=0,y,C,O;for(a=Math.ceil(a),h&&(y=h-d,a=y/Math.floor(y/a)),O=f;O<0;)v++,O=Math.round(f+v*a);for(C=Math.max(f,0);C<g;C++)C===O&&(r.push(s[C]),v++,O=Math.round(f+v*a))}function vot(s){const r=s.length;let a,d;if(r<2)return!1;for(d=s[0],a=1;a<r;++a)if(s[a]-s[a-1]!==d)return!1;return d}const Tot=s=>s==="left"?"right":s==="right"?"left":s,jB=(s,r,a)=>r==="top"||r==="left"?s[r]+a:s[r]-a,WB=(s,r)=>Math.min(r||s,s);function GB(s,r){const a=[],d=s.length/r,h=s.length;let f=0;for(;f<h;f+=d)a.push(s[Math.floor(f)]);return a}function yot(s,r,a){const d=s.ticks.length,h=Math.min(r,d-1),f=s._startPixel,g=s._endPixel,v=1e-6;let y=s.getPixelForTick(h),C;if(!(a&&(d===1?C=Math.max(y-f,g-y):r===0?C=(s.getPixelForTick(1)-y)/2:C=(y-s.getPixelForTick(h-1))/2,y+=h<r?C:-C,y<f-v||y>g+v)))return y}function Rot(s,r){dn(s,a=>{const d=a.gc,h=d.length/2;let f;if(h>r){for(f=0;f<h;++f)delete a.data[d[f]];d.splice(0,h)}})}function Np(s){return s.drawTicks?s.tickLength:0}function HB(s,r){if(!s.display)return 0;const a=Ei(s.font,r),d=tr(s.padding);return(jn(s.text)?s.text.length:1)*a.lineHeight+d.height}function Cot(s,r){return Ac(s,{scale:r,type:"scale"})}function bot(s,r,a){return Ac(s,{tick:a,index:r,type:"tick"})}function Iot(s,r,a){let d=DI(s);return(a&&r!=="right"||!a&&r==="right")&&(d=Tot(d)),d}function wot(s,r,a,d){const{top:h,left:f,bottom:g,right:v,chart:y}=s,{chartArea:C,scales:O}=y;let k=0,M,j,z;const Y=g-h,Z=v-f;if(s.isHorizontal()){if(j=Ji(d,f,v),nn(a)){const H=Object.keys(a)[0],K=a[H];z=O[H].getPixelForValue(K)+Y-r}else a==="center"?z=(C.bottom+C.top)/2+Y-r:z=jB(s,a,r);M=v-f}else{if(nn(a)){const H=Object.keys(a)[0],K=a[H];j=O[H].getPixelForValue(K)-Z+r}else a==="center"?j=(C.left+C.right)/2-Z+r:j=jB(s,a,r);z=Ji(d,g,h),k=a==="left"?-Zr:Zr}return{titleX:j,titleY:z,maxWidth:M,rotation:k}}class Bd extends va{constructor(r){super(),this.id=r.id,this.type=r.type,this.options=void 0,this.ctx=r.ctx,this.chart=r.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(r){this.options=r.setContext(this.getContext()),this.axis=r.axis,this._userMin=this.parse(r.min),this._userMax=this.parse(r.max),this._suggestedMin=this.parse(r.suggestedMin),this._suggestedMax=this.parse(r.suggestedMax)}parse(r,a){return r}getUserBounds(){let{_userMin:r,_userMax:a,_suggestedMin:d,_suggestedMax:h}=this;return r=Xr(r,Number.POSITIVE_INFINITY),a=Xr(a,Number.NEGATIVE_INFINITY),d=Xr(d,Number.POSITIVE_INFINITY),h=Xr(h,Number.NEGATIVE_INFINITY),{min:Xr(r,d),max:Xr(a,h),minDefined:Ii(r),maxDefined:Ii(a)}}getMinMax(r){let{min:a,max:d,minDefined:h,maxDefined:f}=this.getUserBounds(),g;if(h&&f)return{min:a,max:d};const v=this.getMatchingVisibleMetas();for(let y=0,C=v.length;y<C;++y)g=v[y].controller.getMinMax(this,r),h||(a=Math.min(a,g.min)),f||(d=Math.max(d,g.max));return a=f&&a>d?d:a,d=h&&a>d?a:d,{min:Xr(a,Xr(d,a)),max:Xr(d,Xr(a,d))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const r=this.chart.data;return this.options.labels||(this.isHorizontal()?r.xLabels:r.yLabels)||r.labels||[]}getLabelItems(r=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(r))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Rn(this.options.beforeUpdate,[this])}update(r,a,d){const{beginAtZero:h,grace:f,ticks:g}=this.options,v=g.sampleSize;this.beforeUpdate(),this.maxWidth=r,this.maxHeight=a,this._margins=d=Object.assign({left:0,right:0,top:0,bottom:0},d),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+d.left+d.right:this.height+d.top+d.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Hrt(this,f,h),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const y=v<this.ticks.length;this._convertTicksToLabels(y?GB(this.ticks,v):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),g.display&&(g.autoSkip||g.source==="auto")&&(this.ticks=mot(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),y&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let r=this.options.reverse,a,d;this.isHorizontal()?(a=this.left,d=this.right):(a=this.top,d=this.bottom,r=!r),this._startPixel=a,this._endPixel=d,this._reversePixels=r,this._length=d-a,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Rn(this.options.afterUpdate,[this])}beforeSetDimensions(){Rn(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Rn(this.options.afterSetDimensions,[this])}_callHooks(r){this.chart.notifyPlugins(r,this.getContext()),Rn(this.options[r],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Rn(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(r){const a=this.options.ticks;let d,h,f;for(d=0,h=r.length;d<h;d++)f=r[d],f.label=Rn(a.callback,[f.value,d,r],this)}afterTickToLabelConversion(){Rn(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Rn(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const r=this.options,a=r.ticks,d=WB(this.ticks.length,r.ticks.maxTicksLimit),h=a.minRotation||0,f=a.maxRotation;let g=h,v,y,C;if(!this._isVisible()||!a.display||h>=f||d<=1||!this.isHorizontal()){this.labelRotation=h;return}const O=this._getLabelSizes(),k=O.widest.width,M=O.highest.height,j=Ds(this.chart.width-k,0,this.maxWidth);v=r.offset?this.maxWidth/d:j/(d-1),k+6>v&&(v=j/(d-(r.offset?.5:1)),y=this.maxHeight-Np(r.grid)-a.padding-HB(r.title,this.chart.options.font),C=Math.sqrt(k*k+M*M),g=OI(Math.min(Math.asin(Ds((O.highest.height+6)/v,-1,1)),Math.asin(Ds(y/C,-1,1))-Math.asin(Ds(M/C,-1,1)))),g=Math.max(h,Math.min(f,g))),this.labelRotation=g}afterCalculateLabelRotation(){Rn(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Rn(this.options.beforeFit,[this])}fit(){const r={width:0,height:0},{chart:a,options:{ticks:d,title:h,grid:f}}=this,g=this._isVisible(),v=this.isHorizontal();if(g){const y=HB(h,a.options.font);if(v?(r.width=this.maxWidth,r.height=Np(f)+y):(r.height=this.maxHeight,r.width=Np(f)+y),d.display&&this.ticks.length){const{first:C,last:O,widest:k,highest:M}=this._getLabelSizes(),j=d.padding*2,z=hc(this.labelRotation),Y=Math.cos(z),Z=Math.sin(z);if(v){const H=d.mirror?0:Z*k.width+Y*M.height;r.height=Math.min(this.maxHeight,r.height+H+j)}else{const H=d.mirror?0:Y*k.width+Z*M.height;r.width=Math.min(this.maxWidth,r.width+H+j)}this._calculatePadding(C,O,Z,Y)}}this._handleMargins(),v?(this.width=this._length=a.width-this._margins.left-this._margins.right,this.height=r.height):(this.width=r.width,this.height=this._length=a.height-this._margins.top-this._margins.bottom)}_calculatePadding(r,a,d,h){const{ticks:{align:f,padding:g},position:v}=this.options,y=this.labelRotation!==0,C=v!=="top"&&this.axis==="x";if(this.isHorizontal()){const O=this.getPixelForTick(0)-this.left,k=this.right-this.getPixelForTick(this.ticks.length-1);let M=0,j=0;y?C?(M=h*r.width,j=d*a.height):(M=d*r.height,j=h*a.width):f==="start"?j=a.width:f==="end"?M=r.width:f!=="inner"&&(M=r.width/2,j=a.width/2),this.paddingLeft=Math.max((M-O+g)*this.width/(this.width-O),0),this.paddingRight=Math.max((j-k+g)*this.width/(this.width-k),0)}else{let O=a.height/2,k=r.height/2;f==="start"?(O=0,k=r.height):f==="end"&&(O=a.height,k=0),this.paddingTop=O+g,this.paddingBottom=k+g}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Rn(this.options.afterFit,[this])}isHorizontal(){const{axis:r,position:a}=this.options;return a==="top"||a==="bottom"||r==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(r){this.beforeTickToLabelConversion(),this.generateTickLabels(r);let a,d;for(a=0,d=r.length;a<d;a++)ln(r[a].label)&&(r.splice(a,1),d--,a--);this.afterTickToLabelConversion()}_getLabelSizes(){let r=this._labelSizes;if(!r){const a=this.options.ticks.sampleSize;let d=this.ticks;a<d.length&&(d=GB(d,a)),this._labelSizes=r=this._computeLabelSizes(d,d.length,this.options.ticks.maxTicksLimit)}return r}_computeLabelSizes(r,a,d){const{ctx:h,_longestTextCache:f}=this,g=[],v=[],y=Math.floor(a/WB(a,d));let C=0,O=0,k,M,j,z,Y,Z,H,K,q,it,ot;for(k=0;k<a;k+=y){if(z=r[k].label,Y=this._resolveTickFontOptions(k),h.font=Z=Y.string,H=f[Z]=f[Z]||{data:{},gc:[]},K=Y.lineHeight,q=it=0,!ln(z)&&!jn(z))q=nS(h,H.data,H.gc,q,z),it=K;else if(jn(z))for(M=0,j=z.length;M<j;++M)ot=z[M],!ln(ot)&&!jn(ot)&&(q=nS(h,H.data,H.gc,q,ot),it+=K);g.push(q),v.push(it),C=Math.max(q,C),O=Math.max(it,O)}Rot(f,a);const _t=g.indexOf(C),ft=v.indexOf(O),lt=kt=>({width:g[kt]||0,height:v[kt]||0});return{first:lt(0),last:lt(a-1),widest:lt(_t),highest:lt(ft),widths:g,heights:v}}getLabelForValue(r){return r}getPixelForValue(r,a){return NaN}getValueForPixel(r){}getPixelForTick(r){const a=this.ticks;return r<0||r>a.length-1?null:this.getPixelForValue(a[r].value)}getPixelForDecimal(r){this._reversePixels&&(r=1-r);const a=this._startPixel+r*this._length;return mrt(this._alignToPixels?_d(this.chart,a,0):a)}getDecimalForPixel(r){const a=(r-this._startPixel)/this._length;return this._reversePixels?1-a:a}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:r,max:a}=this;return r<0&&a<0?a:r>0&&a>0?r:0}getContext(r){const a=this.ticks||[];if(r>=0&&r<a.length){const d=a[r];return d.$context||(d.$context=bot(this.getContext(),r,d))}return this.$context||(this.$context=Cot(this.chart.getContext(),this))}_tickSize(){const r=this.options.ticks,a=hc(this.labelRotation),d=Math.abs(Math.cos(a)),h=Math.abs(Math.sin(a)),f=this._getLabelSizes(),g=r.autoSkipPadding||0,v=f?f.widest.width+g:0,y=f?f.highest.height+g:0;return this.isHorizontal()?y*d>v*h?v/d:y/h:y*h<v*d?y/d:v/h}_isVisible(){const r=this.options.display;return r!=="auto"?!!r:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(r){const a=this.axis,d=this.chart,h=this.options,{grid:f,position:g,border:v}=h,y=f.offset,C=this.isHorizontal(),k=this.ticks.length+(y?1:0),M=Np(f),j=[],z=v.setContext(this.getContext()),Y=z.display?z.width:0,Z=Y/2,H=function(Se){return _d(d,Se,Y)};let K,q,it,ot,_t,ft,lt,kt,At,qt,vt,xt;if(g==="top")K=H(this.bottom),ft=this.bottom-M,kt=K-Z,qt=H(r.top)+Z,xt=r.bottom;else if(g==="bottom")K=H(this.top),qt=r.top,xt=H(r.bottom)-Z,ft=K+Z,kt=this.top+M;else if(g==="left")K=H(this.right),_t=this.right-M,lt=K-Z,At=H(r.left)+Z,vt=r.right;else if(g==="right")K=H(this.left),At=r.left,vt=H(r.right)-Z,_t=K+Z,lt=this.left+M;else if(a==="x"){if(g==="center")K=H((r.top+r.bottom)/2+.5);else if(nn(g)){const Se=Object.keys(g)[0],le=g[Se];K=H(this.chart.scales[Se].getPixelForValue(le))}qt=r.top,xt=r.bottom,ft=K+Z,kt=ft+M}else if(a==="y"){if(g==="center")K=H((r.left+r.right)/2);else if(nn(g)){const Se=Object.keys(g)[0],le=g[Se];K=H(this.chart.scales[Se].getPixelForValue(le))}_t=K-Z,lt=_t-M,At=r.left,vt=r.right}const Ot=ze(h.ticks.maxTicksLimit,k),zt=Math.max(1,Math.ceil(k/Ot));for(q=0;q<k;q+=zt){const Se=this.getContext(q),le=f.setContext(Se),Lt=v.setContext(Se),Jt=le.lineWidth,$t=le.color,Ve=Lt.dash||[],Pe=Lt.dashOffset,ui=le.tickWidth,hn=le.tickColor,de=le.tickBorderDash||[],Ne=le.tickBorderDashOffset;it=yot(this,q,y),it!==void 0&&(ot=_d(d,it,Jt),C?_t=lt=At=vt=ot:ft=kt=qt=xt=ot,j.push({tx1:_t,ty1:ft,tx2:lt,ty2:kt,x1:At,y1:qt,x2:vt,y2:xt,width:Jt,color:$t,borderDash:Ve,borderDashOffset:Pe,tickWidth:ui,tickColor:hn,tickBorderDash:de,tickBorderDashOffset:Ne}))}return this._ticksLength=k,this._borderValue=K,j}_computeLabelItems(r){const a=this.axis,d=this.options,{position:h,ticks:f}=d,g=this.isHorizontal(),v=this.ticks,{align:y,crossAlign:C,padding:O,mirror:k}=f,M=Np(d.grid),j=M+O,z=k?-O:j,Y=-hc(this.labelRotation),Z=[];let H,K,q,it,ot,_t,ft,lt,kt,At,qt,vt,xt="middle";if(h==="top")_t=this.bottom-z,ft=this._getXAxisLabelAlignment();else if(h==="bottom")_t=this.top+z,ft=this._getXAxisLabelAlignment();else if(h==="left"){const zt=this._getYAxisLabelAlignment(M);ft=zt.textAlign,ot=zt.x}else if(h==="right"){const zt=this._getYAxisLabelAlignment(M);ft=zt.textAlign,ot=zt.x}else if(a==="x"){if(h==="center")_t=(r.top+r.bottom)/2+j;else if(nn(h)){const zt=Object.keys(h)[0],Se=h[zt];_t=this.chart.scales[zt].getPixelForValue(Se)+j}ft=this._getXAxisLabelAlignment()}else if(a==="y"){if(h==="center")ot=(r.left+r.right)/2-j;else if(nn(h)){const zt=Object.keys(h)[0],Se=h[zt];ot=this.chart.scales[zt].getPixelForValue(Se)}ft=this._getYAxisLabelAlignment(M).textAlign}a==="y"&&(y==="start"?xt="top":y==="end"&&(xt="bottom"));const Ot=this._getLabelSizes();for(H=0,K=v.length;H<K;++H){q=v[H],it=q.label;const zt=f.setContext(this.getContext(H));lt=this.getPixelForTick(H)+f.labelOffset,kt=this._resolveTickFontOptions(H),At=kt.lineHeight,qt=jn(it)?it.length:1;const Se=qt/2,le=zt.color,Lt=zt.textStrokeColor,Jt=zt.textStrokeWidth;let $t=ft;g?(ot=lt,ft==="inner"&&(H===K-1?$t=this.options.reverse?"left":"right":H===0?$t=this.options.reverse?"right":"left":$t="center"),h==="top"?C==="near"||Y!==0?vt=-qt*At+At/2:C==="center"?vt=-Ot.highest.height/2-Se*At+At:vt=-Ot.highest.height+At/2:C==="near"||Y!==0?vt=At/2:C==="center"?vt=Ot.highest.height/2-Se*At:vt=Ot.highest.height-qt*At,k&&(vt*=-1),Y!==0&&!zt.showLabelBackdrop&&(ot+=At/2*Math.sin(Y))):(_t=lt,vt=(1-qt)*At/2);let Ve;if(zt.showLabelBackdrop){const Pe=tr(zt.backdropPadding),ui=Ot.heights[H],hn=Ot.widths[H];let de=vt-Pe.top,Ne=0-Pe.left;switch(xt){case"middle":de-=ui/2;break;case"bottom":de-=ui;break}switch(ft){case"center":Ne-=hn/2;break;case"right":Ne-=hn;break;case"inner":H===K-1?Ne-=hn:H>0&&(Ne-=hn/2);break}Ve={left:Ne,top:de,width:hn+Pe.width,height:ui+Pe.height,color:zt.backdropColor}}Z.push({label:it,font:kt,textOffset:vt,options:{rotation:Y,color:le,strokeColor:Lt,strokeWidth:Jt,textAlign:$t,textBaseline:xt,translation:[ot,_t],backdrop:Ve}})}return Z}_getXAxisLabelAlignment(){const{position:r,ticks:a}=this.options;if(-hc(this.labelRotation))return r==="top"?"left":"right";let h="center";return a.align==="start"?h="left":a.align==="end"?h="right":a.align==="inner"&&(h="inner"),h}_getYAxisLabelAlignment(r){const{position:a,ticks:{crossAlign:d,mirror:h,padding:f}}=this.options,g=this._getLabelSizes(),v=r+f,y=g.widest.width;let C,O;return a==="left"?h?(O=this.right+f,d==="near"?C="left":d==="center"?(C="center",O+=y/2):(C="right",O+=y)):(O=this.right-v,d==="near"?C="right":d==="center"?(C="center",O-=y/2):(C="left",O=this.left)):a==="right"?h?(O=this.left+f,d==="near"?C="right":d==="center"?(C="center",O-=y/2):(C="left",O-=y)):(O=this.left+v,d==="near"?C="left":d==="center"?(C="center",O+=y/2):(C="right",O=this.right)):C="right",{textAlign:C,x:O}}_computeLabelArea(){if(this.options.ticks.mirror)return;const r=this.chart,a=this.options.position;if(a==="left"||a==="right")return{top:0,left:this.left,bottom:r.height,right:this.right};if(a==="top"||a==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:r.width}}drawBackground(){const{ctx:r,options:{backgroundColor:a},left:d,top:h,width:f,height:g}=this;a&&(r.save(),r.fillStyle=a,r.fillRect(d,h,f,g),r.restore())}getLineWidthForValue(r){const a=this.options.grid;if(!this._isVisible()||!a.display)return 0;const h=this.ticks.findIndex(f=>f.value===r);return h>=0?a.setContext(this.getContext(h)).lineWidth:0}drawGrid(r){const a=this.options.grid,d=this.ctx,h=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(r));let f,g;const v=(y,C,O)=>{!O.width||!O.color||(d.save(),d.lineWidth=O.width,d.strokeStyle=O.color,d.setLineDash(O.borderDash||[]),d.lineDashOffset=O.borderDashOffset,d.beginPath(),d.moveTo(y.x,y.y),d.lineTo(C.x,C.y),d.stroke(),d.restore())};if(a.display)for(f=0,g=h.length;f<g;++f){const y=h[f];a.drawOnChartArea&&v({x:y.x1,y:y.y1},{x:y.x2,y:y.y2},y),a.drawTicks&&v({x:y.tx1,y:y.ty1},{x:y.tx2,y:y.ty2},{color:y.tickColor,width:y.tickWidth,borderDash:y.tickBorderDash,borderDashOffset:y.tickBorderDashOffset})}}drawBorder(){const{chart:r,ctx:a,options:{border:d,grid:h}}=this,f=d.setContext(this.getContext()),g=d.display?f.width:0;if(!g)return;const v=h.setContext(this.getContext(0)).lineWidth,y=this._borderValue;let C,O,k,M;this.isHorizontal()?(C=_d(r,this.left,g)-g/2,O=_d(r,this.right,v)+v/2,k=M=y):(k=_d(r,this.top,g)-g/2,M=_d(r,this.bottom,v)+v/2,C=O=y),a.save(),a.lineWidth=f.width,a.strokeStyle=f.color,a.beginPath(),a.moveTo(C,k),a.lineTo(O,M),a.stroke(),a.restore()}drawLabels(r){if(!this.options.ticks.display)return;const d=this.ctx,h=this._computeLabelArea();h&&LI(d,h);const f=this.getLabelItems(r);for(const g of f){const v=g.options,y=g.font,C=g.label,O=g.textOffset;Ud(d,C,0,O,y,v)}h&&MI(d)}drawTitle(){const{ctx:r,options:{position:a,title:d,reverse:h}}=this;if(!d.display)return;const f=Ei(d.font),g=tr(d.padding),v=d.align;let y=f.lineHeight/2;a==="bottom"||a==="center"||nn(a)?(y+=g.bottom,jn(d.text)&&(y+=f.lineHeight*(d.text.length-1))):y+=g.top;const{titleX:C,titleY:O,maxWidth:k,rotation:M}=wot(this,y,a,v);Ud(r,d.text,0,0,f,{color:d.color,maxWidth:k,rotation:M,textAlign:Iot(v,a,h),textBaseline:"middle",translation:[C,O]})}draw(r){this._isVisible()&&(this.drawBackground(),this.drawGrid(r),this.drawBorder(),this.drawTitle(),this.drawLabels(r))}_layers(){const r=this.options,a=r.ticks&&r.ticks.z||0,d=ze(r.grid&&r.grid.z,-1),h=ze(r.border&&r.border.z,0);return!this._isVisible()||this.draw!==Bd.prototype.draw?[{z:a,draw:f=>{this.draw(f)}}]:[{z:d,draw:f=>{this.drawBackground(),this.drawGrid(f),this.drawTitle()}},{z:h,draw:()=>{this.drawBorder()}},{z:a,draw:f=>{this.drawLabels(f)}}]}getMatchingVisibleMetas(r){const a=this.chart.getSortedVisibleDatasetMetas(),d=this.axis+"AxisID",h=[];let f,g;for(f=0,g=a.length;f<g;++f){const v=a[f];v[d]===this.id&&(!r||v.type===r)&&h.push(v)}return h}_resolveTickFontOptions(r){const a=this.options.ticks.setContext(this.getContext(r));return Ei(a.font)}_maxDigits(){const r=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/r}}class oE{constructor(r,a,d){this.type=r,this.scope=a,this.override=d,this.items=Object.create(null)}isForType(r){return Object.prototype.isPrototypeOf.call(this.type.prototype,r.prototype)}register(r){const a=Object.getPrototypeOf(r);let d;Not(a)&&(d=this.register(a));const h=this.items,f=r.id,g=this.scope+"."+f;if(!f)throw new Error("class does not have id: "+r);return f in h||(h[f]=r,Aot(r,g,d),this.override&&Jn.override(r.id,r.overrides)),g}get(r){return this.items[r]}unregister(r){const a=this.items,d=r.id,h=this.scope;d in a&&delete a[d],h&&d in Jn[h]&&(delete Jn[h][d],this.override&&delete xd[d])}}function Aot(s,r,a){const d=Rf(Object.create(null),[a?Jn.get(a):{},Jn.get(r),s.defaults]);Jn.set(r,d),s.defaultRoutes&&Oot(r,s.defaultRoutes),s.descriptors&&Jn.describe(r,s.descriptors)}function Oot(s,r){Object.keys(r).forEach(a=>{const d=a.split("."),h=d.pop(),f=[s].concat(d).join("."),g=r[a].split("."),v=g.pop(),y=g.join(".");Jn.route(f,h,y,v)})}function Not(s){return"id"in s&&"defaults"in s}class Dot{constructor(){this.controllers=new oE(rf,"datasets",!0),this.elements=new oE(va,"elements"),this.plugins=new oE(Object,"plugins"),this.scales=new oE(Bd,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...r){this._each("register",r)}remove(...r){this._each("unregister",r)}addControllers(...r){this._each("register",r,this.controllers)}addElements(...r){this._each("register",r,this.elements)}addPlugins(...r){this._each("register",r,this.plugins)}addScales(...r){this._each("register",r,this.scales)}getController(r){return this._get(r,this.controllers,"controller")}getElement(r){return this._get(r,this.elements,"element")}getPlugin(r){return this._get(r,this.plugins,"plugin")}getScale(r){return this._get(r,this.scales,"scale")}removeControllers(...r){this._each("unregister",r,this.controllers)}removeElements(...r){this._each("unregister",r,this.elements)}removePlugins(...r){this._each("unregister",r,this.plugins)}removeScales(...r){this._each("unregister",r,this.scales)}_each(r,a,d){[...a].forEach(h=>{const f=d||this._getRegistryForType(h);d||f.isForType(h)||f===this.plugins&&h.id?this._exec(r,f,h):dn(h,g=>{const v=d||this._getRegistryForType(g);this._exec(r,v,g)})})}_exec(r,a,d){const h=AI(r);Rn(d["before"+h],[],d),a[r](d),Rn(d["after"+h],[],d)}_getRegistryForType(r){for(let a=0;a<this._typedRegistries.length;a++){const d=this._typedRegistries[a];if(d.isForType(r))return d}return this.plugins}_get(r,a,d){const h=a.get(r);if(h===void 0)throw new Error('"'+r+'" is not a registered '+d+".");return h}}var Fo=new Dot;class Pot{constructor(){this._init=[]}notify(r,a,d,h){a==="beforeInit"&&(this._init=this._createDescriptors(r,!0),this._notify(this._init,r,"install"));const f=h?this._descriptors(r).filter(h):this._descriptors(r),g=this._notify(f,r,a,d);return a==="afterDestroy"&&(this._notify(f,r,"stop"),this._notify(this._init,r,"uninstall")),g}_notify(r,a,d,h){h=h||{};for(const f of r){const g=f.plugin,v=g[d],y=[a,h,f.options];if(Rn(v,y,g)===!1&&h.cancelable)return!1}return!0}invalidate(){ln(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(r){if(this._cache)return this._cache;const a=this._cache=this._createDescriptors(r);return this._notifyStateChanges(r),a}_createDescriptors(r,a){const d=r&&r.config,h=ze(d.options&&d.options.plugins,{}),f=kot(d);return h===!1&&!a?[]:Mot(r,f,h,a)}_notifyStateChanges(r){const a=this._oldCache||[],d=this._cache,h=(f,g)=>f.filter(v=>!g.some(y=>v.plugin.id===y.plugin.id));this._notify(h(a,d),r,"stop"),this._notify(h(d,a),r,"start")}}function kot(s){const r={},a=[],d=Object.keys(Fo.plugins.items);for(let f=0;f<d.length;f++)a.push(Fo.getPlugin(d[f]));const h=s.plugins||[];for(let f=0;f<h.length;f++){const g=h[f];a.indexOf(g)===-1&&(a.push(g),r[g.id]=!0)}return{plugins:a,localIds:r}}function Lot(s,r){return!r&&s===!1?null:s===!0?{}:s}function Mot(s,{plugins:r,localIds:a},d,h){const f=[],g=s.getContext();for(const v of r){const y=v.id,C=Lot(d[y],h);C!==null&&f.push({plugin:v,options:xot(s.config,{plugin:v,local:a[y]},C,g)})}return f}function xot(s,{plugin:r,local:a},d,h){const f=s.pluginScopeKeys(r),g=s.getOptionScopes(d,f);return a&&r.defaults&&g.push(r.defaults),s.createResolver(g,h,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Rb(s,r){const a=Jn.datasets[s]||{};return((r.datasets||{})[s]||{}).indexAxis||r.indexAxis||a.indexAxis||"x"}function Uot(s,r){let a=s;return s==="_index_"?a=r:s==="_value_"&&(a=r==="x"?"y":"x"),a}function Vot(s,r){return s===r?"_index_":"_value_"}function zB(s){if(s==="x"||s==="y"||s==="r")return s}function Fot(s){if(s==="top"||s==="bottom")return"x";if(s==="left"||s==="right")return"y"}function Cb(s,...r){if(zB(s))return s;for(const a of r){const d=a.axis||Fot(a.position)||s.length>1&&zB(s[0].toLowerCase());if(d)return d}throw new Error(`Cannot determine type of '${s}' axis. Please provide 'axis' or 'position' option.`)}function KB(s,r,a){if(a[r+"AxisID"]===s)return{axis:r}}function Bot(s,r){if(r.data&&r.data.datasets){const a=r.data.datasets.filter(d=>d.xAxisID===s||d.yAxisID===s);if(a.length)return KB(s,"x",a[0])||KB(s,"y",a[0])}return{}}function jot(s,r){const a=xd[s.type]||{scales:{}},d=r.scales||{},h=Rb(s.type,r),f=Object.create(null);return Object.keys(d).forEach(g=>{const v=d[g];if(!nn(v))return console.error(`Invalid scale configuration for scale: ${g}`);if(v._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${g}`);const y=Cb(g,v,Bot(g,s),Jn.scales[v.type]),C=Vot(y,h),O=a.scales||{};f[g]=$p(Object.create(null),[{axis:y},v,O[y],O[C]])}),s.data.datasets.forEach(g=>{const v=g.type||s.type,y=g.indexAxis||Rb(v,r),O=(xd[v]||{}).scales||{};Object.keys(O).forEach(k=>{const M=Uot(k,y),j=g[M+"AxisID"]||M;f[j]=f[j]||Object.create(null),$p(f[j],[{axis:M},d[j],O[k]])})}),Object.keys(f).forEach(g=>{const v=f[g];$p(v,[Jn.scales[v.type],Jn.scale])}),f}function a4(s){const r=s.options||(s.options={});r.plugins=ze(r.plugins,{}),r.scales=jot(s,r)}function c4(s){return s=s||{},s.datasets=s.datasets||[],s.labels=s.labels||[],s}function Wot(s){return s=s||{},s.data=c4(s.data),a4(s),s}const YB=new Map,d4=new Set;function aE(s,r){let a=YB.get(s);return a||(a=r(),YB.set(s,a),d4.add(a)),a}const Dp=(s,r,a)=>{const d=$E(r,a);d!==void 0&&s.add(d)};class Got{constructor(r){this._config=Wot(r),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(r){this._config.type=r}get data(){return this._config.data}set data(r){this._config.data=c4(r)}get options(){return this._config.options}set options(r){this._config.options=r}get plugins(){return this._config.plugins}update(){const r=this._config;this.clearCache(),a4(r)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(r){return aE(r,()=>[[`datasets.${r}`,""]])}datasetAnimationScopeKeys(r,a){return aE(`${r}.transition.${a}`,()=>[[`datasets.${r}.transitions.${a}`,`transitions.${a}`],[`datasets.${r}`,""]])}datasetElementScopeKeys(r,a){return aE(`${r}-${a}`,()=>[[`datasets.${r}.elements.${a}`,`datasets.${r}`,`elements.${a}`,""]])}pluginScopeKeys(r){const a=r.id,d=this.type;return aE(`${d}-plugin-${a}`,()=>[[`plugins.${a}`,...r.additionalOptionScopes||[]]])}_cachedScopes(r,a){const d=this._scopeCache;let h=d.get(r);return(!h||a)&&(h=new Map,d.set(r,h)),h}getOptionScopes(r,a,d){const{options:h,type:f}=this,g=this._cachedScopes(r,d),v=g.get(a);if(v)return v;const y=new Set;a.forEach(O=>{r&&(y.add(r),O.forEach(k=>Dp(y,r,k))),O.forEach(k=>Dp(y,h,k)),O.forEach(k=>Dp(y,xd[f]||{},k)),O.forEach(k=>Dp(y,Jn,k)),O.forEach(k=>Dp(y,Tb,k))});const C=Array.from(y);return C.length===0&&C.push(Object.create(null)),d4.has(a)&&g.set(a,C),C}chartOptionScopes(){const{options:r,type:a}=this;return[r,xd[a]||{},Jn.datasets[a]||{},{type:a},Jn,Tb]}resolveNamedOptions(r,a,d,h=[""]){const f={$shared:!0},{resolver:g,subPrefixes:v}=qB(this._resolverCache,r,h);let y=g;if(zot(g,a)){f.$shared=!1,d=Cc(d)?d():d;const C=this.createResolver(r,d,v);y=Fu(g,d,C)}for(const C of a)f[C]=y[C];return f}createResolver(r,a,d=[""],h){const{resolver:f}=qB(this._resolverCache,r,d);return nn(a)?Fu(f,a,void 0,h):f}}function qB(s,r,a){let d=s.get(r);d||(d=new Map,s.set(r,d));const h=a.join();let f=d.get(h);return f||(f={resolver:xI(r,a),subPrefixes:a.filter(v=>!v.toLowerCase().includes("hover"))},d.set(h,f)),f}const Hot=s=>nn(s)&&Object.getOwnPropertyNames(s).some(r=>Cc(s[r]));function zot(s,r){const{isScriptable:a,isIndexable:d}=K5(s);for(const h of r){const f=a(h),g=d(h),v=(g||f)&&s[h];if(f&&(Cc(v)||Hot(v))||g&&jn(v))return!0}return!1}var Kot="4.5.0";const Yot=["top","bottom","left","right","chartArea"];function XB(s,r){return s==="top"||s==="bottom"||Yot.indexOf(s)===-1&&r==="x"}function JB(s,r){return function(a,d){return a[s]===d[s]?a[r]-d[r]:a[s]-d[s]}}function QB(s){const r=s.chart,a=r.options.animation;r.notifyPlugins("afterRender"),Rn(a&&a.onComplete,[s],r)}function qot(s){const r=s.chart,a=r.options.animation;Rn(a&&a.onProgress,[s],r)}function l4(s){return FI()&&typeof s=="string"?s=document.getElementById(s):s&&s.length&&(s=s[0]),s&&s.canvas&&(s=s.canvas),s}const bE={},ZB=s=>{const r=l4(s);return Object.values(bE).filter(a=>a.canvas===r).pop()};function Xot(s,r,a){const d=Object.keys(s);for(const h of d){const f=+h;if(f>=r){const g=s[h];delete s[h],(a>0||f>r)&&(s[f+a]=g)}}}function Jot(s,r,a,d){return!a||s.type==="mouseout"?null:d?r:s}var ic;let IS=(ic=class{static register(...r){Fo.add(...r),$B()}static unregister(...r){Fo.remove(...r),$B()}constructor(r,a){const d=this.config=new Got(a),h=l4(r),f=ZB(h);if(f)throw new Error("Canvas is already in use. Chart with ID '"+f.id+"' must be destroyed before the canvas with ID '"+f.canvas.id+"' can be reused.");const g=d.createResolver(d.chartOptionScopes(),this.getContext());this.platform=new(d.platform||fot(h)),this.platform.updateConfig(d);const v=this.platform.acquireContext(h,g.aspectRatio),y=v&&v.canvas,C=y&&y.height,O=y&&y.width;if(this.id=ert(),this.ctx=v,this.canvas=y,this.width=O,this.height=C,this._options=g,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Pot,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=vrt(k=>this.update(k),g.resizeDelay||0),this._dataChanges=[],bE[this.id]=this,!v||!y){console.error("Failed to create chart: can't acquire context from the given item");return}aa.listen(this,"complete",QB),aa.listen(this,"progress",qot),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:r,maintainAspectRatio:a},width:d,height:h,_aspectRatio:f}=this;return ln(r)?a&&f?f:h?d/h:null:r}get data(){return this.config.data}set data(r){this.config.data=r}get options(){return this._options}set options(r){this.config.options=r}get registry(){return Fo}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():CB(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return TB(this.canvas,this.ctx),this}stop(){return aa.stop(this),this}resize(r,a){aa.running(this)?this._resizeBeforeDraw={width:r,height:a}:this._resize(r,a)}_resize(r,a){const d=this.options,h=this.canvas,f=d.maintainAspectRatio&&this.aspectRatio,g=this.platform.getMaximumSize(h,r,a,f),v=d.devicePixelRatio||this.platform.getDevicePixelRatio(),y=this.width?"resize":"attach";this.width=g.width,this.height=g.height,this._aspectRatio=this.aspectRatio,CB(this,v,!0)&&(this.notifyPlugins("resize",{size:g}),Rn(d.onResize,[this,g],this),this.attached&&this._doResize(y)&&this.render())}ensureScalesHaveIDs(){const a=this.options.scales||{};dn(a,(d,h)=>{d.id=h})}buildOrUpdateScales(){const r=this.options,a=r.scales,d=this.scales,h=Object.keys(d).reduce((g,v)=>(g[v]=!1,g),{});let f=[];a&&(f=f.concat(Object.keys(a).map(g=>{const v=a[g],y=Cb(g,v),C=y==="r",O=y==="x";return{options:v,dposition:C?"chartArea":O?"bottom":"left",dtype:C?"radialLinear":O?"category":"linear"}}))),dn(f,g=>{const v=g.options,y=v.id,C=Cb(y,v),O=ze(v.type,g.dtype);(v.position===void 0||XB(v.position,C)!==XB(g.dposition))&&(v.position=g.dposition),h[y]=!0;let k=null;if(y in d&&d[y].type===O)k=d[y];else{const M=Fo.getScale(O);k=new M({id:y,type:O,ctx:this.ctx,chart:this}),d[k.id]=k}k.init(v,r)}),dn(h,(g,v)=>{g||delete d[v]}),dn(d,g=>{Ps.configure(this,g,g.options),Ps.addBox(this,g)})}_updateMetasets(){const r=this._metasets,a=this.data.datasets.length,d=r.length;if(r.sort((h,f)=>h.index-f.index),d>a){for(let h=a;h<d;++h)this._destroyDatasetMeta(h);r.splice(a,d-a)}this._sortedMetasets=r.slice(0).sort(JB("order","index"))}_removeUnreferencedMetasets(){const{_metasets:r,data:{datasets:a}}=this;r.length>a.length&&delete this._stacks,r.forEach((d,h)=>{a.filter(f=>f===d._dataset).length===0&&this._destroyDatasetMeta(h)})}buildOrUpdateControllers(){const r=[],a=this.data.datasets;let d,h;for(this._removeUnreferencedMetasets(),d=0,h=a.length;d<h;d++){const f=a[d];let g=this.getDatasetMeta(d);const v=f.type||this.config.type;if(g.type&&g.type!==v&&(this._destroyDatasetMeta(d),g=this.getDatasetMeta(d)),g.type=v,g.indexAxis=f.indexAxis||Rb(v,this.options),g.order=f.order||0,g.index=d,g.label=""+f.label,g.visible=this.isDatasetVisible(d),g.controller)g.controller.updateIndex(d),g.controller.linkScales();else{const y=Fo.getController(v),{datasetElementType:C,dataElementType:O}=Jn.datasets[v];Object.assign(y,{dataElementType:Fo.getElement(O),datasetElementType:C&&Fo.getElement(C)}),g.controller=new y(this,d),r.push(g.controller)}}return this._updateMetasets(),r}_resetElements(){dn(this.data.datasets,(r,a)=>{this.getDatasetMeta(a).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(r){const a=this.config;a.update();const d=this._options=a.createResolver(a.chartOptionScopes(),this.getContext()),h=this._animationsDisabled=!d.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:r,cancelable:!0})===!1)return;const f=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let g=0;for(let C=0,O=this.data.datasets.length;C<O;C++){const{controller:k}=this.getDatasetMeta(C),M=!h&&f.indexOf(k)===-1;k.buildOrUpdateElements(M),g=Math.max(+k.getMaxOverflow(),g)}g=this._minPadding=d.layout.autoPadding?g:0,this._updateLayout(g),h||dn(f,C=>{C.reset()}),this._updateDatasets(r),this.notifyPlugins("afterUpdate",{mode:r}),this._layers.sort(JB("z","_idx"));const{_active:v,_lastEvent:y}=this;y?this._eventHandler(y,!0):v.length&&this._updateHoverStyles(v,v,!0),this.render()}_updateScales(){dn(this.scales,r=>{Ps.removeBox(this,r)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const r=this.options,a=new Set(Object.keys(this._listeners)),d=new Set(r.events);(!hB(a,d)||!!this._responsiveListeners!==r.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:r}=this,a=this._getUniformDataChanges()||[];for(const{method:d,start:h,count:f}of a){const g=d==="_removeElements"?-f:f;Xot(r,h,g)}}_getUniformDataChanges(){const r=this._dataChanges;if(!r||!r.length)return;this._dataChanges=[];const a=this.data.datasets.length,d=f=>new Set(r.filter(g=>g[0]===f).map((g,v)=>v+","+g.splice(1).join(","))),h=d(0);for(let f=1;f<a;f++)if(!hB(h,d(f)))return;return Array.from(h).map(f=>f.split(",")).map(f=>({method:f[1],start:+f[2],count:+f[3]}))}_updateLayout(r){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Ps.update(this,this.width,this.height,r);const a=this.chartArea,d=a.width<=0||a.height<=0;this._layers=[],dn(this.boxes,h=>{d&&h.position==="chartArea"||(h.configure&&h.configure(),this._layers.push(...h._layers()))},this),this._layers.forEach((h,f)=>{h._idx=f}),this.notifyPlugins("afterLayout")}_updateDatasets(r){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:r,cancelable:!0})!==!1){for(let a=0,d=this.data.datasets.length;a<d;++a)this.getDatasetMeta(a).controller.configure();for(let a=0,d=this.data.datasets.length;a<d;++a)this._updateDataset(a,Cc(r)?r({datasetIndex:a}):r);this.notifyPlugins("afterDatasetsUpdate",{mode:r})}}_updateDataset(r,a){const d=this.getDatasetMeta(r),h={meta:d,index:r,mode:a,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",h)!==!1&&(d.controller._update(a),h.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",h))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(aa.has(this)?this.attached&&!aa.running(this)&&aa.start(this):(this.draw(),QB({chart:this})))}draw(){let r;if(this._resizeBeforeDraw){const{width:d,height:h}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(d,h)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const a=this._layers;for(r=0;r<a.length&&a[r].z<=0;++r)a[r].draw(this.chartArea);for(this._drawDatasets();r<a.length;++r)a[r].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(r){const a=this._sortedMetasets,d=[];let h,f;for(h=0,f=a.length;h<f;++h){const g=a[h];(!r||g.visible)&&d.push(g)}return d}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const r=this.getSortedVisibleDatasetMetas();for(let a=r.length-1;a>=0;--a)this._drawDataset(r[a]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(r){const a=this.ctx,d={meta:r,index:r.index,cancelable:!0},h=wst(this,r);this.notifyPlugins("beforeDatasetDraw",d)!==!1&&(h&&LI(a,h),r.controller.draw(),h&&MI(a),d.cancelable=!1,this.notifyPlugins("afterDatasetDraw",d))}isPointInArea(r){return fa(r,this.chartArea,this._minPadding)}getElementsAtEventForMode(r,a,d,h){const f=Yst.modes[a];return typeof f=="function"?f(this,r,d,h):[]}getDatasetMeta(r){const a=this.data.datasets[r],d=this._metasets;let h=d.filter(f=>f&&f._dataset===a).pop();return h||(h={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:a&&a.order||0,index:r,_dataset:a,_parsed:[],_sorted:!1},d.push(h)),h}getContext(){return this.$context||(this.$context=Ac(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(r){const a=this.data.datasets[r];if(!a)return!1;const d=this.getDatasetMeta(r);return typeof d.hidden=="boolean"?!d.hidden:!a.hidden}setDatasetVisibility(r,a){const d=this.getDatasetMeta(r);d.hidden=!a}toggleDataVisibility(r){this._hiddenIndices[r]=!this._hiddenIndices[r]}getDataVisibility(r){return!this._hiddenIndices[r]}_updateVisibility(r,a,d){const h=d?"show":"hide",f=this.getDatasetMeta(r),g=f.controller._resolveAnimations(void 0,h);tS(a)?(f.data[a].hidden=!d,this.update()):(this.setDatasetVisibility(r,d),g.update(f,{visible:d}),this.update(v=>v.datasetIndex===r?h:void 0))}hide(r,a){this._updateVisibility(r,a,!1)}show(r,a){this._updateVisibility(r,a,!0)}_destroyDatasetMeta(r){const a=this._metasets[r];a&&a.controller&&a.controller._destroy(),delete this._metasets[r]}_stop(){let r,a;for(this.stop(),aa.remove(this),r=0,a=this.data.datasets.length;r<a;++r)this._destroyDatasetMeta(r)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:r,ctx:a}=this;this._stop(),this.config.clearCache(),r&&(this.unbindEvents(),TB(r,a),this.platform.releaseContext(a),this.canvas=null,this.ctx=null),delete bE[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...r){return this.canvas.toDataURL(...r)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const r=this._listeners,a=this.platform,d=(f,g)=>{a.addEventListener(this,f,g),r[f]=g},h=(f,g,v)=>{f.offsetX=g,f.offsetY=v,this._eventHandler(f)};dn(this.options.events,f=>d(f,h))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const r=this._responsiveListeners,a=this.platform,d=(y,C)=>{a.addEventListener(this,y,C),r[y]=C},h=(y,C)=>{r[y]&&(a.removeEventListener(this,y,C),delete r[y])},f=(y,C)=>{this.canvas&&this.resize(y,C)};let g;const v=()=>{h("attach",v),this.attached=!0,this.resize(),d("resize",f),d("detach",g)};g=()=>{this.attached=!1,h("resize",f),this._stop(),this._resize(0,0),d("attach",v)},a.isAttached(this.canvas)?v():g()}unbindEvents(){dn(this._listeners,(r,a)=>{this.platform.removeEventListener(this,a,r)}),this._listeners={},dn(this._responsiveListeners,(r,a)=>{this.platform.removeEventListener(this,a,r)}),this._responsiveListeners=void 0}updateHoverStyle(r,a,d){const h=d?"set":"remove";let f,g,v,y;for(a==="dataset"&&(f=this.getDatasetMeta(r[0].datasetIndex),f.controller["_"+h+"DatasetHoverStyle"]()),v=0,y=r.length;v<y;++v){g=r[v];const C=g&&this.getDatasetMeta(g.datasetIndex).controller;C&&C[h+"HoverStyle"](g.element,g.datasetIndex,g.index)}}getActiveElements(){return this._active||[]}setActiveElements(r){const a=this._active||[],d=r.map(({datasetIndex:f,index:g})=>{const v=this.getDatasetMeta(f);if(!v)throw new Error("No dataset found at index "+f);return{datasetIndex:f,element:v.data[g],index:g}});!QE(d,a)&&(this._active=d,this._lastEvent=null,this._updateHoverStyles(d,a))}notifyPlugins(r,a,d){return this._plugins.notify(this,r,a,d)}isPluginEnabled(r){return this._plugins._cache.filter(a=>a.plugin.id===r).length===1}_updateHoverStyles(r,a,d){const h=this.options.hover,f=(y,C)=>y.filter(O=>!C.some(k=>O.datasetIndex===k.datasetIndex&&O.index===k.index)),g=f(a,r),v=d?r:f(r,a);g.length&&this.updateHoverStyle(g,h.mode,!1),v.length&&h.mode&&this.updateHoverStyle(v,h.mode,!0)}_eventHandler(r,a){const d={event:r,replay:a,cancelable:!0,inChartArea:this.isPointInArea(r)},h=g=>(g.options.events||this.options.events).includes(r.native.type);if(this.notifyPlugins("beforeEvent",d,h)===!1)return;const f=this._handleEvent(r,a,d.inChartArea);return d.cancelable=!1,this.notifyPlugins("afterEvent",d,h),(f||d.changed)&&this.render(),this}_handleEvent(r,a,d){const{_active:h=[],options:f}=this,g=a,v=this._getActiveElements(r,h,d,g),y=art(r),C=Jot(r,this._lastEvent,d,y);d&&(this._lastEvent=null,Rn(f.onHover,[r,v,this],this),y&&Rn(f.onClick,[r,v,this],this));const O=!QE(v,h);return(O||a)&&(this._active=v,this._updateHoverStyles(v,h,a)),this._lastEvent=C,O}_getActiveElements(r,a,d,h){if(r.type==="mouseout")return[];if(!d)return a;const f=this.options.hover;return this.getElementsAtEventForMode(r,f.mode,f,h)}},fe(ic,"defaults",Jn),fe(ic,"instances",bE),fe(ic,"overrides",xd),fe(ic,"registry",Fo),fe(ic,"version",Kot),fe(ic,"getChart",ZB),ic);function $B(){return dn(IS.instances,s=>s._plugins.invalidate())}function u4(s,r,a=r){s.lineCap=ze(a.borderCapStyle,r.borderCapStyle),s.setLineDash(ze(a.borderDash,r.borderDash)),s.lineDashOffset=ze(a.borderDashOffset,r.borderDashOffset),s.lineJoin=ze(a.borderJoinStyle,r.borderJoinStyle),s.lineWidth=ze(a.borderWidth,r.borderWidth),s.strokeStyle=ze(a.borderColor,r.borderColor)}function Qot(s,r,a){s.lineTo(a.x,a.y)}function Zot(s){return s.stepped?Lrt:s.tension||s.cubicInterpolationMode==="monotone"?Mrt:Qot}function h4(s,r,a={}){const d=s.length,{start:h=0,end:f=d-1}=a,{start:g,end:v}=r,y=Math.max(h,g),C=Math.min(f,v),O=h<g&&f<g||h>v&&f>v;return{count:d,start:y,loop:r.loop,ilen:C<y&&!O?d+C-y:C-y}}function $ot(s,r,a,d){const{points:h,options:f}=r,{count:g,start:v,loop:y,ilen:C}=h4(h,a,d),O=Zot(f);let{move:k=!0,reverse:M}=d||{},j,z,Y;for(j=0;j<=C;++j)z=h[(v+(M?C-j:j))%g],!z.skip&&(k?(s.moveTo(z.x,z.y),k=!1):O(s,Y,z,M,f.stepped),Y=z);return y&&(z=h[(v+(M?C:0))%g],O(s,Y,z,M,f.stepped)),!!y}function tat(s,r,a,d){const h=r.points,{count:f,start:g,ilen:v}=h4(h,a,d),{move:y=!0,reverse:C}=d||{};let O=0,k=0,M,j,z,Y,Z,H;const K=it=>(g+(C?v-it:it))%f,q=()=>{Y!==Z&&(s.lineTo(O,Z),s.lineTo(O,Y),s.lineTo(O,H))};for(y&&(j=h[K(0)],s.moveTo(j.x,j.y)),M=0;M<=v;++M){if(j=h[K(M)],j.skip)continue;const it=j.x,ot=j.y,_t=it|0;_t===z?(ot<Y?Y=ot:ot>Z&&(Z=ot),O=(k*O+it)/++k):(q(),s.lineTo(it,ot),z=_t,k=0,Y=Z=ot),H=ot}q()}function bb(s){const r=s.options,a=r.borderDash&&r.borderDash.length;return!s._decimated&&!s._loop&&!r.tension&&r.cubicInterpolationMode!=="monotone"&&!r.stepped&&!a?tat:$ot}function eat(s){return s.stepped?fst:s.tension||s.cubicInterpolationMode==="monotone"?mst:yd}function nat(s,r,a,d){let h=r._path;h||(h=r._path=new Path2D,r.path(h,a,d)&&h.closePath()),u4(s,r.options),s.stroke(h)}function iat(s,r,a,d){const{segments:h,options:f}=r,g=bb(r);for(const v of h)u4(s,f,v.style),s.beginPath(),g(s,r,v,{start:a,end:a+d-1})&&s.closePath(),s.stroke()}const rat=typeof Path2D=="function";function sat(s,r,a,d){rat&&!r.options.segment?nat(s,r,a,d):iat(s,r,a,d)}class Fp extends va{constructor(r){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,r&&Object.assign(this,r)}updateControlPoints(r,a){const d=this.options;if((d.tension||d.cubicInterpolationMode==="monotone")&&!d.stepped&&!this._pointsUpdated){const h=d.spanGaps?this._loop:this._fullLoop;ost(this._points,d,r,h,a),this._pointsUpdated=!0}}set points(r){this._points=r,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=Rst(this,this.options.segment))}first(){const r=this.segments,a=this.points;return r.length&&a[r[0].start]}last(){const r=this.segments,a=this.points,d=r.length;return d&&a[r[d-1].end]}interpolate(r,a){const d=this.options,h=r[a],f=this.points,g=vst(this,{property:a,start:h,end:h});if(!g.length)return;const v=[],y=eat(d);let C,O;for(C=0,O=g.length;C<O;++C){const{start:k,end:M}=g[C],j=f[k],z=f[M];if(j===z){v.push(j);continue}const Y=Math.abs((h-j[a])/(z[a]-j[a])),Z=y(j,z,Y,d.stepped);Z[a]=r[a],v.push(Z)}return v.length===1?v[0]:v}pathSegment(r,a,d){return bb(this)(r,this,a,d)}path(r,a,d){const h=this.segments,f=bb(this);let g=this._loop;a=a||0,d=d||this.points.length-a;for(const v of h)g&=f(r,this,v,{start:a,end:a+d-1});return!!g}draw(r,a,d,h){const f=this.options||{};(this.points||[]).length&&f.borderWidth&&(r.save(),sat(r,this,d,h),r.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}fe(Fp,"id","line"),fe(Fp,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),fe(Fp,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),fe(Fp,"descriptors",{_scriptable:!0,_indexable:r=>r!=="borderDash"&&r!=="fill"});function tj(s,r,a,d){const h=s.options,{[a]:f}=s.getProps([a],d);return Math.abs(r-f)<h.radius+h.hitRadius}class IE extends va{constructor(a){super();fe(this,"parsed");fe(this,"skip");fe(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,a&&Object.assign(this,a)}inRange(a,d,h){const f=this.options,{x:g,y:v}=this.getProps(["x","y"],h);return Math.pow(a-g,2)+Math.pow(d-v,2)<Math.pow(f.hitRadius+f.radius,2)}inXRange(a,d){return tj(this,a,"x",d)}inYRange(a,d){return tj(this,a,"y",d)}getCenterPoint(a){const{x:d,y:h}=this.getProps(["x","y"],a);return{x:d,y:h}}size(a){a=a||this.options||{};let d=a.radius||0;d=Math.max(d,d&&a.hoverRadius||0);const h=d&&a.borderWidth||0;return(d+h)*2}draw(a,d){const h=this.options;this.skip||h.radius<.1||!fa(this,d,this.size(h)/2)||(a.strokeStyle=h.borderColor,a.lineWidth=h.borderWidth,a.fillStyle=h.backgroundColor,yb(a,h,this.x,this.y))}getRange(){const a=this.options||{};return a.radius+a.hitRadius}}fe(IE,"id","point"),fe(IE,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),fe(IE,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});const ej=(s,r)=>{let{boxHeight:a=r,boxWidth:d=r}=s;return s.usePointStyle&&(a=Math.min(a,r),d=s.pointStyleWidth||Math.min(d,r)),{boxWidth:d,boxHeight:a,itemHeight:Math.max(r,a)}},oat=(s,r)=>s!==null&&r!==null&&s.datasetIndex===r.datasetIndex&&s.index===r.index;class nj extends va{constructor(r){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=r.chart,this.options=r.options,this.ctx=r.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(r,a,d){this.maxWidth=r,this.maxHeight=a,this._margins=d,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const r=this.options.labels||{};let a=Rn(r.generateLabels,[this.chart],this)||[];r.filter&&(a=a.filter(d=>r.filter(d,this.chart.data))),r.sort&&(a=a.sort((d,h)=>r.sort(d,h,this.chart.data))),this.options.reverse&&a.reverse(),this.legendItems=a}fit(){const{options:r,ctx:a}=this;if(!r.display){this.width=this.height=0;return}const d=r.labels,h=Ei(d.font),f=h.size,g=this._computeTitleHeight(),{boxWidth:v,itemHeight:y}=ej(d,f);let C,O;a.font=h.string,this.isHorizontal()?(C=this.maxWidth,O=this._fitRows(g,f,v,y)+10):(O=this.maxHeight,C=this._fitCols(g,h,v,y)+10),this.width=Math.min(C,r.maxWidth||this.maxWidth),this.height=Math.min(O,r.maxHeight||this.maxHeight)}_fitRows(r,a,d,h){const{ctx:f,maxWidth:g,options:{labels:{padding:v}}}=this,y=this.legendHitBoxes=[],C=this.lineWidths=[0],O=h+v;let k=r;f.textAlign="left",f.textBaseline="middle";let M=-1,j=-O;return this.legendItems.forEach((z,Y)=>{const Z=d+a/2+f.measureText(z.text).width;(Y===0||C[C.length-1]+Z+2*v>g)&&(k+=O,C[C.length-(Y>0?0:1)]=0,j+=O,M++),y[Y]={left:0,top:j,row:M,width:Z,height:h},C[C.length-1]+=Z+v}),k}_fitCols(r,a,d,h){const{ctx:f,maxHeight:g,options:{labels:{padding:v}}}=this,y=this.legendHitBoxes=[],C=this.columnSizes=[],O=g-r;let k=v,M=0,j=0,z=0,Y=0;return this.legendItems.forEach((Z,H)=>{const{itemWidth:K,itemHeight:q}=aat(d,a,f,Z,h);H>0&&j+q+2*v>O&&(k+=M+v,C.push({width:M,height:j}),z+=M+v,Y++,M=j=0),y[H]={left:z,top:j,col:Y,width:K,height:q},M=Math.max(M,K),j+=q+v}),k+=M,C.push({width:M,height:j}),k}adjustHitBoxes(){if(!this.options.display)return;const r=this._computeTitleHeight(),{legendHitBoxes:a,options:{align:d,labels:{padding:h},rtl:f}}=this,g=Nu(f,this.left,this.width);if(this.isHorizontal()){let v=0,y=Ji(d,this.left+h,this.right-this.lineWidths[v]);for(const C of a)v!==C.row&&(v=C.row,y=Ji(d,this.left+h,this.right-this.lineWidths[v])),C.top+=this.top+r+h,C.left=g.leftForLtr(g.x(y),C.width),y+=C.width+h}else{let v=0,y=Ji(d,this.top+r+h,this.bottom-this.columnSizes[v].height);for(const C of a)C.col!==v&&(v=C.col,y=Ji(d,this.top+r+h,this.bottom-this.columnSizes[v].height)),C.top=y,C.left+=this.left+h,C.left=g.leftForLtr(g.x(C.left),C.width),y+=C.height+h}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const r=this.ctx;LI(r,this),this._draw(),MI(r)}}_draw(){const{options:r,columnSizes:a,lineWidths:d,ctx:h}=this,{align:f,labels:g}=r,v=Jn.color,y=Nu(r.rtl,this.left,this.width),C=Ei(g.font),{padding:O}=g,k=C.size,M=k/2;let j;this.drawTitle(),h.textAlign=y.textAlign("left"),h.textBaseline="middle",h.lineWidth=.5,h.font=C.string;const{boxWidth:z,boxHeight:Y,itemHeight:Z}=ej(g,k),H=function(_t,ft,lt){if(isNaN(z)||z<=0||isNaN(Y)||Y<0)return;h.save();const kt=ze(lt.lineWidth,1);if(h.fillStyle=ze(lt.fillStyle,v),h.lineCap=ze(lt.lineCap,"butt"),h.lineDashOffset=ze(lt.lineDashOffset,0),h.lineJoin=ze(lt.lineJoin,"miter"),h.lineWidth=kt,h.strokeStyle=ze(lt.strokeStyle,v),h.setLineDash(ze(lt.lineDash,[])),g.usePointStyle){const At={radius:Y*Math.SQRT2/2,pointStyle:lt.pointStyle,rotation:lt.rotation,borderWidth:kt},qt=y.xPlus(_t,z/2),vt=ft+M;H5(h,At,qt,vt,g.pointStyleWidth&&z)}else{const At=ft+Math.max((k-Y)/2,0),qt=y.leftForLtr(_t,z),vt=Ou(lt.borderRadius);h.beginPath(),Object.values(vt).some(xt=>xt!==0)?iS(h,{x:qt,y:At,w:z,h:Y,radius:vt}):h.rect(qt,At,z,Y),h.fill(),kt!==0&&h.stroke()}h.restore()},K=function(_t,ft,lt){Ud(h,lt.text,_t,ft+Z/2,C,{strikethrough:lt.hidden,textAlign:y.textAlign(lt.textAlign)})},q=this.isHorizontal(),it=this._computeTitleHeight();q?j={x:Ji(f,this.left+O,this.right-d[0]),y:this.top+O+it,line:0}:j={x:this.left+O,y:Ji(f,this.top+it+O,this.bottom-a[0].height),line:0},Q5(this.ctx,r.textDirection);const ot=Z+O;this.legendItems.forEach((_t,ft)=>{h.strokeStyle=_t.fontColor,h.fillStyle=_t.fontColor;const lt=h.measureText(_t.text).width,kt=y.textAlign(_t.textAlign||(_t.textAlign=g.textAlign)),At=z+M+lt;let qt=j.x,vt=j.y;y.setWidth(this.width),q?ft>0&&qt+At+O>this.right&&(vt=j.y+=ot,j.line++,qt=j.x=Ji(f,this.left+O,this.right-d[j.line])):ft>0&&vt+ot>this.bottom&&(qt=j.x=qt+a[j.line].width+O,j.line++,vt=j.y=Ji(f,this.top+it+O,this.bottom-a[j.line].height));const xt=y.x(qt);if(H(xt,vt,_t),qt=Trt(kt,qt+z+M,q?qt+At:this.right,r.rtl),K(y.x(qt),vt,_t),q)j.x+=At+O;else if(typeof _t.text!="string"){const Ot=C.lineHeight;j.y+=p4(_t,Ot)+O}else j.y+=ot}),Z5(this.ctx,r.textDirection)}drawTitle(){const r=this.options,a=r.title,d=Ei(a.font),h=tr(a.padding);if(!a.display)return;const f=Nu(r.rtl,this.left,this.width),g=this.ctx,v=a.position,y=d.size/2,C=h.top+y;let O,k=this.left,M=this.width;if(this.isHorizontal())M=Math.max(...this.lineWidths),O=this.top+C,k=Ji(r.align,k,this.right-M);else{const z=this.columnSizes.reduce((Y,Z)=>Math.max(Y,Z.height),0);O=C+Ji(r.align,this.top,this.bottom-z-r.labels.padding-this._computeTitleHeight())}const j=Ji(v,k,k+M);g.textAlign=f.textAlign(DI(v)),g.textBaseline="middle",g.strokeStyle=a.color,g.fillStyle=a.color,g.font=d.string,Ud(g,a.text,j,O,d)}_computeTitleHeight(){const r=this.options.title,a=Ei(r.font),d=tr(r.padding);return r.display?a.lineHeight+d.height:0}_getLegendItemAt(r,a){let d,h,f;if(Up(r,this.left,this.right)&&Up(a,this.top,this.bottom)){for(f=this.legendHitBoxes,d=0;d<f.length;++d)if(h=f[d],Up(r,h.left,h.left+h.width)&&Up(a,h.top,h.top+h.height))return this.legendItems[d]}return null}handleEvent(r){const a=this.options;if(!lat(r.type,a))return;const d=this._getLegendItemAt(r.x,r.y);if(r.type==="mousemove"||r.type==="mouseout"){const h=this._hoveredItem,f=oat(h,d);h&&!f&&Rn(a.onLeave,[r,h,this],this),this._hoveredItem=d,d&&!f&&Rn(a.onHover,[r,d,this],this)}else d&&Rn(a.onClick,[r,d,this],this)}}function aat(s,r,a,d,h){const f=cat(d,s,r,a),g=dat(h,d,r.lineHeight);return{itemWidth:f,itemHeight:g}}function cat(s,r,a,d){let h=s.text;return h&&typeof h!="string"&&(h=h.reduce((f,g)=>f.length>g.length?f:g)),r+a.size/2+d.measureText(h).width}function dat(s,r,a){let d=s;return typeof r.text!="string"&&(d=p4(r,a)),d}function p4(s,r){const a=s.text?s.text.length:0;return r*a}function lat(s,r){return!!((s==="mousemove"||s==="mouseout")&&(r.onHover||r.onLeave)||r.onClick&&(s==="click"||s==="mouseup"))}var uat={id:"legend",_element:nj,start(s,r,a){const d=s.legend=new nj({ctx:s.ctx,options:a,chart:s});Ps.configure(s,d,a),Ps.addBox(s,d)},stop(s){Ps.removeBox(s,s.legend),delete s.legend},beforeUpdate(s,r,a){const d=s.legend;Ps.configure(s,d,a),d.options=a},afterUpdate(s){const r=s.legend;r.buildLabels(),r.adjustHitBoxes()},afterEvent(s,r){r.replay||s.legend.handleEvent(r.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(s,r,a){const d=r.datasetIndex,h=a.chart;h.isDatasetVisible(d)?(h.hide(d),r.hidden=!0):(h.show(d),r.hidden=!1)},onHover:null,onLeave:null,labels:{color:s=>s.chart.options.color,boxWidth:40,padding:10,generateLabels(s){const r=s.data.datasets,{labels:{usePointStyle:a,pointStyle:d,textAlign:h,color:f,useBorderRadius:g,borderRadius:v}}=s.legend.options;return s._getSortedDatasetMetas().map(y=>{const C=y.controller.getStyle(a?0:void 0),O=tr(C.borderWidth);return{text:r[y.index].label,fillStyle:C.backgroundColor,fontColor:f,hidden:!y.visible,lineCap:C.borderCapStyle,lineDash:C.borderDash,lineDashOffset:C.borderDashOffset,lineJoin:C.borderJoinStyle,lineWidth:(O.width+O.height)/4,strokeStyle:C.borderColor,pointStyle:d||C.pointStyle,rotation:C.rotation,textAlign:h||C.textAlign,borderRadius:g&&(v||C.borderRadius),datasetIndex:y.index}},this)}},title:{color:s=>s.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:s=>!s.startsWith("on"),labels:{_scriptable:s=>!["generateLabels","filter","sort"].includes(s)}}};class f4 extends va{constructor(r){super(),this.chart=r.chart,this.options=r.options,this.ctx=r.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(r,a){const d=this.options;if(this.left=0,this.top=0,!d.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=r,this.height=this.bottom=a;const h=jn(d.text)?d.text.length:1;this._padding=tr(d.padding);const f=h*Ei(d.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=f:this.width=f}isHorizontal(){const r=this.options.position;return r==="top"||r==="bottom"}_drawArgs(r){const{top:a,left:d,bottom:h,right:f,options:g}=this,v=g.align;let y=0,C,O,k;return this.isHorizontal()?(O=Ji(v,d,f),k=a+r,C=f-d):(g.position==="left"?(O=d+r,k=Ji(v,h,a),y=li*-.5):(O=f-r,k=Ji(v,a,h),y=li*.5),C=h-a),{titleX:O,titleY:k,maxWidth:C,rotation:y}}draw(){const r=this.ctx,a=this.options;if(!a.display)return;const d=Ei(a.font),f=d.lineHeight/2+this._padding.top,{titleX:g,titleY:v,maxWidth:y,rotation:C}=this._drawArgs(f);Ud(r,a.text,0,0,d,{color:a.color,maxWidth:y,rotation:C,textAlign:DI(a.align),textBaseline:"middle",translation:[g,v]})}}function hat(s,r){const a=new f4({ctx:s.ctx,options:r,chart:s});Ps.configure(s,a,r),Ps.addBox(s,a),s.titleBlock=a}var pat={id:"title",_element:f4,start(s,r,a){hat(s,a)},stop(s){const r=s.titleBlock;Ps.removeBox(s,r),delete s.titleBlock},beforeUpdate(s,r,a){const d=s.titleBlock;Ps.configure(s,d,a),d.options=a},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Bp={average(s){if(!s.length)return!1;let r,a,d=new Set,h=0,f=0;for(r=0,a=s.length;r<a;++r){const v=s[r].element;if(v&&v.hasValue()){const y=v.tooltipPosition();d.add(y.x),h+=y.y,++f}}return f===0||d.size===0?!1:{x:[...d].reduce((v,y)=>v+y)/d.size,y:h/f}},nearest(s,r){if(!s.length)return!1;let a=r.x,d=r.y,h=Number.POSITIVE_INFINITY,f,g,v;for(f=0,g=s.length;f<g;++f){const y=s[f].element;if(y&&y.hasValue()){const C=y.getCenterPoint(),O=vb(r,C);O<h&&(h=O,v=y)}}if(v){const y=v.tooltipPosition();a=y.x,d=y.y}return{x:a,y:d}}};function Uo(s,r){return r&&(jn(r)?Array.prototype.push.apply(s,r):s.push(r)),s}function ca(s){return(typeof s=="string"||s instanceof String)&&s.indexOf(`
`)>-1?s.split(`
`):s}function fat(s,r){const{element:a,datasetIndex:d,index:h}=r,f=s.getDatasetMeta(d).controller,{label:g,value:v}=f.getLabelAndValue(h);return{chart:s,label:g,parsed:f.getParsed(h),raw:s.data.datasets[d].data[h],formattedValue:v,dataset:f.getDataset(),dataIndex:h,datasetIndex:d,element:a}}function ij(s,r){const a=s.chart.ctx,{body:d,footer:h,title:f}=s,{boxWidth:g,boxHeight:v}=r,y=Ei(r.bodyFont),C=Ei(r.titleFont),O=Ei(r.footerFont),k=f.length,M=h.length,j=d.length,z=tr(r.padding);let Y=z.height,Z=0,H=d.reduce((it,ot)=>it+ot.before.length+ot.lines.length+ot.after.length,0);if(H+=s.beforeBody.length+s.afterBody.length,k&&(Y+=k*C.lineHeight+(k-1)*r.titleSpacing+r.titleMarginBottom),H){const it=r.displayColors?Math.max(v,y.lineHeight):y.lineHeight;Y+=j*it+(H-j)*y.lineHeight+(H-1)*r.bodySpacing}M&&(Y+=r.footerMarginTop+M*O.lineHeight+(M-1)*r.footerSpacing);let K=0;const q=function(it){Z=Math.max(Z,a.measureText(it).width+K)};return a.save(),a.font=C.string,dn(s.title,q),a.font=y.string,dn(s.beforeBody.concat(s.afterBody),q),K=r.displayColors?g+2+r.boxPadding:0,dn(d,it=>{dn(it.before,q),dn(it.lines,q),dn(it.after,q)}),K=0,a.font=O.string,dn(s.footer,q),a.restore(),Z+=z.width,{width:Z,height:Y}}function mat(s,r){const{y:a,height:d}=r;return a<d/2?"top":a>s.height-d/2?"bottom":"center"}function _at(s,r,a,d){const{x:h,width:f}=d,g=a.caretSize+a.caretPadding;if(s==="left"&&h+f+g>r.width||s==="right"&&h-f-g<0)return!0}function gat(s,r,a,d){const{x:h,width:f}=a,{width:g,chartArea:{left:v,right:y}}=s;let C="center";return d==="center"?C=h<=(v+y)/2?"left":"right":h<=f/2?C="left":h>=g-f/2&&(C="right"),_at(C,s,r,a)&&(C="center"),C}function rj(s,r,a){const d=a.yAlign||r.yAlign||mat(s,a);return{xAlign:a.xAlign||r.xAlign||gat(s,r,a,d),yAlign:d}}function Eat(s,r){let{x:a,width:d}=s;return r==="right"?a-=d:r==="center"&&(a-=d/2),a}function Sat(s,r,a){let{y:d,height:h}=s;return r==="top"?d+=a:r==="bottom"?d-=h+a:d-=h/2,d}function sj(s,r,a,d){const{caretSize:h,caretPadding:f,cornerRadius:g}=s,{xAlign:v,yAlign:y}=a,C=h+f,{topLeft:O,topRight:k,bottomLeft:M,bottomRight:j}=Ou(g);let z=Eat(r,v);const Y=Sat(r,y,C);return y==="center"?v==="left"?z+=C:v==="right"&&(z-=C):v==="left"?z-=Math.max(O,M)+h:v==="right"&&(z+=Math.max(k,j)+h),{x:Ds(z,0,d.width-r.width),y:Ds(Y,0,d.height-r.height)}}function cE(s,r,a){const d=tr(a.padding);return r==="center"?s.x+s.width/2:r==="right"?s.x+s.width-d.right:s.x+d.left}function oj(s){return Uo([],ca(s))}function vat(s,r,a){return Ac(s,{tooltip:r,tooltipItems:a,type:"tooltip"})}function aj(s,r){const a=r&&r.dataset&&r.dataset.tooltip&&r.dataset.tooltip.callbacks;return a?s.override(a):s}const m4={beforeTitle:oa,title(s){if(s.length>0){const r=s[0],a=r.chart.data.labels,d=a?a.length:0;if(this&&this.options&&this.options.mode==="dataset")return r.dataset.label||"";if(r.label)return r.label;if(d>0&&r.dataIndex<d)return a[r.dataIndex]}return""},afterTitle:oa,beforeBody:oa,beforeLabel:oa,label(s){if(this&&this.options&&this.options.mode==="dataset")return s.label+": "+s.formattedValue||s.formattedValue;let r=s.dataset.label||"";r&&(r+=": ");const a=s.formattedValue;return ln(a)||(r+=a),r},labelColor(s){const a=s.chart.getDatasetMeta(s.datasetIndex).controller.getStyle(s.dataIndex);return{borderColor:a.borderColor,backgroundColor:a.backgroundColor,borderWidth:a.borderWidth,borderDash:a.borderDash,borderDashOffset:a.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(s){const a=s.chart.getDatasetMeta(s.datasetIndex).controller.getStyle(s.dataIndex);return{pointStyle:a.pointStyle,rotation:a.rotation}},afterLabel:oa,afterBody:oa,beforeFooter:oa,footer:oa,afterFooter:oa};function wr(s,r,a,d){const h=s[r].call(a,d);return typeof h>"u"?m4[r].call(a,d):h}class Ib extends va{constructor(r){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=r.chart,this.options=r.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(r){this.options=r,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const r=this._cachedAnimations;if(r)return r;const a=this.chart,d=this.options.setContext(this.getContext()),h=d.enabled&&a.options.animation&&d.animations,f=new t4(this.chart,h);return h._cacheable&&(this._cachedAnimations=Object.freeze(f)),f}getContext(){return this.$context||(this.$context=vat(this.chart.getContext(),this,this._tooltipItems))}getTitle(r,a){const{callbacks:d}=a,h=wr(d,"beforeTitle",this,r),f=wr(d,"title",this,r),g=wr(d,"afterTitle",this,r);let v=[];return v=Uo(v,ca(h)),v=Uo(v,ca(f)),v=Uo(v,ca(g)),v}getBeforeBody(r,a){return oj(wr(a.callbacks,"beforeBody",this,r))}getBody(r,a){const{callbacks:d}=a,h=[];return dn(r,f=>{const g={before:[],lines:[],after:[]},v=aj(d,f);Uo(g.before,ca(wr(v,"beforeLabel",this,f))),Uo(g.lines,wr(v,"label",this,f)),Uo(g.after,ca(wr(v,"afterLabel",this,f))),h.push(g)}),h}getAfterBody(r,a){return oj(wr(a.callbacks,"afterBody",this,r))}getFooter(r,a){const{callbacks:d}=a,h=wr(d,"beforeFooter",this,r),f=wr(d,"footer",this,r),g=wr(d,"afterFooter",this,r);let v=[];return v=Uo(v,ca(h)),v=Uo(v,ca(f)),v=Uo(v,ca(g)),v}_createItems(r){const a=this._active,d=this.chart.data,h=[],f=[],g=[];let v=[],y,C;for(y=0,C=a.length;y<C;++y)v.push(fat(this.chart,a[y]));return r.filter&&(v=v.filter((O,k,M)=>r.filter(O,k,M,d))),r.itemSort&&(v=v.sort((O,k)=>r.itemSort(O,k,d))),dn(v,O=>{const k=aj(r.callbacks,O);h.push(wr(k,"labelColor",this,O)),f.push(wr(k,"labelPointStyle",this,O)),g.push(wr(k,"labelTextColor",this,O))}),this.labelColors=h,this.labelPointStyles=f,this.labelTextColors=g,this.dataPoints=v,v}update(r,a){const d=this.options.setContext(this.getContext()),h=this._active;let f,g=[];if(!h.length)this.opacity!==0&&(f={opacity:0});else{const v=Bp[d.position].call(this,h,this._eventPosition);g=this._createItems(d),this.title=this.getTitle(g,d),this.beforeBody=this.getBeforeBody(g,d),this.body=this.getBody(g,d),this.afterBody=this.getAfterBody(g,d),this.footer=this.getFooter(g,d);const y=this._size=ij(this,d),C=Object.assign({},v,y),O=rj(this.chart,d,C),k=sj(d,C,O,this.chart);this.xAlign=O.xAlign,this.yAlign=O.yAlign,f={opacity:1,x:k.x,y:k.y,width:y.width,height:y.height,caretX:v.x,caretY:v.y}}this._tooltipItems=g,this.$context=void 0,f&&this._resolveAnimations().update(this,f),r&&d.external&&d.external.call(this,{chart:this.chart,tooltip:this,replay:a})}drawCaret(r,a,d,h){const f=this.getCaretPosition(r,d,h);a.lineTo(f.x1,f.y1),a.lineTo(f.x2,f.y2),a.lineTo(f.x3,f.y3)}getCaretPosition(r,a,d){const{xAlign:h,yAlign:f}=this,{caretSize:g,cornerRadius:v}=d,{topLeft:y,topRight:C,bottomLeft:O,bottomRight:k}=Ou(v),{x:M,y:j}=r,{width:z,height:Y}=a;let Z,H,K,q,it,ot;return f==="center"?(it=j+Y/2,h==="left"?(Z=M,H=Z-g,q=it+g,ot=it-g):(Z=M+z,H=Z+g,q=it-g,ot=it+g),K=Z):(h==="left"?H=M+Math.max(y,O)+g:h==="right"?H=M+z-Math.max(C,k)-g:H=this.caretX,f==="top"?(q=j,it=q-g,Z=H-g,K=H+g):(q=j+Y,it=q+g,Z=H+g,K=H-g),ot=q),{x1:Z,x2:H,x3:K,y1:q,y2:it,y3:ot}}drawTitle(r,a,d){const h=this.title,f=h.length;let g,v,y;if(f){const C=Nu(d.rtl,this.x,this.width);for(r.x=cE(this,d.titleAlign,d),a.textAlign=C.textAlign(d.titleAlign),a.textBaseline="middle",g=Ei(d.titleFont),v=d.titleSpacing,a.fillStyle=d.titleColor,a.font=g.string,y=0;y<f;++y)a.fillText(h[y],C.x(r.x),r.y+g.lineHeight/2),r.y+=g.lineHeight+v,y+1===f&&(r.y+=d.titleMarginBottom-v)}}_drawColorBox(r,a,d,h,f){const g=this.labelColors[d],v=this.labelPointStyles[d],{boxHeight:y,boxWidth:C}=f,O=Ei(f.bodyFont),k=cE(this,"left",f),M=h.x(k),j=y<O.lineHeight?(O.lineHeight-y)/2:0,z=a.y+j;if(f.usePointStyle){const Y={radius:Math.min(C,y)/2,pointStyle:v.pointStyle,rotation:v.rotation,borderWidth:1},Z=h.leftForLtr(M,C)+C/2,H=z+y/2;r.strokeStyle=f.multiKeyBackground,r.fillStyle=f.multiKeyBackground,yb(r,Y,Z,H),r.strokeStyle=g.borderColor,r.fillStyle=g.backgroundColor,yb(r,Y,Z,H)}else{r.lineWidth=nn(g.borderWidth)?Math.max(...Object.values(g.borderWidth)):g.borderWidth||1,r.strokeStyle=g.borderColor,r.setLineDash(g.borderDash||[]),r.lineDashOffset=g.borderDashOffset||0;const Y=h.leftForLtr(M,C),Z=h.leftForLtr(h.xPlus(M,1),C-2),H=Ou(g.borderRadius);Object.values(H).some(K=>K!==0)?(r.beginPath(),r.fillStyle=f.multiKeyBackground,iS(r,{x:Y,y:z,w:C,h:y,radius:H}),r.fill(),r.stroke(),r.fillStyle=g.backgroundColor,r.beginPath(),iS(r,{x:Z,y:z+1,w:C-2,h:y-2,radius:H}),r.fill()):(r.fillStyle=f.multiKeyBackground,r.fillRect(Y,z,C,y),r.strokeRect(Y,z,C,y),r.fillStyle=g.backgroundColor,r.fillRect(Z,z+1,C-2,y-2))}r.fillStyle=this.labelTextColors[d]}drawBody(r,a,d){const{body:h}=this,{bodySpacing:f,bodyAlign:g,displayColors:v,boxHeight:y,boxWidth:C,boxPadding:O}=d,k=Ei(d.bodyFont);let M=k.lineHeight,j=0;const z=Nu(d.rtl,this.x,this.width),Y=function(lt){a.fillText(lt,z.x(r.x+j),r.y+M/2),r.y+=M+f},Z=z.textAlign(g);let H,K,q,it,ot,_t,ft;for(a.textAlign=g,a.textBaseline="middle",a.font=k.string,r.x=cE(this,Z,d),a.fillStyle=d.bodyColor,dn(this.beforeBody,Y),j=v&&Z!=="right"?g==="center"?C/2+O:C+2+O:0,it=0,_t=h.length;it<_t;++it){for(H=h[it],K=this.labelTextColors[it],a.fillStyle=K,dn(H.before,Y),q=H.lines,v&&q.length&&(this._drawColorBox(a,r,it,z,d),M=Math.max(k.lineHeight,y)),ot=0,ft=q.length;ot<ft;++ot)Y(q[ot]),M=k.lineHeight;dn(H.after,Y)}j=0,M=k.lineHeight,dn(this.afterBody,Y),r.y-=f}drawFooter(r,a,d){const h=this.footer,f=h.length;let g,v;if(f){const y=Nu(d.rtl,this.x,this.width);for(r.x=cE(this,d.footerAlign,d),r.y+=d.footerMarginTop,a.textAlign=y.textAlign(d.footerAlign),a.textBaseline="middle",g=Ei(d.footerFont),a.fillStyle=d.footerColor,a.font=g.string,v=0;v<f;++v)a.fillText(h[v],y.x(r.x),r.y+g.lineHeight/2),r.y+=g.lineHeight+d.footerSpacing}}drawBackground(r,a,d,h){const{xAlign:f,yAlign:g}=this,{x:v,y}=r,{width:C,height:O}=d,{topLeft:k,topRight:M,bottomLeft:j,bottomRight:z}=Ou(h.cornerRadius);a.fillStyle=h.backgroundColor,a.strokeStyle=h.borderColor,a.lineWidth=h.borderWidth,a.beginPath(),a.moveTo(v+k,y),g==="top"&&this.drawCaret(r,a,d,h),a.lineTo(v+C-M,y),a.quadraticCurveTo(v+C,y,v+C,y+M),g==="center"&&f==="right"&&this.drawCaret(r,a,d,h),a.lineTo(v+C,y+O-z),a.quadraticCurveTo(v+C,y+O,v+C-z,y+O),g==="bottom"&&this.drawCaret(r,a,d,h),a.lineTo(v+j,y+O),a.quadraticCurveTo(v,y+O,v,y+O-j),g==="center"&&f==="left"&&this.drawCaret(r,a,d,h),a.lineTo(v,y+k),a.quadraticCurveTo(v,y,v+k,y),a.closePath(),a.fill(),h.borderWidth>0&&a.stroke()}_updateAnimationTarget(r){const a=this.chart,d=this.$animations,h=d&&d.x,f=d&&d.y;if(h||f){const g=Bp[r.position].call(this,this._active,this._eventPosition);if(!g)return;const v=this._size=ij(this,r),y=Object.assign({},g,this._size),C=rj(a,r,y),O=sj(r,y,C,a);(h._to!==O.x||f._to!==O.y)&&(this.xAlign=C.xAlign,this.yAlign=C.yAlign,this.width=v.width,this.height=v.height,this.caretX=g.x,this.caretY=g.y,this._resolveAnimations().update(this,O))}}_willRender(){return!!this.opacity}draw(r){const a=this.options.setContext(this.getContext());let d=this.opacity;if(!d)return;this._updateAnimationTarget(a);const h={width:this.width,height:this.height},f={x:this.x,y:this.y};d=Math.abs(d)<.001?0:d;const g=tr(a.padding),v=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;a.enabled&&v&&(r.save(),r.globalAlpha=d,this.drawBackground(f,r,h,a),Q5(r,a.textDirection),f.y+=g.top,this.drawTitle(f,r,a),this.drawBody(f,r,a),this.drawFooter(f,r,a),Z5(r,a.textDirection),r.restore())}getActiveElements(){return this._active||[]}setActiveElements(r,a){const d=this._active,h=r.map(({datasetIndex:v,index:y})=>{const C=this.chart.getDatasetMeta(v);if(!C)throw new Error("Cannot find a dataset at index "+v);return{datasetIndex:v,element:C.data[y],index:y}}),f=!QE(d,h),g=this._positionChanged(h,a);(f||g)&&(this._active=h,this._eventPosition=a,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(r,a,d=!0){if(a&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const h=this.options,f=this._active||[],g=this._getActiveElements(r,f,a,d),v=this._positionChanged(g,r),y=a||!QE(g,f)||v;return y&&(this._active=g,(h.enabled||h.external)&&(this._eventPosition={x:r.x,y:r.y},this.update(!0,a))),y}_getActiveElements(r,a,d,h){const f=this.options;if(r.type==="mouseout")return[];if(!h)return a.filter(v=>this.chart.data.datasets[v.datasetIndex]&&this.chart.getDatasetMeta(v.datasetIndex).controller.getParsed(v.index)!==void 0);const g=this.chart.getElementsAtEventForMode(r,f.mode,f,d);return f.reverse&&g.reverse(),g}_positionChanged(r,a){const{caretX:d,caretY:h,options:f}=this,g=Bp[f.position].call(this,r,a);return g!==!1&&(d!==g.x||h!==g.y)}}fe(Ib,"positioners",Bp);var Tat={id:"tooltip",_element:Ib,positioners:Bp,afterInit(s,r,a){a&&(s.tooltip=new Ib({chart:s,options:a}))},beforeUpdate(s,r,a){s.tooltip&&s.tooltip.initialize(a)},reset(s,r,a){s.tooltip&&s.tooltip.initialize(a)},afterDraw(s){const r=s.tooltip;if(r&&r._willRender()){const a={tooltip:r};if(s.notifyPlugins("beforeTooltipDraw",{...a,cancelable:!0})===!1)return;r.draw(s.ctx),s.notifyPlugins("afterTooltipDraw",a)}},afterEvent(s,r){if(s.tooltip){const a=r.replay;s.tooltip.handleEvent(r.event,a,r.inChartArea)&&(r.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(s,r)=>r.bodyFont.size,boxWidth:(s,r)=>r.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:m4},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:s=>s!=="filter"&&s!=="itemSort"&&s!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const yat=(s,r,a,d)=>(typeof r=="string"?(a=s.push(r)-1,d.unshift({index:a,label:r})):isNaN(r)&&(a=null),a);function Rat(s,r,a,d){const h=s.indexOf(r);if(h===-1)return yat(s,r,a,d);const f=s.lastIndexOf(r);return h!==f?a:h}const Cat=(s,r)=>s===null?null:Ds(Math.round(s),0,r);function cj(s){const r=this.getLabels();return s>=0&&s<r.length?r[s]:s}class wb extends Bd{constructor(r){super(r),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(r){const a=this._addedLabels;if(a.length){const d=this.getLabels();for(const{index:h,label:f}of a)d[h]===f&&d.splice(h,1);this._addedLabels=[]}super.init(r)}parse(r,a){if(ln(r))return null;const d=this.getLabels();return a=isFinite(a)&&d[a]===r?a:Rat(d,r,ze(a,r),this._addedLabels),Cat(a,d.length-1)}determineDataLimits(){const{minDefined:r,maxDefined:a}=this.getUserBounds();let{min:d,max:h}=this.getMinMax(!0);this.options.bounds==="ticks"&&(r||(d=0),a||(h=this.getLabels().length-1)),this.min=d,this.max=h}buildTicks(){const r=this.min,a=this.max,d=this.options.offset,h=[];let f=this.getLabels();f=r===0&&a===f.length-1?f:f.slice(r,a+1),this._valueRange=Math.max(f.length-(d?0:1),1),this._startValue=this.min-(d?.5:0);for(let g=r;g<=a;g++)h.push({value:g});return h}getLabelForValue(r){return cj.call(this,r)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(r){return typeof r!="number"&&(r=this.parse(r)),r===null?NaN:this.getPixelForDecimal((r-this._startValue)/this._valueRange)}getPixelForTick(r){const a=this.ticks;return r<0||r>a.length-1?null:this.getPixelForValue(a[r].value)}getValueForPixel(r){return Math.round(this._startValue+this.getDecimalForPixel(r)*this._valueRange)}getBasePixel(){return this.bottom}}fe(wb,"id","category"),fe(wb,"defaults",{ticks:{callback:cj}});function bat(s,r){const a=[],{bounds:h,step:f,min:g,max:v,precision:y,count:C,maxTicks:O,maxDigits:k,includeBounds:M}=s,j=f||1,z=O-1,{min:Y,max:Z}=r,H=!ln(g),K=!ln(v),q=!ln(C),it=(Z-Y)/(k+1);let ot=fB((Z-Y)/z/j)*j,_t,ft,lt,kt;if(ot<1e-14&&!H&&!K)return[{value:Y},{value:Z}];kt=Math.ceil(Z/ot)-Math.floor(Y/ot),kt>z&&(ot=fB(kt*ot/z/j)*j),ln(y)||(_t=Math.pow(10,y),ot=Math.ceil(ot*_t)/_t),h==="ticks"?(ft=Math.floor(Y/ot)*ot,lt=Math.ceil(Z/ot)*ot):(ft=Y,lt=Z),H&&K&&f&&hrt((v-g)/f,ot/1e3)?(kt=Math.round(Math.min((v-g)/ot,O)),ot=(v-g)/kt,ft=g,lt=v):q?(ft=H?g:ft,lt=K?v:lt,kt=C-1,ot=(lt-ft)/kt):(kt=(lt-ft)/ot,tf(kt,Math.round(kt),ot/1e3)?kt=Math.round(kt):kt=Math.ceil(kt));const At=Math.max(mB(ot),mB(ft));_t=Math.pow(10,ln(y)?At:y),ft=Math.round(ft*_t)/_t,lt=Math.round(lt*_t)/_t;let qt=0;for(H&&(M&&ft!==g?(a.push({value:g}),ft<g&&qt++,tf(Math.round((ft+qt*ot)*_t)/_t,g,dj(g,it,s))&&qt++):ft<g&&qt++);qt<kt;++qt){const vt=Math.round((ft+qt*ot)*_t)/_t;if(K&&vt>v)break;a.push({value:vt})}return K&&M&&lt!==v?a.length&&tf(a[a.length-1].value,v,dj(v,it,s))?a[a.length-1].value=v:a.push({value:v}):(!K||lt===v)&&a.push({value:lt}),a}function dj(s,r,{horizontal:a,minRotation:d}){const h=hc(d),f=(a?Math.sin(h):Math.cos(h))||.001,g=.75*r*(""+s).length;return Math.min(r/f,g)}class oS extends Bd{constructor(r){super(r),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(r,a){return ln(r)||(typeof r=="number"||r instanceof Number)&&!isFinite(+r)?null:+r}handleTickRangeOptions(){const{beginAtZero:r}=this.options,{minDefined:a,maxDefined:d}=this.getUserBounds();let{min:h,max:f}=this;const g=y=>h=a?h:y,v=y=>f=d?f:y;if(r){const y=Vu(h),C=Vu(f);y<0&&C<0?v(0):y>0&&C>0&&g(0)}if(h===f){let y=f===0?1:Math.abs(f*.05);v(f+y),r||g(h-y)}this.min=h,this.max=f}getTickLimit(){const r=this.options.ticks;let{maxTicksLimit:a,stepSize:d}=r,h;return d?(h=Math.ceil(this.max/d)-Math.floor(this.min/d)+1,h>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${d} would result generating up to ${h} ticks. Limiting to 1000.`),h=1e3)):(h=this.computeTickLimit(),a=a||11),a&&(h=Math.min(a,h)),h}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const r=this.options,a=r.ticks;let d=this.getTickLimit();d=Math.max(2,d);const h={maxTicks:d,bounds:r.bounds,min:r.min,max:r.max,precision:a.precision,step:a.stepSize,count:a.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:a.minRotation||0,includeBounds:a.includeBounds!==!1},f=this._range||this,g=bat(h,f);return r.bounds==="ticks"&&V5(g,this,"value"),r.reverse?(g.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),g}configure(){const r=this.ticks;let a=this.min,d=this.max;if(super.configure(),this.options.offset&&r.length){const h=(d-a)/Math.max(r.length-1,1)/2;a-=h,d+=h}this._startValue=a,this._endValue=d,this._valueRange=d-a}getLabelForValue(r){return kI(r,this.chart.options.locale,this.options.ticks.format)}}class Ab extends oS{determineDataLimits(){const{min:r,max:a}=this.getMinMax(!0);this.min=Ii(r)?r:0,this.max=Ii(a)?a:1,this.handleTickRangeOptions()}computeTickLimit(){const r=this.isHorizontal(),a=r?this.width:this.height,d=hc(this.options.ticks.minRotation),h=(r?Math.sin(d):Math.cos(d))||.001,f=this._resolveTickFontOptions(0);return Math.ceil(a/Math.min(40,f.lineHeight/h))}getPixelForValue(r){return r===null?NaN:this.getPixelForDecimal((r-this._startValue)/this._valueRange)}getValueForPixel(r){return this._startValue+this.getDecimalForPixel(r)*this._valueRange}}fe(Ab,"id","linear"),fe(Ab,"defaults",{ticks:{callback:CS.formatters.numeric}});const If=s=>Math.floor(uc(s)),Ed=(s,r)=>Math.pow(10,If(s)+r);function lj(s){return s/Math.pow(10,If(s))===1}function uj(s,r,a){const d=Math.pow(10,a),h=Math.floor(s/d);return Math.ceil(r/d)-h}function Iat(s,r){const a=r-s;let d=If(a);for(;uj(s,r,d)>10;)d++;for(;uj(s,r,d)<10;)d--;return Math.min(d,If(s))}function wat(s,{min:r,max:a}){r=Xr(s.min,r);const d=[],h=If(r);let f=Iat(r,a),g=f<0?Math.pow(10,Math.abs(f)):1;const v=Math.pow(10,f),y=h>f?Math.pow(10,h):0,C=Math.round((r-y)*g)/g,O=Math.floor((r-y)/v/10)*v*10;let k=Math.floor((C-O)/Math.pow(10,f)),M=Xr(s.min,Math.round((y+O+k*Math.pow(10,f))*g)/g);for(;M<a;)d.push({value:M,major:lj(M),significand:k}),k>=10?k=k<15?15:20:k++,k>=20&&(f++,k=2,g=f>=0?1:g),M=Math.round((y+O+k*Math.pow(10,f))*g)/g;const j=Xr(s.max,M);return d.push({value:j,major:lj(j),significand:k}),d}class hj extends Bd{constructor(r){super(r),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(r,a){const d=oS.prototype.parse.apply(this,[r,a]);if(d===0){this._zero=!0;return}return Ii(d)&&d>0?d:null}determineDataLimits(){const{min:r,max:a}=this.getMinMax(!0);this.min=Ii(r)?Math.max(0,r):null,this.max=Ii(a)?Math.max(0,a):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Ii(this._userMin)&&(this.min=r===Ed(this.min,0)?Ed(this.min,-1):Ed(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:r,maxDefined:a}=this.getUserBounds();let d=this.min,h=this.max;const f=v=>d=r?d:v,g=v=>h=a?h:v;d===h&&(d<=0?(f(1),g(10)):(f(Ed(d,-1)),g(Ed(h,1)))),d<=0&&f(Ed(h,-1)),h<=0&&g(Ed(d,1)),this.min=d,this.max=h}buildTicks(){const r=this.options,a={min:this._userMin,max:this._userMax},d=wat(a,this);return r.bounds==="ticks"&&V5(d,this,"value"),r.reverse?(d.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),d}getLabelForValue(r){return r===void 0?"0":kI(r,this.chart.options.locale,this.options.ticks.format)}configure(){const r=this.min;super.configure(),this._startValue=uc(r),this._valueRange=uc(this.max)-uc(r)}getPixelForValue(r){return(r===void 0||r===0)&&(r=this.min),r===null||isNaN(r)?NaN:this.getPixelForDecimal(r===this.min?0:(uc(r)-this._startValue)/this._valueRange)}getValueForPixel(r){const a=this.getDecimalForPixel(r);return Math.pow(10,this._startValue+a*this._valueRange)}}fe(hj,"id","logarithmic"),fe(hj,"defaults",{ticks:{callback:CS.formatters.logarithmic,major:{enabled:!0}}});function Ob(s){const r=s.ticks;if(r.display&&s.display){const a=tr(r.backdropPadding);return ze(r.font&&r.font.size,Jn.font.size)+a.height}return 0}function Aat(s,r,a){return a=jn(a)?a:[a],{w:krt(s,r.string,a),h:a.length*r.lineHeight}}function pj(s,r,a,d,h){return s===d||s===h?{start:r-a/2,end:r+a/2}:s<d||s>h?{start:r-a,end:r}:{start:r,end:r+a}}function Oat(s){const r={l:s.left+s._padding.left,r:s.right-s._padding.right,t:s.top+s._padding.top,b:s.bottom-s._padding.bottom},a=Object.assign({},r),d=[],h=[],f=s._pointLabels.length,g=s.options.pointLabels,v=g.centerPointLabels?li/f:0;for(let y=0;y<f;y++){const C=g.setContext(s.getPointLabelContext(y));h[y]=C.padding;const O=s.getPointPosition(y,s.drawingArea+h[y],v),k=Ei(C.font),M=Aat(s.ctx,k,s._pointLabels[y]);d[y]=M;const j=oo(s.getIndexAngle(y)+v),z=Math.round(OI(j)),Y=pj(z,O.x,M.w,0,180),Z=pj(z,O.y,M.h,90,270);Nat(a,r,j,Y,Z)}s.setCenterPoint(r.l-a.l,a.r-r.r,r.t-a.t,a.b-r.b),s._pointLabelItems=kat(s,d,h)}function Nat(s,r,a,d,h){const f=Math.abs(Math.sin(a)),g=Math.abs(Math.cos(a));let v=0,y=0;d.start<r.l?(v=(r.l-d.start)/f,s.l=Math.min(s.l,r.l-v)):d.end>r.r&&(v=(d.end-r.r)/f,s.r=Math.max(s.r,r.r+v)),h.start<r.t?(y=(r.t-h.start)/g,s.t=Math.min(s.t,r.t-y)):h.end>r.b&&(y=(h.end-r.b)/g,s.b=Math.max(s.b,r.b+y))}function Dat(s,r,a){const d=s.drawingArea,{extra:h,additionalAngle:f,padding:g,size:v}=a,y=s.getPointPosition(r,d+h+g,f),C=Math.round(OI(oo(y.angle+Zr))),O=xat(y.y,v.h,C),k=Lat(C),M=Mat(y.x,v.w,k);return{visible:!0,x:y.x,y:O,textAlign:k,left:M,top:O,right:M+v.w,bottom:O+v.h}}function Pat(s,r){if(!r)return!0;const{left:a,top:d,right:h,bottom:f}=s;return!(fa({x:a,y:d},r)||fa({x:a,y:f},r)||fa({x:h,y:d},r)||fa({x:h,y:f},r))}function kat(s,r,a){const d=[],h=s._pointLabels.length,f=s.options,{centerPointLabels:g,display:v}=f.pointLabels,y={extra:Ob(f)/2,additionalAngle:g?li/h:0};let C;for(let O=0;O<h;O++){y.padding=a[O],y.size=r[O];const k=Dat(s,O,y);d.push(k),v==="auto"&&(k.visible=Pat(k,C),k.visible&&(C=k))}return d}function Lat(s){return s===0||s===180?"center":s<180?"left":"right"}function Mat(s,r,a){return a==="right"?s-=r:a==="center"&&(s-=r/2),s}function xat(s,r,a){return a===90||a===270?s-=r/2:(a>270||a<90)&&(s-=r),s}function Uat(s,r,a){const{left:d,top:h,right:f,bottom:g}=a,{backdropColor:v}=r;if(!ln(v)){const y=Ou(r.borderRadius),C=tr(r.backdropPadding);s.fillStyle=v;const O=d-C.left,k=h-C.top,M=f-d+C.width,j=g-h+C.height;Object.values(y).some(z=>z!==0)?(s.beginPath(),iS(s,{x:O,y:k,w:M,h:j,radius:y}),s.fill()):s.fillRect(O,k,M,j)}}function Vat(s,r){const{ctx:a,options:{pointLabels:d}}=s;for(let h=r-1;h>=0;h--){const f=s._pointLabelItems[h];if(!f.visible)continue;const g=d.setContext(s.getPointLabelContext(h));Uat(a,g,f);const v=Ei(g.font),{x:y,y:C,textAlign:O}=f;Ud(a,s._pointLabels[h],y,C+v.lineHeight/2,v,{color:g.color,textAlign:O,textBaseline:"middle"})}}function _4(s,r,a,d){const{ctx:h}=s;if(a)h.arc(s.xCenter,s.yCenter,r,0,Ls);else{let f=s.getPointPosition(0,r);h.moveTo(f.x,f.y);for(let g=1;g<d;g++)f=s.getPointPosition(g,r),h.lineTo(f.x,f.y)}}function Fat(s,r,a,d,h){const f=s.ctx,g=r.circular,{color:v,lineWidth:y}=r;!g&&!d||!v||!y||a<0||(f.save(),f.strokeStyle=v,f.lineWidth=y,f.setLineDash(h.dash||[]),f.lineDashOffset=h.dashOffset,f.beginPath(),_4(s,a,g,d),f.closePath(),f.stroke(),f.restore())}function Bat(s,r,a){return Ac(s,{label:a,index:r,type:"pointLabel"})}class dE extends oS{constructor(r){super(r),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const r=this._padding=tr(Ob(this.options)/2),a=this.width=this.maxWidth-r.width,d=this.height=this.maxHeight-r.height;this.xCenter=Math.floor(this.left+a/2+r.left),this.yCenter=Math.floor(this.top+d/2+r.top),this.drawingArea=Math.floor(Math.min(a,d)/2)}determineDataLimits(){const{min:r,max:a}=this.getMinMax(!1);this.min=Ii(r)&&!isNaN(r)?r:0,this.max=Ii(a)&&!isNaN(a)?a:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Ob(this.options))}generateTickLabels(r){oS.prototype.generateTickLabels.call(this,r),this._pointLabels=this.getLabels().map((a,d)=>{const h=Rn(this.options.pointLabels.callback,[a,d],this);return h||h===0?h:""}).filter((a,d)=>this.chart.getDataVisibility(d))}fit(){const r=this.options;r.display&&r.pointLabels.display?Oat(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(r,a,d,h){this.xCenter+=Math.floor((r-a)/2),this.yCenter+=Math.floor((d-h)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(r,a,d,h))}getIndexAngle(r){const a=Ls/(this._pointLabels.length||1),d=this.options.startAngle||0;return oo(r*a+hc(d))}getDistanceFromCenterForValue(r){if(ln(r))return NaN;const a=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-r)*a:(r-this.min)*a}getValueForDistanceFromCenter(r){if(ln(r))return NaN;const a=r/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-a:this.min+a}getPointLabelContext(r){const a=this._pointLabels||[];if(r>=0&&r<a.length){const d=a[r];return Bat(this.getContext(),r,d)}}getPointPosition(r,a,d=0){const h=this.getIndexAngle(r)-Zr+d;return{x:Math.cos(h)*a+this.xCenter,y:Math.sin(h)*a+this.yCenter,angle:h}}getPointPositionForValue(r,a){return this.getPointPosition(r,this.getDistanceFromCenterForValue(a))}getBasePosition(r){return this.getPointPositionForValue(r||0,this.getBaseValue())}getPointLabelPosition(r){const{left:a,top:d,right:h,bottom:f}=this._pointLabelItems[r];return{left:a,top:d,right:h,bottom:f}}drawBackground(){const{backgroundColor:r,grid:{circular:a}}=this.options;if(r){const d=this.ctx;d.save(),d.beginPath(),_4(this,this.getDistanceFromCenterForValue(this._endValue),a,this._pointLabels.length),d.closePath(),d.fillStyle=r,d.fill(),d.restore()}}drawGrid(){const r=this.ctx,a=this.options,{angleLines:d,grid:h,border:f}=a,g=this._pointLabels.length;let v,y,C;if(a.pointLabels.display&&Vat(this,g),h.display&&this.ticks.forEach((O,k)=>{if(k!==0||k===0&&this.min<0){y=this.getDistanceFromCenterForValue(O.value);const M=this.getContext(k),j=h.setContext(M),z=f.setContext(M);Fat(this,j,y,g,z)}}),d.display){for(r.save(),v=g-1;v>=0;v--){const O=d.setContext(this.getPointLabelContext(v)),{color:k,lineWidth:M}=O;!M||!k||(r.lineWidth=M,r.strokeStyle=k,r.setLineDash(O.borderDash),r.lineDashOffset=O.borderDashOffset,y=this.getDistanceFromCenterForValue(a.reverse?this.min:this.max),C=this.getPointPosition(v,y),r.beginPath(),r.moveTo(this.xCenter,this.yCenter),r.lineTo(C.x,C.y),r.stroke())}r.restore()}}drawBorder(){}drawLabels(){const r=this.ctx,a=this.options,d=a.ticks;if(!d.display)return;const h=this.getIndexAngle(0);let f,g;r.save(),r.translate(this.xCenter,this.yCenter),r.rotate(h),r.textAlign="center",r.textBaseline="middle",this.ticks.forEach((v,y)=>{if(y===0&&this.min>=0&&!a.reverse)return;const C=d.setContext(this.getContext(y)),O=Ei(C.font);if(f=this.getDistanceFromCenterForValue(this.ticks[y].value),C.showLabelBackdrop){r.font=O.string,g=r.measureText(v.label).width,r.fillStyle=C.backdropColor;const k=tr(C.backdropPadding);r.fillRect(-g/2-k.left,-f-O.size/2-k.top,g+k.width,O.size+k.height)}Ud(r,v.label,0,-f,O,{color:C.color,strokeColor:C.textStrokeColor,strokeWidth:C.textStrokeWidth})}),r.restore()}drawTitle(){}}fe(dE,"id","radialLinear"),fe(dE,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:CS.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(r){return r},padding:5,centerPointLabels:!1}}),fe(dE,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),fe(dE,"descriptors",{angleLines:{_fallback:"grid"}});const wS={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Or=Object.keys(wS);function fj(s,r){return s-r}function mj(s,r){if(ln(r))return null;const a=s._adapter,{parser:d,round:h,isoWeekday:f}=s._parseOpts;let g=r;return typeof d=="function"&&(g=d(g)),Ii(g)||(g=typeof d=="string"?a.parse(g,d):a.parse(g)),g===null?null:(h&&(g=h==="week"&&(Cf(f)||f===!0)?a.startOf(g,"isoWeek",f):a.startOf(g,h)),+g)}function _j(s,r,a,d){const h=Or.length;for(let f=Or.indexOf(s);f<h-1;++f){const g=wS[Or[f]],v=g.steps?g.steps:Number.MAX_SAFE_INTEGER;if(g.common&&Math.ceil((a-r)/(v*g.size))<=d)return Or[f]}return Or[h-1]}function jat(s,r,a,d,h){for(let f=Or.length-1;f>=Or.indexOf(a);f--){const g=Or[f];if(wS[g].common&&s._adapter.diff(h,d,g)>=r-1)return g}return Or[a?Or.indexOf(a):0]}function Wat(s){for(let r=Or.indexOf(s)+1,a=Or.length;r<a;++r)if(wS[Or[r]].common)return Or[r]}function gj(s,r,a){if(!a)s[r]=!0;else if(a.length){const{lo:d,hi:h}=NI(a,r),f=a[d]>=r?a[d]:a[h];s[f]=!0}}function Gat(s,r,a,d){const h=s._adapter,f=+h.startOf(r[0].value,d),g=r[r.length-1].value;let v,y;for(v=f;v<=g;v=+h.add(v,1,d))y=a[v],y>=0&&(r[y].major=!0);return r}function Ej(s,r,a){const d=[],h={},f=r.length;let g,v;for(g=0;g<f;++g)v=r[g],h[v]=g,d.push({value:v,major:!1});return f===0||!a?d:Gat(s,d,h,a)}class aS extends Bd{constructor(r){super(r),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(r,a={}){const d=r.time||(r.time={}),h=this._adapter=new Wst._date(r.adapters.date);h.init(a),$p(d.displayFormats,h.formats()),this._parseOpts={parser:d.parser,round:d.round,isoWeekday:d.isoWeekday},super.init(r),this._normalized=a.normalized}parse(r,a){return r===void 0?null:mj(this,r)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const r=this.options,a=this._adapter,d=r.time.unit||"day";let{min:h,max:f,minDefined:g,maxDefined:v}=this.getUserBounds();function y(C){!g&&!isNaN(C.min)&&(h=Math.min(h,C.min)),!v&&!isNaN(C.max)&&(f=Math.max(f,C.max))}(!g||!v)&&(y(this._getLabelBounds()),(r.bounds!=="ticks"||r.ticks.source!=="labels")&&y(this.getMinMax(!1))),h=Ii(h)&&!isNaN(h)?h:+a.startOf(Date.now(),d),f=Ii(f)&&!isNaN(f)?f:+a.endOf(Date.now(),d)+1,this.min=Math.min(h,f-1),this.max=Math.max(h+1,f)}_getLabelBounds(){const r=this.getLabelTimestamps();let a=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY;return r.length&&(a=r[0],d=r[r.length-1]),{min:a,max:d}}buildTicks(){const r=this.options,a=r.time,d=r.ticks,h=d.source==="labels"?this.getLabelTimestamps():this._generate();r.bounds==="ticks"&&h.length&&(this.min=this._userMin||h[0],this.max=this._userMax||h[h.length-1]);const f=this.min,g=this.max,v=grt(h,f,g);return this._unit=a.unit||(d.autoSkip?_j(a.minUnit,this.min,this.max,this._getLabelCapacity(f)):jat(this,v.length,a.minUnit,this.min,this.max)),this._majorUnit=!d.major.enabled||this._unit==="year"?void 0:Wat(this._unit),this.initOffsets(h),r.reverse&&v.reverse(),Ej(this,v,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(r=>+r.value))}initOffsets(r=[]){let a=0,d=0,h,f;this.options.offset&&r.length&&(h=this.getDecimalForValue(r[0]),r.length===1?a=1-h:a=(this.getDecimalForValue(r[1])-h)/2,f=this.getDecimalForValue(r[r.length-1]),r.length===1?d=f:d=(f-this.getDecimalForValue(r[r.length-2]))/2);const g=r.length<3?.5:.25;a=Ds(a,0,g),d=Ds(d,0,g),this._offsets={start:a,end:d,factor:1/(a+1+d)}}_generate(){const r=this._adapter,a=this.min,d=this.max,h=this.options,f=h.time,g=f.unit||_j(f.minUnit,a,d,this._getLabelCapacity(a)),v=ze(h.ticks.stepSize,1),y=g==="week"?f.isoWeekday:!1,C=Cf(y)||y===!0,O={};let k=a,M,j;if(C&&(k=+r.startOf(k,"isoWeek",y)),k=+r.startOf(k,C?"day":g),r.diff(d,a,g)>1e5*v)throw new Error(a+" and "+d+" are too far apart with stepSize of "+v+" "+g);const z=h.ticks.source==="data"&&this.getDataTimestamps();for(M=k,j=0;M<d;M=+r.add(M,v,g),j++)gj(O,M,z);return(M===d||h.bounds==="ticks"||j===1)&&gj(O,M,z),Object.keys(O).sort(fj).map(Y=>+Y)}getLabelForValue(r){const a=this._adapter,d=this.options.time;return d.tooltipFormat?a.format(r,d.tooltipFormat):a.format(r,d.displayFormats.datetime)}format(r,a){const h=this.options.time.displayFormats,f=this._unit,g=a||h[f];return this._adapter.format(r,g)}_tickFormatFunction(r,a,d,h){const f=this.options,g=f.ticks.callback;if(g)return Rn(g,[r,a,d],this);const v=f.time.displayFormats,y=this._unit,C=this._majorUnit,O=y&&v[y],k=C&&v[C],M=d[a],j=C&&k&&M&&M.major;return this._adapter.format(r,h||(j?k:O))}generateTickLabels(r){let a,d,h;for(a=0,d=r.length;a<d;++a)h=r[a],h.label=this._tickFormatFunction(h.value,a,r)}getDecimalForValue(r){return r===null?NaN:(r-this.min)/(this.max-this.min)}getPixelForValue(r){const a=this._offsets,d=this.getDecimalForValue(r);return this.getPixelForDecimal((a.start+d)*a.factor)}getValueForPixel(r){const a=this._offsets,d=this.getDecimalForPixel(r)/a.factor-a.end;return this.min+d*(this.max-this.min)}_getLabelSize(r){const a=this.options.ticks,d=this.ctx.measureText(r).width,h=hc(this.isHorizontal()?a.maxRotation:a.minRotation),f=Math.cos(h),g=Math.sin(h),v=this._resolveTickFontOptions(0).size;return{w:d*f+v*g,h:d*g+v*f}}_getLabelCapacity(r){const a=this.options.time,d=a.displayFormats,h=d[a.unit]||d.millisecond,f=this._tickFormatFunction(r,0,Ej(this,[r],this._majorUnit),h),g=this._getLabelSize(f),v=Math.floor(this.isHorizontal()?this.width/g.w:this.height/g.h)-1;return v>0?v:1}getDataTimestamps(){let r=this._cache.data||[],a,d;if(r.length)return r;const h=this.getMatchingVisibleMetas();if(this._normalized&&h.length)return this._cache.data=h[0].controller.getAllParsedValues(this);for(a=0,d=h.length;a<d;++a)r=r.concat(h[a].controller.getAllParsedValues(this));return this._cache.data=this.normalize(r)}getLabelTimestamps(){const r=this._cache.labels||[];let a,d;if(r.length)return r;const h=this.getLabels();for(a=0,d=h.length;a<d;++a)r.push(mj(this,h[a]));return this._cache.labels=this._normalized?r:this.normalize(r)}normalize(r){return Srt(r.sort(fj))}}fe(aS,"id","time"),fe(aS,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function lE(s,r,a){let d=0,h=s.length-1,f,g,v,y;a?(r>=s[d].pos&&r<=s[h].pos&&({lo:d,hi:h}=wd(s,"pos",r)),{pos:f,time:v}=s[d],{pos:g,time:y}=s[h]):(r>=s[d].time&&r<=s[h].time&&({lo:d,hi:h}=wd(s,"time",r)),{time:f,pos:v}=s[d],{time:g,pos:y}=s[h]);const C=g-f;return C?v+(y-v)*(r-f)/C:v}class Sj extends aS{constructor(r){super(r),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const r=this._getTimestampsForTable(),a=this._table=this.buildLookupTable(r);this._minPos=lE(a,this.min),this._tableRange=lE(a,this.max)-this._minPos,super.initOffsets(r)}buildLookupTable(r){const{min:a,max:d}=this,h=[],f=[];let g,v,y,C,O;for(g=0,v=r.length;g<v;++g)C=r[g],C>=a&&C<=d&&h.push(C);if(h.length<2)return[{time:a,pos:0},{time:d,pos:1}];for(g=0,v=h.length;g<v;++g)O=h[g+1],y=h[g-1],C=h[g],Math.round((O+y)/2)!==C&&f.push({time:C,pos:g/(v-1)});return f}_generate(){const r=this.min,a=this.max;let d=super.getDataTimestamps();return(!d.includes(r)||!d.length)&&d.splice(0,0,r),(!d.includes(a)||d.length===1)&&d.push(a),d.sort((h,f)=>h-f)}_getTimestampsForTable(){let r=this._cache.all||[];if(r.length)return r;const a=this.getDataTimestamps(),d=this.getLabelTimestamps();return a.length&&d.length?r=this.normalize(a.concat(d)):r=a.length?a:d,r=this._cache.all=r,r}getDecimalForValue(r){return(lE(this._table,r)-this._minPos)/this._tableRange}getValueForPixel(r){const a=this._offsets,d=this.getDecimalForPixel(r)/a.factor-a.end;return lE(this._table,d*this._tableRange+this._minPos,!0)}}fe(Sj,"id","timeseries"),fe(Sj,"defaults",aS.defaults);const g4="label";function vj(s,r){typeof s=="function"?s(r):s&&(s.current=r)}function Hat(s,r){const a=s.options;a&&r&&Object.assign(a,r)}function E4(s,r){s.labels=r}function S4(s,r){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:g4;const d=[];s.datasets=r.map(h=>{const f=s.datasets.find(g=>g[a]===h[a]);return!f||!h.data||d.includes(f)?{...h}:(d.push(f),Object.assign(f,h),f)})}function zat(s){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:g4;const a={labels:[],datasets:[]};return E4(a,s.labels),S4(a,s.datasets,r),a}function Kat(s,r){const{height:a=150,width:d=300,redraw:h=!1,datasetIdKey:f,type:g,data:v,options:y,plugins:C=[],fallbackContent:O,updateMode:k,...M}=s,j=Rt.useRef(null),z=Rt.useRef(null),Y=()=>{j.current&&(z.current=new IS(j.current,{type:g,data:zat(v,f),options:y&&{...y},plugins:C}),vj(r,z.current))},Z=()=>{vj(r,null),z.current&&(z.current.destroy(),z.current=null)};return Rt.useEffect(()=>{!h&&z.current&&y&&Hat(z.current,y)},[h,y]),Rt.useEffect(()=>{!h&&z.current&&E4(z.current.config.data,v.labels)},[h,v.labels]),Rt.useEffect(()=>{!h&&z.current&&v.datasets&&S4(z.current.config.data,v.datasets,f)},[h,v.datasets]),Rt.useEffect(()=>{z.current&&(h?(Z(),setTimeout(Y)):z.current.update(k))},[h,y,v.labels,v.datasets,k]),Rt.useEffect(()=>{z.current&&(Z(),setTimeout(Y))},[g]),Rt.useEffect(()=>(Y(),()=>Z()),[]),Lb.createElement("canvas",{ref:j,role:"img",height:a,width:d,...M},O)}const Yat=Rt.forwardRef(Kat);function qat(s,r){return IS.register(r),Rt.forwardRef((a,d)=>Lb.createElement(Yat,{...a,ref:d,type:s}))}const Xat=qat("line",RE);IS.register(wb,Ab,IE,Fp,pat,Tat,uat);const Jat=({stats:s})=>{var j,z,Y,Z,H,K,q,it,ot,_t,ft;const[a,d]=Rt.useState(!1),[h,f]=Rt.useState(!1),[g,v]=Rt.useState([]),y=lt=>lt<=2?"quality-good":lt<=4?"quality-fair":"quality-poor",C=lt=>lt<1e3?`${lt.toFixed(0)} bps`:lt<1e6?`${(lt/1e3).toFixed(1)} Kbps`:`${(lt/1e6).toFixed(1)} Mbps`,O=({label:lt,value:kt})=>ht.jsxs("div",{children:[ht.jsx("span",{children:lt}),ht.jsx("span",{children:kt})]});Rt.useEffect(()=>{const lt=Date.now(),kt={timestamp:lt,video:s.video.end2EndDelay||0,audio:s.audio.end2EndDelay||0,index:g.length+1};v(At=>{const vt=lt-12e4;return[...At,kt].filter(Ot=>Ot.timestamp>vt).map((Ot,zt)=>({...Ot,index:zt+1}))})},[s]);const k={labels:g.map(lt=>lt.index),datasets:[{label:"Video Latency",data:g.map(lt=>lt.video),borderColor:"rgb(75, 192, 192)",tension:.4,pointRadius:0,borderWidth:2},{label:"Audio Latency",data:g.map(lt=>lt.audio),borderColor:"rgb(255, 99, 132)",tension:.4,pointRadius:0,borderWidth:2}]},M={responsive:!0,animation:{duration:0},scales:{y:{beginAtZero:!0,grid:{color:"rgba(255, 255, 255, 0.1)"},ticks:{color:"rgba(255, 255, 255, 0.9)"},title:{display:!0,text:"Latency (ms)",color:"rgba(255, 255, 255, 0.9)"}},x:{grid:{color:"rgba(255, 255, 255, 0.1)"},ticks:{color:"rgba(255, 255, 255, 0.9)",callback:function(lt){return Number(lt)}},title:{display:!0,text:"Last 120 Seconds",color:"rgba(255, 255, 255, 0.9)"}}},plugins:{legend:{position:"top",labels:{color:"rgba(255, 255, 255, 0.9)"}},title:{display:!0,text:"Network Latency",color:"rgba(255, 255, 255, 0.9)"}}};return ht.jsxs(ht.Fragment,{children:[ht.jsx("button",{className:"network-quality-toggle",onClick:()=>d(!a),title:a?"Hide network stats":"Show network stats",children:ht.jsx("span",{className:"material-icons",children:a?"insights":"bar_chart"})}),a&&ht.jsxs("div",{className:`network-quality ${h?"minimized":""}`,onClick:()=>f(!h),children:[ht.jsxs("div",{className:"quality-section",children:[ht.jsxs("div",{title:"Local Upload Quality",children:[ht.jsx("span",{children:"Local Upload"}),ht.jsx("span",{className:`quality-indicator ${y(s.localNetwork.uplinkNetworkQuality)}`})]}),ht.jsxs("div",{title:"Local Download Quality",children:[ht.jsx("span",{children:"Local Download"}),ht.jsx("span",{className:`quality-indicator ${y(s.localNetwork.downlinkNetworkQuality)}`})]})]}),!h&&ht.jsxs(ht.Fragment,{children:[ht.jsxs("div",{className:"quality-section",children:[ht.jsxs("div",{title:"Remote Download Quality",children:[ht.jsx("span",{children:"Remote Download"}),ht.jsx("span",{className:`quality-indicator ${y(s.remoteNetwork.downlinkNetworkQuality)}`})]}),ht.jsxs("div",{title:"Remote Upload Quality",children:[ht.jsx("span",{children:"Remote Upload"}),ht.jsx("span",{className:`quality-indicator ${y(s.remoteNetwork.uplinkNetworkQuality)}`})]})]}),ht.jsx("div",{className:"latency-chart",children:ht.jsx(Xat,{data:k,options:M})}),ht.jsxs("div",{className:"stats-section",children:[ht.jsxs("div",{className:"video-stats",children:[ht.jsx("h4",{children:"Video Statistics"}),ht.jsx(O,{label:"Codec",value:s.video.codecType||"N/A"}),ht.jsx(O,{label:"Transport Delay",value:`${((j=s.video.transportDelay)==null?void 0:j.toFixed(1))||0}ms`}),ht.jsx(O,{label:"End-to-End Delay",value:`${((z=s.video.end2EndDelay)==null?void 0:z.toFixed(1))||0}ms`}),ht.jsx(O,{label:"Receive Delay",value:`${((Y=s.video.receiveDelay)==null?void 0:Y.toFixed(1))||0}ms`}),ht.jsx(O,{label:"Frame Rate",value:`${((Z=s.video.receiveFrameRate)==null?void 0:Z.toFixed(1))||0} fps`}),ht.jsx(O,{label:"Resolution",value:`${s.video.receiveResolutionWidth}x${s.video.receiveResolutionHeight}`}),ht.jsx(O,{label:"Bitrate",value:C(s.video.receiveBitrate)}),ht.jsx(O,{label:"Packet Loss",value:`${((H=s.video.packetLossRate)==null?void 0:H.toFixed(2))||0}%`}),ht.jsx(O,{label:"Total Freeze Time",value:`${s.video.totalFreezeTime}s`}),ht.jsx(O,{label:"Freeze Rate",value:`${((K=s.video.freezeRate)==null?void 0:K.toFixed(2))||0}%`})]}),ht.jsxs("div",{className:"audio-stats",children:[ht.jsx("h4",{children:"Audio Statistics"}),ht.jsx(O,{label:"Codec",value:s.audio.codecType||"N/A"}),ht.jsx(O,{label:"Transport Delay",value:`${((q=s.audio.transportDelay)==null?void 0:q.toFixed(1))||0}ms`}),ht.jsx(O,{label:"End-to-End Delay",value:`${((it=s.audio.end2EndDelay)==null?void 0:it.toFixed(1))||0}ms`}),ht.jsx(O,{label:"Receive Delay",value:`${((ot=s.audio.receiveDelay)==null?void 0:ot.toFixed(1))||0}ms`}),ht.jsx(O,{label:"Bitrate",value:C(s.audio.receiveBitrate)}),ht.jsx(O,{label:"Packet Loss",value:`${((_t=s.audio.packetLossRate)==null?void 0:_t.toFixed(2))||0}%`}),ht.jsx(O,{label:"Volume Level",value:`${((ft=s.audio.receiveLevel)==null?void 0:ft.toFixed(0))||0}`})]})]})]})]})]})};var v4={exports:{}};(function(s,r){(function(a,d){s.exports=d()})(Pg,function(){function a(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var o=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,o.get?o:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var d=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Pg<"u"?Pg:typeof self<"u"?self:{};function h(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var f=function(t){try{return!!t()}catch{return!0}},g=!f(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),v=g,y=Function.prototype,C=y.call,O=v&&y.bind.bind(C,C),k=v?O:function(t){return function(){return C.apply(t,arguments)}},M=k({}.isPrototypeOf),j=function(t){return t&&t.Math===Math&&t},z=j(typeof globalThis=="object"&&globalThis)||j(typeof window=="object"&&window)||j(typeof self=="object"&&self)||j(typeof d=="object"&&d)||j(typeof d=="object"&&d)||function(){return this}()||Function("return this")(),Y=g,Z=Function.prototype,H=Z.apply,K=Z.call,q=typeof Reflect=="object"&&Reflect.apply||(Y?K.bind(H):function(){return K.apply(H,arguments)}),it=k,ot=it({}.toString),_t=it("".slice),ft=function(t){return _t(ot(t),8,-1)},lt=ft,kt=k,At=function(t){if(lt(t)==="Function")return kt(t)},qt=typeof document=="object"&&document.all,vt=qt===void 0&&qt!==void 0?function(t){return typeof t=="function"||t===qt}:function(t){return typeof t=="function"},xt={},Ot=!f(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),zt=g,Se=Function.prototype.call,le=zt?Se.bind(Se):function(){return Se.apply(Se,arguments)},Lt={},Jt={}.propertyIsEnumerable,$t=Object.getOwnPropertyDescriptor,Ve=$t&&!Jt.call({1:2},1);Lt.f=Ve?function(t){var e=$t(this,t);return!!e&&e.enumerable}:Jt;var Pe,ui,hn=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},de=f,Ne=ft,On=Object,is=k("".split),ur=de(function(){return!On("z").propertyIsEnumerable(0)})?function(t){return Ne(t)==="String"?is(t,""):On(t)}:On,Ui=function(t){return t==null},jd=Ui,Vi=TypeError,Fi=function(t){if(jd(t))throw new Vi("Can't call method on "+t);return t},ho=ur,po=Fi,Lr=function(t){return ho(po(t))},Hu=vt,ri=function(t){return typeof t=="object"?t!==null:Hu(t)},Bi={},AS=Bi,OS=z,C4=vt,HI=function(t){return C4(t)?t:void 0},Ai=function(t,e){return arguments.length<2?HI(AS[t])||HI(OS[t]):AS[t]&&AS[t][e]||OS[t]&&OS[t][e]},zI=z.navigator,KI=zI&&zI.userAgent,Go=KI?String(KI):"",YI=z,NS=Go,qI=YI.process,XI=YI.Deno,JI=qI&&qI.versions||XI&&XI.version,QI=JI&&JI.v8;QI&&(ui=(Pe=QI.split("."))[0]>0&&Pe[0]<4?1:+(Pe[0]+Pe[1])),!ui&&NS&&(!(Pe=NS.match(/Edge\/(\d+)/))||Pe[1]>=74)&&(Pe=NS.match(/Chrome\/(\d+)/))&&(ui=+Pe[1]);var Oc=ui,ZI=Oc,b4=f,I4=z.String,Wd=!!Object.getOwnPropertySymbols&&!b4(function(){var t=Symbol("symbol detection");return!I4(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&ZI&&ZI<41}),$I=Wd&&!Symbol.sham&&typeof Symbol.iterator=="symbol",w4=Ai,A4=vt,O4=M,N4=Object,zu=$I?function(t){return typeof t=="symbol"}:function(t){var e=w4("Symbol");return A4(e)&&O4(e.prototype,N4(t))},D4=String,Gd=function(t){try{return D4(t)}catch{return"Object"}},P4=vt,k4=Gd,L4=TypeError,hr=function(t){if(P4(t))return t;throw new L4(k4(t)+" is not a function")},M4=hr,x4=Ui,Mf=function(t,e){var n=t[e];return x4(n)?void 0:M4(n)},DS=le,PS=vt,kS=ri,U4=TypeError,tw={exports:{}},ew=z,V4=Object.defineProperty,F4=z,B4=function(t,e){try{V4(ew,t,{value:e,configurable:!0,writable:!0})}catch{ew[t]=e}return e},nw="__core-js_shared__",iw=tw.exports=F4[nw]||B4(nw,{});(iw.versions||(iw.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var LS=tw.exports,rw=LS,Hd=function(t,e){return rw[t]||(rw[t]=e||{})},j4=Fi,W4=Object,fo=function(t){return W4(j4(t))},G4=fo,H4=k({}.hasOwnProperty),si=Object.hasOwn||function(t,e){return H4(G4(t),e)},z4=k,K4=0,Y4=Math.random(),q4=z4(1 .toString),MS=function(t){return"Symbol("+(t===void 0?"":t)+")_"+q4(++K4+Y4,36)},X4=Hd,sw=si,J4=MS,Q4=Wd,Z4=$I,zd=z.Symbol,xS=X4("wks"),$4=Z4?zd.for||zd:zd&&zd.withoutSetter||J4,_n=function(t){return sw(xS,t)||(xS[t]=Q4&&sw(zd,t)?zd[t]:$4("Symbol."+t)),xS[t]},tW=le,ow=ri,aw=zu,eW=Mf,nW=function(t,e){var n,i;if(e==="string"&&PS(n=t.toString)&&!kS(i=DS(n,t))||PS(n=t.valueOf)&&!kS(i=DS(n,t))||e!=="string"&&PS(n=t.toString)&&!kS(i=DS(n,t)))return i;throw new U4("Can't convert object to primitive value")},iW=TypeError,rW=_n("toPrimitive"),sW=function(t,e){if(!ow(t)||aw(t))return t;var n,i=eW(t,rW);if(i){if(e===void 0&&(e="default"),n=tW(i,t,e),!ow(n)||aw(n))return n;throw new iW("Can't convert object to primitive value")}return e===void 0&&(e="number"),nW(t,e)},oW=zu,US=function(t){var e=sW(t,"string");return oW(e)?e:e+""},cw=ri,VS=z.document,aW=cw(VS)&&cw(VS.createElement),FS=function(t){return aW?VS.createElement(t):{}},cW=FS,dw=!Ot&&!f(function(){return Object.defineProperty(cW("div"),"a",{get:function(){return 7}}).a!==7}),dW=Ot,lW=le,uW=Lt,hW=hn,pW=Lr,fW=US,mW=si,_W=dw,lw=Object.getOwnPropertyDescriptor;xt.f=dW?lw:function(t,e){if(t=pW(t),e=fW(e),_W)try{return lw(t,e)}catch{}if(mW(t,e))return hW(!lW(uW.f,t,e),t[e])};var gW=f,EW=vt,SW=/#|\.prototype\./,Ku=function(t,e){var n=TW[vW(t)];return n===RW||n!==yW&&(EW(e)?gW(e):!!e)},vW=Ku.normalize=function(t){return String(t).replace(SW,".").toLowerCase()},TW=Ku.data={},yW=Ku.NATIVE="N",RW=Ku.POLYFILL="P",uw=Ku,CW=hr,bW=g,IW=At(At.bind),ya=function(t,e){return CW(t),e===void 0?t:bW?IW(t,e):function(){return t.apply(e,arguments)}},rs={},hw=Ot&&f(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),wW=ri,AW=String,OW=TypeError,er=function(t){if(wW(t))return t;throw new OW(AW(t)+" is not an object")},NW=Ot,DW=dw,PW=hw,xf=er,pw=US,kW=TypeError,BS=Object.defineProperty,LW=Object.getOwnPropertyDescriptor,jS="enumerable",WS="configurable",GS="writable";rs.f=NW?PW?function(t,e,n){if(xf(t),e=pw(e),xf(n),typeof t=="function"&&e==="prototype"&&"value"in n&&GS in n&&!n[GS]){var i=LW(t,e);i&&i[GS]&&(t[e]=n.value,n={configurable:WS in n?n[WS]:i[WS],enumerable:jS in n?n[jS]:i[jS],writable:!1})}return BS(t,e,n)}:BS:function(t,e,n){if(xf(t),e=pw(e),xf(n),DW)try{return BS(t,e,n)}catch{}if("get"in n||"set"in n)throw new kW("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var MW=rs,xW=hn,Nc=Ot?function(t,e,n){return MW.f(t,e,xW(1,n))}:function(t,e,n){return t[e]=n,t},Yu=z,UW=q,VW=At,FW=vt,BW=xt.f,jW=uw,Kd=Bi,WW=ya,Yd=Nc,fw=si,GW=function(t){var e=function(n,i,o){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,i)}return new t(n,i,o)}return UW(t,this,arguments)};return e.prototype=t.prototype,e},ve=function(t,e){var n,i,o,c,l,u,p,m,_,E=t.target,S=t.global,T=t.stat,A=t.proto,I=S?Yu:T?Yu[E]:Yu[E]&&Yu[E].prototype,w=S?Kd:Kd[E]||Yd(Kd,E,{})[E],P=w.prototype;for(c in e)i=!(n=jW(S?c:E+(T?".":"#")+c,t.forced))&&I&&fw(I,c),u=w[c],i&&(p=t.dontCallGetSet?(_=BW(I,c))&&_.value:I[c]),l=i&&p?p:e[c],(n||A||typeof u!=typeof l)&&(m=t.bind&&i?WW(l,Yu):t.wrap&&i?GW(l):A&&FW(l)?VW(l):l,(t.sham||l&&l.sham||u&&u.sham)&&Yd(m,"sham",!0),Yd(w,c,m),A&&(fw(Kd,o=E+"Prototype")||Yd(Kd,o,{}),Yd(Kd[o],c,l),t.real&&P&&(n||!P[c])&&Yd(P,c,l)))},HW=Math.ceil,zW=Math.floor,KW=Math.trunc||function(t){var e=+t;return(e>0?zW:HW)(e)},YW=KW,HS=function(t){var e=+t;return e!=e||e===0?0:YW(e)},qW=HS,XW=Math.max,JW=Math.min,zS=function(t,e){var n=qW(t);return n<0?XW(n+e,0):JW(n,e)},QW=HS,ZW=Math.min,mw=function(t){var e=QW(t);return e>0?ZW(e,9007199254740991):0},$W=mw,Ra=function(t){return $W(t.length)},tG=Lr,eG=zS,nG=Ra,_w=function(t){return function(e,n,i){var o=tG(e),c=nG(o);if(c===0)return!t&&-1;var l,u=eG(i,c);if(t&&n!=n){for(;c>u;)if((l=o[u++])!=l)return!0}else for(;c>u;u++)if((t||u in o)&&o[u]===n)return t||u||0;return!t&&-1}},KS={includes:_w(!0),indexOf:_w(!1)},iG=KS.includes;ve({target:"Array",proto:!0,forced:f(function(){return!Array(1).includes()})},{includes:function(t){return iG(this,t,arguments.length>1?arguments[1]:void 0)}});var rG=z,sG=Bi,ss=function(t,e){var n=sG[t+"Prototype"],i=n&&n[e];if(i)return i;var o=rG[t],c=o&&o.prototype;return c&&c[e]},oG=ss("Array","includes"),aG=ri,cG=ft,dG=_n("match"),gw=function(t){var e;return aG(t)&&((e=t[dG])!==void 0?!!e:cG(t)==="RegExp")},lG=gw,uG=TypeError,Ew={};Ew[_n("toStringTag")]="z";var YS=String(Ew)==="[object z]",hG=YS,pG=vt,Uf=ft,fG=_n("toStringTag"),mG=Object,_G=Uf(function(){return arguments}())==="Arguments",Ca=hG?Uf:function(t){var e,n,i;return t===void 0?"Undefined":t===null?"Null":typeof(n=function(o,c){try{return o[c]}catch{}}(e=mG(t),fG))=="string"?n:_G?Uf(e):(i=Uf(e))==="Object"&&pG(e.callee)?"Arguments":i},gG=Ca,EG=String,pr=function(t){if(gG(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return EG(t)},SG=_n("match"),vG=ve,TG=function(t){if(lG(t))throw new uG("The method doesn't accept regular expressions");return t},yG=Fi,Sw=pr,RG=function(t){var e=/./;try{"/./"[t](e)}catch{try{return e[SG]=!1,"/./"[t](e)}catch{}}return!1},CG=k("".indexOf);vG({target:"String",proto:!0,forced:!RG("includes")},{includes:function(t){return!!~CG(Sw(yG(this)),Sw(TG(t)),arguments.length>1?arguments[1]:void 0)}});var bG=ss("String","includes"),vw=M,IG=oG,wG=bG,qS=Array.prototype,XS=String.prototype,AG=function(t){var e=t.includes;return t===qS||vw(qS,t)&&e===qS.includes?IG:typeof t=="string"||t===XS||vw(XS,t)&&e===XS.includes?wG:e},pt=h(AG),OG=hr,NG=fo,DG=ur,PG=Ra,Tw=TypeError,yw="Reduce of empty array with no initial value",Rw=function(t){return function(e,n,i,o){var c=NG(e),l=DG(c),u=PG(c);if(OG(n),u===0&&i<2)throw new Tw(yw);var p=t?u-1:0,m=t?-1:1;if(i<2)for(;;){if(p in l){o=l[p],p+=m;break}if(p+=m,t?p<0:u<=p)throw new Tw(yw)}for(;t?p>=0:u>p;p+=m)p in l&&(o=n(o,l[p],p,c));return o}},kG={left:Rw(!1),right:Rw(!0)},LG=f,Vf=function(t,e){var n=[][t];return!!n&&LG(function(){n.call(null,e||function(){return 1},1)})},qu=z,MG=Go,xG=ft,Ff=function(t){return MG.slice(0,t.length)===t},JS=Ff("Bun/")?"BUN":Ff("Cloudflare-Workers")?"CLOUDFLARE":Ff("Deno/")?"DENO":Ff("Node.js/")?"NODE":qu.Bun&&typeof Bun.version=="string"?"BUN":qu.Deno&&typeof Deno.version=="object"?"DENO":xG(qu.process)==="process"?"NODE":qu.window&&qu.document?"BROWSER":"REST",Bf=JS==="NODE",UG=kG.left;ve({target:"Array",proto:!0,forced:!Bf&&Oc>79&&Oc<83||!Vf("reduce")},{reduce:function(t){var e=arguments.length;return UG(this,t,e,e>1?arguments[1]:void 0)}});var VG=ss("Array","reduce"),FG=M,BG=VG,QS=Array.prototype,jG=function(t){var e=t.reduce;return t===QS||FG(QS,t)&&e===QS.reduce?BG:e},Cw=jG,os=h(Cw),WG=ft,Xu=Array.isArray||function(t){return WG(t)==="Array"},GG=ve,HG=Xu,zG=k([].reverse),bw=[1,2];GG({target:"Array",proto:!0,forced:String(bw)===String(bw.reverse())},{reverse:function(){return HG(this)&&(this.length=this.length),zG(this)}});var KG=ss("Array","reverse"),YG=M,qG=KG,ZS=Array.prototype,XG=function(t){var e=t.reverse;return t===ZS||YG(ZS,t)&&e===ZS.reverse?qG:e},Iw=XG,ww=h(Iw),JG=MS,Aw=Hd("keys"),jf=function(t){return Aw[t]||(Aw[t]=JG(t))},QG=!f(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),ZG=si,$G=vt,tH=fo,eH=QG,Ow=jf("IE_PROTO"),$S=Object,nH=$S.prototype,tv=eH?$S.getPrototypeOf:function(t){var e=tH(t);if(ZG(e,Ow))return e[Ow];var n=e.constructor;return $G(n)&&e instanceof n?n.prototype:e instanceof $S?nH:null},iH=k,rH=hr,sH=ri,oH=function(t){return sH(t)||t===null},aH=String,cH=TypeError,dH=function(t,e,n){try{return iH(rH(Object.getOwnPropertyDescriptor(t,e)[n]))}catch{}},lH=ri,uH=Fi,hH=function(t){if(oH(t))return t;throw new cH("Can't set "+aH(t)+" as a prototype")},pH=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=dH(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch{}return function(i,o){return uH(i),hH(o),lH(i)&&(e?t(i,o):i.__proto__=o),i}}():void 0),Wf={},Gf={},ev=si,fH=Lr,mH=KS.indexOf,_H=Gf,Nw=k([].push),Dw=function(t,e){var n,i=fH(t),o=0,c=[];for(n in i)!ev(_H,n)&&ev(i,n)&&Nw(c,n);for(;e.length>o;)ev(i,n=e[o++])&&(~mH(c,n)||Nw(c,n));return c},nv=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],gH=Dw,EH=nv.concat("length","prototype");Wf.f=Object.getOwnPropertyNames||function(t){return gH(t,EH)};var Ju={};Ju.f=Object.getOwnPropertySymbols;var SH=Ai,vH=Wf,TH=Ju,yH=er,RH=k([].concat),CH=SH("Reflect","ownKeys")||function(t){var e=vH.f(yH(t)),n=TH.f;return n?RH(e,n(t)):e},Pw=si,bH=CH,IH=xt,wH=rs,iv={},AH=Dw,OH=nv,Hf=Object.keys||function(t){return AH(t,OH)},NH=Ot,DH=hw,PH=rs,kH=er,LH=Lr,MH=Hf;iv.f=NH&&!DH?Object.defineProperties:function(t,e){kH(t);for(var n,i=LH(e),o=MH(e),c=o.length,l=0;c>l;)PH.f(t,n=o[l++],i[n]);return t};var zf,kw=Ai("document","documentElement"),xH=er,UH=iv,Lw=nv,VH=Gf,FH=kw,BH=FS,rv="prototype",sv="script",Mw=jf("IE_PROTO"),ov=function(){},xw=function(t){return"<"+sv+">"+t+"</"+sv+">"},Uw=function(t){t.write(xw("")),t.close();var e=t.parentWindow.Object;return t=null,e},Kf=function(){try{zf=new ActiveXObject("htmlfile")}catch{}var t,e,n;Kf=typeof document<"u"?document.domain&&zf?Uw(zf):(e=BH("iframe"),n="java"+sv+":",e.style.display="none",FH.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(xw("document.F=Object")),t.close(),t.F):Uw(zf);for(var i=Lw.length;i--;)delete Kf[rv][Lw[i]];return Kf()};VH[Mw]=!0;var Qu=Object.create||function(t,e){var n;return t!==null?(ov[rv]=xH(t),n=new ov,ov[rv]=null,n[Mw]=t):n=Kf(),e===void 0?n:UH.f(n,e)},jH=ri,WH=Nc,Vw=Error,GH=k("".replace),HH=String(new Vw("zxcasd").stack),Fw=/\n\s*at [^:]*:[^\n]*/,zH=Fw.test(HH),KH=hn,YH=!f(function(){var t=new Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",KH(1,7)),t.stack!==7)}),qH=Nc,XH=function(t,e){if(zH&&typeof t=="string"&&!Vw.prepareStackTrace)for(;e--;)t=GH(t,Fw,"");return t},JH=YH,Bw=Error.captureStackTrace,qd={},QH=qd,ZH=_n("iterator"),$H=Array.prototype,jw=function(t){return t!==void 0&&(QH.Array===t||$H[ZH]===t)},t6=Ca,Ww=Mf,e6=Ui,n6=qd,i6=_n("iterator"),Yf=function(t){if(!e6(t))return Ww(t,i6)||Ww(t,"@@iterator")||n6[t6(t)]},r6=le,s6=hr,o6=er,a6=Gd,c6=Yf,d6=TypeError,av=function(t,e){var n=arguments.length<2?c6(t):e;if(s6(n))return o6(r6(n,t));throw new d6(a6(t)+" is not iterable")},l6=le,Gw=er,u6=Mf,Hw=function(t,e,n){var i,o;Gw(t);try{if(!(i=u6(t,"return"))){if(e==="throw")throw n;return n}i=l6(i,t)}catch(c){o=!0,i=c}if(e==="throw")throw n;if(o)throw i;return Gw(i),n},h6=ya,p6=le,f6=er,m6=Gd,_6=jw,g6=Ra,zw=M,E6=av,S6=Yf,Kw=Hw,v6=TypeError,qf=function(t,e){this.stopped=t,this.result=e},Yw=qf.prototype,Zu=function(t,e,n){var i,o,c,l,u,p,m,_=n&&n.that,E=!(!n||!n.AS_ENTRIES),S=!(!n||!n.IS_RECORD),T=!(!n||!n.IS_ITERATOR),A=!(!n||!n.INTERRUPTED),I=h6(e,_),w=function(D){return i&&Kw(i,"normal",D),new qf(!0,D)},P=function(D){return E?(f6(D),A?I(D[0],D[1],w):I(D[0],D[1])):A?I(D,w):I(D)};if(S)i=t.iterator;else if(T)i=t;else{if(!(o=S6(t)))throw new v6(m6(t)+" is not iterable");if(_6(o)){for(c=0,l=g6(t);l>c;c++)if((u=P(t[c]))&&zw(Yw,u))return u;return new qf(!1)}i=E6(t,o)}for(p=S?t.next:i.next;!(m=p6(p,i)).done;){try{u=P(m.value)}catch(D){Kw(i,"throw",D)}if(typeof u=="object"&&u&&zw(Yw,u))return u}return new qf(!1)},T6=pr,y6=ve,R6=M,C6=tv,Xf=pH,b6=function(t,e,n){for(var i=bH(e),o=wH.f,c=IH.f,l=0;l<i.length;l++){var u=i[l];Pw(t,u)||n&&Pw(n,u)||o(t,u,c(e,u))}},qw=Qu,cv=Nc,dv=hn,I6=function(t,e){jH(e)&&"cause"in e&&WH(t,"cause",e.cause)},w6=function(t,e,n,i){JH&&(Bw?Bw(t,e):qH(t,"stack",XH(n,i)))},A6=Zu,O6=function(t,e){return t===void 0?arguments.length<2?"":e:T6(t)},N6=_n("toStringTag"),Jf=Error,D6=[].push,Xd=function(t,e){var n,i=R6(lv,this);Xf?n=Xf(new Jf,i?C6(this):lv):(n=i?this:qw(lv),cv(n,N6,"Error")),e!==void 0&&cv(n,"message",O6(e)),w6(n,Xd,n.stack,1),arguments.length>2&&I6(n,arguments[2]);var o=[];return A6(t,D6,{that:o}),cv(n,"errors",o),n};Xf?Xf(Xd,Jf):b6(Xd,Jf,{name:!0});var lv=Xd.prototype=qw(Jf.prototype,{constructor:dv(1,Xd),message:dv(1,""),name:dv(1,"AggregateError")});y6({global:!0,constructor:!0,arity:2},{AggregateError:Xd});var Qf,$u,Zf,P6=vt,Xw=z.WeakMap,k6=P6(Xw)&&/native code/.test(String(Xw)),Jw=z,L6=ri,M6=Nc,uv=si,hv=LS,x6=jf,U6=Gf,Qw="Object already initialized",pv=Jw.TypeError,V6=Jw.WeakMap;if(k6||hv.state){var mo=hv.state||(hv.state=new V6);mo.get=mo.get,mo.has=mo.has,mo.set=mo.set,Qf=function(t,e){if(mo.has(t))throw new pv(Qw);return e.facade=t,mo.set(t,e),e},$u=function(t){return mo.get(t)||{}},Zf=function(t){return mo.has(t)}}else{var Jd=x6("state");U6[Jd]=!0,Qf=function(t,e){if(uv(t,Jd))throw new pv(Qw);return e.facade=t,M6(t,Jd,e),e},$u=function(t){return uv(t,Jd)?t[Jd]:{}},Zf=function(t){return uv(t,Jd)}}var Dc,Zw,$w,Pc={set:Qf,get:$u,has:Zf,enforce:function(t){return Zf(t)?$u(t):Qf(t,{})},getterFor:function(t){return function(e){var n;if(!L6(e)||(n=$u(e)).type!==t)throw new pv("Incompatible receiver, "+t+" required");return n}}},fv=Ot,F6=si,tA=Function.prototype,B6=fv&&Object.getOwnPropertyDescriptor,mv=F6(tA,"name"),eA={EXISTS:mv,PROPER:mv&&(function(){}).name==="something",CONFIGURABLE:mv&&(!fv||fv&&B6(tA,"name").configurable)},j6=Nc,ba=function(t,e,n,i){return i&&i.enumerable?t[e]=n:j6(t,e,n),t},W6=f,G6=vt,H6=ri,z6=Qu,nA=tv,K6=ba,_v=_n("iterator"),iA=!1;[].keys&&("next"in($w=[].keys())?(Zw=nA(nA($w)))!==Object.prototype&&(Dc=Zw):iA=!0);var Y6=!H6(Dc)||W6(function(){var t={};return Dc[_v].call(t)!==t});G6((Dc=Y6?{}:z6(Dc))[_v])||K6(Dc,_v,function(){return this});var rA={IteratorPrototype:Dc,BUGGY_SAFARI_ITERATORS:iA},q6=Ca,X6=YS?{}.toString:function(){return"[object "+q6(this)+"]"},J6=YS,Q6=rs.f,Z6=Nc,$6=si,t8=X6,sA=_n("toStringTag"),Ho=function(t,e,n,i){var o=n?t:t&&t.prototype;o&&($6(o,sA)||Q6(o,sA,{configurable:!0,value:e}),i&&!J6&&Z6(o,"toString",t8))},e8=rA.IteratorPrototype,n8=Qu,i8=hn,r8=Ho,s8=qd,o8=function(){return this},gv=function(t,e,n,i){var o=e+" Iterator";return t.prototype=n8(e8,{next:i8(+!i,n)}),r8(t,o,!1,!0),s8[o]=o8,t},a8=ve,c8=le,d8=eA,l8=gv,u8=tv,h8=Ho,oA=ba,aA=qd,p8=rA,f8=d8.PROPER,$f=p8.BUGGY_SAFARI_ITERATORS,Ev=_n("iterator"),cA="keys",tm="values",dA="entries",m8=function(){return this},lA=function(t,e,n,i,o,c,l){l8(n,e,i);var u,p,m,_=function(P){if(P===o&&I)return I;if(!$f&&P&&P in T)return T[P];switch(P){case cA:case tm:case dA:return function(){return new n(this,P)}}return function(){return new n(this)}},E=e+" Iterator",S=!1,T=t.prototype,A=T[Ev]||T["@@iterator"]||o&&T[o],I=!$f&&A||_(o),w=e==="Array"&&T.entries||A;if(w&&(u=u8(w.call(new t)))!==Object.prototype&&u.next&&(h8(u,E,!0,!0),aA[E]=m8),f8&&o===tm&&A&&A.name!==tm&&(S=!0,I=function(){return c8(A,this)}),o)if(p={values:_(tm),keys:c?I:_(cA),entries:_(dA)},l)for(m in p)($f||S||!(m in T))&&oA(T,m,p[m]);else a8({target:e,proto:!0,forced:$f||S},p);return l&&T[Ev]!==I&&oA(T,Ev,I,{name:o}),aA[e]=I,p},em=function(t,e){return{value:t,done:e}},_8=Lr,uA=qd,hA=Pc;rs.f;var g8=lA,nm=em,pA="Array Iterator",E8=hA.set,S8=hA.getterFor(pA);g8(Array,"Array",function(t,e){E8(this,{type:pA,target:_8(t),index:0,kind:e})},function(){var t=S8(this),e=t.target,n=t.index++;if(!e||n>=e.length)return t.target=null,nm(void 0,!0);switch(t.kind){case"keys":return nm(n,!1);case"values":return nm(e[n],!1)}return nm([n,e[n]],!1)},"values"),uA.Arguments=uA.Array;var v8=rs,im=function(t,e,n){return v8.f(t,e,n)},T8=Ai,y8=im,R8=Ot,fA=_n("species"),C8=M,b8=TypeError,Sv=function(t,e){if(C8(e,t))return t;throw new b8("Incorrect invocation")},I8=vt,vv=LS,w8=k(Function.toString);I8(vv.inspectSource)||(vv.inspectSource=function(t){return w8(t)});var mA=vv.inspectSource,A8=k,O8=f,_A=vt,N8=Ca,D8=mA,gA=function(){},EA=Ai("Reflect","construct"),Tv=/^\s*(?:class|function)\b/,P8=A8(Tv.exec),k8=!Tv.test(gA),th=function(t){if(!_A(t))return!1;try{return EA(gA,[],t),!0}catch{return!1}},SA=function(t){if(!_A(t))return!1;switch(N8(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return k8||!!P8(Tv,D8(t))}catch{return!0}};SA.sham=!0;var eh,Qd,vA,yv,rm=!EA||O8(function(){var t;return th(th.call)||!th(Object)||!th(function(){t=!0})||t})?SA:th,L8=rm,M8=Gd,x8=TypeError,TA=er,U8=function(t){if(L8(t))return t;throw new x8(M8(t)+" is not a constructor")},V8=Ui,F8=_n("species"),Rv=function(t,e){var n,i=TA(t).constructor;return i===void 0||V8(n=TA(i)[F8])?e:U8(n)},Ia=k([].slice),B8=TypeError,kc=function(t,e){if(t<e)throw new B8("Not enough arguments");return t},yA=/(?:ipad|iphone|ipod).*applewebkit/i.test(Go),Mr=z,j8=q,W8=ya,RA=vt,G8=si,CA=f,bA=kw,H8=Ia,IA=FS,z8=kc,K8=yA,Y8=Bf,Cv=Mr.setImmediate,bv=Mr.clearImmediate,q8=Mr.process,Iv=Mr.Dispatch,X8=Mr.Function,wA=Mr.MessageChannel,J8=Mr.String,wv=0,nh={},AA="onreadystatechange";CA(function(){eh=Mr.location});var Av=function(t){if(G8(nh,t)){var e=nh[t];delete nh[t],e()}},Ov=function(t){return function(){Av(t)}},OA=function(t){Av(t.data)},NA=function(t){Mr.postMessage(J8(t),eh.protocol+"//"+eh.host)};Cv&&bv||(Cv=function(t){z8(arguments.length,1);var e=RA(t)?t:X8(t),n=H8(arguments,1);return nh[++wv]=function(){j8(e,void 0,n)},Qd(wv),wv},bv=function(t){delete nh[t]},Y8?Qd=function(t){q8.nextTick(Ov(t))}:Iv&&Iv.now?Qd=function(t){Iv.now(Ov(t))}:wA&&!K8?(yv=(vA=new wA).port2,vA.port1.onmessage=OA,Qd=W8(yv.postMessage,yv)):Mr.addEventListener&&RA(Mr.postMessage)&&!Mr.importScripts&&eh&&eh.protocol!=="file:"&&!CA(NA)?(Qd=NA,Mr.addEventListener("message",OA,!1)):Qd=AA in IA("script")?function(t){bA.appendChild(IA("script"))[AA]=function(){bA.removeChild(this),Av(t)}}:function(t){setTimeout(Ov(t),0)});var sm={set:Cv,clear:bv},DA=z,Q8=Ot,Z8=Object.getOwnPropertyDescriptor,PA=function(t){if(!Q8)return DA[t];var e=Z8(DA,t);return e&&e.value},kA=function(){this.head=null,this.tail=null};kA.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var Zd,Nv,Dv,Pv,LA,MA=kA,$8=/ipad|iphone|ipod/i.test(Go)&&typeof Pebble<"u",tz=/web0s(?!.*chrome)/i.test(Go),$d=z,ez=PA,xA=ya,kv=sm.set,nz=MA,iz=yA,rz=$8,sz=tz,Lv=Bf,UA=$d.MutationObserver||$d.WebKitMutationObserver,VA=$d.document,FA=$d.process,om=$d.Promise,Mv=ez("queueMicrotask");if(!Mv){var am=new nz,cm=function(){var t,e;for(Lv&&(t=FA.domain)&&t.exit();e=am.get();)try{e()}catch(n){throw am.head&&Zd(),n}t&&t.enter()};iz||Lv||sz||!UA||!VA?!rz&&om&&om.resolve?((Pv=om.resolve(void 0)).constructor=om,LA=xA(Pv.then,Pv),Zd=function(){LA(cm)}):Lv?Zd=function(){FA.nextTick(cm)}:(kv=xA(kv,$d),Zd=function(){kv(cm)}):(Nv=!0,Dv=VA.createTextNode(""),new UA(cm).observe(Dv,{characterData:!0}),Zd=function(){Dv.data=Nv=!Nv}),Mv=function(t){am.head||Zd(),am.add(t)}}var BA=Mv,tl=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}},Lc=z.Promise,oz=z,ih=Lc,az=vt,cz=uw,dz=mA,lz=_n,jA=JS,xv=Oc,WA=ih&&ih.prototype,uz=lz("species"),GA=!1,HA=az(oz.PromiseRejectionEvent),hz=cz("Promise",function(){var t=dz(ih),e=t!==String(ih);if(!e&&xv===66||!WA.catch||!WA.finally)return!0;if(!xv||xv<51||!/native code/.test(t)){var n=new ih(function(o){o(1)}),i=function(o){o(function(){},function(){})};if((n.constructor={})[uz]=i,!(GA=n.then(function(){})instanceof i))return!0}return!(e||jA!=="BROWSER"&&jA!=="DENO"||HA)}),rh={CONSTRUCTOR:hz,REJECTION_EVENT:HA,SUBCLASSING:GA},_o={},zA=hr,pz=TypeError,fz=function(t){var e,n;this.promise=new t(function(i,o){if(e!==void 0||n!==void 0)throw new pz("Bad Promise constructor");e=i,n=o}),this.resolve=zA(e),this.reject=zA(n)};_o.f=function(t){return new fz(t)};var Uv,KA,mz=ve,dm=Bf,wa=z,sh=le,_z=ba,gz=Ho,Ez=function(t){var e=T8(t);R8&&e&&!e[fA]&&y8(e,fA,{configurable:!0,get:function(){return this}})},Sz=hr,Vv=vt,vz=ri,Tz=Sv,yz=Rv,YA=sm.set,Fv=BA,Rz=function(t,e){try{arguments.length===1?console.error(t):console.error(t,e)}catch{}},Cz=tl,bz=MA,qA=Pc,Bv=Lc,XA=rh,JA=_o,lm="Promise",QA=XA.CONSTRUCTOR,Iz=XA.REJECTION_EVENT,jv=qA.getterFor(lm),wz=qA.set,Az=Bv&&Bv.prototype,oh=Bv,Wv=Az,ZA=wa.TypeError,Gv=wa.document,Hv=wa.process,zv=JA.f,Oz=zv,Nz=!!(Gv&&Gv.createEvent&&wa.dispatchEvent),$A="unhandledrejection",tO=function(t){var e;return!(!vz(t)||!Vv(e=t.then))&&e},eO=function(t,e){var n,i,o,c=e.value,l=e.state===1,u=l?t.ok:t.fail,p=t.resolve,m=t.reject,_=t.domain;try{u?(l||(e.rejection===2&&Pz(e),e.rejection=1),u===!0?n=c:(_&&_.enter(),n=u(c),_&&(_.exit(),o=!0)),n===t.promise?m(new ZA("Promise-chain cycle")):(i=tO(n))?sh(i,n,p,m):p(n)):m(c)}catch(E){_&&!o&&_.exit(),m(E)}},nO=function(t,e){t.notified||(t.notified=!0,Fv(function(){for(var n,i=t.reactions;n=i.get();)eO(n,t);t.notified=!1,e&&!t.rejection&&Dz(t)}))},iO=function(t,e,n){var i,o;Nz?((i=Gv.createEvent("Event")).promise=e,i.reason=n,i.initEvent(t,!1,!0),wa.dispatchEvent(i)):i={promise:e,reason:n},!Iz&&(o=wa["on"+t])?o(i):t===$A&&Rz("Unhandled promise rejection",n)},Dz=function(t){sh(YA,wa,function(){var e,n=t.facade,i=t.value;if(rO(t)&&(e=Cz(function(){dm?Hv.emit("unhandledRejection",i,n):iO($A,n,i)}),t.rejection=dm||rO(t)?2:1,e.error))throw e.value})},rO=function(t){return t.rejection!==1&&!t.parent},Pz=function(t){sh(YA,wa,function(){var e=t.facade;dm?Hv.emit("rejectionHandled",e):iO("rejectionhandled",e,t.value)})},el=function(t,e,n){return function(i){t(e,i,n)}},nl=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,nO(t,!0))},Kv=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw new ZA("Promise can't be resolved itself");var i=tO(e);i?Fv(function(){var o={done:!1};try{sh(i,e,el(Kv,o,t),el(nl,o,t))}catch(c){nl(o,c,t)}}):(t.value=e,t.state=1,nO(t,!1))}catch(o){nl({done:!1},o,t)}}};QA&&(Wv=(oh=function(t){Tz(this,Wv),Sz(t),sh(Uv,this);var e=jv(this);try{t(el(Kv,e),el(nl,e))}catch(n){nl(e,n)}}).prototype,(Uv=function(t){wz(this,{type:lm,done:!1,notified:!1,parent:!1,reactions:new bz,rejection:!1,state:0,value:null})}).prototype=_z(Wv,"then",function(t,e){var n=jv(this),i=zv(yz(this,oh));return n.parent=!0,i.ok=!Vv(t)||t,i.fail=Vv(e)&&e,i.domain=dm?Hv.domain:void 0,n.state===0?n.reactions.add(i):Fv(function(){eO(i,n)}),i.promise}),KA=function(){var t=new Uv,e=jv(t);this.promise=t,this.resolve=el(Kv,e),this.reject=el(nl,e)},JA.f=zv=function(t){return t===oh||t===void 0?new KA(t):Oz(t)}),mz({global:!0,constructor:!0,wrap:!0,forced:QA},{Promise:oh}),gz(oh,lm,!1,!0),Ez(lm);var sO=_n("iterator"),oO=!1;try{var kz=0,aO={next:function(){return{done:!!kz++}},return:function(){oO=!0}};aO[sO]=function(){return this},Array.from(aO,function(){throw 2})}catch{}var Lz=Lc,Mz=function(t,e){try{if(!e&&!oO)return!1}catch{return!1}var n=!1;try{var i={};i[sO]=function(){return{next:function(){return{done:n=!0}}}},t(i)}catch{}return n},um=rh.CONSTRUCTOR||!Mz(function(t){Lz.all(t).then(void 0,function(){})}),xz=le,Uz=hr,Vz=_o,Fz=tl,Bz=Zu;ve({target:"Promise",stat:!0,forced:um},{all:function(t){var e=this,n=Vz.f(e),i=n.resolve,o=n.reject,c=Fz(function(){var l=Uz(e.resolve),u=[],p=0,m=1;Bz(t,function(_){var E=p++,S=!1;m++,xz(l,e,_).then(function(T){S||(S=!0,u[E]=T,--m||i(u))},o)}),--m||i(u)});return c.error&&o(c.value),n.promise}});var jz=ve,Wz=rh.CONSTRUCTOR;Lc&&Lc.prototype,jz({target:"Promise",proto:!0,forced:Wz,real:!0},{catch:function(t){return this.then(void 0,t)}});var Gz=le,Hz=hr,zz=_o,Kz=tl,Yz=Zu;ve({target:"Promise",stat:!0,forced:um},{race:function(t){var e=this,n=zz.f(e),i=n.reject,o=Kz(function(){var c=Hz(e.resolve);Yz(t,function(l){Gz(c,e,l).then(n.resolve,i)})});return o.error&&i(o.value),n.promise}});var qz=_o;ve({target:"Promise",stat:!0,forced:rh.CONSTRUCTOR},{reject:function(t){var e=qz.f(this);return(0,e.reject)(t),e.promise}});var Xz=er,Jz=ri,Qz=_o,cO=function(t,e){if(Xz(t),Jz(e)&&e.constructor===t)return e;var n=Qz.f(t);return(0,n.resolve)(e),n.promise},Zz=ve,$z=Lc,tK=rh.CONSTRUCTOR,eK=cO,nK=Ai("Promise"),iK=!tK;Zz({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return eK(iK&&this===nK?$z:this,t)}});var rK=le,sK=hr,oK=_o,aK=tl,cK=Zu;ve({target:"Promise",stat:!0,forced:um},{allSettled:function(t){var e=this,n=oK.f(e),i=n.resolve,o=n.reject,c=aK(function(){var l=sK(e.resolve),u=[],p=0,m=1;cK(t,function(_){var E=p++,S=!1;m++,rK(l,e,_).then(function(T){S||(S=!0,u[E]={status:"fulfilled",value:T},--m||i(u))},function(T){S||(S=!0,u[E]={status:"rejected",reason:T},--m||i(u))})}),--m||i(u)});return c.error&&o(c.value),n.promise}});var dK=le,lK=hr,uK=Ai,hK=_o,pK=tl,fK=Zu,dO="No one promise resolved";ve({target:"Promise",stat:!0,forced:um},{any:function(t){var e=this,n=uK("AggregateError"),i=hK.f(e),o=i.resolve,c=i.reject,l=pK(function(){var u=lK(e.resolve),p=[],m=0,_=1,E=!1;fK(t,function(S){var T=m++,A=!1;_++,dK(u,e,S).then(function(I){A||E||(E=!0,o(I))},function(I){A||E||(A=!0,p[T]=I,--_||c(new n(p,dO)))})}),--_||c(new n(p,dO))});return l.error&&c(l.value),i.promise}});var mK=ve,_K=q,gK=Ia,EK=_o,SK=hr,lO=tl,Yv=z.Promise,uO=!1;mK({target:"Promise",stat:!0,forced:!Yv||!Yv.try||lO(function(){Yv.try(function(t){uO=t===8},8)}).error||!uO},{try:function(t){var e=arguments.length>1?gK(arguments,1):[],n=EK.f(this),i=lO(function(){return _K(SK(t),void 0,e)});return(i.error?n.reject:n.resolve)(i.value),n.promise}});var vK=_o;ve({target:"Promise",stat:!0},{withResolvers:function(){var t=vK.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var TK=ve,qv=Lc,yK=f,RK=Ai,CK=vt,bK=Rv,hO=cO,IK=qv&&qv.prototype;TK({target:"Promise",proto:!0,real:!0,forced:!!qv&&yK(function(){IK.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=bK(this,RK("Promise")),n=CK(t);return this.then(n?function(i){return hO(e,t()).then(function(){return i})}:t,n?function(i){return hO(e,t()).then(function(){throw i})}:t)}});var Xv=k,wK=HS,AK=pr,OK=Fi,NK=Xv("".charAt),pO=Xv("".charCodeAt),DK=Xv("".slice),fO=function(t){return function(e,n){var i,o,c=AK(OK(e)),l=wK(n),u=c.length;return l<0||l>=u?t?"":void 0:(i=pO(c,l))<55296||i>56319||l+1===u||(o=pO(c,l+1))<56320||o>57343?t?NK(c,l):i:t?DK(c,l,l+2):o-56320+(i-55296<<10)+65536}},Jv={codeAt:fO(!1),charAt:fO(!0)},PK=Jv.charAt,kK=pr,mO=Pc,LK=lA,_O=em,gO="String Iterator",MK=mO.set,xK=mO.getterFor(gO);LK(String,"String",function(t){MK(this,{type:gO,string:kK(t),index:0})},function(){var t,e=xK(this),n=e.string,i=e.index;return i>=n.length?_O(void 0,!0):(t=PK(n,i),e.index+=t.length,_O(t,!1))});var UK=Bi.Promise,VK={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},FK=z,BK=Ho,EO=qd;for(var Qv in VK)BK(FK[Qv],Qv),EO[Qv]=EO.Array;var SO=UK,gt=h(SO),jK=ss("Array","values"),WK=Ca,GK=si,HK=M,zK=jK,Zv=Array.prototype,KK={DOMTokenList:!0,NodeList:!0},YK=function(t){var e=t.values;return t===Zv||HK(Zv,t)&&e===Zv.values||GK(KK,WK(t))?zK:e},nr=h(YK),vO=Gd,qK=TypeError,TO=Ia,XK=Math.floor,$v=function(t,e){var n=t.length;if(n<8)for(var i,o,c=1;c<n;){for(o=c,i=t[c];o&&e(t[o-1],i)>0;)t[o]=t[--o];o!==c++&&(t[o]=i)}else for(var l=XK(n/2),u=$v(TO(t,0,l),e),p=$v(TO(t,l),e),m=u.length,_=p.length,E=0,S=0;E<m||S<_;)t[E+S]=E<m&&S<_?e(u[E],p[S])<=0?u[E++]:p[S++]:E<m?u[E++]:p[S++];return t},yO=$v,RO=Go.match(/firefox\/(\d+)/i),JK=!!RO&&+RO[1],QK=/MSIE|Trident/.test(Go),CO=Go.match(/AppleWebKit\/(\d+)\./),ZK=!!CO&&+CO[1],$K=ve,bO=k,tY=hr,eY=fo,IO=Ra,nY=function(t,e){if(!delete t[e])throw new qK("Cannot delete property "+vO(e)+" of "+vO(t))},wO=pr,tT=f,iY=yO,rY=Vf,AO=JK,sY=QK,OO=Oc,NO=ZK,Aa=[],DO=bO(Aa.sort),oY=bO(Aa.push),aY=tT(function(){Aa.sort(void 0)}),cY=tT(function(){Aa.sort(null)}),dY=rY("sort"),PO=!tT(function(){if(OO)return OO<70;if(!(AO&&AO>3)){if(sY)return!0;if(NO)return NO<603;var t,e,n,i,o="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)Aa.push({k:e+i,v:n})}for(Aa.sort(function(c,l){return l.v-c.v}),i=0;i<Aa.length;i++)e=Aa[i].k.charAt(0),o.charAt(o.length-1)!==e&&(o+=e);return o!=="DGBEFHACIJK"}});$K({target:"Array",proto:!0,forced:aY||!cY||!dY||!PO},{sort:function(t){t!==void 0&&tY(t);var e=eY(this);if(PO)return t===void 0?DO(e):DO(e,t);var n,i,o=[],c=IO(e);for(i=0;i<c;i++)i in e&&oY(o,e[i]);for(iY(o,function(l){return function(u,p){return p===void 0?-1:u===void 0?1:l!==void 0?+l(u,p)||0:wO(u)>wO(p)?1:-1}}(t)),n=IO(o),i=0;i<n;)e[i]=o[i++];for(;i<c;)nY(e,i++);return e}});var lY=ss("Array","sort"),uY=M,hY=lY,eT=Array.prototype,pY=function(t){var e=t.sort;return t===eT||uY(eT,t)&&e===eT.sort?hY:e},Mc=h(pY),fY=ve,mY=k,_Y=zS,gY=RangeError,kO=String.fromCharCode,LO=String.fromCodePoint,EY=mY([].join);fY({target:"String",stat:!0,arity:1,forced:!!LO&&LO.length!==1},{fromCodePoint:function(t){for(var e,n=[],i=arguments.length,o=0;i>o;){if(e=+arguments[o++],_Y(e,1114111)!==e)throw new gY(e+" is not a valid code point");n[o]=e<65536?kO(e):kO(55296+((e-=65536)>>10),e%1024+56320)}return EY(n,"")}});var SY=f,vY=_n("iterator"),hm=!SY(function(){var t=new URL("b?a=1&b=2&c=3","https://a"),e=t.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),i="";return t.pathname="c%20d",e.forEach(function(o,c){e.delete("b"),i+=c+o}),n.delete("a",2),n.delete("b",void 0),!t.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!e.size&&!0||!e.sort||t.href!=="https://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[vY]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||i!=="a1c3"||new URL("https://x",void 0).host!=="x"}),TY=ba,nT=ve,MO=z,iT=PA,yY=Ai,pm=le,Us=k,ah=Ot,xO=hm,UO=ba,RY=im,CY=function(t,e,n){for(var i in e)n&&n.unsafe&&t[i]?t[i]=e[i]:TY(t,i,e[i],n);return t},bY=Ho,IY=gv,rT=Pc,VO=Sv,sT=vt,wY=si,AY=ya,OY=Ca,NY=er,FO=ri,ir=pr,DY=Qu,BO=hn,jO=av,PY=Yf,fm=em,il=kc,kY=yO,LY=_n("iterator"),rl="URLSearchParams",WO=rl+"Iterator",GO=rT.set,as=rT.getterFor(rl),MY=rT.getterFor(WO),HO=iT("fetch"),mm=iT("Request"),ch=iT("Headers"),oT=mm&&mm.prototype,zO=ch&&ch.prototype,xY=MO.TypeError,UY=MO.encodeURIComponent,VY=String.fromCharCode,FY=yY("String","fromCodePoint"),BY=parseInt,_m=Us("".charAt),KO=Us([].join),Oa=Us([].push),YO=Us("".replace),jY=Us([].shift),qO=Us([].splice),XO=Us("".split),JO=Us("".slice),WY=Us(/./.exec),GY=/\+/g,HY=/^[0-9a-f]+$/i,QO=function(t,e){var n=JO(t,e,e+2);return WY(HY,n)?BY(n,16):NaN},zY=function(t){for(var e=0,n=128;n>0&&t&n;n>>=1)e++;return e},KY=function(t){var e=null;switch(t.length){case 1:e=t[0];break;case 2:e=(31&t[0])<<6|63&t[1];break;case 3:e=(15&t[0])<<12|(63&t[1])<<6|63&t[2];break;case 4:e=(7&t[0])<<18|(63&t[1])<<12|(63&t[2])<<6|63&t[3]}return e>1114111?null:e},ZO=function(t){for(var e=(t=YO(t,GY," ")).length,n="",i=0;i<e;){var o=_m(t,i);if(o==="%"){if(_m(t,i+1)==="%"||i+3>e){n+="%",i++;continue}var c=QO(t,i+1);if(c!=c){n+=o,i++;continue}i+=2;var l=zY(c);if(l===0)o=VY(c);else{if(l===1||l>4){n+="",i++;continue}for(var u=[c],p=1;p<l&&!(++i+3>e||_m(t,i)!=="%");){var m=QO(t,i+1);if(m!=m){i+=3;break}if(m>191||m<128)break;Oa(u,m),i+=2,p++}if(u.length!==l){n+="";continue}var _=KY(u);_===null?n+="":o=FY(_)}}n+=o,i++}return n},YY=/[!'()~]|%20/g,qY={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},XY=function(t){return qY[t]},$O=function(t){return YO(UY(t),YY,XY)},aT=IY(function(t,e){GO(this,{type:WO,target:as(t).entries,index:0,kind:e})},rl,function(){var t=MY(this),e=t.target,n=t.index++;if(!e||n>=e.length)return t.target=null,fm(void 0,!0);var i=e[n];switch(t.kind){case"keys":return fm(i.key,!1);case"values":return fm(i.value,!1)}return fm([i.key,i.value],!1)},!0),tN=function(t){this.entries=[],this.url=null,t!==void 0&&(FO(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?_m(t,0)==="?"?JO(t,1):t:ir(t)))};tN.prototype={type:rl,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,n,i,o,c,l,u,p=this.entries,m=PY(t);if(m)for(n=(e=jO(t,m)).next;!(i=pm(n,e)).done;){if(c=(o=jO(NY(i.value))).next,(l=pm(c,o)).done||(u=pm(c,o)).done||!pm(c,o).done)throw new xY("Expected sequence with length 2");Oa(p,{key:ir(l.value),value:ir(u.value)})}else for(var _ in t)wY(t,_)&&Oa(p,{key:_,value:ir(t[_])})},parseQuery:function(t){if(t)for(var e,n,i=this.entries,o=XO(t,"&"),c=0;c<o.length;)(e=o[c++]).length&&(n=XO(e,"="),Oa(i,{key:ZO(jY(n)),value:ZO(KO(n,"="))}))},serialize:function(){for(var t,e=this.entries,n=[],i=0;i<e.length;)t=e[i++],Oa(n,$O(t.key)+"="+$O(t.value));return KO(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var gm=function(){VO(this,sl);var t=GO(this,new tN(arguments.length>0?arguments[0]:void 0));ah||(this.size=t.entries.length)},sl=gm.prototype;if(CY(sl,{append:function(t,e){var n=as(this);il(arguments.length,2),Oa(n.entries,{key:ir(t),value:ir(e)}),ah||this.length++,n.updateURL()},delete:function(t){for(var e=as(this),n=il(arguments.length,1),i=e.entries,o=ir(t),c=n<2?void 0:arguments[1],l=c===void 0?c:ir(c),u=0;u<i.length;){var p=i[u];if(p.key!==o||l!==void 0&&p.value!==l)u++;else if(qO(i,u,1),l!==void 0)break}ah||(this.size=i.length),e.updateURL()},get:function(t){var e=as(this).entries;il(arguments.length,1);for(var n=ir(t),i=0;i<e.length;i++)if(e[i].key===n)return e[i].value;return null},getAll:function(t){var e=as(this).entries;il(arguments.length,1);for(var n=ir(t),i=[],o=0;o<e.length;o++)e[o].key===n&&Oa(i,e[o].value);return i},has:function(t){for(var e=as(this).entries,n=il(arguments.length,1),i=ir(t),o=n<2?void 0:arguments[1],c=o===void 0?o:ir(o),l=0;l<e.length;){var u=e[l++];if(u.key===i&&(c===void 0||u.value===c))return!0}return!1},set:function(t,e){var n=as(this);il(arguments.length,1);for(var i,o=n.entries,c=!1,l=ir(t),u=ir(e),p=0;p<o.length;p++)(i=o[p]).key===l&&(c?qO(o,p--,1):(c=!0,i.value=u));c||Oa(o,{key:l,value:u}),ah||(this.size=o.length),n.updateURL()},sort:function(){var t=as(this);kY(t.entries,function(e,n){return e.key>n.key?1:-1}),t.updateURL()},forEach:function(t){for(var e,n=as(this).entries,i=AY(t,arguments.length>1?arguments[1]:void 0),o=0;o<n.length;)i((e=n[o++]).value,e.key,this)},keys:function(){return new aT(this,"keys")},values:function(){return new aT(this,"values")},entries:function(){return new aT(this,"entries")}},{enumerable:!0}),UO(sl,LY,sl.entries,{name:"entries"}),UO(sl,"toString",function(){return as(this).serialize()},{enumerable:!0}),ah&&RY(sl,"size",{get:function(){return as(this).entries.length},configurable:!0,enumerable:!0}),bY(gm,rl),nT({global:!0,constructor:!0,forced:!xO},{URLSearchParams:gm}),!xO&&sT(ch)){var JY=Us(zO.has),QY=Us(zO.set),eN=function(t){if(FO(t)){var e,n=t.body;if(OY(n)===rl)return e=t.headers?new ch(t.headers):new ch,JY(e,"content-type")||QY(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),DY(t,{body:BO(0,ir(n)),headers:BO(0,e)})}return t};if(sT(HO)&&nT({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return HO(t,arguments.length>1?eN(arguments[1]):{})}}),sT(mm)){var cT=function(t){return VO(this,oT),new mm(t,arguments.length>1?eN(arguments[1]):{})};oT.constructor=cT,cT.prototype=oT,nT({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:cT})}}var cs,ZY={URLSearchParams:gm,getState:as},$Y=Bi.URLSearchParams,nN=Ot,t9=k,e9=le,n9=f,dT=Hf,i9=Ju,r9=Lt,s9=fo,o9=ur,ol=Object.assign,iN=Object.defineProperty,a9=t9([].concat),c9=!ol||n9(function(){if(nN&&ol({b:1},ol(iN({},"a",{enumerable:!0,get:function(){iN(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},e={},n=Symbol("assign detection"),i="abcdefghijklmnopqrst";return t[n]=7,i.split("").forEach(function(o){e[o]=o}),ol({},t)[n]!==7||dT(ol({},e)).join("")!==i})?function(t,e){for(var n=s9(t),i=arguments.length,o=1,c=i9.f,l=r9.f;i>o;)for(var u,p=o9(arguments[o++]),m=c?a9(dT(p),c(p)):dT(p),_=m.length,E=0;_>E;)u=m[E++],nN&&!e9(l,p,u)||(n[u]=p[u]);return n}:ol,d9=er,l9=Hw,u9=Ot,h9=rs,p9=hn,lT=function(t,e,n){u9?h9.f(t,e,p9(0,n)):t[e]=n},f9=ya,m9=le,_9=fo,g9=function(t,e,n,i){try{return i?e(d9(n)[0],n[1]):e(n)}catch(o){l9(t,"throw",o)}},E9=jw,S9=rm,v9=Ra,rN=lT,T9=av,y9=Yf,sN=Array,xc=k,uT=2147483647,R9=/[^\0-\u007E]/,oN=/[.\u3002\uFF0E\uFF61]/g,aN="Overflow: input needs wider integers to process",cN=RangeError,C9=xc(oN.exec),al=Math.floor,hT=String.fromCharCode,dN=xc("".charCodeAt),lN=xc([].join),Na=xc([].push),b9=xc("".replace),I9=xc("".split),w9=xc("".toLowerCase),uN=function(t){return t+22+75*(t<26)},A9=function(t,e,n){var i=0;for(t=n?al(t/700):t>>1,t+=al(t/e);t>455;)t=al(t/35),i+=36;return al(i+36*t/(t+38))},O9=function(t){var e=[];t=function(P){for(var D=[],U=0,G=P.length;U<G;){var W=dN(P,U++);if(W>=55296&&W<=56319&&U<G){var F=dN(P,U++);(64512&F)==56320?Na(D,((1023&W)<<10)+(1023&F)+65536):(Na(D,W),U--)}else Na(D,W)}return D}(t);var n,i,o=t.length,c=128,l=0,u=72;for(n=0;n<t.length;n++)(i=t[n])<128&&Na(e,hT(i));var p=e.length,m=p;for(p&&Na(e,"-");m<o;){var _=uT;for(n=0;n<t.length;n++)(i=t[n])>=c&&i<_&&(_=i);var E=m+1;if(_-c>al((uT-l)/E))throw new cN(aN);for(l+=(_-c)*E,c=_,n=0;n<t.length;n++){if((i=t[n])<c&&++l>uT)throw new cN(aN);if(i===c){for(var S=l,T=36;;){var A=T<=u?1:T>=u+26?26:T-u;if(S<A)break;var I=S-A,w=36-A;Na(e,hT(uN(A+I%w))),S=al(I/w),T+=36}Na(e,hT(uN(S))),u=A9(l,E,m===p),l=0,m++}}l++,c++}return lN(e,"")},N9=ve,pT=Ot,D9=hm,fT=z,hN=ya,ds=k,Em=ba,ls=im,P9=Sv,mT=si,_T=c9,cl=function(t){var e=_9(t),n=S9(this),i=arguments.length,o=i>1?arguments[1]:void 0,c=o!==void 0;c&&(o=f9(o,i>2?arguments[2]:void 0));var l,u,p,m,_,E,S=y9(e),T=0;if(!S||this===sN&&E9(S))for(l=v9(e),u=n?new this(l):sN(l);l>T;T++)E=c?o(e[T],T):e[T],rN(u,T,E);else for(u=n?new this:[],_=(m=T9(e,S)).next;!(p=m9(_,m)).done;T++)E=c?g9(m,o,[p.value,T],!0):p.value,rN(u,T,E);return u.length=T,u},Vs=Ia,k9=Jv.codeAt,L9=function(t){var e,n,i=[],o=I9(b9(w9(t),oN,"."),".");for(e=0;e<o.length;e++)n=o[e],Na(i,C9(R9,n)?"xn--"+O9(n):n);return lN(i,".")},zo=pr,M9=Ho,x9=kc,pN=ZY,fN=Pc,U9=fN.set,Sm=fN.getterFor("URL"),V9=pN.URLSearchParams,F9=pN.getState,dh=fT.URL,gT=fT.TypeError,vm=fT.parseInt,B9=Math.floor,mN=Math.pow,us=ds("".charAt),Fs=ds(/./.exec),lh=ds([].join),j9=ds(1 .toString),W9=ds([].pop),dl=ds([].push),ET=ds("".replace),G9=ds([].shift),H9=ds("".split),uh=ds("".slice),Tm=ds("".toLowerCase),z9=ds([].unshift),ST="Invalid scheme",Uc="Invalid host",_N="Invalid port",gN=/[a-z]/i,K9=/[\d+-.a-z]/i,vT=/\d/,Y9=/^0x/i,q9=/^[0-7]+$/,X9=/^\d+$/,EN=/^[\da-f]+$/i,J9=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Q9=/[\0\t\n\r #/:<>?@[\\\]^|]/,Z9=/^[\u0000-\u0020]+/,$9=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,t7=/[\t\n\r]/g,hh=function(t){var e,n,i,o;if(typeof t=="number"){for(e=[],n=0;n<4;n++)z9(e,t%256),t=B9(t/256);return lh(e,".")}if(typeof t=="object"){for(e="",i=function(c){for(var l=null,u=1,p=null,m=0,_=0;_<8;_++)c[_]!==0?(m>u&&(l=p,u=m),p=null,m=0):(p===null&&(p=_),++m);return m>u?p:l}(t),n=0;n<8;n++)o&&t[n]===0||(o&&(o=!1),i===n?(e+=n?":":"::",o=!0):(e+=j9(t[n],16),n<7&&(e+=":")));return"["+e+"]"}return t},ym={},SN=_T({},ym,{" ":1,'"':1,"<":1,">":1,"`":1}),vN=_T({},SN,{"#":1,"?":1,"{":1,"}":1}),TT=_T({},vN,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Da=function(t,e){var n=k9(t,0);return n>32&&n<127&&!mT(e,t)?t:encodeURIComponent(t)},Rm={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ph=function(t,e){var n;return t.length===2&&Fs(gN,us(t,0))&&((n=us(t,1))===":"||!e&&n==="|")},TN=function(t){var e;return t.length>1&&ph(uh(t,0,2))&&(t.length===2||(e=us(t,2))==="/"||e==="\\"||e==="?"||e==="#")},e7=function(t){return t==="."||Tm(t)==="%2e"},yT={},yN={},RT={},RN={},CN={},CT={},bN={},IN={},Cm={},bm={},bT={},IT={},wT={},AT={},wN={},OT={},ll={},go={},AN={},Vc={},Ko={},NT=function(t,e,n){var i,o,c,l=zo(t);if(e){if(o=this.parse(l))throw new gT(o);this.searchParams=null}else{if(n!==void 0&&(i=new NT(n,!0)),o=this.parse(l,null,i))throw new gT(o);(c=F9(new V9)).bindURL(this),this.searchParams=c}};NT.prototype={type:"URL",parse:function(t,e,n){var i,o,c,l,u,p=this,m=e||yT,_=0,E="",S=!1,T=!1,A=!1;for(t=zo(t),e||(p.scheme="",p.username="",p.password="",p.host=null,p.port=null,p.path=[],p.query=null,p.fragment=null,p.cannotBeABaseURL=!1,t=ET(t,Z9,""),t=ET(t,$9,"$1")),t=ET(t,t7,""),i=cl(t);_<=i.length;){switch(o=i[_],m){case yT:if(!o||!Fs(gN,o)){if(e)return ST;m=RT;continue}E+=Tm(o),m=yN;break;case yN:if(o&&(Fs(K9,o)||o==="+"||o==="-"||o==="."))E+=Tm(o);else{if(o!==":"){if(e)return ST;E="",m=RT,_=0;continue}if(e&&(p.isSpecial()!==mT(Rm,E)||E==="file"&&(p.includesCredentials()||p.port!==null)||p.scheme==="file"&&!p.host))return;if(p.scheme=E,e)return void(p.isSpecial()&&Rm[p.scheme]===p.port&&(p.port=null));E="",p.scheme==="file"?m=AT:p.isSpecial()&&n&&n.scheme===p.scheme?m=RN:p.isSpecial()?m=IN:i[_+1]==="/"?(m=CN,_++):(p.cannotBeABaseURL=!0,dl(p.path,""),m=AN)}break;case RT:if(!n||n.cannotBeABaseURL&&o!=="#")return ST;if(n.cannotBeABaseURL&&o==="#"){p.scheme=n.scheme,p.path=Vs(n.path),p.query=n.query,p.fragment="",p.cannotBeABaseURL=!0,m=Ko;break}m=n.scheme==="file"?AT:CT;continue;case RN:if(o!=="/"||i[_+1]!=="/"){m=CT;continue}m=Cm,_++;break;case CN:if(o==="/"){m=bm;break}m=go;continue;case CT:if(p.scheme=n.scheme,o===cs)p.username=n.username,p.password=n.password,p.host=n.host,p.port=n.port,p.path=Vs(n.path),p.query=n.query;else if(o==="/"||o==="\\"&&p.isSpecial())m=bN;else if(o==="?")p.username=n.username,p.password=n.password,p.host=n.host,p.port=n.port,p.path=Vs(n.path),p.query="",m=Vc;else{if(o!=="#"){p.username=n.username,p.password=n.password,p.host=n.host,p.port=n.port,p.path=Vs(n.path),p.path.length--,m=go;continue}p.username=n.username,p.password=n.password,p.host=n.host,p.port=n.port,p.path=Vs(n.path),p.query=n.query,p.fragment="",m=Ko}break;case bN:if(!p.isSpecial()||o!=="/"&&o!=="\\"){if(o!=="/"){p.username=n.username,p.password=n.password,p.host=n.host,p.port=n.port,m=go;continue}m=bm}else m=Cm;break;case IN:if(m=Cm,o!=="/"||us(E,_+1)!=="/")continue;_++;break;case Cm:if(o!=="/"&&o!=="\\"){m=bm;continue}break;case bm:if(o==="@"){S&&(E="%40"+E),S=!0,c=cl(E);for(var I=0;I<c.length;I++){var w=c[I];if(w!==":"||A){var P=Da(w,TT);A?p.password+=P:p.username+=P}else A=!0}E=""}else if(o===cs||o==="/"||o==="?"||o==="#"||o==="\\"&&p.isSpecial()){if(S&&E==="")return"Invalid authority";_-=cl(E).length+1,E="",m=bT}else E+=o;break;case bT:case IT:if(e&&p.scheme==="file"){m=OT;continue}if(o!==":"||T){if(o===cs||o==="/"||o==="?"||o==="#"||o==="\\"&&p.isSpecial()){if(p.isSpecial()&&E==="")return Uc;if(e&&E===""&&(p.includesCredentials()||p.port!==null))return;if(l=p.parseHost(E))return l;if(E="",m=ll,e)return;continue}o==="["?T=!0:o==="]"&&(T=!1),E+=o}else{if(E==="")return Uc;if(l=p.parseHost(E))return l;if(E="",m=wT,e===IT)return}break;case wT:if(!Fs(vT,o)){if(o===cs||o==="/"||o==="?"||o==="#"||o==="\\"&&p.isSpecial()||e){if(E!==""){var D=vm(E,10);if(D>65535)return _N;p.port=p.isSpecial()&&D===Rm[p.scheme]?null:D,E=""}if(e)return;m=ll;continue}return _N}E+=o;break;case AT:if(p.scheme="file",o==="/"||o==="\\")m=wN;else{if(!n||n.scheme!=="file"){m=go;continue}switch(o){case cs:p.host=n.host,p.path=Vs(n.path),p.query=n.query;break;case"?":p.host=n.host,p.path=Vs(n.path),p.query="",m=Vc;break;case"#":p.host=n.host,p.path=Vs(n.path),p.query=n.query,p.fragment="",m=Ko;break;default:TN(lh(Vs(i,_),""))||(p.host=n.host,p.path=Vs(n.path),p.shortenPath()),m=go;continue}}break;case wN:if(o==="/"||o==="\\"){m=OT;break}n&&n.scheme==="file"&&!TN(lh(Vs(i,_),""))&&(ph(n.path[0],!0)?dl(p.path,n.path[0]):p.host=n.host),m=go;continue;case OT:if(o===cs||o==="/"||o==="\\"||o==="?"||o==="#"){if(!e&&ph(E))m=go;else if(E===""){if(p.host="",e)return;m=ll}else{if(l=p.parseHost(E))return l;if(p.host==="localhost"&&(p.host=""),e)return;E="",m=ll}continue}E+=o;break;case ll:if(p.isSpecial()){if(m=go,o!=="/"&&o!=="\\")continue}else if(e||o!=="?")if(e||o!=="#"){if(o!==cs&&(m=go,o!=="/"))continue}else p.fragment="",m=Ko;else p.query="",m=Vc;break;case go:if(o===cs||o==="/"||o==="\\"&&p.isSpecial()||!e&&(o==="?"||o==="#")){if((u=Tm(u=E))===".."||u==="%2e."||u===".%2e"||u==="%2e%2e"?(p.shortenPath(),o==="/"||o==="\\"&&p.isSpecial()||dl(p.path,"")):e7(E)?o==="/"||o==="\\"&&p.isSpecial()||dl(p.path,""):(p.scheme==="file"&&!p.path.length&&ph(E)&&(p.host&&(p.host=""),E=us(E,0)+":"),dl(p.path,E)),E="",p.scheme==="file"&&(o===cs||o==="?"||o==="#"))for(;p.path.length>1&&p.path[0]==="";)G9(p.path);o==="?"?(p.query="",m=Vc):o==="#"&&(p.fragment="",m=Ko)}else E+=Da(o,vN);break;case AN:o==="?"?(p.query="",m=Vc):o==="#"?(p.fragment="",m=Ko):o!==cs&&(p.path[0]+=Da(o,ym));break;case Vc:e||o!=="#"?o!==cs&&(o==="'"&&p.isSpecial()?p.query+="%27":p.query+=o==="#"?"%23":Da(o,ym)):(p.fragment="",m=Ko);break;case Ko:o!==cs&&(p.fragment+=Da(o,SN))}_++}},parseHost:function(t){var e,n,i;if(us(t,0)==="["){if(us(t,t.length-1)!=="]"||(e=function(o){var c,l,u,p,m,_,E,S=[0,0,0,0,0,0,0,0],T=0,A=null,I=0,w=function(){return us(o,I)};if(w()===":"){if(us(o,1)!==":")return;I+=2,A=++T}for(;w();){if(T===8)return;if(w()!==":"){for(c=l=0;l<4&&Fs(EN,w());)c=16*c+vm(w(),16),I++,l++;if(w()==="."){if(l===0||(I-=l,T>6))return;for(u=0;w();){if(p=null,u>0){if(!(w()==="."&&u<4))return;I++}if(!Fs(vT,w()))return;for(;Fs(vT,w());){if(m=vm(w(),10),p===null)p=m;else{if(p===0)return;p=10*p+m}if(p>255)return;I++}S[T]=256*S[T]+p,++u!=2&&u!==4||T++}if(u!==4)return;break}if(w()===":"){if(I++,!w())return}else if(w())return;S[T++]=c}else{if(A!==null)return;I++,A=++T}}if(A!==null)for(_=T-A,T=7;T!==0&&_>0;)E=S[T],S[T--]=S[A+_-1],S[A+--_]=E;else if(T!==8)return;return S}(uh(t,1,-1)),!e))return Uc;this.host=e}else if(this.isSpecial()){if(t=L9(t),Fs(J9,t)||(e=function(o){var c,l,u,p,m,_,E,S=H9(o,".");if(S.length&&S[S.length-1]===""&&S.length--,(c=S.length)>4)return o;for(l=[],u=0;u<c;u++){if((p=S[u])==="")return o;if(m=10,p.length>1&&us(p,0)==="0"&&(m=Fs(Y9,p)?16:8,p=uh(p,m===8?1:2)),p==="")_=0;else{if(!Fs(m===10?X9:m===8?q9:EN,p))return o;_=vm(p,m)}dl(l,_)}for(u=0;u<c;u++)if(_=l[u],u===c-1){if(_>=mN(256,5-c))return null}else if(_>255)return null;for(E=W9(l),u=0;u<l.length;u++)E+=l[u]*mN(256,3-u);return E}(t),e===null))return Uc;this.host=e}else{if(Fs(Q9,t))return Uc;for(e="",n=cl(t),i=0;i<n.length;i++)e+=Da(n[i],ym);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return mT(Rm,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||this.scheme==="file"&&e===1&&ph(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,n=t.username,i=t.password,o=t.host,c=t.port,l=t.path,u=t.query,p=t.fragment,m=e+":";return o!==null?(m+="//",t.includesCredentials()&&(m+=n+(i?":"+i:"")+"@"),m+=hh(o),c!==null&&(m+=":"+c)):e==="file"&&(m+="//"),m+=t.cannotBeABaseURL?l[0]:l.length?"/"+lh(l,"/"):"",u!==null&&(m+="?"+u),p!==null&&(m+="#"+p),m},setHref:function(t){var e=this.parse(t);if(e)throw new gT(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if(t==="blob")try{return new ul(t.path[0]).origin}catch{return"null"}return t!=="file"&&this.isSpecial()?t+"://"+hh(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(zo(t)+":",yT)},getUsername:function(){return this.username},setUsername:function(t){var e=cl(zo(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<e.length;n++)this.username+=Da(e[n],TT)}},getPassword:function(){return this.password},setPassword:function(t){var e=cl(zo(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<e.length;n++)this.password+=Da(e[n],TT)}},getHost:function(){var t=this.host,e=this.port;return t===null?"":e===null?hh(t):hh(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,bT)},getHostname:function(){var t=this.host;return t===null?"":hh(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,IT)},getPort:function(){var t=this.port;return t===null?"":zo(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=zo(t))===""?this.port=null:this.parse(t,wT))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+lh(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,ll))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=zo(t))===""?this.query=null:(us(t,0)==="?"&&(t=uh(t,1)),this.query="",this.parse(t,Vc)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=zo(t))!==""?(us(t,0)==="#"&&(t=uh(t,1)),this.fragment="",this.parse(t,Ko)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var ul=function(t){var e=P9(this,rr),n=x9(arguments.length,1)>1?arguments[1]:void 0,i=U9(e,new NT(t,!1,n));pT||(e.href=i.serialize(),e.origin=i.getOrigin(),e.protocol=i.getProtocol(),e.username=i.getUsername(),e.password=i.getPassword(),e.host=i.getHost(),e.hostname=i.getHostname(),e.port=i.getPort(),e.pathname=i.getPathname(),e.search=i.getSearch(),e.searchParams=i.getSearchParams(),e.hash=i.getHash())},rr=ul.prototype,hs=function(t,e){return{get:function(){return Sm(this)[t]()},set:e&&function(n){return Sm(this)[e](n)},configurable:!0,enumerable:!0}};if(pT&&(ls(rr,"href",hs("serialize","setHref")),ls(rr,"origin",hs("getOrigin")),ls(rr,"protocol",hs("getProtocol","setProtocol")),ls(rr,"username",hs("getUsername","setUsername")),ls(rr,"password",hs("getPassword","setPassword")),ls(rr,"host",hs("getHost","setHost")),ls(rr,"hostname",hs("getHostname","setHostname")),ls(rr,"port",hs("getPort","setPort")),ls(rr,"pathname",hs("getPathname","setPathname")),ls(rr,"search",hs("getSearch","setSearch")),ls(rr,"searchParams",hs("getSearchParams")),ls(rr,"hash",hs("getHash","setHash"))),Em(rr,"toJSON",function(){return Sm(this).serialize()},{enumerable:!0}),Em(rr,"toString",function(){return Sm(this).serialize()},{enumerable:!0}),dh){var ON=dh.createObjectURL,NN=dh.revokeObjectURL;ON&&Em(ul,"createObjectURL",hN(ON,dh)),NN&&Em(ul,"revokeObjectURL",hN(NN,dh))}M9(ul,"URL"),N9({global:!0,constructor:!0,forced:!D9,sham:!pT},{URL:ul});var n7=ve,DN=f,i7=kc,PN=pr,r7=hm,DT=Ai("URL"),s7=r7&&DN(function(){DT.canParse()}),o7=DN(function(){return DT.canParse.length!==1});n7({target:"URL",stat:!0,forced:!s7||o7},{canParse:function(t){var e=i7(arguments.length,1),n=PN(t),i=e<2||arguments[1]===void 0?void 0:PN(arguments[1]);try{return!!new DT(n,i)}catch{return!1}}});var a7=ve,c7=kc,kN=pr,d7=hm,l7=Ai("URL");a7({target:"URL",stat:!0,forced:!d7},{parse:function(t){var e=c7(arguments.length,1),n=kN(t),i=e<2||arguments[1]===void 0?void 0:kN(arguments[1]);try{return new l7(n,i)}catch{return null}}});var Im=h(Bi.URL);let LN=!0,MN=!0;function wm(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseInt(i[n],10)}function Fc(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,o=i.addEventListener;i.addEventListener=function(l,u){if(l!==e)return o.apply(this,arguments);const p=m=>{const _=n(m);_&&(u.handleEvent?u.handleEvent(_):u(_))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(u,p),o.apply(this,[l,p])};const c=i.removeEventListener;i.removeEventListener=function(l,u){if(l!==e||!this._eventMap||!this._eventMap[e])return c.apply(this,arguments);if(!this._eventMap[e].has(u))return c.apply(this,arguments);const p=this._eventMap[e].get(u);return this._eventMap[e].delete(u),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,c.apply(this,[l,p])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(l){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),l&&this.addEventListener(e,this["_on"+e]=l)},enumerable:!0,configurable:!0})}function u7(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(LN=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function h7(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(MN=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function xN(){if(typeof window=="object"){if(LN)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function PT(t,e){MN&&console.warn(t+" is deprecated, please use "+e+" instead.")}function UN(t){return Object.prototype.toString.call(t)==="[object Object]"}function VN(t){var e;return UN(t)?os(e=Object.keys(t)).call(e,function(n,i){const o=UN(t[i]),c=o?VN(t[i]):t[i],l=o&&!Object.keys(c).length;return c===void 0||l?n:Object.assign(n,{[i]:c})},{}):t}function kT(t,e,n){e&&!n.has(e.id)&&(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?kT(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(o=>{kT(t,t.get(o),n)})}))}function FN(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",o=new Map;if(e===null)return o;const c=[];return t.forEach(l=>{l.type==="track"&&l.trackIdentifier===e.id&&c.push(l)}),c.forEach(l=>{t.forEach(u=>{u.type===i&&u.trackId===l.id&&kT(t,u,o)})}),o}const BN=xN;function jN(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const u={};return Object.keys(l).forEach(p=>{if(p==="require"||p==="advanced"||p==="mediaSource")return;const m=typeof l[p]=="object"?l[p]:{ideal:l[p]};m.exact!==void 0&&typeof m.exact=="number"&&(m.min=m.max=m.exact);const _=function(E,S){return E?E+S.charAt(0).toUpperCase()+S.slice(1):S==="deviceId"?"sourceId":S};if(m.ideal!==void 0){u.optional=u.optional||[];let E={};typeof m.ideal=="number"?(E[_("min",p)]=m.ideal,u.optional.push(E),E={},E[_("max",p)]=m.ideal,u.optional.push(E)):(E[_("",p)]=m.ideal,u.optional.push(E))}m.exact!==void 0&&typeof m.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[_("",p)]=m.exact):["min","max"].forEach(E=>{m[E]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[_(E,p)]=m[E])})}),l.advanced&&(u.optional=(u.optional||[]).concat(l.advanced)),u},o=function(l,u){if(e.version>=61)return u(l);if((l=JSON.parse(JSON.stringify(l)))&&typeof l.audio=="object"){const p=function(m,_,E){_ in m&&!(E in m)&&(m[E]=m[_],delete m[_])};p((l=JSON.parse(JSON.stringify(l))).audio,"autoGainControl","googAutoGainControl"),p(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=i(l.audio)}if(l&&typeof l.video=="object"){let p=l.video.facingMode;p=p&&(typeof p=="object"?p:{ideal:p});const m=e.version<66;if(p&&(p.exact==="user"||p.exact==="environment"||p.ideal==="user"||p.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||m)){let _;if(delete l.video.facingMode,p.exact==="environment"||p.ideal==="environment"?_=["back","rear"]:p.exact!=="user"&&p.ideal!=="user"||(_=["front"]),_)return n.mediaDevices.enumerateDevices().then(E=>{E=E.filter(T=>T.kind==="videoinput");let S=E.find(T=>_.some(A=>{var I;return pt(I=T.label.toLowerCase()).call(I,A)}));return!S&&E.length&&pt(_).call(_,"back")&&(S=E[E.length-1]),S&&(l.video.deviceId=p.exact?{exact:S.deviceId}:{ideal:S.deviceId}),l.video=i(l.video),BN("chrome: "+JSON.stringify(l)),u(l)})}l.video=i(l.video)}return BN("chrome: "+JSON.stringify(l)),u(l)},c=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(l,u,p){o(l,m=>{n.webkitGetUserMedia(m,u,_=>{p&&p(c(_))})})}).bind(n),n.mediaDevices.getUserMedia){const l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(u){return o(u,p=>l(p).then(m=>{if(p.audio&&!m.getAudioTracks().length||p.video&&!m.getVideoTracks().length)throw m.getTracks().forEach(_=>{_.stop()}),new DOMException("","NotFoundError");return m},m=>gt.reject(c(m))))}}}function WN(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function GN(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let o;o=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(l=>l.track&&l.track.id===i.track.id):{track:i.track};const c=new Event("track");c.track=i.track,c.receiver=o,c.transceiver={receiver:o},c.streams=[n.stream],this.dispatchEvent(c)}),n.stream.getTracks().forEach(i=>{let o;o=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(l=>l.track&&l.track.id===i.id):{track:i};const c=new Event("track");c.track=i,c.receiver=o,c.transceiver={receiver:o},c.streams=[n.stream],this.dispatchEvent(c)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Fc(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function HN(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(o,c){return{track:c,get dtmf(){return this._dtmf===void 0&&(c.kind==="audio"?this._dtmf=o.createDTMFSender(c):this._dtmf=null),this._dtmf},_pc:o}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(l,u){let p=o.apply(this,arguments);return p||(p=e(this,l),this._senders.push(p)),p};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(l){c.apply(this,arguments);const u=this._senders.indexOf(l);u!==-1&&this._senders.splice(u,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(c=>{this._senders.push(e(this,c))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach(c=>{const l=this._senders.find(u=>u.track===c);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function zN(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,i,o]=arguments;if(arguments.length>0&&typeof n=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof n!="function"))return e.apply(this,[]);const c=function(u){const p={};return u.result().forEach(m=>{const _={id:m.id,timestamp:m.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[m.type]||m.type};m.names().forEach(E=>{_[E]=m.stat(E)}),p[_.id]=_}),p},l=function(u){return new Map(Object.keys(u).map(p=>[p,u[p]]))};if(arguments.length>=2){const u=function(p){i(l(c(p)))};return e.apply(this,[u,n])}return new gt((u,p)=>{e.apply(this,[function(m){u(l(c(m)))},p])}).then(i,o)}}function KN(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(c=>c._pc=this),o});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>FN(c,o.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i}),Fc(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>FN(o,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let i,o,c;return this.getSenders().forEach(l=>{l.track===n&&(i?c=!0:i=l)}),this.getReceivers().forEach(l=>(l.track===n&&(o?c=!0:o=l),l.track===n)),c||i&&o?gt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():o?o.getStats():gt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function YN(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(c=>this._shimmedLocalStreams[c][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(c,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const u=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(u)===-1&&this._shimmedLocalStreams[l.id].push(u):this._shimmedLocalStreams[l.id]=[l,u],u};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._shimmedLocalStreams=this._shimmedLocalStreams||{},c.getTracks().forEach(p=>{if(this.getSenders().find(_=>_.track===p))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();n.apply(this,arguments);const u=this.getSenders().filter(p=>l.indexOf(p)===-1);this._shimmedLocalStreams[c.id]=[c].concat(u)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[c.id],i.apply(this,arguments)};const o=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},c&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const u=this._shimmedLocalStreams[l].indexOf(c);u!==-1&&this._shimmedLocalStreams[l].splice(u,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),o.apply(this,arguments)}}function qN(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return YN(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const p=n.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(m=>this._reverseStreams[m.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(m=>{if(this.getSenders().find(E=>E.track===m))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){const m=new t.MediaStream(p.getTracks());this._streams[p.id]=m,this._reverseStreams[m.id]=p,p=m}i.apply(this,[p])};const o=t.RTCPeerConnection.prototype.removeStream;function c(p,m){let _=m.sdp;return Object.keys(p._reverseStreams||[]).forEach(E=>{const S=p._reverseStreams[E],T=p._streams[S.id];_=_.replace(new RegExp(T.id,"g"),S.id)}),new RTCSessionDescription({type:m.type,sdp:_})}t.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},t.RTCPeerConnection.prototype.addTrack=function(p,m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const _=[].slice.call(arguments,1);if(_.length!==1||!_[0].getTracks().find(T=>T===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(T=>T.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const S=this._streams[m.id];if(S)S.addTrack(p),gt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const T=new t.MediaStream([p]);this._streams[m.id]=T,this._reverseStreams[T.id]=m,this.addStream(T)}return this.getSenders().find(T=>T.track===p)},["createOffer","createAnswer"].forEach(function(p){const m=t.RTCPeerConnection.prototype[p],_={[p](){const E=arguments;return arguments.length&&typeof arguments[0]=="function"?m.apply(this,[S=>{const T=c(this,S);E[0].apply(null,[T])},S=>{E[1]&&E[1].apply(null,S)},arguments[2]]):m.apply(this,arguments).then(S=>c(this,S))}};t.RTCPeerConnection.prototype[p]=_[p]});const l=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(p,m){let _=m.sdp;return Object.keys(p._reverseStreams||[]).forEach(E=>{const S=p._reverseStreams[E],T=p._streams[S.id];_=_.replace(new RegExp(S.id,"g"),T.id)}),new RTCSessionDescription({type:m.type,sdp:_})}(this,arguments[0]),l.apply(this,arguments)):l.apply(this,arguments)};const u=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const p=u.get.apply(this);return p.type===""?p:c(this,p)}}),t.RTCPeerConnection.prototype.removeTrack=function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(p._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let m;this._streams=this._streams||{},Object.keys(this._streams).forEach(_=>{this._streams[_].getTracks().find(E=>p.track===E)&&(m=this._streams[_])}),m&&(m.getTracks().length===1?this.removeStream(this._reverseStreams[m.id]):m.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function LT(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=o[n]})}function XN(t,e){Fc(t,"negotiationneeded",n=>{const i=n.target;if(!(e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var JN=Object.freeze({__proto__:null,fixNegotiationNeeded:XN,shimAddTrackRemoveTrack:qN,shimAddTrackRemoveTrackWithNative:YN,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof e=="function"?t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then(i=>{const o=n.video&&n.video.width,c=n.video&&n.video.height,l=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:l||3}},o&&(n.video.mandatory.maxWidth=o),c&&(n.video.mandatory.maxHeight=c),t.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:HN,shimGetStats:zN,shimGetUserMedia:jN,shimMediaStream:WN,shimOnTrack:GN,shimPeerConnection:LT,shimSenderReceiverGetStats:KN});function QN(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(o,c,l){PT("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(o).then(c,l)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const o=function(l,u,p){u in l&&!(p in l)&&(l[p]=l[u],delete l[u])},c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(l){return typeof l=="object"&&typeof l.audio=="object"&&(l=JSON.parse(JSON.stringify(l)),o(l.audio,"autoGainControl","mozAutoGainControl"),o(l.audio,"noiseSuppression","mozNoiseSuppression")),c(l)},i&&i.prototype.getSettings){const l=i.prototype.getSettings;i.prototype.getSettings=function(){const u=l.apply(this,arguments);return o(u,"mozAutoGainControl","autoGainControl"),o(u,"mozNoiseSuppression","noiseSuppression"),u}}if(i&&i.prototype.applyConstraints){const l=i.prototype.applyConstraints;i.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),o(u,"autoGainControl","mozAutoGainControl"),o(u,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[u])}}}}function ZN(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function MT(t,e){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const c=t.RTCPeerConnection.prototype[o],l={[o](){return arguments[0]=new(o==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}};t.RTCPeerConnection.prototype[o]=l[o]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[o,c,l]=arguments;return i.apply(this,[o||null]).then(u=>{if(e.version<53&&!c)try{u.forEach(p=>{p.type=n[p.type]||p.type})}catch(p){if(p.name!=="TypeError")throw p;u.forEach((m,_)=>{u.set(_,Object.assign({},m,{type:n[m.type]||m.type}))})}return u}).then(c,l)}}function $N(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(o=>o._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):gt.resolve(new Map)}}function tD(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n}),Fc(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function eD(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(e){PT("removeStream","removeTrack"),this.getSenders().forEach(n=>{var i;n.track&&pt(i=e.getTracks()).call(i,n.track)&&this.removeTrack(n)})})}function nD(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function iD(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(c=>{if("rid"in c&&!/^[a-z0-9]{0,16}$/i.test(c.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in c&&!(parseFloat(c.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in c&&!(parseFloat(c.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=e.apply(this,arguments);if(i){const{sender:c}=o,l=c.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=n,c.sendEncodings=n,this.setParametersPromises.push(c.setParameters(l).then(()=>{delete c.sendEncodings}).catch(()=>{delete c.sendEncodings})))}return o})}function rD(t){if(typeof t!="object"||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function sD(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?gt.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function oD(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?gt.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var aD=Object.freeze({__proto__:null,shimAddTransceiver:iD,shimCreateAnswer:oD,shimCreateOffer:sD,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,gt.reject(i)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:rD,shimGetUserMedia:QN,shimOnTrack:ZN,shimPeerConnection:MT,shimRTCDataChannel:nD,shimReceiverGetStats:tD,shimRemoveStream:eD,shimSenderGetStats:$N});function cD(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),pt(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach(o=>e.call(this,o,n)),n.getVideoTracks().forEach(o=>e.call(this,o,n))},t.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,o=new Array(i>1?i-1:0),c=1;c<i;c++)o[c-1]=arguments[c];return o&&o.forEach(l=>{var u;this._localStreams?pt(u=this._localStreams).call(u,l)||this._localStreams.push(l):this._localStreams=[l]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(n===-1)return;this._localStreams.splice(n,1);const i=e.getTracks();this.getSenders().forEach(o=>{pt(i).call(i,o.track)&&this.removeTrack(o)})})}}function dD(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(o=>{var c;if(this._remoteStreams||(this._remoteStreams=[]),pt(c=this._remoteStreams).call(c,o))return;this._remoteStreams.push(o);const l=new Event("addstream");l.stream=o,this.dispatchEvent(l)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(o=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(o)>=0)return;n._remoteStreams.push(o);const c=new Event("addstream");c.stream=o,n.dispatchEvent(c)})}),e.apply(n,arguments)}}}function lD(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,o=e.setLocalDescription,c=e.setRemoteDescription,l=e.addIceCandidate;e.createOffer=function(p,m){const _=arguments.length>=2?arguments[2]:arguments[0],E=n.apply(this,[_]);return m?(E.then(p,m),gt.resolve()):E},e.createAnswer=function(p,m){const _=arguments.length>=2?arguments[2]:arguments[0],E=i.apply(this,[_]);return m?(E.then(p,m),gt.resolve()):E};let u=function(p,m,_){const E=o.apply(this,[p]);return _?(E.then(m,_),gt.resolve()):E};e.setLocalDescription=u,u=function(p,m,_){const E=c.apply(this,[p]);return _?(E.then(m,_),gt.resolve()):E},e.setRemoteDescription=u,u=function(p,m,_){const E=l.apply(this,[p]);return _?(E.then(m,_),gt.resolve()):E},e.addIceCandidate=u}function uD(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=o=>i(hD(o))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,i,o){e.mediaDevices.getUserMedia(n).then(i,o)}).bind(e))}function hD(t){return t&&t.video!==void 0?Object.assign({},t,{video:VN(t.video)}):t}function pD(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const o=[];for(let c=0;c<n.iceServers.length;c++){let l=n.iceServers[c];!l.hasOwnProperty("urls")&&l.hasOwnProperty("url")?(PT("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,o.push(l)):o.push(n.iceServers[c])}n.iceServers=o}return new e(n,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function fD(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function mD(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(c=>c.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const o=this.getTransceivers().find(c=>c.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):n.offerToReceiveVideo!==!0||o||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function _D(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var gD=Object.freeze({__proto__:null,shimAudioContext:_D,shimCallbacksAPI:lD,shimConstraints:hD,shimCreateOfferLegacy:mD,shimGetUserMedia:uD,shimLocalStreamsAPI:cD,shimRTCIceServerUrls:pD,shimRemoteStreamsAPI:dD,shimTrackEventTransceiver:fD}),ED=`	
\v\f\r \u2028\u2029\uFEFF`,p7=Fi,f7=pr,xT=ED,SD=k("".replace),m7=RegExp("^["+xT+"]+"),_7=RegExp("(^|[^"+xT+"])["+xT+"]+$"),UT=function(t){return function(e){var n=f7(p7(e));return 1&t&&(n=SD(n,m7,"")),2&t&&(n=SD(n,_7,"$1")),n}},g7={start:UT(1),end:UT(2),trim:UT(3)},E7=eA.PROPER,S7=f,vD=ED,v7=g7.trim;ve({target:"String",proto:!0,forced:function(t){return S7(function(){return!!vD[t]()||""[t]()!==""||E7&&vD[t].name!==t})}("trim")},{trim:function(){return v7(this)}});var T7=ss("String","trim"),y7=M,R7=T7,VT=String.prototype,C7=function(t){var e=t.trim;return typeof t=="string"||t===VT||y7(VT,t)&&e===VT.trim?R7:e},hi=h(C7),TD={exports:{}};(function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,o)=>(o>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(o=>o.indexOf(i)===0)},e.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const o={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let c=8;c<i.length;c+=2)switch(i[c]){case"raddr":o.relatedAddress=i[c+1];break;case"rport":o.relatedPort=parseInt(i[c+1],10);break;case"tcptype":o.tcpType=i[c+1];break;case"ufrag":o.ufrag=i[c+1],o.usernameFragment=i[c+1];break;default:o[i[c]]===void 0&&(o[i[c]]=i[c+1])}return o},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const o=n.component;o==="rtp"?i.push(1):o==="rtcp"?i.push(2):i.push(o),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const c=n.type;return i.push("typ"),i.push(c),c!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const o={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),o.name=i[0],o.clockRate=parseInt(i[1],10),o.channels=i.length===3?parseInt(i[2],10):1,o.numChannels=o.channels,o},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const o=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(o!==1?"/"+o:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let o;const c=n.substring(n.indexOf(" ")+1).split(";");for(let l=0;l<c.length;l++)o=c[l].trim().split("="),i[o[0].trim()]=o[1];return i},e.writeFmtp=function(n){let i="",o=n.payloadType;if(n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const c=[];Object.keys(n.parameters).forEach(l=>{n.parameters[l]!==void 0?c.push(l+"="+n.parameters[l]):c.push(l)}),i+="a=fmtp:"+o+" "+c.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",o=n.payloadType;return n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(c=>{i+="a=rtcp-fb:"+o+" "+c.type+(c.parameter&&c.parameter.length?" "+c.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),o={ssrc:parseInt(n.substring(7,i),10)},c=n.indexOf(":",i);return c>-1?(o.attribute=n.substring(i+1,c),o.value=n.substring(c+1)):o.attribute=n.substring(i+1),o},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(o=>parseInt(o,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let o="a=setup:"+i+`\r
`;return n.fingerprints.forEach(c=>{o+="a=fingerprint:"+c.algorithm+" "+c.value+`\r
`}),o},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const o=e.matchPrefix(n+i,"a=ice-ufrag:")[0],c=e.matchPrefix(n+i,"a=ice-pwd:")[0];return o&&c?{usernameFragment:o.substring(12),password:c.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=e.splitLines(n)[0].split(" ");i.profile=o[2];for(let l=3;l<o.length;l++){const u=o[l],p=e.matchPrefix(n,"a=rtpmap:"+u+" ")[0];if(p){const m=e.parseRtpMap(p),_=e.matchPrefix(n,"a=fmtp:"+u+" ");switch(m.parameters=_.length?e.parseFmtp(_[0]):{},m.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+u+" ").map(e.parseRtcpFb),i.codecs.push(m),m.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(m.name.toUpperCase())}}}e.matchPrefix(n,"a=extmap:").forEach(l=>{i.headerExtensions.push(e.parseExtmap(l))});const c=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(l=>{c.forEach(u=>{l.rtcpFeedback.find(p=>p.type===u.type&&p.parameter===u.parameter)||l.rtcpFeedback.push(u)})}),i},e.writeRtpDescription=function(n,i){let o="";o+="m="+n+" ",o+=i.codecs.length>0?"9":"0",o+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",o+=i.codecs.map(l=>l.preferredPayloadType!==void 0?l.preferredPayloadType:l.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(l=>{o+=e.writeRtpMap(l),o+=e.writeFmtp(l),o+=e.writeRtcpFb(l)});let c=0;return i.codecs.forEach(l=>{l.maxptime>c&&(c=l.maxptime)}),c>0&&(o+="a=maxptime:"+c+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(l=>{o+=e.writeExtmap(l)}),o},e.parseRtpEncodingParameters=function(n){const i=[],o=e.parseRtpParameters(n),c=o.fecMechanisms.indexOf("RED")!==-1,l=o.fecMechanisms.indexOf("ULPFEC")!==-1,u=e.matchPrefix(n,"a=ssrc:").map(S=>e.parseSsrcMedia(S)).filter(S=>S.attribute==="cname"),p=u.length>0&&u[0].ssrc;let m;const _=e.matchPrefix(n,"a=ssrc-group:FID").map(S=>S.substring(17).split(" ").map(T=>parseInt(T,10)));_.length>0&&_[0].length>1&&_[0][0]===p&&(m=_[0][1]),o.codecs.forEach(S=>{if(S.name.toUpperCase()==="RTX"&&S.parameters.apt){let T={ssrc:p,codecPayloadType:parseInt(S.parameters.apt,10)};p&&m&&(T.rtx={ssrc:m}),i.push(T),c&&(T=JSON.parse(JSON.stringify(T)),T.fec={ssrc:p,mechanism:l?"red+ulpfec":"red"},i.push(T))}}),i.length===0&&p&&i.push({ssrc:p});let E=e.matchPrefix(n,"b=");return E.length&&(E=E[0].indexOf("b=TIAS:")===0?parseInt(E[0].substring(7),10):E[0].indexOf("b=AS:")===0?1e3*parseInt(E[0].substring(5),10)*.95-16e3:void 0,i.forEach(S=>{S.maxBitrate=E})),i},e.parseRtcpParameters=function(n){const i={},o=e.matchPrefix(n,"a=ssrc:").map(u=>e.parseSsrcMedia(u)).filter(u=>u.attribute==="cname")[0];o&&(i.cname=o.value,i.ssrc=o.ssrc);const c=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=c.length>0,i.compound=c.length===0;const l=e.matchPrefix(n,"a=rtcp-mux");return i.mux=l.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const o=e.matchPrefix(n,"a=msid:");if(o.length===1)return i=o[0].substring(7).split(" "),{stream:i[0],track:i[1]};const c=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="msid");return c.length>0?(i=c[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},e.parseSctpDescription=function(n){const i=e.parseMLine(n),o=e.matchPrefix(n,"a=max-message-size:");let c;o.length>0&&(c=parseInt(o[0].substring(19),10)),isNaN(c)&&(c=65536);const l=e.matchPrefix(n,"a=sctp-port:");if(l.length>0)return{port:parseInt(l[0].substring(12),10),protocol:i.fmt,maxMessageSize:c};const u=e.matchPrefix(n,"a=sctpmap:");if(u.length>0){const p=u[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:c}}},e.writeSctpDescription=function(n,i){let o=[];return o=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&o.push("a=max-message-size:"+i.maxMessageSize+`\r
`),o.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,o){let c;const l=i!==void 0?i:2;return c=n||e.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+c+" "+l+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const o=e.splitLines(n);for(let c=0;c<o.length;c++)switch(o[c]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[c].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let o=0;o<i.length;o++)if(i[o].length<2||i[o].charAt(1)!=="=")return!1;return!0},t.exports=e})(TD);var yD=TD.exports,hl=h(yD),b7=a({__proto__:null,default:hl},[yD]);function Am(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new e(n),o=hl.parseCandidate(n.candidate),c=Object.assign(i,o);return c.toJSON=function(){return{candidate:c.candidate,sdpMid:c.sdpMid,sdpMLineIndex:c.sdpMLineIndex,usernameFragment:c.usernameFragment}},c}return new e(n)},t.RTCIceCandidate.prototype=e.prototype,Fc(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function FT(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Fc(t,"icecandidate",e=>{if(e.candidate){const n=hl.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Om(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(u){if(!u||!u.sdp)return!1;const p=hl.splitSections(u.sdp);return p.shift(),p.some(m=>{const _=hl.parseMLine(m);return _&&_.kind==="application"&&_.protocol.indexOf("SCTP")!==-1})},i=function(u){const p=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;const m=parseInt(p[1],10);return m!=m?-1:m},o=function(u){let p=65536;return e.browser==="firefox"&&(p=e.version<57?u===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),p},c=function(u,p){let m=65536;e.browser==="firefox"&&e.version===57&&(m=65535);const _=hl.matchPrefix(u.sdp,"a=max-message-size:");return _.length>0?m=parseInt(_[0].substr(19),10):e.browser==="firefox"&&p!==-1&&(m=2147483637),m},l=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const u=i(arguments[0]),p=o(u),m=c(arguments[0],u);let _;_=p===0&&m===0?Number.POSITIVE_INFINITY:p===0||m===0?Math.max(p,m):Math.min(p,m);const E={};Object.defineProperty(E,"maxMessageSize",{get:()=>_}),this._sctp=E}return l.apply(this,arguments)}}function Nm(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,o){const c=i.send;i.send=function(){const l=arguments[0],u=l.length||l.size||l.byteLength;if(i.readyState==="open"&&o.sctp&&u>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return c.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},Fc(t,"datachannel",i=>(e(i.channel,i.target),i))}function BT(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const c=o.target;if(c._lastConnectionState!==c.connectionState){c._lastConnectionState=c.connectionState;const l=new Event("connectionstatechange",o);c.dispatchEvent(l)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function jT(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=i.sdp.split(`
`).filter(c=>hi(c).call(c)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:o}):i.sdp=o}return n.apply(this,arguments)}}function Dm(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?gt.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),gt.resolve())})}function Pm(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var I7=Object.freeze({__proto__:null,removeExtmapAllowMixed:jT,shimAddIceCandidateNullOrEmpty:Dm,shimConnectionState:BT,shimMaxMessageSize:Om,shimParameterlessSetLocalDescription:Pm,shimRTCIceCandidate:Am,shimRTCIceCandidateRelayProtocol:FT,shimSendThrowTypeError:Nm});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=xN,i=function(c){const l={browser:null,version:null};if(c===void 0||!c.navigator)return l.browser="Not a browser.",l;const{navigator:u}=c;if(u.mozGetUserMedia)l.browser="firefox",l.version=wm(u.userAgent,/Firefox\/(\d+)\./,1);else if(u.webkitGetUserMedia||c.isSecureContext===!1&&c.webkitRTCPeerConnection)l.browser="chrome",l.version=wm(u.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!c.RTCPeerConnection||!u.userAgent.match(/AppleWebKit\/(\d+)\./))return l.browser="Not a supported browser.",l;l.browser="safari",l.version=wm(u.userAgent,/AppleWebKit\/(\d+)\./,1),l.supportsUnifiedPlan=c.RTCRtpTransceiver&&"currentDirection"in c.RTCRtpTransceiver.prototype}return l}(t),o={browserDetails:i,commonShim:I7,extractVersion:wm,disableLog:u7,disableWarnings:h7,sdp:b7};switch(i.browser){case"chrome":if(!JN||!LT||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),o;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),o;n("adapter.js shimming chrome."),o.browserShim=JN,Dm(t,i),Pm(t),jN(t,i),WN(t),LT(t,i),GN(t),qN(t,i),HN(t),zN(t),KN(t),XN(t,i),Am(t),FT(t),BT(t),Om(t,i),Nm(t),jT(t,i);break;case"firefox":if(!aD||!MT||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=aD,Dm(t,i),Pm(t),QN(t,i),MT(t,i),ZN(t),eD(t),$N(t),tD(t),nD(t),iD(t),rD(t),sD(t),oD(t),Am(t),BT(t),Om(t,i),Nm(t);break;case"safari":if(!gD||!e.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=gD,Dm(t,i),Pm(t),pD(t),mD(t),lD(t),cD(t),dD(t),fD(t),uD(t),_D(t),Am(t),FT(t),Om(t,i),Nm(t),jT(t,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var WT=z;ve({global:!0,forced:WT.globalThis!==WT},{globalThis:WT});var RD=h(z),GT={exports:{}};(function(t,e){(function(n,i){var o="function",c="undefined",l="object",u="string",p="major",m="model",_="name",E="type",S="vendor",T="version",A="architecture",I="console",w="mobile",P="tablet",D="smarttv",U="wearable",G="embedded",W="Amazon",F="Apple",X="ASUS",tt="BlackBerry",nt="Browser",at="Chrome",Kt="Firefox",Xt="Google",Ut="Huawei",me="LG",he="Microsoft",ni="Motorola",et="Opera",ut="Samsung",Tt="Sharp",rt="Sony",b="Xiaomi",V="Zebra",B="Facebook",dt="Chromium OS",Wt="Mac OS",De=" Browser",Sn=function(mn){for(var vn={},Ue=0;Ue<mn.length;Ue++)vn[mn[Ue].toUpperCase()]=mn[Ue];return vn},Kr=function(mn,vn){return typeof mn===u&&Is(vn).indexOf(Is(mn))!==-1},Is=function(mn){return mn.toLowerCase()},Ep=function(mn,vn){if(typeof mn===u)return mn=mn.replace(/^\s\s*/,""),typeof vn===c?mn:mn.substring(0,500)},pd=function(mn,vn){for(var Ue,Yi,eo,sn,sa,se,no=0;no<vn.length&&!sa;){var fd=vn[no],Mo=vn[no+1];for(Ue=Yi=0;Ue<fd.length&&!sa&&fd[Ue];)if(sa=fd[Ue++].exec(mn))for(eo=0;eo<Mo.length;eo++)se=sa[++Yi],typeof(sn=Mo[eo])===l&&sn.length>0?sn.length===2?typeof sn[1]==o?this[sn[0]]=sn[1].call(this,se):this[sn[0]]=sn[1]:sn.length===3?typeof sn[1]!==o||sn[1].exec&&sn[1].test?this[sn[0]]=se?se.replace(sn[1],sn[2]):i:this[sn[0]]=se?sn[1].call(this,se,sn[2]):i:sn.length===4&&(this[sn[0]]=se?sn[3].call(this,se.replace(sn[1],sn[2])):i):this[sn]=se||i;no+=2}},au=function(mn,vn){for(var Ue in vn)if(typeof vn[Ue]===l&&vn[Ue].length>0){for(var Yi=0;Yi<vn[Ue].length;Yi++)if(Kr(vn[Ue][Yi],mn))return Ue==="?"?i:Ue}else if(Kr(vn[Ue],mn))return Ue==="?"?i:Ue;return vn.hasOwnProperty("*")?vn["*"]:mn},Og={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Ng={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[T,[_,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[T,[_,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[_,T],[/opios[\/ ]+([\w\.]+)/i],[T,[_,et+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[T,[_,et+" GX"]],[/\bopr\/([\w\.]+)/i],[T,[_,et]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[T,[_,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[T,[_,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[_,T],[/quark(?:pc)?\/([-\w\.]+)/i],[T,[_,"Quark"]],[/\bddg\/([\w\.]+)/i],[T,[_,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[T,[_,"UC"+nt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[T,[_,"WeChat"]],[/konqueror\/([\w\.]+)/i],[T,[_,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[T,[_,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[T,[_,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[T,[_,"Smart Lenovo "+nt]],[/(avast|avg)\/([\w\.]+)/i],[[_,/(.+)/,"$1 Secure "+nt],T],[/\bfocus\/([\w\.]+)/i],[T,[_,Kt+" Focus"]],[/\bopt\/([\w\.]+)/i],[T,[_,et+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[T,[_,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[T,[_,"Dolphin"]],[/coast\/([\w\.]+)/i],[T,[_,et+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[T,[_,"MIUI"+De]],[/fxios\/([\w\.-]+)/i],[T,[_,Kt]],[/\bqihoobrowser\/?([\w\.]*)/i],[T,[_,"360"]],[/\b(qq)\/([\w\.]+)/i],[[_,/(.+)/,"$1Browser"],T],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[_,/(.+)/,"$1"+De],T],[/samsungbrowser\/([\w\.]+)/i],[T,[_,ut+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[T,[_,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[_,"Sogou Mobile"],T],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[_,T],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[_],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[T,_],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[_,B],T],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[_,T],[/\bgsa\/([\w\.]+) .*safari\//i],[T,[_,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[T,[_,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[T,[_,at+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[_,at+" WebView"],T],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[T,[_,"Android "+nt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[_,T],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[T,[_,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[T,_],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[_,[T,au,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[_,T],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[_,"Netscape"],T],[/(wolvic|librewolf)\/([\w\.]+)/i],[_,T],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[T,[_,Kt+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[_,[T,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[_,[T,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[A,"amd64"]],[/(ia32(?=;))/i],[[A,Is]],[/((?:i[346]|x)86)[;\)]/i],[[A,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[A,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[A,"armhf"]],[/windows (ce|mobile); ppc;/i],[[A,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[A,/ower/,"",Is]],[/(sun4\w)[;\)]/i],[[A,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[A,Is]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[m,[S,ut],[E,P]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[m,[S,ut],[E,w]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[m,[S,F],[E,w]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[m,[S,F],[E,P]],[/(macintosh);/i],[m,[S,F]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[m,[S,Tt],[E,w]],[/(?:honor)([-\w ]+)[;\)]/i],[m,[S,"Honor"],[E,w]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[m,[S,Ut],[E,P]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[m,[S,Ut],[E,w]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[m,/_/g," "],[S,b],[E,w]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[m,/_/g," "],[S,b],[E,P]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[m,[S,"OPPO"],[E,w]],[/\b(opd2\d{3}a?) bui/i],[m,[S,"OPPO"],[E,P]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[m,[S,"Vivo"],[E,w]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[m,[S,"Realme"],[E,w]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[m,[S,ni],[E,w]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[m,[S,ni],[E,P]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[m,[S,me],[E,P]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[m,[S,me],[E,w]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[m,[S,"Lenovo"],[E,P]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[m,/_/g," "],[S,"Nokia"],[E,w]],[/(pixel c)\b/i],[m,[S,Xt],[E,P]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[m,[S,Xt],[E,w]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[m,[S,rt],[E,w]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[m,"Xperia Tablet"],[S,rt],[E,P]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[m,[S,"OnePlus"],[E,w]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[m,[S,W],[E,P]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[m,/(.+)/g,"Fire Phone $1"],[S,W],[E,w]],[/(playbook);[-\w\),; ]+(rim)/i],[m,S,[E,P]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[m,[S,tt],[E,w]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[m,[S,X],[E,P]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[m,[S,X],[E,w]],[/(nexus 9)/i],[m,[S,"HTC"],[E,P]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[S,[m,/_/g," "],[E,w]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[m,[S,"TCL"],[E,P]],[/(itel) ((\w+))/i],[[S,Is],m,[E,au,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[m,[S,"Acer"],[E,P]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[m,[S,"Meizu"],[E,w]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[m,[S,"Ulefone"],[E,w]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[m,[S,"Energizer"],[E,w]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[m,[S,"Cat"],[E,w]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[m,[S,"Smartfren"],[E,w]],[/droid.+; (a(?:015|06[35]|142p?))/i],[m,[S,"Nothing"],[E,w]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[S,m,[E,w]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[S,m,[E,P]],[/(surface duo)/i],[m,[S,he],[E,P]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[m,[S,"Fairphone"],[E,w]],[/(u304aa)/i],[m,[S,"AT&T"],[E,w]],[/\bsie-(\w*)/i],[m,[S,"Siemens"],[E,w]],[/\b(rct\w+) b/i],[m,[S,"RCA"],[E,P]],[/\b(venue[\d ]{2,7}) b/i],[m,[S,"Dell"],[E,P]],[/\b(q(?:mv|ta)\w+) b/i],[m,[S,"Verizon"],[E,P]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[m,[S,"Barnes & Noble"],[E,P]],[/\b(tm\d{3}\w+) b/i],[m,[S,"NuVision"],[E,P]],[/\b(k88) b/i],[m,[S,"ZTE"],[E,P]],[/\b(nx\d{3}j) b/i],[m,[S,"ZTE"],[E,w]],[/\b(gen\d{3}) b.+49h/i],[m,[S,"Swiss"],[E,w]],[/\b(zur\d{3}) b/i],[m,[S,"Swiss"],[E,P]],[/\b((zeki)?tb.*\b) b/i],[m,[S,"Zeki"],[E,P]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[S,"Dragon Touch"],m,[E,P]],[/\b(ns-?\w{0,9}) b/i],[m,[S,"Insignia"],[E,P]],[/\b((nxa|next)-?\w{0,9}) b/i],[m,[S,"NextBook"],[E,P]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[S,"Voice"],m,[E,w]],[/\b(lvtel\-)?(v1[12]) b/i],[[S,"LvTel"],m,[E,w]],[/\b(ph-1) /i],[m,[S,"Essential"],[E,w]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[m,[S,"Envizen"],[E,P]],[/\b(trio[-\w\. ]+) b/i],[m,[S,"MachSpeed"],[E,P]],[/\btu_(1491) b/i],[m,[S,"Rotor"],[E,P]],[/(shield[\w ]+) b/i],[m,[S,"Nvidia"],[E,P]],[/(sprint) (\w+)/i],[S,m,[E,w]],[/(kin\.[onetw]{3})/i],[[m,/\./g," "],[S,he],[E,w]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[m,[S,V],[E,P]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[m,[S,V],[E,w]],[/smart-tv.+(samsung)/i],[S,[E,D]],[/hbbtv.+maple;(\d+)/i],[[m,/^/,"SmartTV"],[S,ut],[E,D]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[S,me],[E,D]],[/(apple) ?tv/i],[S,[m,F+" TV"],[E,D]],[/crkey/i],[[m,at+"cast"],[S,Xt],[E,D]],[/droid.+aft(\w+)( bui|\))/i],[m,[S,W],[E,D]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[m,[S,Tt],[E,D]],[/(bravia[\w ]+)( bui|\))/i],[m,[S,rt],[E,D]],[/(mitv-\w{5}) bui/i],[m,[S,b],[E,D]],[/Hbbtv.*(technisat) (.*);/i],[S,m,[E,D]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[S,Ep],[m,Ep],[E,D]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[E,D]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[S,m,[E,I]],[/droid.+; (shield) bui/i],[m,[S,"Nvidia"],[E,I]],[/(playstation [345portablevi]+)/i],[m,[S,rt],[E,I]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[m,[S,he],[E,I]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[m,[S,ut],[E,U]],[/((pebble))app/i],[S,m,[E,U]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[m,[S,F],[E,U]],[/droid.+; (glass) \d/i],[m,[S,Xt],[E,U]],[/droid.+; (wt63?0{2,3})\)/i],[m,[S,V],[E,U]],[/droid.+; (glass) \d/i],[m,[S,Xt],[E,U]],[/(pico) (4|neo3(?: link|pro)?)/i],[S,m,[E,U]],[/; (quest( \d| pro)?)/i],[m,[S,B],[E,U]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[S,[E,G]],[/(aeobc)\b/i],[m,[S,W],[E,G]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[m,[E,w]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[m,[E,P]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[E,P]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[E,w]],[/(android[-\w\. ]{0,9});.+buil/i],[m,[S,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[T,[_,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[_,T],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[T,[_,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[_,T],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[T,_]],os:[[/microsoft (windows) (vista|xp)/i],[_,T],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[_,[T,au,Og]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[T,au,Og],[_,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[T,/_/g,"."],[_,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[_,Wt],[T,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[T,_],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[_,T],[/\(bb(10);/i],[T,[_,tt]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[T,[_,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[T,[_,Kt+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[T,[_,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[T,[_,"watchOS"]],[/crkey\/([\d\.]+)/i],[T,[_,at+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[_,dt],T],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[_,T],[/(sunos) ?([\w\.\d]*)/i],[[_,"Solaris"],T],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[_,T]]},Yr=function(mn,vn){if(typeof mn===l&&(vn=mn,mn=i),!(this instanceof Yr))return new Yr(mn,vn).getResult();var Ue=typeof n!==c&&n.navigator?n.navigator:i,Yi=mn||(Ue&&Ue.userAgent?Ue.userAgent:""),eo=Ue&&Ue.userAgentData?Ue.userAgentData:i,sn=vn?function(se,no){var fd={};for(var Mo in se)no[Mo]&&no[Mo].length%2==0?fd[Mo]=no[Mo].concat(se[Mo]):fd[Mo]=se[Mo];return fd}(Ng,vn):Ng,sa=Ue&&Ue.userAgent==Yi;return this.getBrowser=function(){var se={};return se[_]=i,se[T]=i,pd.call(se,Yi,sn.browser),se[p]=function(no){return typeof no===u?no.replace(/[^\d\.]/g,"").split(".")[0]:i}(se[T]),sa&&Ue&&Ue.brave&&typeof Ue.brave.isBrave==o&&(se[_]="Brave"),se},this.getCPU=function(){var se={};return se[A]=i,pd.call(se,Yi,sn.cpu),se},this.getDevice=function(){var se={};return se[S]=i,se[m]=i,se[E]=i,pd.call(se,Yi,sn.device),sa&&!se[E]&&eo&&eo.mobile&&(se[E]=w),sa&&se[m]=="Macintosh"&&Ue&&typeof Ue.standalone!==c&&Ue.maxTouchPoints&&Ue.maxTouchPoints>2&&(se[m]="iPad",se[E]=P),se},this.getEngine=function(){var se={};return se[_]=i,se[T]=i,pd.call(se,Yi,sn.engine),se},this.getOS=function(){var se={};return se[_]=i,se[T]=i,pd.call(se,Yi,sn.os),sa&&!se[_]&&eo&&eo.platform&&eo.platform!="Unknown"&&(se[_]=eo.platform.replace(/chrome os/i,dt).replace(/macos/i,Wt)),se},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Yi},this.setUA=function(se){return Yi=typeof se===u&&se.length>500?Ep(se,500):se,this},this.setUA(Yi),this};Yr.VERSION="0.7.40",Yr.BROWSER=Sn([_,T,p]),Yr.CPU=Sn([A]),Yr.DEVICE=Sn([m,S,E,I,w,D,P,U,G]),Yr.ENGINE=Yr.OS=Sn([_,T]),t.exports&&(e=t.exports=Yr),e.UAParser=Yr;var ra=typeof n!==c&&(n.jQuery||n.Zepto);if(ra&&!ra.ua){var Dg=new Yr;ra.ua=Dg.getResult(),ra.ua.get=function(){return Dg.getUA()},ra.ua.set=function(mn){Dg.setUA(mn);var vn=Dg.getResult();for(var Ue in vn)ra.ua[Ue]=vn[Ue]}}})(typeof window=="object"?window:d)})(GT,GT.exports);var w7=h(GT.exports),CD=sm.clear;ve({global:!0,bind:!0,enumerable:!0,forced:z.clearImmediate!==CD},{clearImmediate:CD});var bD=z,A7=q,O7=vt,N7=JS,D7=Go,P7=Ia,k7=kc,L7=bD.Function,M7=/MSIE .\./.test(D7)||N7==="BUN"&&function(){var t=bD.Bun.version.split(".");return t.length<3||t[0]==="0"&&(t[1]<3||t[1]==="3"&&t[2]==="0")}(),x7=ve,ID=z,wD=sm.set,U7=function(t,e){var n=e?2:1;return M7?function(i,o){var c=k7(arguments.length,1)>n,l=O7(i)?i:L7(i),u=c?P7(arguments,n):[],p=c?function(){A7(l,this,u)}:l;return e?t(p,o):t(p)}:t},AD=ID.setImmediate?U7(wD,!1):wD;x7({global:!0,bind:!0,enumerable:!0,forced:ID.setImmediate!==AD},{setImmediate:AD});var OD=h(Bi.setImmediate),V7=z,F7=BA,B7=hr,j7=kc,W7=Ot;ve({global:!0,enumerable:!0,dontCallGetSet:!0,forced:f(function(){return W7&&Object.getOwnPropertyDescriptor(V7,"queueMicrotask").value.length!==1})},{queueMicrotask:function(t){j7(arguments.length,1),F7(B7(t))}});var ND=h(Bi.queueMicrotask);function DD(t,e){return function(){return t.apply(e,arguments)}}const{toString:G7}=Object.prototype,{getPrototypeOf:HT}=Object,{iterator:km,toStringTag:PD}=Symbol,Lm=(zT=Object.create(null),t=>{const e=G7.call(t);return zT[e]||(zT[e]=e.slice(8,-1).toLowerCase())});var zT;const Bs=t=>(t=t.toLowerCase(),e=>Lm(e)===t),Mm=t=>e=>typeof e===t,{isArray:pl}=Array,fh=Mm("undefined"),kD=Bs("ArrayBuffer"),H7=Mm("string"),fr=Mm("function"),LD=Mm("number"),xm=t=>t!==null&&typeof t=="object",Um=t=>{if(Lm(t)!=="object")return!1;const e=HT(t);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||PD in t||km in t)},z7=Bs("Date"),K7=Bs("File"),Y7=Bs("Blob"),q7=Bs("FileList"),X7=Bs("URLSearchParams"),[J7,Q7,Z7,$7]=["ReadableStream","Request","Response","Headers"].map(Bs);function mh(t,e){let n,i,{allOwnKeys:o=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),pl(t))for(n=0,i=t.length;n<i;n++)e.call(null,t[n],n,t);else{const c=o?Object.getOwnPropertyNames(t):Object.keys(t),l=c.length;let u;for(n=0;n<l;n++)u=c[n],e.call(null,t[u],u,t)}}function MD(t,e){e=e.toLowerCase();const n=Object.keys(t);let i,o=n.length;for(;o-- >0;)if(i=n[o],e===i.toLowerCase())return i;return null}const Bc=RD!==void 0?RD:typeof self<"u"?self:typeof window<"u"?window:Pg,xD=t=>!fh(t)&&t!==Bc,tq=(KT=typeof Uint8Array<"u"&&HT(Uint8Array),t=>KT&&t instanceof KT);var KT;const eq=Bs("HTMLFormElement"),UD=(t=>{let{hasOwnProperty:e}=t;return(n,i)=>e.call(n,i)})(Object.prototype),nq=Bs("RegExp"),VD=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),i={};mh(n,(o,c)=>{let l;(l=e(o,c,t))!==!1&&(i[c]=l||o)}),Object.defineProperties(t,i)},iq=Bs("AsyncFunction"),FD=(BD=typeof OD=="function",jD=fr(Bc.postMessage),BD?OD:jD?(YT="axios@".concat(Math.random()),Vm=[],Bc.addEventListener("message",t=>{let{source:e,data:n}=t;e===Bc&&n===YT&&Vm.length&&Vm.shift()()},!1),t=>{Vm.push(t),Bc.postMessage(YT,"*")}):t=>setTimeout(t));var BD,jD,YT,Vm;const rq=ND!==void 0?ND.bind(Bc):typeof process<"u"&&process.nextTick||FD;var mt={isArray:pl,isArrayBuffer:kD,isBuffer:function(t){return t!==null&&!fh(t)&&t.constructor!==null&&!fh(t.constructor)&&fr(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||fr(t.append)&&((e=Lm(t))==="formdata"||e==="object"&&fr(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&kD(t.buffer),e},isString:H7,isNumber:LD,isBoolean:t=>t===!0||t===!1,isObject:xm,isPlainObject:Um,isReadableStream:J7,isRequest:Q7,isResponse:Z7,isHeaders:$7,isUndefined:fh,isDate:z7,isFile:K7,isBlob:Y7,isRegExp:nq,isFunction:fr,isStream:t=>xm(t)&&fr(t.pipe),isURLSearchParams:X7,isTypedArray:tq,isFileList:q7,forEach:mh,merge:function t(){const{caseless:e}=xD(this)&&this||{},n={},i=(o,c)=>{const l=e&&MD(n,c)||c;Um(n[l])&&Um(o)?n[l]=t(n[l],o):Um(o)?n[l]=t({},o):pl(o)?n[l]=o.slice():n[l]=o};for(let o=0,c=arguments.length;o<c;o++)arguments[o]&&mh(arguments[o],i);return n},extend:function(t,e,n){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return mh(e,(o,c)=>{n&&fr(o)?t[c]=DD(o,n):t[c]=o},{allOwnKeys:i}),t},trim:t=>hi(t)?hi(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,e,n,i)=>{t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:(t,e,n,i)=>{let o,c,l;const u={};if(e=e||{},t==null)return e;do{for(o=Object.getOwnPropertyNames(t),c=o.length;c-- >0;)l=o[c],i&&!i(l,t,e)||u[l]||(e[l]=t[l],u[l]=!0);t=n!==!1&&HT(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:Lm,kindOfTest:Bs,endsWith:(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const i=t.indexOf(e,n);return i!==-1&&i===n},toArray:t=>{if(!t)return null;if(pl(t))return t;let e=t.length;if(!LD(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},forEachEntry:(t,e)=>{const n=(t&&t[km]).call(t);let i;for(;(i=n.next())&&!i.done;){const o=i.value;e.call(t,o[0],o[1])}},matchAll:(t,e)=>{let n;const i=[];for(;(n=t.exec(e))!==null;)i.push(n);return i},isHTMLForm:eq,hasOwnProperty:UD,hasOwnProp:UD,reduceDescriptors:VD,freezeMethods:t=>{VD(t,(e,n)=>{if(fr(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=t[n];fr(i)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(t,e)=>{const n={},i=o=>{o.forEach(c=>{n[c]=!0})};return pl(t)?i(t):i(String(t).split(e)),n},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,i){return n.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,findKey:MD,global:Bc,isContextDefined:xD,isSpecCompliantForm:function(t){return!!(t&&fr(t.append)&&t[PD]==="FormData"&&t[km])},toJSONObject:t=>{const e=new Array(10),n=(i,o)=>{if(xm(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[o]=i;const c=pl(i)?[]:{};return mh(i,(l,u)=>{const p=n(l,o+1);!fh(p)&&(c[u]=p)}),e[o]=void 0,c}}return i};return n(t,0)},isAsyncFn:iq,isThenable:t=>t&&(xm(t)||fr(t))&&fr(t.then)&&fr(t.catch),setImmediate:FD,asap:rq,isIterable:t=>t!=null&&fr(t[km])};function Ce(t,e,n,i,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),i&&(this.request=i),o&&(this.response=o,this.status=o.status?o.status:null)}mt.inherits(Ce,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:mt.toJSONObject(this.config),code:this.code,status:this.status}}});const WD=Ce.prototype,GD={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{GD[t]={value:t}}),Object.defineProperties(Ce,GD),Object.defineProperty(WD,"isAxiosError",{value:!0}),Ce.from=(t,e,n,i,o,c)=>{const l=Object.create(WD);return mt.toFlatObject(t,l,function(u){return u!==Error.prototype},u=>u!=="isAxiosError"),Ce.call(l,t.message,e,n,i,o),l.cause=t,l.name=t.name,c&&Object.assign(l,c),l};function qT(t){return mt.isPlainObject(t)||mt.isArray(t)}function HD(t){return mt.endsWith(t,"[]")?t.slice(0,-2):t}function zD(t,e,n){return t?t.concat(e).map(function(i,o){return i=HD(i),!n&&o?"["+i+"]":i}).join(n?".":""):e}const sq=mt.toFlatObject(mt,{},null,function(t){return/^is[A-Z]/.test(t)});function Fm(t,e,n){if(!mt.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const i=(n=mt.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,T){return!mt.isUndefined(T[S])})).metaTokens,o=n.visitor||m,c=n.dots,l=n.indexes,u=(n.Blob||typeof Blob<"u"&&Blob)&&mt.isSpecCompliantForm(e);if(!mt.isFunction(o))throw new TypeError("visitor must be a function");function p(S){if(S===null)return"";if(mt.isDate(S))return S.toISOString();if(!u&&mt.isBlob(S))throw new Ce("Blob is not supported. Use a Buffer instead.");return mt.isArrayBuffer(S)||mt.isTypedArray(S)?u&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function m(S,T,A){let I=S;if(S&&!A&&typeof S=="object"){if(mt.endsWith(T,"{}"))T=i?T:T.slice(0,-2),S=JSON.stringify(S);else if(mt.isArray(S)&&function(w){return mt.isArray(w)&&!w.some(qT)}(S)||(mt.isFileList(S)||mt.endsWith(T,"[]"))&&(I=mt.toArray(S)))return T=HD(T),I.forEach(function(w,P){!mt.isUndefined(w)&&w!==null&&e.append(l===!0?zD([T],P,c):l===null?T:T+"[]",p(w))}),!1}return!!qT(S)||(e.append(zD(A,T,c),p(S)),!1)}const _=[],E=Object.assign(sq,{defaultVisitor:m,convertValue:p,isVisitable:qT});if(!mt.isObject(t))throw new TypeError("data must be an object");return function S(T,A){if(!mt.isUndefined(T)){if(_.indexOf(T)!==-1)throw Error("Circular reference detected in "+A.join("."));_.push(T),mt.forEach(T,function(I,w){(!(mt.isUndefined(I)||I===null)&&o.call(e,I,mt.isString(w)?hi(w).call(w):w,A,E))===!0&&S(I,A?A.concat(w):[w])}),_.pop()}}(t),e}function KD(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function XT(t,e){this._pairs=[],t&&Fm(t,this,e)}const YD=XT.prototype;function oq(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function qD(t,e,n){if(!e)return t;const i=n&&n.encode||oq;mt.isFunction(n)&&(n={serialize:n});const o=n&&n.serialize;let c;if(c=o?o(e,n):mt.isURLSearchParams(e)?e.toString():new XT(e,n).toString(i),c){const l=t.indexOf("#");l!==-1&&(t=t.slice(0,l)),t+=(t.indexOf("?")===-1?"?":"&")+c}return t}YD.append=function(t,e){this._pairs.push([t,e])},YD.toString=function(t){const e=t?function(n){return t.call(this,n,KD)}:KD;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};var XD=class{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){mt.forEach(this.handlers,function(e){e!==null&&t(e)})}},JD={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},QD={exports:{}},aq=ve,cq=Ot,ZD=rs.f;aq({target:"Object",stat:!0,forced:Object.defineProperty!==ZD,sham:!cq},{defineProperty:ZD});var $D=Bi.Object,dq=QD.exports=function(t,e,n){return $D.defineProperty(t,e,n)};$D.defineProperty.sham&&(dq.sham=!0);var tP=h(QD.exports),lq=TypeError,eP=Xu,uq=rm,hq=ri,pq=_n("species"),nP=Array,fq=function(t){var e;return eP(t)&&(e=t.constructor,(uq(e)&&(e===nP||eP(e.prototype))||hq(e)&&(e=e[pq])===null)&&(e=void 0)),e===void 0?nP:e},iP=function(t,e){return new(fq(t))(e===0?0:e)},mq=f,_q=Oc,gq=_n("species"),rP=function(t){return _q>=51||!mq(function(){var e=[];return(e.constructor={})[gq]=function(){return{foo:1}},e[t](Boolean).foo!==1})},Eq=ve,Sq=f,vq=Xu,Tq=ri,yq=fo,Rq=Ra,sP=function(t){if(t>9007199254740991)throw lq("Maximum allowed index exceeded");return t},oP=lT,Cq=iP,bq=rP,Iq=Oc,aP=_n("isConcatSpreadable"),wq=Iq>=51||!Sq(function(){var t=[];return t[aP]=!1,t.concat()[0]!==t}),Aq=function(t){if(!Tq(t))return!1;var e=t[aP];return e!==void 0?!!e:vq(t)};Eq({target:"Array",proto:!0,arity:1,forced:!wq||!bq("concat")},{concat:function(t){var e,n,i,o,c,l=yq(this),u=Cq(l,0),p=0;for(e=-1,i=arguments.length;e<i;e++)if(Aq(c=e===-1?l:arguments[e]))for(o=Rq(c),sP(p+o),n=0;n<o;n++,p++)n in c&&oP(u,p,c[n]);else sP(p+1),oP(u,p++,c);return u.length=p,u}});var cP={},Oq=ft,Nq=Lr,dP=Wf.f,Dq=Ia,lP=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];cP.f=function(t){return lP&&Oq(t)==="Window"?function(e){try{return dP(e)}catch{return Dq(lP)}}(t):dP(Nq(t))};var fl={},Pq=_n;fl.f=Pq;var uP=Bi,kq=si,Lq=fl,Mq=rs.f,Ln=function(t){var e=uP.Symbol||(uP.Symbol={});kq(e,t)||Mq(e,t,{value:Lq.f(t)})},xq=le,Uq=Ai,Vq=_n,Fq=ba,hP=function(){var t=Uq("Symbol"),e=t&&t.prototype,n=e&&e.valueOf,i=Vq("toPrimitive");e&&!e[i]&&Fq(e,i,function(o){return xq(n,this)},{arity:1})},Bq=ya,jq=ur,Wq=fo,Gq=Ra,Hq=iP,pP=k([].push),Pa=function(t){var e=t===1,n=t===2,i=t===3,o=t===4,c=t===6,l=t===7,u=t===5||c;return function(p,m,_,E){for(var S,T,A=Wq(p),I=jq(A),w=Gq(I),P=Bq(m,_),D=0,U=E||Hq,G=e?U(p,w):n||l?U(p,0):void 0;w>D;D++)if((u||D in I)&&(T=P(S=I[D],D,A),t))if(e)G[D]=T;else if(T)switch(t){case 3:return!0;case 5:return S;case 6:return D;case 2:pP(G,S)}else switch(t){case 4:return!1;case 7:pP(G,S)}return c?-1:i||o?o:G}},fP={forEach:Pa(0),map:Pa(1),filter:Pa(2),some:Pa(3),every:Pa(4),find:Pa(5),findIndex:Pa(6),filterReject:Pa(7)},Bm=ve,_h=z,JT=le,zq=k,ml=Ot,_l=Wd,Kq=f,Si=si,Yq=M,QT=er,jm=Lr,ZT=US,qq=pr,$T=hn,gl=Qu,mP=Hf,Xq=Wf,_P=cP,Jq=Ju,gP=xt,EP=rs,Qq=iv,SP=Lt,vP=ba,Zq=im,ty=Hd,TP=Gf,yP=MS,$q=_n,tX=fl,eX=Ln,nX=hP,iX=Ho,RP=Pc,Wm=fP.forEach,mr=jf("hidden"),Gm="Symbol",gh="prototype",rX=RP.set,CP=RP.getterFor(Gm),js=Object[gh],jc=_h.Symbol,Hm=jc&&jc[gh],sX=_h.RangeError,oX=_h.TypeError,ey=_h.QObject,bP=gP.f,Wc=EP.f,IP=_P.f,aX=SP.f,wP=zq([].push),Yo=ty("symbols"),Eh=ty("op-symbols"),cX=ty("wks"),ny=!ey||!ey[gh]||!ey[gh].findChild,AP=function(t,e,n){var i=bP(js,e);i&&delete js[e],Wc(t,e,n),i&&t!==js&&Wc(js,e,i)},iy=ml&&Kq(function(){return gl(Wc({},"a",{get:function(){return Wc(this,"a",{value:7}).a}})).a!==7})?AP:Wc,ry=function(t,e){var n=Yo[t]=gl(Hm);return rX(n,{type:Gm,tag:t,description:e}),ml||(n.description=e),n},zm=function(t,e,n){t===js&&zm(Eh,e,n),QT(t);var i=ZT(e);return QT(n),Si(Yo,i)?(n.enumerable?(Si(t,mr)&&t[mr][i]&&(t[mr][i]=!1),n=gl(n,{enumerable:$T(0,!1)})):(Si(t,mr)||Wc(t,mr,$T(1,gl(null))),t[mr][i]=!0),iy(t,i,n)):Wc(t,i,n)},sy=function(t,e){QT(t);var n=jm(e),i=mP(n).concat(PP(n));return Wm(i,function(o){ml&&!JT(OP,n,o)||zm(t,o,n[o])}),t},OP=function(t){var e=ZT(t),n=JT(aX,this,e);return!(this===js&&Si(Yo,e)&&!Si(Eh,e))&&(!(n||!Si(this,e)||!Si(Yo,e)||Si(this,mr)&&this[mr][e])||n)},NP=function(t,e){var n=jm(t),i=ZT(e);if(n!==js||!Si(Yo,i)||Si(Eh,i)){var o=bP(n,i);return!o||!Si(Yo,i)||Si(n,mr)&&n[mr][i]||(o.enumerable=!0),o}},DP=function(t){var e=IP(jm(t)),n=[];return Wm(e,function(i){Si(Yo,i)||Si(TP,i)||wP(n,i)}),n},PP=function(t){var e=t===js,n=IP(e?Eh:jm(t)),i=[];return Wm(n,function(o){!Si(Yo,o)||e&&!Si(js,o)||wP(i,Yo[o])}),i};_l||(jc=function(){if(Yq(Hm,this))throw new oX("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?qq(arguments[0]):void 0,e=yP(t),n=function(i){var o=this===void 0?_h:this;o===js&&JT(n,Eh,i),Si(o,mr)&&Si(o[mr],e)&&(o[mr][e]=!1);var c=$T(1,i);try{iy(o,e,c)}catch(l){if(!(l instanceof sX))throw l;AP(o,e,c)}};return ml&&ny&&iy(js,e,{configurable:!0,set:n}),ry(e,t)},vP(Hm=jc[gh],"toString",function(){return CP(this).tag}),vP(jc,"withoutSetter",function(t){return ry(yP(t),t)}),SP.f=OP,EP.f=zm,Qq.f=sy,gP.f=NP,Xq.f=_P.f=DP,Jq.f=PP,tX.f=function(t){return ry($q(t),t)},ml&&Zq(Hm,"description",{configurable:!0,get:function(){return CP(this).description}})),Bm({global:!0,constructor:!0,wrap:!0,forced:!_l,sham:!_l},{Symbol:jc}),Wm(mP(cX),function(t){eX(t)}),Bm({target:Gm,stat:!0,forced:!_l},{useSetter:function(){ny=!0},useSimple:function(){ny=!1}}),Bm({target:"Object",stat:!0,forced:!_l,sham:!ml},{create:function(t,e){return e===void 0?gl(t):sy(gl(t),e)},defineProperty:zm,defineProperties:sy,getOwnPropertyDescriptor:NP}),Bm({target:"Object",stat:!0,forced:!_l},{getOwnPropertyNames:DP}),nX(),iX(jc,Gm),TP[mr]=!0;var kP=Wd&&!!Symbol.for&&!!Symbol.keyFor,dX=ve,lX=Ai,uX=si,hX=pr,LP=Hd,pX=kP,oy=LP("string-to-symbol-registry"),fX=LP("symbol-to-string-registry");dX({target:"Symbol",stat:!0,forced:!pX},{for:function(t){var e=hX(t);if(uX(oy,e))return oy[e];var n=lX("Symbol")(e);return oy[e]=n,fX[n]=e,n}});var mX=ve,_X=si,gX=zu,EX=Gd,SX=kP,MP=Hd("symbol-to-string-registry");mX({target:"Symbol",stat:!0,forced:!SX},{keyFor:function(t){if(!gX(t))throw new TypeError(EX(t)+" is not a symbol");if(_X(MP,t))return MP[t]}});var xP=Xu,vX=vt,UP=ft,TX=pr,VP=k([].push),yX=ve,FP=Ai,BP=q,RX=le,Sh=k,jP=f,WP=vt,GP=zu,HP=Ia,CX=function(t){if(vX(t))return t;if(xP(t)){for(var e=t.length,n=[],i=0;i<e;i++){var o=t[i];typeof o=="string"?VP(n,o):typeof o!="number"&&UP(o)!=="Number"&&UP(o)!=="String"||VP(n,TX(o))}var c=n.length,l=!0;return function(u,p){if(l)return l=!1,p;if(xP(this))return p;for(var m=0;m<c;m++)if(n[m]===u)return p}}},bX=Wd,IX=String,ka=FP("JSON","stringify"),Km=Sh(/./.exec),zP=Sh("".charAt),wX=Sh("".charCodeAt),AX=Sh("".replace),OX=Sh(1 .toString),NX=/[\uD800-\uDFFF]/g,KP=/^[\uD800-\uDBFF]$/,YP=/^[\uDC00-\uDFFF]$/,qP=!bX||jP(function(){var t=FP("Symbol")("stringify detection");return ka([t])!=="[null]"||ka({a:t})!=="{}"||ka(Object(t))!=="{}"}),XP=jP(function(){return ka("\uDF06\uD834")!=='"\\udf06\\ud834"'||ka("\uDEAD")!=='"\\udead"'}),DX=function(t,e){var n=HP(arguments),i=CX(e);if(WP(i)||t!==void 0&&!GP(t))return n[1]=function(o,c){if(WP(i)&&(c=RX(i,this,IX(o),c)),!GP(c))return c},BP(ka,null,n)},PX=function(t,e,n){var i=zP(n,e-1),o=zP(n,e+1);return Km(KP,t)&&!Km(YP,o)||Km(YP,t)&&!Km(KP,i)?"\\u"+OX(wX(t,0),16):t};ka&&yX({target:"JSON",stat:!0,arity:3,forced:qP||XP},{stringify:function(t,e,n){var i=HP(arguments),o=BP(qP?DX:ka,null,i);return XP&&typeof o=="string"?AX(o,NX,PX):o}});var JP=Ju,kX=fo;ve({target:"Object",stat:!0,forced:!Wd||f(function(){JP.f(1)})},{getOwnPropertySymbols:function(t){var e=JP.f;return e?e(kX(t)):[]}}),Ln("asyncIterator"),Ln("hasInstance"),Ln("isConcatSpreadable"),Ln("iterator"),Ln("match"),Ln("matchAll"),Ln("replace"),Ln("search"),Ln("species"),Ln("split");var LX=hP;Ln("toPrimitive"),LX();var MX=Ai,xX=Ho;Ln("toStringTag"),xX(MX("Symbol"),"Symbol"),Ln("unscopables"),Ho(z.JSON,"JSON",!0);var UX=Bi.Symbol,VX=_n,FX=rs.f,QP=VX("metadata"),ZP=Function.prototype;ZP[QP]===void 0&&FX(ZP,QP,{value:null}),Ln("asyncDispose"),Ln("dispose"),Ln("metadata");var BX=UX,jX=k,ay=Ai("Symbol"),WX=ay.keyFor,GX=jX(ay.prototype.valueOf),$P=ay.isRegisteredSymbol||function(t){try{return WX(GX(t))!==void 0}catch{return!1}};ve({target:"Symbol",stat:!0},{isRegisteredSymbol:$P});for(var HX=Hd,tk=Ai,zX=k,KX=zu,YX=_n,Ym=tk("Symbol"),ek=Ym.isWellKnownSymbol,nk=tk("Object","getOwnPropertyNames"),qX=zX(Ym.prototype.valueOf),ik=HX("wks"),cy=0,rk=nk(Ym),XX=rk.length;cy<XX;cy++)try{var sk=rk[cy];KX(Ym[sk])&&YX(sk)}catch{}var ok=function(t){if(ek&&ek(t))return!0;try{for(var e=qX(t),n=0,i=nk(ik),o=i.length;n<o;n++)if(ik[i[n]]==e)return!0}catch{}return!1};ve({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:ok}),Ln("customMatcher"),Ln("observable"),ve({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:$P}),ve({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:ok}),Ln("matcher"),Ln("metadataKey"),Ln("patternMatch"),Ln("replaceAll");var El=h(BX),ak=h(fl.f("iterator"));function vh(t){return vh=typeof El=="function"&&typeof ak=="symbol"?function(e){return typeof e}:function(e){return e&&typeof El=="function"&&e.constructor===El&&e!==El.prototype?"symbol":typeof e},vh(t)}var JX=h(fl.f("toPrimitive"));function QX(t){var e=function(n,i){if(vh(n)!="object"||!n)return n;var o=n[JX];if(o!==void 0){var c=o.call(n,i||"default");if(vh(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}(t,"string");return vh(e)=="symbol"?e:e+""}function N(t,e,n){return(e=QX(e))in t?tP(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ck=h($Y),ZX={isBrowser:!0,classes:{URLSearchParams:ck!==void 0?ck:XT,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const dy=typeof window<"u"&&typeof document<"u",ly=typeof navigator=="object"&&navigator||void 0,$X=dy&&(!ly||["ReactNative","NativeScript","NS"].indexOf(ly.product)<0),tJ=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",eJ=dy&&window.location.href||"http://localhost";function dk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function lk(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?dk(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):dk(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var ji=lk(lk({},Object.freeze({__proto__:null,hasBrowserEnv:dy,hasStandardBrowserEnv:$X,hasStandardBrowserWebWorkerEnv:tJ,navigator:ly,origin:eJ})),ZX),nJ=er,iJ=le,rJ=si,sJ=M,oJ=function(){var t=nJ(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},uk=RegExp.prototype,hk=function(t){var e=t.flags;return e!==void 0||"flags"in uk||rJ(t,"flags")||!sJ(uk,t)?e:iJ(oJ,t)},aJ=Jv.charAt,pk=le,cJ=er,dJ=vt,lJ=ft,uJ=/./.exec,hJ=TypeError,pJ=ve,fk=le,mk=At,fJ=gv,qm=em,_k=Fi,gk=mw,Th=pr,mJ=er,_J=ri,gJ=ft,EJ=gw,Ek=hk,SJ=Mf,vJ=f,TJ=Rv,yJ=function(t,e,n){return e+(n?aJ(t,e).length:1)},RJ=function(t,e){var n=t.exec;if(dJ(n)){var i=pk(n,t,e);return i!==null&&cJ(i),i}if(lJ(t)==="RegExp")return pk(uJ,t,e);throw new hJ("RegExp#exec called on incompatible receiver")},Sk=Pc,CJ=_n("matchAll"),vk="RegExp String",Tk=vk+" Iterator",bJ=Sk.set,IJ=Sk.getterFor(Tk),wJ=TypeError,uy=mk("".indexOf),Xm=mk("".matchAll),hy=!!Xm&&!vJ(function(){Xm("a",/./)}),AJ=fJ(function(t,e,n,i){bJ(this,{type:Tk,regexp:t,string:e,global:n,unicode:i,done:!1})},vk,function(){var t=IJ(this);if(t.done)return qm(void 0,!0);var e=t.regexp,n=t.string,i=RJ(e,n);return i===null?(t.done=!0,qm(void 0,!0)):t.global?(Th(i[0])===""&&(e.lastIndex=yJ(n,gk(e.lastIndex),t.unicode)),qm(i,!1)):(t.done=!0,qm(i,!1))}),yk=function(t){var e,n,i,o=mJ(this),c=Th(t),l=TJ(o,RegExp),u=Th(Ek(o));return e=new l(l===RegExp?o.source:o,u),n=!!~uy(u,"g"),i=!!~uy(u,"u"),e.lastIndex=gk(o.lastIndex),new AJ(e,c,n,i)};pJ({target:"String",proto:!0,forced:hy},{matchAll:function(t){var e,n,i,o,c=_k(this);if(_J(t)){if(EJ(t)&&(e=Th(_k(Ek(t))),!~uy(e,"g")))throw new wJ("`.matchAll` does not allow non-global regexes");if(hy)return Xm(c,t);if((i=SJ(t,CJ))===void 0&&gJ(t)==="RegExp"&&(i=yk),i)return fk(i,t,c)}else if(hy)return Xm(c,t);return n=Th(c),o=new RegExp(t,"g"),fk(yk,o,n)}});var OJ=ss("String","matchAll"),NJ=M,DJ=OJ,py=String.prototype,PJ=function(t){var e=t.matchAll;return typeof t=="string"||t===py||NJ(py,t)&&e===py.matchAll?DJ:e},kJ=h(PJ);function Rk(t){function e(n,i,o,c){let l=n[c++];if(l==="__proto__")return!0;const u=Number.isFinite(+l),p=c>=n.length;return l=!l&&mt.isArray(o)?o.length:l,p?(mt.hasOwnProp(o,l)?o[l]=[o[l],i]:o[l]=i,!u):(o[l]&&mt.isObject(o[l])||(o[l]=[]),e(n,i,o[l],c)&&mt.isArray(o[l])&&(o[l]=function(m){const _={},E=Object.keys(m);let S;const T=E.length;let A;for(S=0;S<T;S++)A=E[S],_[A]=m[A];return _}(o[l])),!u)}if(mt.isFormData(t)&&mt.isFunction(t.entries)){const n={};return mt.forEachEntry(t,(i,o)=>{e(function(c){return kJ(mt).call(mt,/\w+|\[(\w*)]/g,c).map(l=>l[0]==="[]"?"":l[1]||l[0])}(i),o,n,0)}),n}return null}const fy={transitional:JD,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const n=e.getContentType()||"",i=n.indexOf("application/json")>-1,o=mt.isObject(t);if(o&&mt.isHTMLForm(t)&&(t=new FormData(t)),mt.isFormData(t))return i?JSON.stringify(Rk(t)):t;if(mt.isArrayBuffer(t)||mt.isBuffer(t)||mt.isStream(t)||mt.isFile(t)||mt.isBlob(t)||mt.isReadableStream(t))return t;if(mt.isArrayBufferView(t))return t.buffer;if(mt.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let c;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(l,u){return Fm(l,new ji.classes.URLSearchParams,Object.assign({visitor:function(p,m,_,E){return ji.isNode&&mt.isBuffer(p)?(this.append(m,p.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)}},u))}(t,this.formSerializer).toString();if((c=mt.isFileList(t))||n.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return Fm(c?{"files[]":t}:t,l&&new l,this.formSerializer)}}return o||i?(e.setContentType("application/json",!1),function(l,u,p){if(mt.isString(l))try{return(u||JSON.parse)(l),hi(mt).call(mt,l)}catch(m){if(m.name!=="SyntaxError")throw m}return(p||JSON.stringify)(l)}(t)):t}],transformResponse:[function(t){const e=this.transitional||fy.transitional,n=e&&e.forcedJSONParsing,i=this.responseType==="json";if(mt.isResponse(t)||mt.isReadableStream(t))return t;if(t&&mt.isString(t)&&(n&&!this.responseType||i)){const o=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(c){if(o)throw c.name==="SyntaxError"?Ce.from(c,Ce.ERR_BAD_RESPONSE,this,null,this.response):c}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ji.classes.FormData,Blob:ji.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};mt.forEach(["delete","get","head","post","put","patch"],t=>{fy.headers[t]={}});var my=fy;const LJ=mt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ck=Symbol("internals");function yh(t){var e;return t&&hi(e=String(t)).call(e).toLowerCase()}function Jm(t){return t===!1||t==null?t:mt.isArray(t)?t.map(Jm):String(t)}function _y(t,e,n,i,o){return mt.isFunction(i)?i.call(this,e,n):(o&&(e=n),mt.isString(e)?mt.isString(i)?e.indexOf(i)!==-1:mt.isRegExp(i)?i.test(e):void 0:void 0)}class Qm{constructor(e){e&&this.set(e)}set(e,n,i){const o=this;function c(p,m,_){const E=yh(m);if(!E)throw new Error("header name must be a non-empty string");const S=mt.findKey(o,E);(!S||o[S]===void 0||_===!0||_===void 0&&o[S]!==!1)&&(o[S||m]=Jm(p))}const l=(p,m)=>mt.forEach(p,(_,E)=>c(_,E,m));if(mt.isPlainObject(e)||e instanceof this.constructor)l(e,n);else if(mt.isString(e)&&(e=hi(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(hi(u=e).call(u)))l((p=>{const m={};let _,E,S;return p&&p.split(`
`).forEach(function(T){var A,I;S=T.indexOf(":"),_=hi(A=T.substring(0,S)).call(A).toLowerCase(),E=hi(I=T.substring(S+1)).call(I),!_||m[_]&&LJ[_]||(_==="set-cookie"?m[_]?m[_].push(E):m[_]=[E]:m[_]=m[_]?m[_]+", "+E:E)}),m})(e),n);else if(mt.isObject(e)&&mt.isIterable(e)){let p,m,_={};for(const E of e){if(!mt.isArray(E))throw TypeError("Object iterator must return a key-value pair");_[m=E[0]]=(p=_[m])?mt.isArray(p)?[...p,E[1]]:[p,E[1]]:E[1]}l(_,n)}else e!=null&&c(n,e,i);var u;return this}get(e,n){if(e=yh(e)){const i=mt.findKey(this,e);if(i){const o=this[i];if(!n)return o;if(n===!0)return function(c){const l=Object.create(null),u=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let p;for(;p=u.exec(c);)l[p[1]]=p[2];return l}(o);if(mt.isFunction(n))return n.call(this,o,i);if(mt.isRegExp(n))return n.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=yh(e)){const i=mt.findKey(this,e);return!(!i||this[i]===void 0||n&&!_y(0,this[i],i,n))}return!1}delete(e,n){const i=this;let o=!1;function c(l){if(l=yh(l)){const u=mt.findKey(i,l);!u||n&&!_y(0,i[u],u,n)||(delete i[u],o=!0)}}return mt.isArray(e)?e.forEach(c):c(e),o}clear(e){const n=Object.keys(this);let i=n.length,o=!1;for(;i--;){const c=n[i];e&&!_y(0,this[c],c,e,!0)||(delete this[c],o=!0)}return o}normalize(e){const n=this,i={};return mt.forEach(this,(o,c)=>{var l;const u=mt.findKey(i,c);if(u)return n[u]=Jm(o),void delete n[c];const p=e?function(m){return hi(m).call(m).toLowerCase().replace(/([a-z\d])(\w*)/g,(_,E,S)=>E.toUpperCase()+S)}(c):hi(l=String(c)).call(l);p!==c&&delete n[c],n[p]=Jm(o),i[p]=!0}),this}concat(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(e){const n=Object.create(null);return mt.forEach(this,(i,o)=>{i!=null&&i!==!1&&(n[o]=e&&mt.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[n,i]=e;return n+": "+i}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const n=new this(e);for(var i=arguments.length,o=new Array(i>1?i-1:0),c=1;c<i;c++)o[c-1]=arguments[c];return o.forEach(l=>n.set(l)),n}static accessor(e){const n=(this[Ck]=this[Ck]={accessors:{}}).accessors,i=this.prototype;function o(c){const l=yh(c);n[l]||(function(u,p){const m=mt.toCamelCase(" "+p);["get","set","has"].forEach(_=>{Object.defineProperty(u,_+m,{value:function(E,S,T){return this[_].call(this,p,E,S,T)},configurable:!0})})}(i,c),n[l]=!0)}return mt.isArray(e)?e.forEach(o):o(e),this}}Qm.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),mt.reduceDescriptors(Qm.prototype,(t,e)=>{let{value:n}=t,i=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(o){this[i]=o}}}),mt.freezeMethods(Qm);var Ws=Qm;function gy(t,e){const n=this||my,i=e||n,o=Ws.from(i.headers);let c=i.data;return mt.forEach(t,function(l){c=l.call(n,c,o.normalize(),e?e.status:void 0)}),o.normalize(),c}function bk(t){return!(!t||!t.__CANCEL__)}function Sl(t,e,n){Ce.call(this,t??"canceled",Ce.ERR_CANCELED,e,n),this.name="CanceledError"}function Ik(t,e,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?e(new Ce("Request failed with status code "+n.status,[Ce.ERR_BAD_REQUEST,Ce.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):t(n)}mt.inherits(Sl,Ce,{__CANCEL__:!0});const Zm=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const o=function(c,l){c=c||10;const u=new Array(c),p=new Array(c);let m,_=0,E=0;return l=l!==void 0?l:1e3,function(S){const T=Date.now(),A=p[E];m||(m=T),u[_]=S,p[_]=T;let I=E,w=0;for(;I!==_;)w+=u[I++],I%=c;if(_=(_+1)%c,_===E&&(E=(E+1)%c),T-m<l)return;const P=A&&T-A;return P?Math.round(1e3*w/P):void 0}}(50,250);return function(c,l){let u,p,m=0,_=1e3/l;const E=function(S){m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),u=null,p&&(clearTimeout(p),p=null),c.apply(null,S)};return[function(){const S=Date.now(),T=S-m;for(var A=arguments.length,I=new Array(A),w=0;w<A;w++)I[w]=arguments[w];T>=_?E(I,S):(u=I,p||(p=setTimeout(()=>{p=null,E(u)},_-T)))},()=>u&&E(u)]}(c=>{const l=c.loaded,u=c.lengthComputable?c.total:void 0,p=l-i,m=o(p);i=l,t({loaded:l,total:u,progress:u?l/u:void 0,bytes:p,rate:m||void 0,estimated:m&&u&&l<=u?(u-l)/m:void 0,event:c,lengthComputable:u!=null,[e?"download":"upload"]:!0})},n)},wk=(t,e)=>{const n=t!=null;return[i=>e[0]({lengthComputable:n,total:t,loaded:i}),e[1]]},Ak=t=>function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return mt.asap(()=>t(...n))};var MJ=ji.hasStandardBrowserEnv?((t,e)=>n=>(n=new Im(n,ji.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new Im(ji.origin),ji.navigator&&/(msie|trident)/i.test(ji.navigator.userAgent)):()=>!0,xJ=ji.hasStandardBrowserEnv?{write(t,e,n,i,o,c){const l=[t+"="+encodeURIComponent(e)];mt.isNumber(n)&&l.push("expires="+new Date(n).toGMTString()),mt.isString(i)&&l.push("path="+i),mt.isString(o)&&l.push("domain="+o),c===!0&&l.push("secure"),document.cookie=l.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Ok(t,e,n){let i=!function(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}(e);return t&&(i||n==0)?function(o,c){return c?o.replace(/\/?\/$/,"")+"/"+c.replace(/^\/+/,""):o}(t,e):e}function Nk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}const Dk=t=>t instanceof Ws?function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Nk(Object(i),!0).forEach(function(o){N(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Nk(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}({},t):t;function Gc(t,e){e=e||{};const n={};function i(m,_,E,S){return mt.isPlainObject(m)&&mt.isPlainObject(_)?mt.merge.call({caseless:S},m,_):mt.isPlainObject(_)?mt.merge({},_):mt.isArray(_)?_.slice():_}function o(m,_,E,S){return mt.isUndefined(_)?mt.isUndefined(m)?void 0:i(void 0,m,0,S):i(m,_,0,S)}function c(m,_){if(!mt.isUndefined(_))return i(void 0,_)}function l(m,_){return mt.isUndefined(_)?mt.isUndefined(m)?void 0:i(void 0,m):i(void 0,_)}function u(m,_,E){return E in e?i(m,_):E in t?i(void 0,m):void 0}const p={url:c,method:c,data:c,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:u,headers:(m,_,E)=>o(Dk(m),Dk(_),0,!0)};return mt.forEach(Object.keys(Object.assign({},t,e)),function(m){const _=p[m]||o,E=_(t[m],e[m],m);mt.isUndefined(E)&&_!==u||(n[m]=E)}),n}var Pk=t=>{const e=Gc({},t);let n,{data:i,withXSRFToken:o,xsrfHeaderName:c,xsrfCookieName:l,headers:u,auth:p}=e;if(e.headers=u=Ws.from(u),e.url=qD(Ok(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),p&&u.set("Authorization","Basic "+btoa((p.username||"")+":"+(p.password?unescape(encodeURIComponent(p.password)):""))),mt.isFormData(i)){if(ji.hasStandardBrowserEnv||ji.hasStandardBrowserWebWorkerEnv)u.setContentType(void 0);else if((n=u.getContentType())!==!1){const[m,..._]=n?n.split(";").map(E=>hi(E).call(E)).filter(Boolean):[];u.setContentType([m||"multipart/form-data",..._].join("; "))}}if(ji.hasStandardBrowserEnv&&(o&&mt.isFunction(o)&&(o=o(e)),o||o!==!1&&MJ(e.url))){const m=c&&l&&xJ.read(l);m&&u.set(c,m)}return e},UJ=typeof XMLHttpRequest<"u"&&function(t){return new gt(function(e,n){const i=Pk(t);let o=i.data;const c=Ws.from(i.headers).normalize();let l,u,p,m,_,{responseType:E,onUploadProgress:S,onDownloadProgress:T}=i;function A(){m&&m(),_&&_(),i.cancelToken&&i.cancelToken.unsubscribe(l),i.signal&&i.signal.removeEventListener("abort",l)}let I=new XMLHttpRequest;function w(){if(!I)return;const D=Ws.from("getAllResponseHeaders"in I&&I.getAllResponseHeaders());Ik(function(U){e(U),A()},function(U){n(U),A()},{data:E&&E!=="text"&&E!=="json"?I.response:I.responseText,status:I.status,statusText:I.statusText,headers:D,config:t,request:I}),I=null}I.open(i.method.toUpperCase(),i.url,!0),I.timeout=i.timeout,"onloadend"in I?I.onloadend=w:I.onreadystatechange=function(){I&&I.readyState===4&&(I.status!==0||I.responseURL&&I.responseURL.indexOf("file:")===0)&&setTimeout(w)},I.onabort=function(){I&&(n(new Ce("Request aborted",Ce.ECONNABORTED,t,I)),I=null)},I.onerror=function(){n(new Ce("Network Error",Ce.ERR_NETWORK,t,I)),I=null},I.ontimeout=function(){let D=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const U=i.transitional||JD;i.timeoutErrorMessage&&(D=i.timeoutErrorMessage),n(new Ce(D,U.clarifyTimeoutError?Ce.ETIMEDOUT:Ce.ECONNABORTED,t,I)),I=null},o===void 0&&c.setContentType(null),"setRequestHeader"in I&&mt.forEach(c.toJSON(),function(D,U){I.setRequestHeader(U,D)}),mt.isUndefined(i.withCredentials)||(I.withCredentials=!!i.withCredentials),E&&E!=="json"&&(I.responseType=i.responseType),T&&([p,_]=Zm(T,!0),I.addEventListener("progress",p)),S&&I.upload&&([u,m]=Zm(S),I.upload.addEventListener("progress",u),I.upload.addEventListener("loadend",m)),(i.cancelToken||i.signal)&&(l=D=>{I&&(n(!D||D.type?new Sl(null,t,I):D),I.abort(),I=null)},i.cancelToken&&i.cancelToken.subscribe(l),i.signal&&(i.signal.aborted?l():i.signal.addEventListener("abort",l)));const P=function(D){const U=/^([-+\w]{1,25})(:?\/\/|:)/.exec(D);return U&&U[1]||""}(i.url);P&&ji.protocols.indexOf(P)===-1?n(new Ce("Unsupported protocol "+P+":",Ce.ERR_BAD_REQUEST,t)):I.send(o||null)})},VJ=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let i,o=new AbortController;const c=function(m){if(!i){i=!0,u();const _=m instanceof Error?m:this.reason;o.abort(_ instanceof Ce?_:new Sl(_ instanceof Error?_.message:_))}};let l=e&&setTimeout(()=>{l=null,c(new Ce("timeout ".concat(e," of ms exceeded"),Ce.ETIMEDOUT))},e);const u=()=>{t&&(l&&clearTimeout(l),l=null,t.forEach(m=>{m.unsubscribe?m.unsubscribe(c):m.removeEventListener("abort",c)}),t=null)};t.forEach(m=>m.addEventListener("abort",c));const{signal:p}=o;return p.unsubscribe=()=>mt.asap(u),p}},Ey=h(SO),kk=fl.f("asyncIterator"),FJ=h(kk);function Sy(t,e){this.v=t,this.k=e}function xr(t){return function(){return new Rh(t.apply(this,arguments))}}function Rh(t){var e,n;function i(c,l){try{var u=t[c](l),p=u.value,m=p instanceof Sy;Ey.resolve(m?p.v:p).then(function(_){if(m){var E=c==="return"?"return":"next";if(!p.k||_.done)return i(E,_);_=t[E](_).value}o(u.done?"return":"normal",_)},function(_){i("throw",_)})}catch(_){o("throw",_)}}function o(c,l){switch(c){case"return":e.resolve({value:l,done:!0});break;case"throw":e.reject(l);break;default:e.resolve({value:l,done:!1})}(e=e.next)?i(e.key,e.arg):n=null}this._invoke=function(c,l){return new Ey(function(u,p){var m={key:c,arg:l,resolve:u,reject:p,next:null};n?n=n.next=m:(e=n=m,i(c,l))})},typeof t.return!="function"&&(this.return=void 0)}function oe(t){return new Sy(t,0)}function $m(t){var e={},n=!1;function i(o,c){return n=!0,c=new Ey(function(l){l(t[o](c))}),{done:!1,value:new Sy(c,1)}}return e[El!==void 0&&ak||"@@iterator"]=function(){return this},e.next=function(o){return n?(n=!1,o):i("next",o)},typeof t.throw=="function"&&(e.throw=function(o){if(n)throw n=!1,o;return i("throw",o)}),typeof t.return=="function"&&(e.return=function(o){return n?(n=!1,o):i("return",o)}),e}Rh.prototype[typeof El=="function"&&FJ||"@@asyncIterator"]=function(){return this},Rh.prototype.next=function(t){return this._invoke("next",t)},Rh.prototype.throw=function(t){return this._invoke("throw",t)},Rh.prototype.return=function(t){return this._invoke("return",t)};var vy=h(kk);function Ty(t){var e,n,i,o=2;for(typeof Symbol<"u"&&(n=vy,i=Symbol.iterator);o--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new t_(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function t_(t){function e(n){if(Object(n)!==n)return gt.reject(new TypeError(n+" is not an object."));var i=n.done;return gt.resolve(n.value).then(function(o){return{value:o,done:i}})}return t_=function(n){this.s=n,this.n=n.next},t_.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?gt.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?gt.reject(n):e(i.apply(this.s,arguments))}},new t_(t)}const BJ=function*(t,e){let n=t.byteLength;if(!e||n<e)return void(yield t);let i,o=0;for(;o<n;)i=o+e,yield t.slice(o,i),o=i},jJ=function(){var t=xr(function*(e,n){var i,o=!1,c=!1;try{for(var l,u=Ty(WJ(e));o=!(l=yield oe(u.next())).done;o=!1){const p=l.value;yield*$m(Ty(BJ(p,n)))}}catch(p){c=!0,i=p}finally{try{o&&u.return!=null&&(yield oe(u.return()))}finally{if(c)throw i}}});return function(e,n){return t.apply(this,arguments)}}(),WJ=function(){var t=xr(function*(e){if(e[vy])return void(yield*$m(Ty(e)));const n=e.getReader();try{for(;;){const{done:i,value:o}=yield oe(n.read());if(i)break;yield o}}finally{yield oe(n.cancel())}});return function(e){return t.apply(this,arguments)}}(),Lk=(t,e,n,i)=>{const o=jJ(t,e);let c,l=0,u=p=>{c||(c=!0,i&&i(p))};return new ReadableStream({async pull(p){try{const{done:m,value:_}=await o.next();if(m)return u(),void p.close();let E=_.byteLength;if(n){let S=l+=E;n(S)}p.enqueue(new Uint8Array(_))}catch(m){throw u(m),m}},cancel:p=>(u(p),o.return())},{highWaterMark:2})};function Mk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function xk(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Mk(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Mk(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const e_=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Uk=e_&&typeof ReadableStream=="function",GJ=e_&&(typeof TextEncoder=="function"?(Vk=new TextEncoder,t=>Vk.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var Vk;const Fk=function(t){try{for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return!!t(...n)}catch{return!1}},HJ=Uk&&Fk(()=>{let t=!1;const e=new Request(ji.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),yy=Uk&&Fk(()=>mt.isReadableStream(new Response("").body)),n_={stream:yy&&(t=>t.body)};var Bk;e_&&(Bk=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!n_[t]&&(n_[t]=mt.isFunction(Bk[t])?e=>e[t]():(e,n)=>{throw new Ce("Response type '".concat(t,"' is not supported"),Ce.ERR_NOT_SUPPORT,n)})}));const zJ=async(t,e)=>{const n=mt.toFiniteNumber(t.getContentLength());return n??(async i=>i==null?0:mt.isBlob(i)?i.size:mt.isSpecCompliantForm(i)?(await new Request(ji.origin,{method:"POST",body:i}).arrayBuffer()).byteLength:mt.isArrayBufferView(i)||mt.isArrayBuffer(i)?i.byteLength:(mt.isURLSearchParams(i)&&(i+=""),mt.isString(i)?(await GJ(i)).byteLength:void 0))(e)};var KJ=e_&&(async t=>{let{url:e,method:n,data:i,signal:o,cancelToken:c,timeout:l,onDownloadProgress:u,onUploadProgress:p,responseType:m,headers:_,withCredentials:E="same-origin",fetchOptions:S}=Pk(t);m=m?(m+"").toLowerCase():"text";let T,A=VJ([o,c&&c.toAbortSignal()],l);const I=A&&A.unsubscribe&&(()=>{A.unsubscribe()});let w;try{if(p&&HJ&&n!=="get"&&n!=="head"&&(w=await zJ(_,i))!==0){let W,F=new Request(e,{method:"POST",body:i,duplex:"half"});if(mt.isFormData(i)&&(W=F.headers.get("content-type"))&&_.setContentType(W),F.body){const[X,tt]=wk(w,Zm(Ak(p)));i=Lk(F.body,65536,X,tt)}}mt.isString(E)||(E=E?"include":"omit");const P="credentials"in Request.prototype;T=new Request(e,xk(xk({},S),{},{signal:A,method:n.toUpperCase(),headers:_.normalize().toJSON(),body:i,duplex:"half",credentials:P?E:void 0}));let D=await fetch(T);const U=yy&&(m==="stream"||m==="response");if(yy&&(u||U&&I)){const W={};["status","statusText","headers"].forEach(nt=>{W[nt]=D[nt]});const F=mt.toFiniteNumber(D.headers.get("content-length")),[X,tt]=u&&wk(F,Zm(Ak(u),!0))||[];D=new Response(Lk(D.body,65536,X,()=>{tt&&tt(),I&&I()}),W)}m=m||"text";let G=await n_[mt.findKey(n_,m)||"text"](D,t);return!U&&I&&I(),await new gt((W,F)=>{Ik(W,F,{data:G,headers:Ws.from(D.headers),status:D.status,statusText:D.statusText,config:t,request:T})})}catch(P){throw I&&I(),P&&P.name==="TypeError"&&/Load failed|fetch/i.test(P.message)?Object.assign(new Ce("Network Error",Ce.ERR_NETWORK,t,T),{cause:P.cause||P}):Ce.from(P,P&&P.code,t,T)}});const Ry={http:null,xhr:UJ,fetch:KJ};mt.forEach(Ry,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const jk=t=>"- ".concat(t),YJ=t=>mt.isFunction(t)||t===null||t===!1;var Wk={getAdapter:t=>{t=mt.isArray(t)?t:[t];const{length:e}=t;let n,i;const o={};for(let c=0;c<e;c++){let l;if(n=t[c],i=n,!YJ(n)&&(i=Ry[(l=String(n)).toLowerCase()],i===void 0))throw new Ce("Unknown adapter '".concat(l,"'"));if(i)break;o[l||"#"+c]=i}if(!i){const c=Object.entries(o).map(l=>{let[u,p]=l;return"adapter ".concat(u," ")+(p===!1?"is not supported by the environment":"is not available in the build")});throw new Ce("There is no suitable adapter to dispatch the request "+(e?c.length>1?`since :
`+c.map(jk).join(`
`):" "+jk(c[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:Ry};function Cy(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Sl(null,t)}function Gk(t){return Cy(t),t.headers=Ws.from(t.headers),t.data=gy.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Wk.getAdapter(t.adapter||my.adapter)(t).then(function(e){return Cy(t),e.data=gy.call(t,t.transformResponse,e),e.headers=Ws.from(e.headers),e},function(e){return bk(e)||(Cy(t),e&&e.response&&(e.response.data=gy.call(t,t.transformResponse,e.response),e.response.headers=Ws.from(e.response.headers))),gt.reject(e)})}const Hk="1.9.0",i_={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{i_[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const zk={};i_.transitional=function(t,e,n){function i(o,c){return"[Axios v"+Hk+"] Transitional option '"+o+"'"+c+(n?". "+n:"")}return(o,c,l)=>{if(t===!1)throw new Ce(i(c," has been removed"+(e?" in "+e:"")),Ce.ERR_DEPRECATED);return e&&!zk[c]&&(zk[c]=!0,console.warn(i(c," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(o,c,l)}},i_.spelling=function(t){return(e,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(t)),!0)};var r_={assertOptions:function(t,e,n){if(typeof t!="object")throw new Ce("options must be an object",Ce.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let o=i.length;for(;o-- >0;){const c=i[o],l=e[c];if(l){const u=t[c],p=u===void 0||l(u,c,t);if(p!==!0)throw new Ce("option "+c+" must be "+p,Ce.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new Ce("Unknown option "+c,Ce.ERR_BAD_OPTION)}},validators:i_};const Eo=r_.validators;let s_=class{constructor(t){this.defaults=t||{},this.interceptors={request:new XD,response:new XD}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const o=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?o&&!String(n.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+o):n.stack=o}catch{}}throw n}}_request(t,e){typeof t=="string"?(e=e||{}).url=t:e=t||{},e=Gc(this.defaults,e);const{transitional:n,paramsSerializer:i,headers:o}=e;n!==void 0&&r_.assertOptions(n,{silentJSONParsing:Eo.transitional(Eo.boolean),forcedJSONParsing:Eo.transitional(Eo.boolean),clarifyTimeoutError:Eo.transitional(Eo.boolean)},!1),i!=null&&(mt.isFunction(i)?e.paramsSerializer={serialize:i}:r_.assertOptions(i,{encode:Eo.function,serialize:Eo.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),r_.assertOptions(e,{baseUrl:Eo.spelling("baseURL"),withXsrfToken:Eo.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let c=o&&mt.merge(o.common,o[e.method]);o&&mt.forEach(["delete","get","head","post","put","patch","common"],T=>{delete o[T]}),e.headers=Ws.concat(c,o);const l=[];let u=!0;this.interceptors.request.forEach(function(T){typeof T.runWhen=="function"&&T.runWhen(e)===!1||(u=u&&T.synchronous,l.unshift(T.fulfilled,T.rejected))});const p=[];let m;this.interceptors.response.forEach(function(T){p.push(T.fulfilled,T.rejected)});let _,E=0;if(!u){const T=[Gk.bind(this),void 0];for(T.unshift.apply(T,l),T.push.apply(T,p),_=T.length,m=gt.resolve(e);E<_;)m=m.then(T[E++],T[E++]);return m}_=l.length;let S=e;for(E=0;E<_;){const T=l[E++],A=l[E++];try{S=T(S)}catch(I){A.call(this,I);break}}try{m=Gk.call(this,S)}catch(T){return gt.reject(T)}for(E=0,_=p.length;E<_;)m=m.then(p[E++],p[E++]);return m}getUri(t){return qD(Ok((t=Gc(this.defaults,t)).baseURL,t.url,t.allowAbsoluteUrls),t.params,t.paramsSerializer)}};mt.forEach(["delete","get","head","options"],function(t){s_.prototype[t]=function(e,n){return this.request(Gc(n||{},{method:t,url:e,data:(n||{}).data}))}}),mt.forEach(["post","put","patch"],function(t){function e(n){return function(i,o,c){return this.request(Gc(c||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}s_.prototype[t]=e(),s_.prototype[t+"Form"]=e(!0)});var o_=s_;class by{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new gt(function(o){n=o});const i=this;this.promise.then(o=>{if(!i._listeners)return;let c=i._listeners.length;for(;c-- >0;)i._listeners[c](o);i._listeners=null}),this.promise.then=o=>{let c;const l=new gt(u=>{i.subscribe(u),c=u}).then(o);return l.cancel=function(){i.unsubscribe(c)},l},e(function(o,c,l){i.reason||(i.reason=new Sl(o,c,l),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=i=>{e.abort(i)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new by(function(i){e=i}),cancel:e}}}var qJ=by;const Iy={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Iy).forEach(t=>{let[e,n]=t;Iy[n]=e});var XJ=Iy;const oi=function t(e){const n=new o_(e),i=DD(o_.prototype.request,n);return mt.extend(i,o_.prototype,n,{allOwnKeys:!0}),mt.extend(i,n,null,{allOwnKeys:!0}),i.create=function(o){return t(Gc(e,o))},i}(my);oi.Axios=o_,oi.CanceledError=Sl,oi.CancelToken=qJ,oi.isCancel=bk,oi.VERSION=Hk,oi.toFormData=Fm,oi.AxiosError=Ce,oi.Cancel=oi.CanceledError,oi.all=function(t){return gt.all(t)},oi.spread=function(t){return function(e){return t.apply(null,e)}},oi.isAxiosError=function(t){return mt.isObject(t)&&t.isAxiosError===!0},oi.mergeConfig=Gc,oi.AxiosHeaders=Ws,oi.formToJSON=t=>Rk(mt.isHTMLForm(t)?new FormData(t):t),oi.getAdapter=Wk.getAdapter,oi.HttpStatusCode=XJ,oi.default=oi;var Oi=oi;const JJ=()=>{};function Ch(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:JJ};return t.promise=new gt((e,n)=>{t.resolve=i=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,e(i),t.value=i)},t.reject=i=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,n(i))}}),t}const a_=new Map,c_=new Map,So=new Map;let bn=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),ue=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const wy=new w7;let Gs=wy.getResult(),Ay=null;function ie(t){if(!Ay){t&&wy.setUA(t),Gs=wy.getResult();const e=function(u){if(u.engine.name==="Blink"&&u.browser.name!=="WeChat")return ue.CHROME;switch(u.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return ue.CHROME;case"Safari":case"Mobile Safari":return ue.SAFARI;case"Edge":return ue.EDGE;case"Firefox":return ue.FIREFOX;case"QQ":case"QQBrowser":return ue.QQ;case"Opera":return ue.OPERA;case"WeChat":return ue.WECHAT;default:return u.browser.name||""}}(Gs),n=Kk(Gs),i=function(u){return u.os.name==="Windows"?u.os.version?u.os.name+" "+u.os.version:u.os.name:u.os.name||""}(Gs),o=Gs.os.version,c=Kk(Gs,!1),l=Gs.device.type;if(!(e&&n&&i&&o))return{name:e,version:n,os:i,osVersion:o,browserVersion:c,deviceType:l};Ay={name:e,version:n,os:i,osVersion:o,browserVersion:c,deviceType:l}}return Ay}function Kk(t){let e,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return e=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",n?e.split(".")[0]:e}function d_(){return ie().os}function Yk(){const t=ie();return"".concat(t.os," ").concat(t.osVersion)}function l_(){const t=ie();return!!(Gs.engine.name==="WebKit"&&t.os===bn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==ue.SAFARI||ai()&&t.name!==ue.SAFARI)}function qo(){return ie().name===ue.CHROME}function Hn(){return ie().name===ue.SAFARI}function qk(){const t=ie();if(t.name!==ue.SAFARI||!t.browserVersion)return!1;const e=t.browserVersion.split(".");return Number(e[0])>15||Number(e[0])===15&&Number(e[1])>=4}function Xk(){return ie().name===ue.EDGE}function qe(){return ie().name===ue.FIREFOX}function ai(){return ie().os===bn.IOS}function vl(t){const e=ie();return!(e.name!==ue.CHROME||!e.osVersion)&&Number(e.version)>=t}function Jk(t){const e=ie();return!(e.name!==ue.CHROME||!e.osVersion)&&Number(e.version)<t}function Oy(t,e,n){const i=ie();return!(i.name!==t||!i.osVersion)&&(n?Number(i.version)>=e&&Number(i.version)<=n:Number(i.version)===e)}function Ny(t){const e=ie();return!(e.name!==ue.EDGE||!e.osVersion)&&Number(e.version)>=t}function Dy(t){const e=ie();return!(e.name!==ue.FIREFOX||!e.osVersion)&&Number(e.version)>=t}function Qk(t){const e=ie();return!(e.name!==ue.SAFARI||!e.osVersion)&&Number(e.version)>=t}function Zk(t,e,n){const i=ie();if(i.os!==bn.IOS||!i.osVersion)return!1;const o=i.osVersion.split(".");return n?e&&Number(o[0])===t&&Number(o[1])>e||Number(o[0])>t:e?Number(o[0])===t&&Number(o[1])>=e||Number(o[0])>t:Number(o[0])>=t}function $k(t,e,n){const i=ie();if(i.os!==bn.IOS||!i.osVersion)return!1;const o=i.osVersion.split(".");return n?e&&Number(o[0])===t&&Number(o[1])<e||Number(o[0])<t:e?Number(o[0])===t&&Number(o[1])<=e||Number(o[0])<t:Number(o[0])<=t}function Py(t,e,n){const i=ie();if(i.name!==ue.SAFARI||!i.osVersion||!i.browserVersion)return!1;const o=i.browserVersion.split(".");return n?e&&Number(o[0])===t&&Number(o[1])<e||Number(o[0])<t:e?Number(o[0])===t&&Number(o[1])<=e||Number(o[0])<t:Number(o[0])<=t}function ky(t){const e=ie();return!(e.name!==ue.OPERA||!e.osVersion)&&Number(e.version)>=t}function t1(){const t=ie();if(t.os!==bn.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function Tl(){const t=ie();if(t.os!==bn.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15}function Ly(){const t=ie();if(t.os!==bn.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===16}function e1(){const t=ie();if(t.os!==bn.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function ps(){return Hn()&&navigator.maxTouchPoints>0}function n1(){return ie().name===ue.WECHAT}function i1(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function My(){const t=d_();return function(){const{deviceType:e}=ie();return e==="mobile"||e==="tablet"}()||t===bn.ANDROID||t===bn.IOS||t===bn.HARMONY_OS}function Xo(){const t=ie();return t.name!==ue.EDGE&&t.name!==ue.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function u_(){return d_()===bn.ANDROID}function bh(){const t=ie();return u_()&&(t.name===ue.CHROME||t.name===ue.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Ft(t,e,n){return(e=function(i){var o=function(c,l){if(typeof c!="object"||!c)return c;var u=c[Symbol.toPrimitive];if(u!==void 0){var p=u.call(c,"string");if(typeof p!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}(i);return typeof o=="symbol"?o:o+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function ct(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?r1(Object(n),!0).forEach(function(i){Ft(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let L=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),$=class extends Error{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(e),Ft(this,"code",void 0),Ft(this,"message",void 0),Ft(this,"data",void 0),Ft(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(e),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",e=arguments.length>1?arguments[1]:void 0;return t==="error"&&(e||console).error(this.toString()),t==="warning"&&(e||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function Hs(t,e){if(typeof t!="boolean")throw new $(L.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function Tn(t,e,n){if(!pt(n).call(n,t))throw new $(L.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(n)))}function be(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<n||t>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(o){return typeof o=="number"&&o%1==0}(t))throw new $(L.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function xy(t,e){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new $(L.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));t.min!==void 0&&be(t.min,"".concat(e,".min"),0,1/0),t.max!==void 0&&be(t.max,"".concat(e,".max"),1,1/0),t.exact!==void 0&&be(t.exact,"".concat(e,".exact"),1,1/0),t.ideal!==void 0&&be(t.ideal,"".concat(e,".ideal"),1,1/0)}else be(t,e,1,1/0)}function Mn(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,o=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new $(L.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!s1(t,n,i,o))throw new $(L.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(o?" ASCII characters only.":""))}function Jo(t,e){if(!Array.isArray(t))throw new $(L.INVALID_PARAMS,"".concat(e," should be an array"))}function Xe(t){return t==null}function s1(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=n&&t.length>=e&&(!i||function(o){if(typeof o!="string")return!1;for(let c=0;c<o.length;c+=1){const l=o.charCodeAt(c);if(l<0||l>255)return!1}return!0}(t))}var Ih=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(Ih||{}),Uy=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(Uy||{});const o1=new class{constructor(){Ft(this,"_clientSize",null),Ft(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Ft(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Ft(this,"getStyle",t=>window.getComputedStyle(t,null)),Ft(this,"checkCssVisibleProperty",t=>{var e;let n=!0;const i=this.getStyle(t),{display:o,visibility:c,opacity:l,filter:u}=i;return(o==="none"||pt(e=["hidden","collapse"]).call(e,c)||Number(l)<.1)&&(n=!1),!!n&&(u&&u.split(" ").filter(p=>{var m;const _=p.split("(")[0];return pt(m=["brightness","blur","opacity"]).call(m,_)}).map(p=>{const[m,_]=p.split(/\(|\)/);return[m,Number(_.match(/^[0-9\.]+/))]}).forEach(p=>{const[m,_]=p;switch(m){case"brightness":(_<.1||_>3)&&(n=!1);break;case"blur":_>3&&(n=!1);break;case"opacity":_<.1&&(n=!1)}}),n)}),Ft(this,"checkPropertyUpToAllParentNodes",(t,e)=>{let n=!0,i=!0;const o=l=>e(l);let c=t;for(;c&&i;)o(c)||(n=!1,i=!1),c=c.parentElement,c||(i=!1);return n}),Ft(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),Ft(this,"getSizeAboutClient",t=>{const{width:e,height:n,left:i,right:o,top:c,bottom:l}=t.getBoundingClientRect(),u=this.getClientWidth(),p=this.getClientHeight();return{width:e,height:n,left:i,right:o,top:c,bottom:l,clientWidth:u,clientHeight:p,clientMin:Math.min(u,p)}}),Ft(this,"checkActualSize",()=>{const{width:t,height:e,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(t,e,n)}),Ft(this,"elementFromPoint",(t,e)=>document.elementFromPoint?document.elementFromPoint(t,e):null),Ft(this,"checkCoverForAPoint",(t,e,n)=>{const i=this.elementFromPoint(t,e);return i!==null&&i!==n}),Ft(this,"getPointPositionList",()=>{const{width:t,height:e,left:n,top:i}=this._clientSize,o=t/6,c=e/6,l=[],u=10**6;for(let p=0;p<5;p++)for(let m=0;m<5;m++){const _=(n*u+(p===0?.1:p===4?(o*p*u-1e5)/u:o*p)*u)/u,E=(i*u+(m===0?.1:m===4?(c*m*u-1e5)/u:c*m)*u)/u;l.push({x:_,y:E})}return[...l]}),Ft(this,"checkElementCover",t=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,t)).filter(e=>!!e).length>6),Ft(this,"checkSizeIsVisible",(t,e,n)=>(t>50||n/t<=10)&&(e>50||n/e<=10)),Ft(this,"checkSizeOfPartInClient",()=>{const{left:t,right:e,top:n,bottom:i,clientHeight:o,clientWidth:c,clientMin:l}=this._clientSize;let u,p,m,_;if(t<0)u=0;else{if(!(t<c))return!1;u=t}if(e<0)return!1;if(p=e<c?e:c,n<0)m=0;else{if(!(n<o))return!1;m=n}if(i<0)return!1;_=i<o?i:o;const E=p-u,S=_-m;return this.checkSizeIsVisible(E,S,l)}),Ft(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),Ft(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(Ih.COVERED);{const e=this.checkActualSize(),n=this.checkSizeOfPartInClient();return e&&!n?this.returnHiddenResult(Ih.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Ih.SIZE)}}return this.returnHiddenResult(Ih.STYLE)}return this.returnHiddenResult(Uy.UNMOUNTED)}return this.returnHiddenResult(Uy.INVALID_HTML_ELEMENT)}),Ft(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function Vy(t){return new TextEncoder().encode(t)}const a1=function(t,e){const n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n},Fy=async t=>function(e,n){let i="";return new Uint8Array(e).forEach(o=>{i+=o.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",Vy(t)),16);class Ke{constructor(){Ft(this,"_events",{}),Ft(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(n=>n.listener):[]}on(e,n){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!1})}once(e,n){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!0})}off(e,n){if(!this._events[e])return;const i=this._events[e],o=this._indexOfListener(i,n);o!==-1&&i.splice(o,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const n=this._events[e].map(l=>l);for(var i=arguments.length,o=new Array(i>1?i-1:0),c=1;c<i;c++)o[c-1]=arguments[c];for(let l=0;l<n.length;l+=1){const u=n[l];u.once&&this.off(e,u.listener),u.listener.apply(this,o||[])}}safeEmit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];[...this._events[e]||[]].forEach(c=>{c.once&&this.off(e,c.listener);try{c.listener.apply(this,i)}catch(l){console.error("safeEmit event:".concat(e," error ").concat(l==null?void 0:l.toString()))}})}_indexOfListener(e,n){let i=e.length;for(;i--;)if(e[i].listener===n)return i;return-1}}let wh=null;function c1(){if(wh)return wh;if(window.electron)return wh=window.electron;if(!window.require)return null;try{return wh=window.require("electron"),wh}catch{return null}}let tn=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t.PRELOAD_MEDIA_FAILED="preloadMediaFailed",t.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",t}({}),We=function(t){return t.TRACER="tracer",t}({});function d1(t){return be(t.timeout,"config.timeout",0,1e5),be(t.timeoutFactor,"config.timeoutFactor",0,100,!1),be(t.maxRetryCount,"config.maxRetryConfig",0,1/0),be(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let QJ=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),_e=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function Ah(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function l1(t){return Mn(t.turnServerURL,"turnServerURL"),Mn(t.username,"username"),Mn(t.password,"password"),t.udpport&&be(t.udpport,"udpport",1,99999,!0),t.forceturn&&Hs(t.forceturn,"forceturn"),t.security&&Hs(t.security,"security"),t.tcpport&&be(t.tcpport,"tcpport",1,99999,!0),!0}function By(t){return t.level!==void 0&&Tn(t.level,"level",[1,2,3]),t.delay!==void 0&&be(t.delay,"delay",0,3e3,!0),!0}let te=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.AUDIO_PTS="audio-pts",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),zn=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),sr=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),yl=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function Kn(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return t.getListeners(e).length===0?gt.reject(new $(L.UNEXPECTED_ERROR,"can not emit promise")):new gt((c,l)=>{t.emit(e,...i,c,l)})}function we(t,e){if(t.getListeners(e).length===0)return gt.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return Kn(t,e,...i)}function _r(t,e){if(t.getListeners(e).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return Oh(t,e,...i)}function Oh(t,e){let n=null,i=null;for(var o=arguments.length,c=new Array(o>2?o-2:0),l=2;l<o;l++)c[l-2]=arguments[l];if(t.emit(e,...c,u=>{n=u},u=>{i=u}),i!==null)throw i;if(n===null)throw new $(L.UNEXPECTED_ERROR,"handler is not sync");return n}const on=new class extends Ke{set networkState(t){this.emit(yl.NETWORK_STATE_CHANGE,t,this._networkState),t===sr.ONLINE?this.emit(yl.ONLINE):t===sr.OFFLINE&&(this.onlineWaiter=new gt(e=>{this.once(yl.ONLINE,()=>{this.onlineWaiter=void 0,e(sr.ONLINE)})}),this.emit(yl.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===sr.ONLINE}constructor(){super(),Ft(this,"_moduleName","network-indicator"),Ft(this,"_networkState",sr.ONLINE),Ft(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=sr.ONLINE}),window.addEventListener("offline",()=>{this.networkState=sr.OFFLINE})}};function h_(t,e){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}function Rl(t){const e=[];return t.forEach(n=>{e.indexOf(n)===-1&&e.push(n)}),e}function p_(t){gt!==void 0?gt.resolve().then(t):setTimeout(t,0)}function Ge(t){return JSON.parse(JSON.stringify(t))}function Hc(t){try{return Ge(t)}catch{return t}}const u1={};function La(t,e){u1[e]||(u1[e]=!0,t())}function zc(t){const e=window.atob(t),n=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i+=1)n[i]=e.charCodeAt(i);return n}function Ma(t){let e="";for(let n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return window.btoa(e)}function h1(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(t);if(n.length>e)n=n.slice(0,e);else if(n.length<e){const i=new Uint8Array(e);i.set(n),n=i}return n}function p1(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=os(e).call(e,(l,u)=>l+u.length,0),o=new Uint8Array(new ArrayBuffer(i));let c=0;return e.forEach(l=>{o.set(l,c),c+=l.length}),o}function vo(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function f1(t){let e=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(n=>{e+=typeof n=="string"?vo(n):n.size}),e+138}function ZJ(t){const e=new $(L.TIMEOUT,"timeout");return new gt((n,i)=>{window.setTimeout(()=>i(e),t)})}function xn(t){return new gt(e=>{window.setTimeout(e,t)})}function Ae(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,t).toLowerCase();return n.length===t?"".concat(e).concat(n):"".concat(e).concat(n)+Ae(t-n.length,"")}function Kc(){return Ae(32,"").toUpperCase()}const f_=()=>{},m1=new class{constructor(){Ft(this,"fnMap",new Map)}throttleByKey(t,e,n,i){for(var o=arguments.length,c=new Array(o>4?o-4:0),l=4;l<o;l++)c[l-4]=arguments[l];if(this.fnMap.has(e)){const u=this.fnMap.get(e);if(u.threshold!==n){u.fn(...u.args),clearTimeout(u.timer);const p=window.setTimeout(()=>{const m=this.fnMap.get(e);m&&m.fn(...m.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:p,args:c,skipFn:i})}else u.skipFn&&u.skipFn(...u.args),this.fnMap.set(e,ct(ct({},u),{},{fn:t,args:c,skipFn:i}))}else{const u=window.setTimeout(()=>{const p=this.fnMap.get(e);p&&p.fn(...p.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:u,args:c,skipFn:i})}}},_1=m1.throttleByKey.bind(m1);function g1(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function jy(t,e){if(!g1(t)||!g1(e)||Array.isArray(t)&&!Array.isArray(e)||!Array.isArray(t)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(t)){const n=[...t];for(let i=0;i<e.length;i++)n[i]=jy(t[i],e[i]);return n}{const n=ct({},t);for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(Object.prototype.hasOwnProperty.call(t,i)?n[i]=jy(t[i],e[i]):n[i]=e[i]);return n}}function E1(t,e){let n=[0];if(e&&(n=new Array(e).fill(0)),t===0)return n;let i=0;for(;t>0&&(n[i]=255&t,t>>=8,i++,!e||i!==e););return n}function Cl(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function Wy(t){return os(t).call(t,(e,n)=>e+n,0)}function S1(t){const e="0123456789abcdef";function n(U){let G,W="";for(G=0;G<=3;G++)W+=e.charAt(U>>8*G+4&15)+e.charAt(U>>8*G&15);return W}function i(U,G){const W=(65535&U)+(65535&G);return(U>>16)+(G>>16)+(W>>16)<<16|65535&W}function o(U,G,W,F,X,tt){return i(function(nt,at){return nt<<at|nt>>>32-at}(i(i(G,U),i(F,tt)),X),W)}function c(U,G,W,F,X,tt,nt){return o(G&W|~G&F,U,G,X,tt,nt)}function l(U,G,W,F,X,tt,nt){return o(G&F|W&~F,U,G,X,tt,nt)}function u(U,G,W,F,X,tt,nt){return o(G^W^F,U,G,X,tt,nt)}function p(U,G,W,F,X,tt,nt){return o(W^(G|~F),U,G,X,tt,nt)}const m=function(U){let G;const W=1+(U.length+8>>6),F=new Array(16*W);for(G=0;G<16*W;G++)F[G]=0;for(G=0;G<U.length;G++)F[G>>2]|=U.charCodeAt(G)<<G%4*8;return F[G>>2]|=128<<G%4*8,F[16*W-2]=8*U.length,F}(t);let _,E,S,T,A,I=1732584193,w=-271733879,P=-1732584194,D=271733878;for(_=0;_<m.length;_+=16)E=I,S=w,T=P,A=D,I=c(I,w,P,D,m[_+0],7,-680876936),D=c(D,I,w,P,m[_+1],12,-389564586),P=c(P,D,I,w,m[_+2],17,606105819),w=c(w,P,D,I,m[_+3],22,-1044525330),I=c(I,w,P,D,m[_+4],7,-176418897),D=c(D,I,w,P,m[_+5],12,1200080426),P=c(P,D,I,w,m[_+6],17,-1473231341),w=c(w,P,D,I,m[_+7],22,-45705983),I=c(I,w,P,D,m[_+8],7,1770035416),D=c(D,I,w,P,m[_+9],12,-1958414417),P=c(P,D,I,w,m[_+10],17,-42063),w=c(w,P,D,I,m[_+11],22,-1990404162),I=c(I,w,P,D,m[_+12],7,1804603682),D=c(D,I,w,P,m[_+13],12,-40341101),P=c(P,D,I,w,m[_+14],17,-1502002290),w=c(w,P,D,I,m[_+15],22,1236535329),I=l(I,w,P,D,m[_+1],5,-165796510),D=l(D,I,w,P,m[_+6],9,-1069501632),P=l(P,D,I,w,m[_+11],14,643717713),w=l(w,P,D,I,m[_+0],20,-373897302),I=l(I,w,P,D,m[_+5],5,-701558691),D=l(D,I,w,P,m[_+10],9,38016083),P=l(P,D,I,w,m[_+15],14,-660478335),w=l(w,P,D,I,m[_+4],20,-405537848),I=l(I,w,P,D,m[_+9],5,568446438),D=l(D,I,w,P,m[_+14],9,-1019803690),P=l(P,D,I,w,m[_+3],14,-187363961),w=l(w,P,D,I,m[_+8],20,1163531501),I=l(I,w,P,D,m[_+13],5,-1444681467),D=l(D,I,w,P,m[_+2],9,-51403784),P=l(P,D,I,w,m[_+7],14,1735328473),w=l(w,P,D,I,m[_+12],20,-1926607734),I=u(I,w,P,D,m[_+5],4,-378558),D=u(D,I,w,P,m[_+8],11,-2022574463),P=u(P,D,I,w,m[_+11],16,1839030562),w=u(w,P,D,I,m[_+14],23,-35309556),I=u(I,w,P,D,m[_+1],4,-1530992060),D=u(D,I,w,P,m[_+4],11,1272893353),P=u(P,D,I,w,m[_+7],16,-155497632),w=u(w,P,D,I,m[_+10],23,-1094730640),I=u(I,w,P,D,m[_+13],4,681279174),D=u(D,I,w,P,m[_+0],11,-358537222),P=u(P,D,I,w,m[_+3],16,-722521979),w=u(w,P,D,I,m[_+6],23,76029189),I=u(I,w,P,D,m[_+9],4,-640364487),D=u(D,I,w,P,m[_+12],11,-421815835),P=u(P,D,I,w,m[_+15],16,530742520),w=u(w,P,D,I,m[_+2],23,-995338651),I=p(I,w,P,D,m[_+0],6,-198630844),D=p(D,I,w,P,m[_+7],10,1126891415),P=p(P,D,I,w,m[_+14],15,-1416354905),w=p(w,P,D,I,m[_+5],21,-57434055),I=p(I,w,P,D,m[_+12],6,1700485571),D=p(D,I,w,P,m[_+3],10,-1894986606),P=p(P,D,I,w,m[_+10],15,-1051523),w=p(w,P,D,I,m[_+1],21,-2054922799),I=p(I,w,P,D,m[_+8],6,1873313359),D=p(D,I,w,P,m[_+15],10,-30611744),P=p(P,D,I,w,m[_+6],15,-1560198380),w=p(w,P,D,I,m[_+13],21,1309151649),I=p(I,w,P,D,m[_+4],6,-145523070),D=p(D,I,w,P,m[_+11],10,-1120210379),P=p(P,D,I,w,m[_+2],15,718787259),w=p(w,P,D,I,m[_+9],21,-343485551),I=i(I,E),w=i(w,S),P=i(P,T),D=i(D,A);return n(I)+n(w)+n(P)+n(D)}let $J=1,v1=console,Qn=class{static setLogger(t){v1=t}constructor(t,e){Ft(this,"id",void 0),Ft(this,"lockingPromise",gt.resolve()),Ft(this,"locks",0),Ft(this,"name",""),Ft(this,"lockId",void 0),this.lockId=$J++,t&&(this.name=t),e&&(this.id=e),this.logger("created")}logger(t,e){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(e??"");v1.debug("".concat(n," ").concat(i))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,this.logger("locked",t);const n=new gt(o=>{e=()=>{this.locks-=1,this.logger("unlocked",t),o()}}),i=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function bl(t,e){return function(n,i,o){const c=o.value;if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const l=this[e];if(!l)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(t));const u=await l.lock("From ".concat(t,".").concat(i));try{for(var p=arguments.length,m=new Array(p),_=0;_<p;_++)m[_]=arguments[_];return await c.apply(this,m)}finally{u()}},o}}const pn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Gy(t,e){const n=Math.floor(e.timeout*Math.pow(e.timeoutFactor,t));return Math.min(e.maxRetryTimeout,n)}function zs(t,e,n,i){const o=Object.assign({},pn,i);let c=o.timeout;const l=async()=>{await function(m){return new gt(_=>{window.setTimeout(_,m)})}(c),c*=o.timeoutFactor,c=Math.min(o.maxRetryTimeout,c)};let u=!1;const p=new gt(async(m,_)=>{e=e||(()=>!1),n=n||(()=>!0);for(let E=0;E<o.maxRetryCount;E+=1){if(u)return _(new $(L.OPERATION_ABORTED));try{const S=await t();if(!e(S,E)||E+1===o.maxRetryCount)return m(S);await l()}catch(S){if(!n(S,E)||E+1===o.maxRetryCount)return _(S);await l()}}});return p.cancel=()=>u=!0,p}let m_,T1=class{constructor(t){Ft(this,"input",[]),Ft(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:os(t=this.input).call(t,(e,n)=>e+n)/this.input.length}},__=0,Hy=0;function zy(t,e,n,i){return new gt((o,c)=>{e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),__+=vo(e.data)):n&&(e.data.size?__+=e.data.size:e.data instanceof FormData?__+=f1(e.data):__+=vo(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,Oi.request(e).then(l=>{typeof l.data=="string"?Hy+=vo(l.data):l.data instanceof ArrayBuffer||l.data instanceof Uint8Array?Hy+=l.data.byteLength:Hy+=vo(JSON.stringify(l.data)),i&&o({data:l.data,headers:l.headers}),o(l.data)}).catch(l=>{Oi.isCancel(l)?c(new $(L.OPERATION_ABORTED,"cancel token canceled")):l.code==="ECONNABORTED"?c(new $(L.NETWORK_TIMEOUT,l.message)):l.response?c(new $(L.NETWORK_RESPONSE_ERROR,l.response.status)):c(new $(L.NETWORK_ERROR,l.message))})})}async function tQ(t,e){const n=new Blob([e.data],{type:"buffer"});return await zy(t,ct(ct({},e),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const y1=()=>window.isSecureContext!==void 0;function fs(t){if(Array.isArray(t))return t.map(n=>n);if(!R1(t))return t;const e={};for(const n in t){const i=t[n];R1(i)||Array.isArray(i)?e[n]=fs(i):e[n]=i}return e}function R1(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let Ky=class{constructor(t){Ft(this,"input",[]),Ft(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const To={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Nh={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:To,remoteCandidate:To},updateInterval:0},C1={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},b1={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},I1={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},w1={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let Yy=class{constructor(t,e){Ft(this,"onFirstVideoReceived",void 0),Ft(this,"onFirstVideoDecoded",void 0),Ft(this,"onFirstAudioReceived",void 0),Ft(this,"onFirstVideoDecodedTimeout",void 0),Ft(this,"onFirstAudioDecoded",void 0),Ft(this,"onSelectedLocalCandidateChanged",void 0),Ft(this,"onSelectedRemoteCandidateChanged",void 0),Ft(this,"videoIsReady",!1),Ft(this,"videoIsReady2",{}),Ft(this,"pc",void 0),Ft(this,"options",void 0),Ft(this,"intervalTimer",void 0),Ft(this,"stats",fs(Nh)),Ft(this,"isFirstVideoReceived",{}),Ft(this,"isFirstVideoDecoded",{}),Ft(this,"isFirstAudioReceived",{}),Ft(this,"isFirstAudioDecoded",{}),Ft(this,"isFirstVideoDecodedTimeout",{}),Ft(this,"lossRateWindowStats",[]),this.pc=t,this.options=e,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new gt(t=>{t({local:ct({},To),remote:ct({},To)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,e){this.videoIsReady2[t]=e}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const e=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,o=0,c=0,l=0;for(const u of n)t[u].forEach((p,m)=>{if(!this.lossRateWindowStats[e-1][u][m]||!this.lossRateWindowStats[0][u][m])return;const _=this.lossRateWindowStats[e-1][u][m].packets-this.lossRateWindowStats[0][u][m].packets,E=this.lossRateWindowStats[e-1][u][m].packetsLost-this.lossRateWindowStats[0][u][m].packetsLost;u==="videoSend"||u==="audioSend"?(i+=_,c+=E):(o+=_,l+=E),Number.isNaN(_)||Number.isNaN(_)?p.packetLostRate=0:p.packetLostRate=_<=0||E<=0?0:E/(_+E)});t.sendPacketLossRate=i<=0||c<=0?0:c/(i+c),t.recvPacketLossRate=o<=0||l<=0?0:l/(o+l)}},eQ=class extends Yy{constructor(){super(...arguments),Ft(this,"_stats",Nh),Ft(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),e=this.statsResponsesToObjects(t);this._stats=fs(Nh);const n=e.filter(o=>o.type==="ssrc");this.processSSRCStats(n);const i=e.find(o=>o.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(e=>{var n;const i=pt(n=e.id).call(n,"send");switch("".concat(e.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const o=fs(b1);o.codec=e.googCodecName,o.adaptionChangeReason="none",e.googCpuLimitedResolution&&(o.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(o.adaptionChangeReason="bandwidth"),o.avgEncodeMs=Number(e.googAvgEncodeMs),o.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},o.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},o.firsCount=Number(e.googFirReceived),o.nacksCount=Number(e.googNacksReceived),o.plisCount=Number(e.googPlisReceived),o.frameCount=Number(e.framesEncoded),o.bytes=Number(e.bytesSent),o.packets=Number(e.packetsSent),o.packetsLost=Number(e.packetsLost),o.ssrc=Number(e.ssrc),o.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(o),this._stats.rtt=o.rttMs;break}case"video_recv":{const o=fs(C1),c=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(o.codec=e.googCodecName,o.targetDelayMs=Number(e.googTargetDelayMs),o.renderDelayMs=Number(e.googRenderDelayMs),o.currentDelayMs=Number(e.googCurrentDelayMs),o.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),o.decodeMs=Number(e.googDecodeMs),o.maxDecodeMs=Number(e.googMaxDecodeMs),o.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},o.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},o.decodeFrameRate=Number(e.googFrameRateDecoded),o.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},o.jitterBufferMs=Number(e.googJitterBufferMs),o.firsCount=Number(e.googFirsSent),o.nacksCount=Number(e.googNacksSent),o.plisCount=Number(e.googPlisSent),o.framesDecodeCount=Number(e.framesDecoded),o.bytes=Number(e.bytesReceived),o.packets=Number(e.packetsReceived),o.packetsLost=Number(e.packetsLost),o.ssrc=Number(e.ssrc),o.packets>0&&!this.isFirstVideoReceived[o.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o.ssrc),this.isFirstVideoReceived[o.ssrc]=!0),o.framesDecodeCount>0&&!this.isFirstVideoDecoded[o.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o.ssrc,o.decodedFrame.width,o.decodedFrame.height),this.isFirstVideoDecoded[o.ssrc]=!0),c){const l=c.stats,u=Date.now()-c.lts;o.framesDecodeFreezeTime=l.framesDecodeFreezeTime,o.framesDecodeInterval=l.framesDecodeInterval,o.framesDecodeCount>l.framesDecodeCount&&this.isFirstVideoDecoded[o.ssrc]?(c.lts=Date.now(),o.framesDecodeInterval=u,o.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?o.framesDecodeFreezeTime+=o.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):o.framesDecodeCount<c.stats.framesDecodeCount&&(o.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(o.ssrc,{stats:ct({},o),lts:Date.now()}),this._stats.videoRecv.push(o);break}case"audio_recv":{const o=fs(w1);o.codec=e.googCodecName,o.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,o.decodingCNG=Number(e.googDecodingCNG),o.decodingCTN=Number(e.googDecodingCTN),o.decodingCTSG=Number(e.googDecodingCTSG),o.decodingNormal=Number(e.googDecodingNormal),o.decodingPLC=Number(e.googDecodingPLC),o.decodingPLCCNG=Number(e.googDecodingPLCCNG),o.expandRate=Number(e.googExpandRate),o.accelerateRate=Number(e.googAccelerateRate),o.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),o.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),o.speechExpandRate=Number(e.googSpeechExpandRate),o.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),o.jitterBufferMs=Number(e.googJitterBufferMs),o.jitterMs=Number(e.googJitterReceived),o.bytes=Number(e.bytesReceived),o.packets=Number(e.packetsReceived),o.packetsLost=Number(e.packetsLost),o.ssrc=Number(e.ssrc),o.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),o.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),o.receivedFrames>0&&!this.isFirstAudioReceived[o.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o.ssrc),this.isFirstAudioReceived[o.ssrc]=!0),o.decodingNormal>0&&!this.isFirstAudioDecoded[o.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o.ssrc),this.isFirstAudioDecoded[o.ssrc]=!0),this._stats.audioRecv.push(o);break}case"audio_send":{const o=fs(I1);o.codec=e.googCodecName,o.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,o.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),o.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),o.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),o.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),o.bytes=Number(e.bytesSent),o.packets=Number(e.packetsSent),o.packetsLost=Number(e.packetsLost),o.ssrc=Number(e.ssrc),o.rttMs=Number(e.googRtt||0),this._stats.rtt=o.rttMs,this._stats.audioSend.push(o);break}}})}_getStats(){return new gt((t,e)=>{this.pc.getStats(t,e)})}statsResponsesToObjects(t){const e=[];return t.result().forEach(n=>{const i={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(o=>{i[o]=n.stat(o)}),e.push(i)}),e}},Dh=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),g_=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),qy=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),gr=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var Il=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(Il||{});function Ph(t,e,n,i){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Il.kNone;if(!e)return;const c=Number(e[n]);if(typeof c!="number")return;const l=Number(e[i]);if(typeof l!="number")return;if(!t)return l?c/l*o:void 0;const u=Number(t[n]);if(typeof u!="number")return;const p=Number(t[i]);if(typeof p!="number")return;const m=l-p;return m?(c-u)/m*o:void 0}let A1=class extends Yy{constructor(){super(...arguments),Ft(this,"_stats",Nh),Ft(this,"report",void 0),Ft(this,"lastDecodeVideoReceiverStats",new Map),Ft(this,"lastVideoFramesRecv",new Map),Ft(this,"lastVideoFramesSent",new Map),Ft(this,"lastVideoFramesDecode",new Map),Ft(this,"lastVideoFramesOutput",new Map),Ft(this,"lastVideoJBDelay",new Map),Ft(this,"lastAudioJBDelay",new Map),Ft(this,"mediaBytesSent",new Map),Ft(this,"mediaBytesRetransmit",new Map),Ft(this,"mediaBytesTargetEncode",new Map),Ft(this,"lastDecodeAudioReceiverStats",new Map),Ft(this,"lastAudioConcealment",new Map),Ft(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=fs(Nh),this.report.forEach(t=>{switch(t.type){case gr.OUTBOUND:case gr.INBOUND:{const e=t.mediaType||t.kind,n=!e&&"frameWidth"in t,i=!e&&!("frameWidth"in t);t.type===gr.OUTBOUND?e==="audio"||i?this.processAudioOutboundStats(t):(e==="video"||n)&&this.processVideoOutboundStats(t):t.type===gr.INBOUND&&(e==="audio"||i?this.processAudioInboundStats(t):(e==="video"||n)&&this.processVideoInboundStats(t));break}case gr.TRANSPORT:{const e=this.report.get(t.selectedCandidatePairId);e&&this.processCandidatePairStats(e);break}case gr.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),e={local:ct({},To),remote:ct({},To)};return t.forEach(n=>{let i;if(n.type===gr.TRANSPORT&&(i=t.get(n.selectedCandidatePairId)),n.type===gr.CANDIDATE_PAIR&&n.selected&&(i=n),i){const o=(c,l)=>{c.type=l.type,c.id=l.id,l.address&&(c.address=l.address),l.candidateType&&(c.candidateType=l.candidateType),l.port&&(c.port=l.port),l.priority&&(c.priority=l.priority),l.protocol&&(c.protocol=l.protocol),l.relayProtocol&&(c.relayProtocol=l.relayProtocol)};if(i.localCandidateId){const c=t.get(i.localCandidateId);c&&o(e.local,c)}if(i.remoteCandidateId){const c=t.get(i.remoteCandidateId);c&&o(e.remote,c)}}}),e}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const e=this.report.get(t.localCandidateId);e&&this.processCandidateStats(e)}if(t.remoteCandidateId){const e=this.report.get(t.remoteCandidateId);e&&this.processCandidateStats(e)}}processCandidateStats(t){let e;t.type===gr.LOCAL_CANDIDATE&&(e=this._stats.selectedCandidatePair.localCandidate),t.type===gr.REMOTE_CANDIDATE&&(e=this._stats.selectedCandidatePair.remoteCandidate),e&&(e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol),t.type===gr.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==e.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(ct({},e),ct({},this.stats.selectedCandidatePair.localCandidate)),t.type===gr.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==e.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(ct({},e),ct({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let e=this._stats.audioRecv.find(i=>i.ssrc===t.ssrc);e||(e=fs(w1),this._stats.audioRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.packetsDiscarded=t.packetsDiscarded,e.bytes=t.bytesReceived,e.jitterMs=1e3*t.jitter,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived,e.totalProcessingDelay=t.totalProcessingDelay,e.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(e.ssrc);e.avgProcessingDelayMs=Ph(n,e,"totalProcessingDelay","jitterBufferEmittedCount",Il.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,e),this.calculateAudioFreeze(e,n,t),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),e.receivedFrames||(e.receivedFrames=t.packetsReceived),e.droppedFrames||(e.droppedFrames=t.packetsLost),e.receivedFrames>0&&!this.isFirstAudioReceived[e.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(e.ssrc),this.isFirstAudioReceived[e.ssrc]=!0),e.outputLevel&&e.outputLevel>0&&!this.isFirstAudioDecoded[e.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(e.ssrc),this.isFirstAudioDecoded[e.ssrc]=!0),typeof t.concealedSamples=="number"&&(e.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(e.ssrc,ct({},e))}calculateAudioFreeze(t,e,n){const i=this.lastAudioConcealment.get(t.ssrc);if(e!=null&&i!=null){const o=i.lts,c=n.timestamp,l=c-o;if(l<=0)return;const u=t.concealedSamples-e.concealedSamples-0,p=i.nonSilent+u,m=t.totalSamplesReceived-e.totalSamplesReceived;if(m<=0)return;const _=80*m/l,E=200*m/l,S=l/m;let T=0;t.freezeSamples80=e.freezeSamples80,t.freezeMs80=e.freezeMs80,p>_&&(i.plc80>0?(t.freezeSamples80+=u,t.freezeMs80+=Math.round(u*S)):(t.freezeSamples80+=p,t.freezeMs80+=Math.round(p*S)),T=i.plc80+1);let A=0;t.freezeSamples200=e.freezeSamples200,t.freezeMs200=e.freezeMs200,p>E&&(i.plc200>0?(t.freezeSamples200+=u,t.freezeMs200+=Math.round(u*S)):(t.freezeSamples200+=p,t.freezeMs200+=Math.round(p*S)),A=i.plc200+1),this.lastAudioConcealment.set(t.ssrc,{nonSilent:u,lts:c,plc80:T,plc200:A})}else t.freezeSamples80=0,t.freezeSamples200=0,t.freezeMs80=0,t.freezeMs200=0,this.lastAudioConcealment.set(t.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(t){let e=this._stats.videoRecv.find(l=>l.ssrc===t.ssrc);e||(e=fs(C1),this._stats.videoRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.framesDecodeCount=t.framesDecoded,e.framesDroppedCount=t.framesDropped,e.totalInterFrameDelay=t.totalInterFrameDelay,e.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,e.totalFreezesDuration=t.totalFreezesDuration,e.totalProcessingDelay=t.totalProcessingDelay,e.packetsDiscarded=t.packetsDiscarded,e.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,e.totalAssemblyTime=t.totalAssemblyTime,e.keyFramesDecoded=t.keyFramesDecoded,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(e.ssrc),i=this.lastVideoFramesDecode.get(e.ssrc),o=this.lastVideoFramesOutput.get(e.ssrc),c=Date.now();if(e.framesDecodeCount>0&&!this.isFirstVideoDecoded[e.ssrc]){const l=e.decodedFrame?e.decodedFrame.width:0,u=e.decodedFrame?e.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e.ssrc,l,u),this.isFirstVideoDecoded[e.ssrc]=!0}if(n){const l=n.stats,u=c-n.lts;e.framesDecodeFreezeTime=l.framesDecodeFreezeTime,e.framesDecodeInterval=l.framesDecodeInterval,!this.isFirstVideoDecoded[e.ssrc]&&u>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[e.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(e.ssrc),this.isFirstVideoDecodedTimeout[e.ssrc]=!0),e.framesDecodeCount>l.framesDecodeCount&&this.isFirstVideoDecoded[e.ssrc]?(n.lts=Date.now(),e.framesDecodeInterval=u,e.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?e.framesDecodeFreezeTime+=e.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):e.framesDecodeCount<l.framesDecodeCount&&(e.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(n.stats.framesDecodeCount>t.framesDecoded?e.qpSumPerFrame=t.qpSum/t.framesDecoded:e.qpSumPerFrame=(t.qpSum-n.qpSum)/(t.framesDecoded-n.stats.framesDecodeCount))}t.totalDecodeTime&&(e.decodeMs=1e3*t.totalDecodeTime,e.avgDecodeMs=Ph(n==null?void 0:n.stats,e,"decodeMs","framesDecodeCount")),e.avgProcessingDelayMs=Ph(n==null?void 0:n.stats,e,"totalProcessingDelay","framesDecodeCount",Il.kMillisecondsFromSeconds),e.avgFramesAssembledFromMultiplePacketsMs=Ph(n==null?void 0:n.stats,e,"totalAssemblyTime","framesAssembledFromMultiplePackets",Il.kMillisecondsFromSeconds),e.avgInterFrameDelayMs=Ph(n==null?void 0:n.stats,e,"totalInterFrameDelay","framesDecodeCount",Il.kMillisecondsFromSeconds),i&&c-i.lts>=800?(e.decodeFrameRate=Math.round((e.framesDecodeCount-i.count)/((c-i.lts)/1e3)),this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:c,rate:e.decodeFrameRate})):i?e.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:c,rate:0}),e.framesDroppedCount&&t.framesReceived&&(o&&c-o.lts>=800?(e.outputFrameRate=Math.round((t.framesReceived-e.framesDroppedCount-o.count)/((c-o.lts)/1e3)),this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:c,rate:Math.max(e.outputFrameRate,0)})):o?e.outputFrameRate=o.rate:this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:c,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(e.framesRateFirefox=t.framerateMean),e.packets>0&&!this.isFirstVideoReceived[e.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(e.ssrc),this.isFirstVideoReceived[e.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(e.ssrc,{stats:ct({},e),lts:n?n.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let e=this._stats.videoSend.find(i=>i.ssrc===t.ssrc);e||(e=fs(b1),this._stats.videoSend.push(e));const n=this.mediaBytesSent.get(t.ssrc);if(n)n.add(t.bytesSent);else{const i=new Ky(10);i.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,i)}if(t.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(t.ssrc);if(i)i.add(t.retransmittedBytesSent);else{const o=new Ky(10);o.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,o)}}if(t.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(t.ssrc);if(i)i.add(t.totalEncodedBytesTarget);else{const o=new Ky(10);o.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,o)}}if(e.ssrc=t.ssrc,e.bytes=t.bytesSent,e.packets=t.packetsSent,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.frameCount=t.framesEncoded,e.adaptionChangeReason=t.qualityLimitationReason,e.scalabilityMode=t.scalabilityMode,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,e.hugeFramesSent=t.hugeFramesSent,e.keyFramesEncoded=t.keyFramesEncoded,e.targetBitrate=t.targetBitrate,t.totalEncodeTime&&t.framesEncoded){const i=this.lastEncoderMs.get(t.ssrc);if(!i||i.lastFrameCount>t.framesEncoded)e.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const o=t.framesEncoded-i.lastFrameCount,c=t.totalEncodeTime-i.lastEncoderTime;e.avgEncodeMs=1e3*c/o}}if(t.framesEncoded&&t.qpSum){const i=this.lastEncoderMs.get(t.ssrc);!i||i.lastFrameCount>t.framesEncoded?e.qpSumPerFrame=t.qpSum/t.framesEncoded:e.qpSumPerFrame=(t.qpSum-i.lastQpSum)/(t.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,e),this.processVideoTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const i=this.findRemoteStatsId(t.ssrc,gr.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,e)}}processAudioOutboundStats(t){let e=this._stats.audioSend.find(n=>n.ssrc===t.ssrc);if(e||(e=fs(I1),this._stats.audioSend.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsSent,e.bytes=t.bytesSent,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const n=this.findRemoteStatsId(t.ssrc,gr.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,e)}}findRemoteStatsId(t,e){var n;const i=Array.from(nr(n=this.report).call(n)).find(o=>o.type===e&&o.ssrc===t);return i?i.id:null}processVideoMediaSource(t,e){const n=this.report.get(t);n&&n.width&&n.height&&n.framesPerSecond&&(e.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(t,e){const n=this.report.get(t);n&&(e.inputLevel=n.audioLevel)}processVideoTrackSenderStats(t,e,n){var i,o,c,l;const u=e?this.report.get(e):void 0,p=(i=u==null?void 0:u.framesSent)!==null&&i!==void 0?i:t.framesSent;if(typeof p!="number")return;let m=(o=u==null?void 0:u.frameWidth)!==null&&o!==void 0?o:t.frameWidth,_=(c=u==null?void 0:u.frameHeight)!==null&&c!==void 0?c:t.frameHeight,E=(l=u==null?void 0:u.framesPerSecond)!==null&&l!==void 0?l:t.framesPerSecond;if(typeof m=="number"&&typeof _=="number"||(m=0,_=0),E==null){const S=Date.now(),T=this.lastVideoFramesSent.get(n.ssrc);T&&S-T.lts>=800?(E=Math.round((p-T.count)/((S-T.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:p,lts:S,rate:E})):T?E=T.rate:this.lastVideoFramesSent.set(n.ssrc,{count:p,lts:S,rate:0})}n.sentFrame={width:m,height:_,frameRate:Math.max(0,E)}}processVideoTrackReceiverStats(t,e,n){var i,o,c,l,u;const p=e?this.report.get(e):void 0,m=(i=p==null?void 0:p.framesReceived)!==null&&i!==void 0?i:t.framesReceived,_=(o=p==null?void 0:p.frameWidth)!==null&&o!==void 0?o:t.frameWidth,E=(c=p==null?void 0:p.frameHeight)!==null&&c!==void 0?c:t.frameHeight,S=(l=p==null?void 0:p.jitterBufferDelay)!==null&&l!==void 0?l:t.jitterBufferDelay,T=(u=p==null?void 0:p.jitterBufferEmittedCount)!==null&&u!==void 0?u:t.jitterBufferEmittedCount;if(typeof m=="number"){const A=this.lastVideoFramesRecv.get(n.ssrc),I=Date.now();n.framesReceivedCount=m;let w=0;A&&I-A.lts>=800?(w=Math.round((m-A.count)/((I-A.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:m,lts:I,rate:w})):A?w=A.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:m,lts:I,rate:0}),n.receivedFrame={width:_||0,height:E||0,frameRate:w||0},n.decodedFrame={width:_||0,height:E||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:_||0,height:E||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(S&&T){const A=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let I=A.jitterBufferMs;const w=T-A.jitterBufferEmittedCount;w>0&&(I=1e3*(S-A.jitterBufferDelay)/w),n.jitterBufferMs=I,n.currentDelayMs=Math.round(I),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:S,jitterBufferEmittedCount:T,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(t,e,n){var i,o,c,l;const u=e?this.report.get(e):void 0,p=(i=(o=u==null?void 0:u.echoReturnLoss)!==null&&o!==void 0?o:t.echoReturnLoss)!==null&&i!==void 0?i:0,m=(c=(l=u==null?void 0:u.echoReturnLossEnhancement)!==null&&l!==void 0?l:t.echoReturnLossEnhancement)!==null&&c!==void 0?c:0;n.aecReturnLoss=p,n.aecReturnLossEnhancement=m}processAudioTrackReceiverStats(t,e,n){var i,o,c,l,u,p,m,_,E;const S=e?this.report.get(e):void 0,T=(i=S==null?void 0:S.removedSamplesForAcceleration)!==null&&i!==void 0?i:t.removedSamplesForAcceleration,A=(o=S==null?void 0:S.totalSamplesReceived)!==null&&o!==void 0?o:t.totalSamplesReceived,I=(c=S==null?void 0:S.jitterBufferDelay)!==null&&c!==void 0?c:t.jitterBufferDelay,w=(l=S==null?void 0:S.jitterBufferEmittedCount)!==null&&l!==void 0?l:t.jitterBufferEmittedCount,P=(u=S==null?void 0:S.audioLevel)!==null&&u!==void 0?u:t==null?void 0:t.audioLevel,D=(p=S==null?void 0:S.totalSamplesDuration)!==null&&p!==void 0?p:t==null?void 0:t.totalSamplesDuration,U=(m=S==null?void 0:S.concealedSamples)!==null&&m!==void 0?m:t.concealedSamples,G=(_=S==null?void 0:S.silentConcealedSamples)!==null&&_!==void 0?_:t.silentConcealedSamples,W=(E=S==null?void 0:S.concealmentEvents)!==null&&E!==void 0?E:t.concealmentEvents;if(typeof A=="number"&&(n.totalSamplesReceived=A),typeof G=="number"&&(n.silentConcealedSamples=G),typeof W=="number"&&(n.concealmentEvents=W),typeof U=="number"&&(n.concealedSamples=U),T&&A&&(n.accelerateRate=T/A),I&&w){const X=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let tt=X.jitterBufferMs;const nt=w-X.jitterBufferEmittedCount;nt>0&&(tt=1e3*(I-X.jitterBufferDelay)/nt),n.jitterBufferMs=Math.round(tt),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:I,jitterBufferEmittedCount:w,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=P;let F=1920;D&&A&&(F=A/D/50,n.receivedFrames=Math.round(A/F)),U&&(n.droppedFrames=Math.round(U/F))}processRemoteInboundStats(t,e){const n=this.report.get(t);n&&(e.packetsLost=n.packetsLost,n.roundTripTime&&(e.rttMs=1e3*n.roundTripTime),n.jitter&&(e.jitterMs=1e3*n.jitter),n.timestamp&&(e.timestamp=n.timestamp))}getCodecFromCodecStats(t){const e=this.report.get(t);if(!e)return"";const n=e.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let t=0,e=null,n=null;this.mediaBytesSent.forEach(o=>{t+=o.diffMean()}),this.mediaBytesRetransmit.forEach(o=>{e=e===null?o.diffMean():e+o.diffMean()}),this.mediaBytesTargetEncode.forEach(o=>{n=n===null?o.diffMean():n+o.diffMean()});const i=e!==null?t-e:t;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},e!==null&&(this._stats.bitrate.retransmit=8*e/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},nQ=class extends Yy{updateStats(){return gt.resolve()}};function Xy(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const c=function(){const l=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return l&&l[0]?Number(l[0].split("/")[1]):null}();return c?c<76?new eQ(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o}):new A1(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o}):function(l){if(!window.RTCStatsReport)return!1;const u=l.getStats();return!!(u instanceof gt||function(p){return!!p&&(typeof p=="object"||typeof p=="function")&&typeof p.then=="function"}(u))}(t)?new A1(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o}):new nQ(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o})}const O1="websdk_ng_install_id";function Jy(){try{if(x("INSTALL_ID"))return x("INSTALL_ID");let t=window.localStorage.getItem(O1);return t||(t=Kc(),window.localStorage.setItem(O1,t)),ye("INSTALL_ID",t),t}catch{return}}const Ur=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const e=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(e&&e[1]&&e[2]){const n=e[1],i=e[2];return"".concat(n,".").concat(i)}return"4.0.0.999"}("4.24.0"),Qy=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Yc=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Yn=function(){const t="us".concat("erna","me"),e="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),o=[];for(let u=0;u<6;u++)o.push("1");const c=o.join(""),l={};return l[t]=i,l[e]=c,Object.assign(l,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Yn;const E_={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},Zy={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},$y="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",t0={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},Be=ct(ct(ct(ct({},t0),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:Zy,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},E_),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function ye(t,e,n){var i,o,c;pt(i=Object.keys(Be)).call(i,t)&&(!n&&pt(o=Object.keys(Ks)).call(o,t)||(Be[t]=e,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS"||e!==!0||(Be.ENABLE_ENCODED_TRANSFORM=!0),t==="USE_NEW_NETWORK_CONFIG"&&e&&(c=!!e,Be.USE_NEW_NETWORK_CONFIG=c,c&&(Be.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Be.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Be.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Be.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Be.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Be.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Be.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&e&&(Be.ENABLE_INSTANT_VIDEO=!0,Be.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&e&&(Be.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&e&&(Be.NEW_TURN_MODE||(Be.NEW_TURN_MODE=4))))}function x(t){return Be[t]}Qy||(Be.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Be.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Be.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Be.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Be.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Be.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Be.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Be.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Be.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Be.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Be.AREAS=["NORTH_AMERICA","OVERSEA"]);let N1=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const Ks={};var Bt=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",t.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",t.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",t.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",t.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",t.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",t.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(Bt||{});let kh=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const D1=128,iQ=96,P1=1e3,wl=10;let rQ=0;var k1=(()=>{var t={8:(i,o,c)=>{c.r(o),c.d(o,{Parser:()=>nt,Printer:()=>me,parse:()=>ut,print:()=>Tt});const l=`
`,u="".concat("\r").concat(l),p=" ";let m;function _(rt){return rt>="0"&&rt<="9"}function E(rt){return rt>="!"&&rt<="~"}function S(rt){return E(rt)||rt>=""&&rt<=""}function T(rt){return rt==="!"||rt>="#"&&rt<="'"||rt>="*"&&rt<="+"||rt>="-"&&rt<="."||rt>="0"&&rt<="9"||rt>="A"&&rt<="Z"||rt>="^"&&rt<="~"}function A(rt){return rt>="1"&&rt<="9"}function I(rt){return rt>="A"&&rt<="Z"||rt>="a"&&rt<="z"}function w(rt){return rt==="d"||rt==="h"||rt==="m"||rt==="s"}function P(rt){return rt>""&&rt<"	"||rt>"\v"&&rt<"\f"||rt>""&&rt<""}function D(rt){return I(rt)||_(rt)||rt==="+"||rt==="/"}function U(rt){return _(rt)||I(rt)||rt==="+"||rt==="/"||rt==="-"||rt==="_"}function G(rt){return I(rt)||_(rt)||rt==="+"||rt==="/"}function W(rt,b){var V=Object.keys(rt);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(rt);b&&(B=B.filter(function(dt){return Object.getOwnPropertyDescriptor(rt,dt).enumerable})),V.push.apply(V,B)}return V}function F(rt){for(var b=1;b<arguments.length;b++){var V=arguments[b]!=null?arguments[b]:{};b%2?W(Object(V),!0).forEach(function(B){X(rt,B,V[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(rt,Object.getOwnPropertyDescriptors(V)):W(Object(V)).forEach(function(B){Object.defineProperty(rt,B,Object.getOwnPropertyDescriptor(V,B))})}return rt}function X(rt,b,V){return b in rt?Object.defineProperty(rt,b,{value:V,enumerable:!0,configurable:!0,writable:!0}):rt[b]=V,rt}(function(rt){rt.VERSION="v",rt.ORIGIN="o",rt.SESSION_NAME="s",rt.INFORMATION="i",rt.URI="u",rt.EMAIL="e",rt.PHONE="p",rt.CONNECTION="c",rt.BANDWIDTH="b",rt.TIME="t",rt.REPEAT="r",rt.ZONE_ADJUSTMENTS="z",rt.KEY="k",rt.ATTRIBUTE="a",rt.MEDIA="m"})(m||(m={}));class tt{consumeText(b,V){let B=V;for(;B<b.length;){const dt=b[B];if(dt==="\0"||dt==="\r"||dt===l)break;B+=1}if(B-V==0)throw new Error("Invalid text, at ".concat(b));return B}consumeUnicastAddress(b,V,B){return this.consumeTill(b,V,p)}consumeOneOrMore(b,V,B){let dt=V;for(;B(b[dt]);)dt++;if(dt-V==0)throw new Error("Invalid rule at ".concat(V,"."));return dt}consumeSpace(b,V){if(b[V]===p)return V+1;throw new Error("Invalid space at ".concat(V,"."))}consumeIP4Address(b,V){let B=V;for(let dt=0;dt<4;dt++)if(B=this.consumeDecimalUChar(b,B),dt!==3){if(b[B]!==".")throw new Error("Invalid IP4 address.");B++}return B}consumeDecimalUChar(b,V){let B=V;for(let Wt=0;Wt<3&&_(b[B]);Wt++,B++);if(B-V==0)throw new Error("Invalid decimal uchar.");const dt=parseInt(b.slice(V,B));if(dt>=0&&dt<=255)return B;throw new Error("Invalid decimal uchar")}consumeIP6Address(b,V){let B=this.consumeHexpart(b,V);return b[B]===":"&&(B+=1,B=this.consumeIP4Address(b,B)),B}consumeHexpart(b,V){let B=V;if(b[B]===":"&&b[B+1]===":"){B+=2;try{B=this.consumeHexseq(b,B)}catch{}return B}if(B=this.consumeHexseq(b,B),b[B]===":"&&b[B+1]===":"){B+=2;try{B=this.consumeHexseq(b,B)}catch{}return B}return B}consumeHexseq(b,V){let B=V;for(;B=this.consumeHex4(b,B),b[B]===":"&&b[B+1]!==":";)B+=1;return B}consumeHex4(b,V){let B=0;for(;B<4;B++)if(!((dt=b[V+B])>="0"&&dt<="9"||dt>="a"&&dt<="f"||dt>="A"&&dt<="F")){if(B===0)throw new Error("Invalid hex 4");break}var dt;return V+B}consumeFQDN(b,V){let B=V;for(;_(b[B])||I(b[B])||b[B]==="-"||b[B]===".";)B+=1;if(B-V<4)throw new Error("Invalid FQDN");return B}consumeExtnAddr(b,V){return this.consumeOneOrMore(b,V,S)}consumeMulticastAddress(b,V,B){switch(B){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(b,V);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(b,V);default:try{return this.consumeFQDN(b,V)}catch{return this.consumeExtnAddr(b,V)}}}consumeIP6MulticastAddress(b,V){const B=this.consumeHexpart(b,V);return b[B]==="/"?this.consumeInteger(b,B+1):B}consumeIP4MulticastAddress(b,V){let B=V+3;const dt=b.slice(V,B),Wt=parseInt(dt);if(Wt<224||Wt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let De=0;De<3;De++){if(b[B]!==".")throw new Error("Invalid IP4 multicast address.");B+=1,B=this.consumeDecimalUChar(b,B)}return b[B]==="/"&&(B+=1),B=this.consumeTTL(b,B),b[B]==="/"&&(B=this.consumeInteger(b,B)),B}consumeInteger(b,V){if(!A(b[V]))throw new Error("Invalid integer.");for(V+=1;_(b[V]);)V+=1;return V}consumeTTL(b,V){if(b[V]==="0")return V+1;if(!A(b[V]))throw new Error("Invalid TTL.");V+=1;for(let B=0;B<2&&_(b[V]);B++)V+=1;return V}consumeToken(b,V){return this.consumeOneOrMore(b,V,T)}consumeTime(b,V){let B=V;if(b[B]==="0")return B+1;for(A(b[B])&&(B+=1);_(b[B]);)B++;if(B-V<10)throw new Error("Invalid time");return B}consumeAddress(b,V){return this.consumeTill(b,V,p)}consumeTypedTime(b,V){let B=V;return B=this.consumeOneOrMore(b,B,_),w(b[B])?B+1:B}consumeRepeatInterval(b,V){if(!A(b[V]))throw new Error("Invalid repeat interval");for(V+=1;_(b[V]);)V+=1;return w(b[V])&&(V+=1),V}consumePort(b,V){return this.consumeOneOrMore(b,V,_)}consume(b,V,B){for(let dt=0;dt<B.length;dt++){if(V+dt>=b.length)throw new Error("consume exceeding value length");if(b[V+dt]!==B[dt])throw new Error("consume ".concat(B," failed at ").concat(dt))}return V+B.length}consumeTill(b,V,B){let dt=V;for(;dt<b.length&&(typeof B!="string"||b[dt]!==B)&&(typeof B!="function"||!B(b[dt]));)dt++;return dt}}class nt extends tt{constructor(){super(),X(this,"records",[]),X(this,"currentLine",0)}parse(b){const V=this.probeEOL(b);this.records=b.split(V).filter(ra=>!!hi(ra).call(ra)).map(this.parseLine),this.currentLine=0;const B=this.parseVersion(),dt=this.parseOrigin(),Wt=this.parseSessionName(),De=this.parseInformation(),Sn=this.parseUri(),Kr=this.parseEmail(),Is=this.parsePhone(),Ep=this.parseConnection(),pd=this.parseBandWidth(),au=this.parseTimeFields(),Og=this.parseKey(),Ng=this.parseSessionAttribute(),Yr=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:B,origin:dt,sessionName:Wt,information:De,uri:Sn,emails:Kr,phones:Is,connection:Ep,bandwidths:pd,timeFields:au,key:Og,attributes:Ng,mediaDescriptions:Yr}}getCurrentRecord(){const b=this.records[this.currentLine];if(!b)throw new Error("Record doesn't exit.");return b}probeEOL(b){for(let V=0;V<b.length;V++)if(b[V]===l)return b[V-1]==="\r"?u:l;throw new Error("Invalid newline character.")}parseLine(b,V){if(b.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const B=b[0];if(b[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:B,value:b.slice(2),line:V,cur:0}}parseSessionAttribute(){const b=new Kt;for(;this.currentLine<this.records.length;){const V=this.getCurrentRecord();if(V.type!==m.ATTRIBUTE)break;const B={attField:this.extractOneOrMore(V,dt=>T(dt)&&dt!==":"),_cur:0};V.value[V.cur]===":"&&(V.cur+=1,B.attValue=this.extractOneOrMore(V,P)),b.parse(B),this.currentLine++}return b.digest()}parseMediaAttributes(b){const V=new Xt(b);for(;this.currentLine<this.records.length;){const B=this.getCurrentRecord();if(B.type!==m.ATTRIBUTE)break;const dt={attField:this.extractOneOrMore(B,Wt=>T(Wt)&&Wt!==":"),_cur:0};B.value[B.cur]===":"&&(B.cur+=1,dt.attValue=this.extractOneOrMore(B,P)),V.parse(dt),this.currentLine++}return V.digest()}parseKey(){const b=this.getCurrentRecord();if(b.type===m.KEY){if(b.value==="prompt"||b.value==="clear:"||b.value==="base64:"||b.value==="uri:")return b.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const b=this.getCurrentRecord();if(b.type===m.ZONE_ADJUSTMENTS){const V=[];for(;;)try{const B=this.extract(b,this.consumeTime);this.consumeSpaceForRecord(b);let dt=!1;b.value[b.cur]==="-"&&(dt=!0,b.cur+=1);const Wt=this.extract(b,this.consumeTypedTime);V.push({time:B,typedTime:Wt,back:dt})}catch{break}if(V.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,V}return[]}parseRepeat(){const b=[];for(;;){const V=this.getCurrentRecord();if(V.type!==m.REPEAT)break;{const B=this.extract(V,this.consumeRepeatInterval),dt=this.parseTypedTime(V);b.push({repeatInterval:B,typedTimes:dt}),this.currentLine++}}return b}parseTypedTime(b){const V=[];for(;;)try{this.consumeSpaceForRecord(b),V.push(this.extract(b,this.consumeTypedTime))}catch{break}if(V.length===0)throw new Error("Invalid typed time.");return V}parseTime(){const b=this.getCurrentRecord(),V=this.extract(b,this.consumeTime);this.consumeSpaceForRecord(b);const B=this.extract(b,this.consumeTime);return this.currentLine++,{startTime:V,stopTime:B}}parseBandWidth(){const b=[];for(;this.currentLine<this.records.length;){const V=this.getCurrentRecord();if(V.type!==m.BANDWIDTH)break;{const B=this.extractOneOrMore(V,T);if(V.value[V.cur]!==":")throw new Error("Invalid bandwidth field.");V.cur++;const dt=this.extractOneOrMore(V,_);b.push({bwtype:B,bandwidth:dt}),this.currentLine++}}return b}parseVersion(){const b=this.getCurrentRecord();if(b.type!==m.VERSION)throw new Error("first sdp record must be version");const V=b.value.slice(0,this.consumeOneOrMore(b.value,0,_));if(V.length!==b.value.length)throw new Error('invalid proto version, "v='.concat(b.value,'"'));return this.currentLine++,V}parseOrigin(){const b=this.getCurrentRecord();if(b.type!==m.ORIGIN)throw new Error("second line of sdp must be origin");const V=this.extractOneOrMore(b,S);this.consumeSpaceForRecord(b);const B=this.extractOneOrMore(b,_);this.consumeSpaceForRecord(b);const dt=this.extractOneOrMore(b,_);this.consumeSpaceForRecord(b);const Wt=this.extractOneOrMore(b,T);this.consumeSpaceForRecord(b);const De=this.extractOneOrMore(b,T);this.consumeSpaceForRecord(b);const Sn=this.extract(b,this.consumeUnicastAddress);return this.currentLine++,{username:V,sessId:B,sessVersion:dt,nettype:Wt,addrtype:De,unicastAddress:Sn}}parseSessionName(){const b=this.getCurrentRecord();if(b.type===m.SESSION_NAME){const V=this.extract(b,this.consumeText);return this.currentLine++,V}}parseInformation(){const b=this.getCurrentRecord();if(b.type!==m.INFORMATION)return;const V=this.extract(b,this.consumeText);return this.currentLine++,V}parseUri(){const b=this.getCurrentRecord();if(b.type===m.URI)return this.currentLine++,b.value}parseEmail(){const b=[];for(;;){const V=this.getCurrentRecord();if(V.type!==m.EMAIL)break;b.push(V.value),this.currentLine++}return b}parsePhone(){const b=[];for(;;){const V=this.getCurrentRecord();if(V.type!==m.PHONE)break;b.push(V.value),this.currentLine++}return b}parseConnection(){const b=this.getCurrentRecord();if(b.type===m.CONNECTION){const V=this.extractOneOrMore(b,T);this.consumeSpaceForRecord(b);const B=this.extractOneOrMore(b,T);this.consumeSpaceForRecord(b);const dt=this.extract(b,this.consumeAddress);return this.currentLine++,{nettype:V,addrtype:B,address:dt}}}parseMedia(){const b=this.getCurrentRecord(),V=this.extract(b,this.consumeToken);this.consumeSpaceForRecord(b);let B=this.extract(b,this.consumePort);b.value[b.cur]==="/"&&(b.cur+=1,B+=this.extract(b,this.consumeInteger)),this.consumeSpaceForRecord(b);const dt=[];for(dt.push(this.extract(b,this.consumeToken));b.value[b.cur]==="/";)b.cur+=1,dt.push(this.extract(b,this.consumeToken));if(dt.length===0)throw new Error("Invalid proto");const Wt=this.parseFmt(b);return this.currentLine++,{mediaType:V,port:B,protos:dt,fmts:Wt}}parseTimeFields(){const b=[];for(;this.getCurrentRecord().type===m.TIME;){const V=this.parseTime(),B=this.parseRepeat(),dt=this.parseZone();b.push({time:V,repeats:B,zones:dt})}return b}parseMediaDescription(){const b=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===m.MEDIA;){const V=this.parseMedia(),B=this.parseInformation(),dt=this.parseConnections(),Wt=this.parseBandWidth(),De=this.parseKey(),Sn=this.parseMediaAttributes(V);b.push({media:V,information:B,connections:dt,bandwidths:Wt,key:De,attributes:Sn})}return b}parseConnections(){const b=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===m.CONNECTION;)b.push(this.parseConnection());return b}parseFmt(b){const V=[];for(;;)try{this.consumeSpaceForRecord(b),V.push(this.extract(b,this.consumeToken))}catch{break}if(V.length===0)throw new Error("Invalid fmts");return V}extract(b,V){for(var B=arguments.length,dt=new Array(B>2?B-2:0),Wt=2;Wt<B;Wt++)dt[Wt-2]=arguments[Wt];const De=V.call(this,b.value,b.cur,...dt),Sn=b.value.slice(b.cur,De);return b.cur=De,Sn}extractOneOrMore(b,V){const B=this.consumeOneOrMore(b.value,b.cur,V),dt=b.value.slice(b.cur,B);return b.cur=B,dt}consumeSpaceForRecord(b){if(b.value[b.cur]!==p)throw new Error("Invalid space at ".concat(b.cur,"."));b.cur+=1}}class at extends tt{constructor(){super(...arguments),X(this,"attributes",void 0),X(this,"digested",!1)}extractOneOrMore(b,V,B){const dt=this.consumeOneOrMore(b.attValue,b._cur,V),Wt=b.attValue.slice(b._cur,dt),[De,Sn]=B||[];if(typeof De=="number"&&Wt.length<De)throw new Error("error in length, should be more or equal than ".concat(De," characters."));if(typeof Sn=="number"&&Wt.length>Sn)throw new Error("error in length, should be less or equal than ".concat(Sn," characters."));return b._cur=dt,Wt}consumeAttributeSpace(b){if(b.attValue[b._cur]!==p)throw new Error("Invalid space at ".concat(b._cur,"."));b._cur+=1}extract(b,V){if(!b.attValue)throw new Error("Nothing to extract from attValue.");for(var B=arguments.length,dt=new Array(B>2?B-2:0),Wt=2;Wt<B;Wt++)dt[Wt-2]=arguments[Wt];const De=V.call(this,b.attValue,b._cur,...dt),Sn=b.attValue.slice(b._cur,De);return b._cur=De,Sn}atEnd(b){if(!b.attValue)throw new Error;return b._cur>=b.attValue.length}peekChar(b){if(!b.attValue)throw new Error;return b.attValue[b._cur]}peek(b,V){if(!b.attValue)throw new Error;for(let B=0;B<V.length;B++)if(V[B]!==b.attValue[b._cur+B])return!1;return!0}parseIceUfrag(b){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(b,D,[4,256])}parseIcePwd(b){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(b,D,[22,256])}parseIceOptions(b){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const V=[];for(;!this.atEnd(b);){V.push(this.extractOneOrMore(b,D));try{this.consumeAttributeSpace(b)}catch(B){if(this.atEnd(b))break;throw B}}this.attributes.iceOptions=V}parseFingerprint(b){const V=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const B=this.extract(b,this.consumeTill);this.attributes.fingerprints.push({hashFunction:V,fingerprint:B})}parseExtmap(b){const V=this.extractOneOrMore(b,_);let B;this.peekChar(b)==="/"&&(this.extract(b,this.consume,"/"),B=this.extract(b,this.consumeToken)),this.consumeAttributeSpace(b);const dt=this.extract(b,this.consumeTill,p),Wt=F(F({entry:parseInt(V,10)},B&&{direction:B}),{},{extensionName:dt});this.peekChar(b)===p&&(this.consumeAttributeSpace(b),Wt.extensionAttributes=this.extract(b,this.consumeTill)),this.attributes.extmaps.push(Wt)}parseSetup(b){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const V=this.extract(b,this.consumeTill);if(V!=="active"&&V!=="passive"&&V!=="actpass"&&V!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=V}}class Kt extends at{constructor(){super(...arguments),X(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(b){if(this.digested)throw new Error("already digested");try{switch(b.attField){case"group":this.parseGroup(b);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(b);break;case"ice-pwd":this.parseIcePwd(b);break;case"ice-options":this.parseIceOptions(b);break;case"fingerprint":this.parseFingerprint(b);break;case"setup":this.parseSetup(b);break;case"tls-id":this.parseTlsId(b);break;case"identity":this.parseIdentity(b);break;case"extmap":this.parseExtmap(b);break;case"msid-semantic":this.parseMsidSemantic(b);break;default:b.ignored=!0,this.attributes.unrecognized.push(b)}}catch(V){throw console.error("parsing session attribute ".concat(b.attField,' error, "a=').concat(b.attField,":").concat(b.attValue,'"')),V}if(!b.ignored&&b.attValue&&!this.atEnd(b))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(b){const V=this.extract(b,this.consumeToken),B=[];for(;!this.atEnd(b)&&this.peekChar(b)===p;)this.consumeAttributeSpace(b),B.push(this.extract(b,this.consumeToken));this.attributes.groups.push({semantic:V,identificationTag:B})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(b){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(b,U)}parseIdentity(b){const V=this.extractOneOrMore(b,G),B=[];for(;!this.atEnd(b)&&this.peekChar(b)===p;){this.consumeAttributeSpace(b);const dt=this.extract(b,this.consumeToken);this.extract(b,this.consume,"=");const Wt=this.extractOneOrMore(b,De=>De!==p&&P(De));B.push({name:dt,value:Wt})}this.attributes.identities.push({assertionValue:V,extensions:B})}parseMsidSemantic(b){this.peekChar(b)===p&&this.consumeAttributeSpace(b);const V={semantic:this.extract(b,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(b)}catch{break}if(this.peekChar(b)==="*"){this.extract(b,this.consume,"*"),V.applyForAll=!0;break}{const B=this.extract(b,this.consumeTill,p);V.identifierList.push(B)}}this.attributes.msidSemantic=V}}class Xt extends at{constructor(b){super(),X(this,"attributes",void 0),b.protos.indexOf("RTP")!==-1||b.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(b){if(this.digested)throw new Error("already digested");try{switch(b.attField){case"extmap":this.parseExtmap(b);break;case"setup":this.parseSetup(b);break;case"ice-ufrag":this.parseIceUfrag(b);break;case"ice-pwd":this.parseIcePwd(b);break;case"ice-options":this.parseIceOptions(b);break;case"candidate":this.parseCandidate(b);break;case"remote-candidate":this.parseRemoteCandidate(b);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(b);break;case"rtpmap":this.parseRtpmap(b);break;case"ptime":this.parsePtime(b);break;case"maxptime":this.parseMaxPtime(b);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(b);break;case"ssrc":this.parseSSRC(b);break;case"fmtp":this.parseFmtp(b);break;case"rtcp-fb":this.parseRtcpFb(b);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(b);break;case"mid":this.parseMid(b);break;case"msid":this.parseMsid(b);break;case"imageattr":this.parseImageAttr(b);break;case"rid":this.parseRid(b);break;case"simulcast":this.parseSimulcast(b);break;case"sctp-port":this.parseSctpPort(b);break;case"max-message-size":this.parseMaxMessageSize(b);break;case"ssrc-group":this.parseSSRCGroup(b);break;default:b.ignored=!0,this.attributes.unrecognized.push(b)}}catch(V){throw console.error("parsing media attribute ".concat(b.attField,' error, "a=').concat(b.attField,":").concat(b.attValue,'"')),V}if(!b.ignored&&b.attValue&&!this.atEnd(b))throw new Error("attribute parsing error")}parseCandidate(b){const V=this.extractOneOrMore(b,D,[1,32]);this.consumeAttributeSpace(b);const B=this.extractOneOrMore(b,_,[1,5]);this.consumeAttributeSpace(b);const dt=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const Wt=this.extractOneOrMore(b,_,[1,10]);this.consumeAttributeSpace(b);const De=this.extract(b,this.consumeAddress);this.consumeAttributeSpace(b);const Sn=this.extract(b,this.consumePort);this.consumeAttributeSpace(b),this.extract(b,this.consume,"typ"),this.consumeAttributeSpace(b);const Kr={foundation:V,componentId:B,transport:dt,priority:Wt,connectionAddress:De,port:Sn,type:this.extract(b,this.consumeToken),extension:{}};for(this.peek(b," raddr")&&(this.extract(b,this.consume," raddr"),this.consumeAttributeSpace(b),Kr.relAddr=this.extract(b,this.consumeAddress)),this.peek(b," rport")&&(this.extract(b,this.consume," rport"),this.consumeAttributeSpace(b),Kr.relPort=this.extract(b,this.consumePort));this.peekChar(b)===p;){this.consumeAttributeSpace(b);const Is=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b),Kr.extension[Is]=this.extractOneOrMore(b,E)}this.attributes.candidates.push(Kr)}parseRemoteCandidate(b){const V=[];for(;;){const B=this.extractOneOrMore(b,_,[1,5]);this.consumeAttributeSpace(b);const dt=this.extract(b,this.consumeAddress);this.consumeAttributeSpace(b);const Wt=this.extract(b,this.consumePort);V.push({componentId:B,connectionAddress:dt,port:Wt});try{this.consumeAttributeSpace(b)}catch{break}}this.attributes.remoteCandidatesList.push(V)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(b){const V=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const B=this.extract(b,this.consumeTill,"/");this.extract(b,this.consume,"/");const dt={encodingName:B,clockRate:this.extractOneOrMore(b,_)};this.atEnd(b)||this.peekChar(b)!=="/"||(this.extract(b,this.consume,"/"),dt.encodingParameters=parseInt(this.extract(b,this.consumeTill),10));const Wt=this.attributes.payloads.find(De=>De.payloadType===parseInt(V,10));Wt?Wt.rtpMap=dt:this.attributes.payloads.push({payloadType:parseInt(V,10),rtpMap:dt,rtcpFeedbacks:[]})}parsePtime(b){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(b,this.consumeTill)}parseMaxPtime(b){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(b,this.consumeTill)}parseDirection(b){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=b.attField}parseSSRC(b){const V=this.extractOneOrMore(b,_);this.consumeAttributeSpace(b);const B=this.extract(b,this.consumeTill,":");let dt;this.peekChar(b)===":"&&(this.extract(b,this.consume,":"),dt=this.extract(b,this.consumeTill));const Wt=this.attributes.ssrcs.find(De=>De.ssrcId===parseInt(V,10));Wt?Wt.attributes[B]=dt:this.attributes.ssrcs.push({ssrcId:parseInt(V,10),attributes:{[B]:dt}})}parseFmtp(b){const V=this.extract(b,this.consumeTill,p);this.consumeAttributeSpace(b);const B=this.extract(b,this.consumeTill),dt={};B.split(";").forEach(De=>{let[Sn,Kr]=De.split("=");Sn=hi(Sn).call(Sn);const Is=typeof Kr=="string"?hi(Kr).call(Kr):null;typeof Sn=="string"&&Sn.length>0&&(dt[Sn]=Is)});const Wt=this.attributes.payloads.find(De=>De.payloadType===parseInt(V,10));Wt?Wt.fmtp={parameters:dt}:this.attributes.payloads.push({payloadType:parseInt(V,10),rtcpFeedbacks:[],fmtp:{parameters:dt}})}parseFmtParameters(b){const V={},B=this.extract(b,this.consumeTill,"=");b._cur++;const dt=this.extract(b,this.consumeTill,";");for(V[B]=dt;b.attValue[b._cur]===";";){const Wt=this.extract(b,this.consumeTill,"=");b._cur++;const De=this.extract(b,this.consumeTill,";");V[Wt]=De}return V}parseRtcpFb(b){let V="";V=this.peekChar(b)==="*"?this.extract(b,this.consume,"*"):this.extract(b,this.consumeTill,p),this.consumeAttributeSpace(b);const B=this.extract(b,this.consumeTill,p);let dt;if(B==="trr-int")dt={type:B,interval:this.extract(b,this.consumeTill)};else{const Wt={type:B};this.peekChar(b)===p&&(this.consumeAttributeSpace(b),Wt.parameter=this.extract(b,this.consumeToken),this.peekChar(b)===p&&(Wt.additional=this.extract(b,this.consumeTill))),dt=Wt}if(V==="*")this.attributes.rtcpFeedbackWildcards.push(dt);else{const Wt=this.attributes.payloads.find(De=>De.payloadType===parseInt(V,10));Wt?Wt.rtcpFeedbacks.push(dt):this.attributes.payloads.push({payloadType:parseInt(V,10),rtcpFeedbacks:[dt]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(b){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const V={port:this.extract(b,this.consumePort)};this.peekChar(b)===p&&(this.consumeAttributeSpace(b),V.netType=this.extractOneOrMore(b,T),this.consumeAttributeSpace(b),V.addressType=this.extractOneOrMore(b,T),this.consumeAttributeSpace(b),V.address=this.extract(b,this.consumeAddress)),this.attributes.rtcp=V}parseMsid(b){const V={id:this.extractOneOrMore(b,T,[1,64])};this.peekChar(b)===p&&(this.consumeAttributeSpace(b),V.appdata=this.extractOneOrMore(b,T,[1,64])),this.attributes.msids.push(V)}parseImageAttr(b){this.attributes.imageattr.push(b.attValue)}parseRid(b){const V=this.extractOneOrMore(b,dt=>I(dt)||_(dt)||dt==="_"||dt==="-");this.consumeAttributeSpace(b);const B={id:V,direction:this.extract(b,this.consumeToken),params:[]};if(this.peekChar(b)===p){if(this.consumeAttributeSpace(b),this.peek(b,"pt=")){this.extract(b,this.consume,"pt=");const dt=[];for(;;){const Wt=this.extract(b,this.consumeToken);dt.push(Wt);try{this.extract(b,this.consume,",")}catch{break}}B.payloads=dt,this.peekChar(b)===p&&this.extract(b,this.consume,p)}for(;;){const dt=this.extract(b,this.consumeToken);switch(dt){case"depend":{const Wt={type:dt,rids:this.extract(b,this.consume,"=").split(",")};B.params.push(Wt);break}default:{const Wt={type:dt};this.peekChar(b)==="="&&(this.extract(b,this.consume,"="),Wt.val=this.extract(b,this.consumeTill,";")),B.params.push(Wt)}}try{this.extract(b,this.consume,";")}catch{break}}}this.attributes.rids.push(B)}parseSimulcast(b){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=b.attValue,this.extract(b,this.consumeTill)}parseSctpPort(b){this.attributes.sctpPort=this.extractOneOrMore(b,_,[1,5])}parseMaxMessageSize(b){this.attributes.maxMessageSize=this.extractOneOrMore(b,_,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(b){this.attributes.mid=this.extract(b,this.consumeToken)}parseSSRCGroup(b){const V=this.extract(b,this.consumeToken),B=[];for(;;)try{this.consumeAttributeSpace(b);const dt=this.extract(b,this.consumeInteger);B.push(parseInt(dt,10))}catch{break}this.attributes.ssrcGroups.push({semantic:V,ssrcIds:B})}}function Ut(rt,b,V){return b in rt?Object.defineProperty(rt,b,{value:V,enumerable:!0,configurable:!0,writable:!0}):rt[b]=V,rt}class me{constructor(){Ut(this,"eol",u)}print(b,V){let B="";return V&&(this.eol=V),B+=this.printVersion(b.version),B+=this.printOrigin(b.origin),B+=this.printSessionName(b.sessionName),B+=this.printInformation(b.information),B+=this.printUri(b.uri),B+=this.printEmail(b.emails),B+=this.printPhone(b.phones),B+=this.printConnection(b.connection),B+=this.printBandwidth(b.bandwidths),B+=this.printTimeFields(b.timeFields),B+=this.printKey(b.key),B+=this.printSessionAttributes(b.attributes),B+=this.printMediaDescription(b.mediaDescriptions),B}printVersion(b){return"v=".concat(b).concat(this.eol)}printOrigin(b){return"o=".concat(b.username," ").concat(b.sessId," ").concat(b.sessVersion," ").concat(b.nettype," ").concat(b.addrtype," ").concat(b.unicastAddress).concat(this.eol)}printSessionName(b){return b?"s=".concat(b).concat(this.eol):""}printInformation(b){return b?"i=".concat(b).concat(this.eol):""}printUri(b){return b?"u=".concat(b).concat(this.eol):""}printEmail(b){let V="";for(const B of b)V+="e=".concat(B).concat(this.eol);return V}printPhone(b){let V="";for(const B of b)V+="e=".concat(B).concat(this.eol);return V}printConnection(b){return b?"c=".concat(b.nettype," ").concat(b.addrtype," ").concat(b.address).concat(this.eol):""}printBandwidth(b){let V="";for(const B of b)V+="b=".concat(B.bwtype,":").concat(B.bandwidth).concat(this.eol);return V}printTimeFields(b){let V="";for(const B of b){V+="t=".concat(B.time.startTime," ").concat(B.time.startTime).concat(this.eol);for(const dt of B.repeats)V+="r=".concat(dt.repeatInterval," ").concat(dt.typedTimes.join(" ")).concat(this.eol);B.zoneAdjustments&&(V+="z=",V+="z=".concat(B.zoneAdjustments.map(dt=>"".concat(dt.time," ").concat(dt.back?"-":""," ").concat(dt.typedTime)).join(" ")).concat(this.eol),V+=this.eol)}return V}printKey(b){return b?"k=".concat(b).concat(this.eol):""}printAttributes(b){let V="";for(const B of b)V+="a=".concat(B.attField).concat(B.attValue?":".concat(B.attValue):"").concat(this.eol);return V}printMediaDescription(b){let V="";for(const B of b)V+=this.printMedia(B.media),V+=this.printInformation(B.information),V+=this.printConnections(B.connections),V+=this.printBandwidth(B.bandwidths),V+=this.printKey(B.key),V+=this.printMediaAttributes(B);return V}printConnections(b){let V="";for(const B of b)V+=this.printConnection(B);return V}printMedia(b){return"m=".concat(b.mediaType," ").concat(b.port," ").concat(b.protos.join("/")," ").concat(b.fmts.join(" ")).concat(this.eol)}printSessionAttributes(b){return new ni(this.eol).print(b)}printMediaAttributes(b){return new et(this.eol).print(b)}}class he{constructor(b){Ut(this,"eol",void 0),this.eol=b}printIceUfrag(b){return b===void 0?"":"a=ice-ufrag:".concat(b).concat(this.eol)}printIcePwd(b){return b===void 0?"":"a=ice-pwd:".concat(b).concat(this.eol)}printIceOptions(b){return b===void 0?"":"a=ice-options:".concat(b.join(p)).concat(this.eol)}printFingerprints(b){return b.length>0?b.map(V=>"a=fingerprint:".concat(V.hashFunction).concat(p).concat(V.fingerprint)).join(this.eol)+this.eol:""}printExtmap(b){return b.map(V=>"a=extmap:".concat(V.entry).concat(V.direction?"/".concat(V.direction):"").concat(p).concat(V.extensionName).concat(V.extensionAttributes?"".concat(p).concat(V.extensionAttributes):"").concat(this.eol)).join("")}printSetup(b){return b===void 0?"":"a=setup:".concat(b).concat(this.eol)}printUnrecognized(b){return b.map(V=>"a=".concat(V.attField).concat(V.attValue?":".concat(V.attValue):"").concat(this.eol)).join("")}}class ni extends he{print(b){let V="";return V+=this.printGroups(b.groups),V+=this.printMsidSemantic(b.msidSemantic),V+=this.printIceLite(b.iceLite),V+=this.printIceUfrag(b.iceUfrag),V+=this.printIcePwd(b.icePwd),V+=this.printIceOptions(b.iceOptions),V+=this.printFingerprints(b.fingerprints),V+=this.printSetup(b.setup),V+=this.printTlsId(b.tlsId),V+=this.printIdentity(b.identities),V+=this.printExtmap(b.extmaps),V+=this.printUnrecognized(b.unrecognized),V}printGroups(b){let V="";return b.length>0&&(V+=b.map(B=>"a=group:".concat(B.semantic).concat(B.identificationTag.map(dt=>"".concat(p).concat(dt)).join("")).concat(this.eol)).join("")),V}printIceLite(b){return b===void 0?"":"a=ice-lite"+this.eol}printTlsId(b){return b?"a=tls-id:".concat(b).concat(this.eol):""}printIdentity(b){return b.length===0?"":b.map(V=>"a=identity:".concat(V.assertionValue).concat(V.extensions.map(B=>"".concat(p).concat(B.name).concat(B.value?"=".concat(B.value):"")))).join(this.eol)+this.eol}printMsidSemantic(b){if(!b)return"";let V="a=msid-semantic:".concat(b.semantic);return b.applyForAll?V+="".concat(p,"*"):b.identifierList.length>0&&(V+=b.identifierList.map(B=>"".concat(p).concat(B))),V+this.eol}}class et extends he{print(b){const V=b.attributes;let B="";return B+=this.printRTCP(V.rtcp),B+=this.printIceUfrag(V.iceUfrag),B+=this.printIcePwd(V.icePwd),B+=this.printIceOptions(V.iceOptions),B+=this.printCandidates(V.candidates),B+=this.printRemoteCandidatesList(V.remoteCandidatesList),B+=this.printEndOfCandidates(V.endOfCandidates),B+=this.printFingerprints(V.fingerprints),B+=this.printSetup(V.setup),B+=this.printMid(V.mid),B+=this.printExtmap(V.extmaps),B+=this.printRTPRelated(V),B+=this.printPtime(V.ptime),B+=this.printMaxPtime(V.maxPtime),B+=this.printDirection(V.direction),B+=this.printSSRCGroups(V.ssrcGroups),B+=this.printSSRC(V.ssrcs),B+=this.printRTCPMux(V.rtcpMux),B+=this.printRTCPMuxOnly(V.rtcpMuxOnly),B+=this.printRTCPRsize(V.rtcpRsize),B+=this.printMSId(V.msids),B+=this.printImageattr(V.imageattr),B+=this.printRid(V.rids),B+=this.printSimulcast(V.simulcast),B+=this.printSCTPPort(V.sctpPort),B+=this.printMaxMessageSize(V.maxMessageSize),B+=this.printUnrecognized(V.unrecognized),B}printCandidates(b){return b.map(V=>"a=candidate:".concat(V.foundation).concat(p).concat(V.componentId).concat(p).concat(V.transport).concat(p).concat(V.priority).concat(p).concat(V.connectionAddress).concat(p).concat(V.port).concat(p,"typ").concat(p).concat(V.type).concat(V.relAddr?"".concat(p,"raddr").concat(p).concat(V.relAddr):"").concat(V.relPort?"".concat(p,"rport").concat(p).concat(V.relPort):"").concat(Object.keys(V.extension).map(B=>"".concat(p).concat(B).concat(p).concat(V.extension[B])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(b){return b.map(V=>"a=remote-candidates:".concat(V.join(p)).concat(this.eol)).join("")}printEndOfCandidates(b){return b===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(b){if(!b.payloads)return"";const V=b.payloads;let B="";B+=b.rtcpFeedbackWildcards.map(dt=>this.printRTCPFeedback("*",dt)).join("");for(const dt of V)B+=this.printRtpMap(dt.payloadType,dt.rtpMap),B+=this.printFmtp(dt.payloadType,dt.fmtp),B+=dt.rtcpFeedbacks.map(Wt=>this.printRTCPFeedback(dt.payloadType,Wt)).join("");return B}printFmtp(b,V){if(!V)return"";const B=Object.keys(V.parameters);return B.length===1&&V.parameters[B[0]]===null?"a=fmtp:".concat(b).concat(p).concat(B[0]).concat(this.eol):"a=fmtp:".concat(b).concat(p).concat(Object.keys(V.parameters).map(dt=>"".concat(dt,"=").concat(V.parameters[dt])).join(";")).concat(this.eol)}printRtpMap(b,V){return V?"a=rtpmap:".concat(b).concat(p).concat(V.encodingName,"/").concat(V.clockRate).concat(V.encodingParameters?"/".concat(V.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(b,V){let B="a=rtcp-fb:".concat(b).concat(p),dt=V;return dt.type==="trr-int"?B+="ttr-int".concat(p).concat(dt.interval):(B+="".concat(dt.type),dt.parameter&&(B+="".concat(p).concat(dt.parameter),dt.additional&&(B+="".concat(p).concat(dt.additional)))),B+this.eol}printPtime(b){return b===void 0?"":"a=ptime:".concat(b).concat(this.eol)}printMaxPtime(b){return b===void 0?"":"a=maxptime:".concat(b).concat(this.eol)}printDirection(b){return b===void 0?"":"a=".concat(b).concat(this.eol)}printSSRC(b){return b.map(V=>Object.keys(V.attributes).map(B=>"a=ssrc:".concat(V.ssrcId.toString(10)).concat(p).concat(B).concat(V.attributes[B]?":".concat(V.attributes[B]):"").concat(this.eol)).join("")).join("")}printRTCPMux(b){return b===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(b){return b===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(b){return b===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(b){if(b===void 0)return"";let V="a=rtcp:".concat(b.port);return b.netType&&(V+="".concat(p).concat(b.netType)),b.addressType&&(V+="".concat(p).concat(b.addressType)),b.address&&(V+="".concat(p).concat(b.address)),V+this.eol}printMSId(b){return b.map(V=>"a=msid:".concat(V.id).concat(V.appdata?"".concat(p).concat(V.appdata):"").concat(this.eol)).join("")}printImageattr(b){return b.map(V=>"a=imageattr:".concat(V).concat(this.eol)).join("")}printRid(b){return b.map(V=>{let B="a=rid:".concat(V.id).concat(p).concat(V.direction);return V.payloads&&(B+="".concat(p,"pt=").concat(V.payloads.join(","))),V.params.length>0&&(B+="".concat(p).concat(V.params.map(dt=>dt.type==="depend"?"depend=".concat(dt.rids.join(",")):"".concat(dt.type,"=").concat(dt.val)).join(";"))),B+this.eol}).join("")}printSimulcast(b){return b===void 0?"":"a=simulcast:".concat(b).concat(this.eol)}printSCTPPort(b){return b===void 0?"":"a=sctp-port:".concat(b).concat(this.eol)}printMaxMessageSize(b){return b===void 0?"":"a=max-message-size:".concat(b).concat(this.eol)}printMid(b){return b===void 0?"":"a=mid:".concat(b).concat(this.eol)}printSSRCGroups(b){return b.map(V=>"a=ssrc-group:".concat(V.semantic).concat(V.ssrcIds.map(B=>"".concat(p).concat(B.toString(10))).join("")).concat(this.eol)).join("")}}function ut(rt){return new nt().parse(rt)}function Tt(rt,b){return new me().print(rt,b)}}},e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={exports:{}};return t[i](o,o.exports,n),o.exports}return n.d=(i,o)=>{for(var c in o)n.o(o,c)&&!n.o(i,c)&&Object.defineProperty(i,c,{enumerable:!0,get:o[c]})},n.o=(i,o)=>Object.prototype.hasOwnProperty.call(i,o),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n(8)})();function Wi(t){return k1.parse(t)}function xa(t,e){return k1.print(t,e)}var sQ=ss("Array","keys"),oQ=Ca,aQ=si,cQ=M,dQ=sQ,e0=Array.prototype,lQ={DOMTokenList:!0,NodeList:!0},uQ=function(t){var e=t.keys;return t===e0||cQ(e0,t)&&e===e0.keys||aQ(lQ,oQ(t))?dQ:e},Gi=h(uQ);function Je(t,e,n){return(e=function(i){var o=function(c,l){if(typeof c!="object"||!c)return c;var u=c[Symbol.toPrimitive];if(u!==void 0){var p=u.call(c,"string");if(typeof p!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}(i);return typeof o=="symbol"?o:o+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function L1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function Ht(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?L1(Object(n),!0).forEach(function(i){Je(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):L1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const M1=new class extends Ke{constructor(){super(...arguments),Je(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:e}=t;e[e.length-1]&&e[e.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=e[e.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class hQ{constructor(e){Je(this,"logger",void 0),Je(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function n0(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function x1(){const t=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?(e==null?void 0:e[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const Vr={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},S_=Date.now(),Lh=t=>{for(const e in Vr)if(Object.prototype.hasOwnProperty.call(Vr,e)&&Vr[e]===t)return e;return"DEFAULT"},R=new class{constructor(){Je(this,"proxyServerURL",void 0),Je(this,"logLevel",Vr.DEBUG),Je(this,"uploadState","collecting"),Je(this,"uploadLogWaitingList",[]),Je(this,"uploadLogUploadingList",[]),Je(this,"uploadErrorCount",0),Je(this,"currentLogID",0),Je(this,"url",void 0),Je(this,"extLog",(t,e)=>{this.appendLogToWaitingList(t,...e)})}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Vr.DEBUG].concat(e);this.log.apply(this,i)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Vr.INFO].concat(e);this.log.apply(this,i)}warning(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Vr.WARNING].concat(e);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Vr.ERROR].concat(e);this.log.apply(this,i)}upload(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Vr.DEBUG].concat(e);this.uploadLog.apply(this,i)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){ye("UPLOAD_LOG",!0)}disableLogUpload(){ye("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new hQ(this).prefix(t)}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-S_<100)return void setTimeout(()=>{this.log(...e)},Date.now()-S_);const i=Math.max(0,Math.min(4,e[0]));if(e[0]=n0()+" Agora-SDK [".concat(Lh(i),"]:"),this.appendLogToWaitingList(i,...e),i<this.logLevel)return;const o=n0()+" %cAgora-SDK [".concat(Lh(i),"]:");let c=[];if(!x("USE_NEW_LOG"))switch(i){case Vr.DEBUG:c=[o,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,c);break;case Vr.INFO:c=[o,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,c);break;case Vr.WARNING:c=[o,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,c);break;case Vr.ERROR:c=[o,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,c)}}uploadLog(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-S_<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-S_);const i=Math.max(0,Math.min(4,e[0]));e[0]=n0()+" Agora-SDK [".concat(Lh(i),"]:"),this.appendLogToWaitingList(i,...e)}appendLogToWaitingList(t){if(!x("UPLOAD_LOG"))return;for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=x1()+" Agora-SDK [".concat(Lh(t),"]:"):n[0]=x1()+" Agora-SDK [".concat(Lh(t),"]:");let o="";n.forEach(c=>{typeof c=="object"&&(c=JSON.stringify(c)),o+="".concat(c," ")}),this.uploadLogWaitingList.push({payload_str:o,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,e={sdk_version:Ur,process_id:x("PROCESS_ID"),payload:JSON.stringify(t)};return zs(async()=>{const n=await Oi.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(x("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(x("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>{const i={status:-1,message:n.message,errorRange:t.map(o=>o.log_item_id)};return n.response?(i.status=n.response.status,i.data=n.response.data,i.headers=n.response.headers):n.request&&(i.status=n.request.status),M1.reportLogUploadError(i),!0},{timeout:x("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:x("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,x("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),x("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),x("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),x("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var U1;function pQ(t){return Mn(t.reportId,"params.reportId",0,100,!1),Mn(t.category,"params.category",0,100,!1),Mn(t.event,"params.event",0,100,!1),Mn(t.label,"params.label",0,100,!1),be(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(U1={}).FREE="free",U1.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const fQ={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let yn=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),je=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let mQ=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function Pt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,n,i){const o=i.value;if(typeof o=="function"){const c=t.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);i.value=function(){for(var l,u=arguments.length,p=new Array(u),m=0;m<u;m++)p[m]=arguments[m];let _=p;if(t.argsMap)try{_=t.argsMap(this,...p)}catch(S){R.warning(S),_=[]}try{JSON.stringify(_)}catch{R.warning("arguments for method ".concat(c,".").concat(String(n)," not serializable for apiInvoke.")),_=[]}const E=(t.report||bt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((l=this.store)===null||l===void 0?void 0:l.clientId)||this._ID,name:"".concat(c,".").concat(String(n)),options:_,tag:We.TRACER,reportResult:t.reportResult},t.throttleTime);try{const S=o.apply(this,p);return S instanceof gt?S.then(T=>(E.onSuccess(t.reportResult&&T),T)).catch(T=>{throw E.onError(T),T}):(E.onSuccess(t.reportResult&&S),S)}catch(S){throw E.onError(S),S}}}return i}}const bt=new class{constructor(){Je(this,"baseInfoMap",new Map),Je(this,"proxyServer",void 0),Je(this,"eventUploadTimer",void 0),Je(this,"setSessionIdTimer",void 0),Je(this,"url",void 0),Je(this,"sids",new Set),Je(this,"backupUrl",void 0),Je(this,"_appId",void 0),Je(this,"_aid",0),Je(this,"keyEventUploadPendingItems",[]),Je(this,"normalEventUploadPendingItems",[]),Je(this,"apiInvokeUploadPendingItems",[]),Je(this,"apiInvokeCount",0),Je(this,"apiInvokeLoggedCount",0),Je(this,"ltsList",[]),Je(this,"lastSendNormalEventTime",Date.now()),Je(this,"customReportCounterTimer",void 0),Je(this,"customReportCount",0),Je(this,"extApiInvoke",async t=>{for(const e of t){const n=Ht(Ht({},e),{},{sid:null,invokeId:++this.apiInvokeCount,tag:We.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),x("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),x("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,e=>{let[n,i]=e;return n+i}),16)||0}reportApiInvoke(t,e,n){e.timeout=e.timeout||6e4,e.reportResult=e.reportResult===void 0||e.reportResult;const i=Date.now();this.apiInvokeCount+=1;const o=this.apiInvokeCount,c=!!x("SHOW_REPORT_INVOKER_LOG"),l=!!x("SHOW_REPORT_USER_INVOKER_LOG"),u=c||l&&e.id;u&&(this.apiInvokeLoggedCount+=1);const p=this.apiInvokeLoggedCount;function m(T,A){if(u){let I="[apiInvoke-".concat(p,"]");if(e.id&&(I+="[".concat(e.id,"]")),e.name&&(I+="[".concat(e.name,"]"),e.name===tn.JOIN))return R.info("".concat(I," ").concat(T));R.info("".concat(I," ").concat(T),T==="start"?e.options:A||"")}}const _=()=>({tag:e.tag,invokeId:o,sid:t,name:e.name,apiInvokeTime:i,options:e.options,states:e.states||null});m("start");let E=!1;xn(e.timeout).then(()=>{E||(this.sendApiInvoke(Ht(Ht({},_()),{},{error:L.API_INVOKE_TIMEOUT,success:!1})),m("timeout"))});const S=new $(L.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:T=>{const A=()=>{if(E)throw S;return E=!0,this.sendApiInvoke(Ht(Ht({},_()),{},{success:!0},e.reportResult&&{result:T})),m("onSuccess"),T};return n?_1(A,e.name+"Success",n,()=>E=!0):A()},onError:T=>{const A=()=>{if(E)throw T;E=!0,this.sendApiInvoke(Ht(Ht({},_()),{},{success:!1,error:T})),m("onFailure",T.toString())};return n?_1(A,e.name+"Error",n,()=>E=!0):A()}}}sessionInit(t,e){if(this.baseInfoMap.has(t))return;const n=Date.now(),i=this.createBaseInfo(t,n);i.cname=e.cname;const o=Object.assign({},{willUploadConsoleLog:x("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Qy?"global":"oversea",areas:x("AREAS")&&x("AREAS").join(",")},e.extend),{stringUid:c,channelProfile:l,channelMode:u,isABTestSuccess:p,lsid:m,clientRole:_}=e,E=Date.now(),S=Ht(Ht({},i),{},{eventType:yn.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,buildFormat:e.buildFormat,build:$y,lts:E,elapse:E-n,extend:JSON.stringify(o),mode:e.mode,process:x("PROCESS_ID"),appType:x("APP_TYPE"),success:!0,version:Ur,stringUid:c,channelProfile:l,channelMode:u,isABTestSuccess:p,lsid:m,clientType:pt(T=window.navigator.userAgent).call(T,"AgoraWebView")?42:20,clientRole:_,serviceId:x("PROCESS_ID"),extensionID:x("PLUGIN_INFO").join(",")||""});var T;this.send({type:je.SESSION,data:S},!0)}joinChooseServer(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,o=Date.now(),c=Ht(Ht({},i),{},{role:e.role,eventType:yn.JOIN_CHOOSE_SERVER,lts:o,eventElapse:e.elapse||o-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:o-n.startTime,success:e.succ,chooseServerAddrList:JSON.stringify(e.serverList),uid:e.uid?parseInt(e.uid):null,cid:e.cid?parseInt(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0,isHttp3:e.isHttp3,corssRegionTagReq:e.corssRegionTagReq||void 0,corssRegionTagRes:e.corssRegionTagRes||void 0,resourceTimingInfo:e.resourceTimingInfo||void 0});this.send({type:je.JOIN_CHOOSE_SERVER,data:c},!0)}reqUserAccount(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,o=Date.now(),c=Ht(Ht({},i),{},{eventType:yn.REQ_USER_ACCOUNT,lts:o,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:e.elapse||o-n.startTime,eventElapse:o-e.lts,extend:JSON.stringify(e.extend)});this.send({type:je.REQ_USER_ACCOUNT,data:c},!0)}joinGateway(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info;e.vid&&(i.vid=e.vid),i.uid=e.uid,i.cid=e.cid;const o=Date.now(),{firstSuccess:c,addr:l,isProxy:u}=e,p=o-n.startTime,m=Ht(Ht({},i),{},{eventType:yn.JOIN_GATEWAY,lts:o,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,errorMsg:e.errorMsg||"",elapse:p,eventElapse:o-e.lts,firstSuccess:c,signalChannel:e.signalChannel,preload:e.preload?1:0,installId:Jy(),isABTestSuccess:e.isABTestSuccess?1:0}),_=m.success?1:0;if(e.succ&&(n.lastJoinSuccessTime=o),c)this.send({type:je.JOIN_GATEWAY,data:m},!0);else{let E;if(l)if(u){const T=l.match(/h=(\d{1,3}-){3}\d{1,3}/g),A=l.match(/p=[0-9]{1,6}/g);E={isSuccess:_,gatewayIp:T&&T.length?T[0].split("=")[1].replace(/-/g,"."):"",port:A&&A.length?A[0].split("=")[1]:"",isProxy:u?1:0}}else{const T=l.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),A=l.match(/(:|p=)[0-9]{1,6}/g);E={isSuccess:_,gatewayIp:T&&T.length?T[0].split("//")[1].replace(/-/g,"."):"",port:A&&A.length?A[0].split(/:|p=/g)[1]:"",isProxy:u?1:0}}else E={isSuccess:_,gatewayIp:"",port:"",isProxy:u?1:0};delete m.success,delete m.eventType,delete m.firstSuccess,m.vid=Number(m.vid);const S=Object.assign({},m,E,{eventType:yn.REJOIN_GATEWAY});this.send({type:je.RE_JOIN_GATEWAY,data:S},!0)}}joinChannelTimeout(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=Date.now(),o=Ht(Ht({},n.info),{},{lts:i,timeout:e,elapse:i-n.startTime});this.send({type:je.JOIN_CHANNEL_TIMEOUT,data:o},!0)}publish(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,o=Date.now(),c=Ht(Ht({},i),{},{eventType:yn.PUBLISH,lts:o,eventElapse:e.eventElapse,elapse:o-n.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:je.PUBLISH,data:c},!0)}subscribe(t,e,n){const i=this.baseInfoMap.get(t);if(!i)return;const o=i.info,c=Date.now(),l=Ht(Ht({},o),{},{eventType:yn.SUBSCRIBE,lts:c,eventElapse:e.eventElapse,elapse:c-i.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid,preSsrc:e.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof e.peerid=="string"?l.peerSuid=e.peerid:l.peer=e.peerid,this.send({type:je.SUBSCRIBE,data:l},!0)}wsCompressorInit(t){var e;const n=[...Gi(e=this.baseInfoMap).call(e)],i=n.length?n[0]:"UnableToGetSid",o=this.baseInfoMap.get(i);if(!o)return;const c=o.info,l=Date.now(),u=Ht(Ht({},c),{},{eventType:yn.WS_COMPRESSOR_INIT,lts:l,eventElapse:t.eventElapse,elapse:l-o.startTime,status:t.status?1:2});this.send({type:je.WS_COMPRESSOR_INIT,data:u},!0)}firstXLAPeerFirstVideoFrame(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,o=Date.now(),c=e.peerPubStatusMs-(n.lastJoinSuccessTime||o),l=Ht(Ht({},i),{},{elapse:o-n.startTime,eventType:yn.XLA_PEER_FIRST_VIDEO_FRAME,lts:o,peer:e.peer,width:e.width,height:e.height,ssrc:e.ssrc,p2pid:e.p2pid,peerPublishDuration:e.peerPublishDuration,joinChannelSuccessElapse:c,peerPubStatusMs:e.peerPubStatusMs-e.joinChannelStart,availablePublish:e.peerPublishDuration>c?1:0,preloadStart:Math.max(e.preloadStart-e.joinChannelStart,0),preloadEnd:Math.max(e.preloadEnd-e.joinChannelStart,0),encrypt:Math.max(e.apStart-e.joinChannelStart,0),ap:Math.max(e.apEnd-e.joinChannelStart,0),sua:Math.max(e.suaEnd-e.joinChannelStart,0),beforeConnect:Math.max(e.beforeConnect-e.joinChannelStart,0),peerRecevier:Math.max(e.peerReceiver-e.joinChannelStart,0),ice:Math.max(e.ice-e.joinChannelStart,0),pc:Math.max(e.pc-e.joinChannelStart,0),signalConnected:Math.max(e.signalConnected-e.joinChannelStart,0),joinReq:Math.max(e.joinReq-e.joinChannelStart,0),joinRes:Math.max(e.joinRes-e.joinChannelStart,0),userJoinNotify:Math.max(e.userJoinNotify-e.joinChannelStart,0),videoSsrcNotify:Math.max(e.videoAddNotify-e.joinChannelStart,0),subscribeDelayMs:Math.max(e.subscribeStart-e.videoAddNotify,0),subscribeStart:Math.max(e.subscribeStart-e.joinChannelStart,0),subscribeEnd:Math.max(e.subscribeEnd-e.joinChannelStart,0),firstReceived:Math.max(e.firstReceived-e.joinChannelStart,0),firstDecoded:Math.max(e.firstDecoded-e.joinChannelStart,0),firstPreRender:Math.max(e.firstPreRender-e.joinChannelStart,0),firstRender:Math.max(e.firstRender-e.joinChannelStart,0),playDelayMs:Math.max(e.playStart-e.subscribeEnd,0),playStart:Math.max(e.playStart-e.joinChannelStart,0),playEnd:Math.max(e.playEnd-e.joinChannelStart,0),isPreSub:e.isPreSub?1:0,isPrePc:e.isPrePc?1:0,isPreInstantVideo:e.isPreInstantVideo?1:0});this.send({type:je.XLA_PEER_FIRST_VIDEO_FRAME,data:l},!0)}firstRemoteVideoDecode(t,e,n,i){const o=this.baseInfoMap.get(t);if(!o)return;const c=o.info,l=Date.now(),u=Ht(Ht(Ht({},c),i),{},{elapse:l-o.startTime,eventType:e,lts:l,firstDecodeFrame:Math.max((i.firstFrame||l)-o.startTime,0),apEnd:Math.max(i.apEnd-o.startTime,0),apStart:Math.max(i.apStart-o.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-o.startTime,0),joinGwStart:Math.max(i.joinGwStart-o.startTime,0),pcEnd:Math.max(i.pcEnd-o.startTime,0),pcStart:Math.max(i.pcStart-o.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-o.startTime,0),subscriberStart:Math.max(i.subscriberStart-o.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-o.startTime,0)});this.send({type:n,data:u},!0)}firstRemoteFrame(t,e,n,i){const o=this.baseInfoMap.get(t);if(!o)return;const c=o.info,l=Date.now(),u=Ht(Ht(Ht({},c),i),{},{elapse:l-o.startTime,eventType:e,lts:l});this.send({type:n,data:u},!0)}abTest(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,o=Date.now(),c=Ht(Ht(Ht({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:o-n.startTime,eventType:yn.AB_TEST,lts:o});this.send({type:je.AB_TEST,data:c},!0)}pcStats(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,o=Date.now(),c=Ht(Ht(Ht({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:o-n.startTime,eventType:yn.PC_STATS,lts:o,preallocation:e.preallocation?1:0});this.send({type:je.PC_STATS,data:c},!0)}updateRemoteRTPCapabilities(t,e){if(t){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,o=Date.now(),c=Ht(Ht(Ht({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:yn.UPDATE_REMOTE_RTPCAPABILITIES,lts:o});this.send({type:je.UPDATE_REMOTE_RTPCAPABILITIES,data:c},!0)}}onGatewayStream(t,e,n,i){const o=this.baseInfoMap.get(t);if(!o)return;const c=o.info,l=Date.now(),u=Ht(Ht(Ht({},c),i),{},{eventType:e,lts:l});this.send({type:n,data:u},!0)}streamSwitch(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,o=Date.now(),c=Ht(Ht({},i),{},{eventType:yn.STREAM_SWITCH,lts:o,isDual:e.isdual,elapse:o-n.startTime,success:e.succ});this.send({type:je.STREAM_SWITCH,data:c},!0)}requestProxyAppCenter(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,o=Date.now(),c=Ht(Ht({},i),{},{eventType:yn.REQUEST_PROXY_APPCENTER,lts:o,eventElapse:o-e.lts,elapse:o-n.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:je.REQUEST_PROXY_APPCENTER,data:c},!0)}requestProxyWorkerManager(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,o=Date.now(),c=Ht(Ht({},i),{},{eventType:yn.REQUEST_PROXY_WORKER_MANAGER,lts:o,eventElapse:o-e.lts,elapse:o-n.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:je.REQUEST_PROXY_WORKER_MANAGER,data:c},!0)}setProxyServer(t){this.proxyServer=t,t?R.debug("reportProxyServerurl: ".concat(t)):R.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,o=Date.now(),c=Ht(Ht({},i),{},{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:o,elapse:o-n.startTime,joinChannelSuccessElapse:o-(n.lastJoinSuccessTime||o),peerPublishDurationVideo:e.videoPublishDuration,peerPublishDurationAudio:e.audioPublishDuration});this.send({type:je.PEER_PUBLISH_STATUS,data:c},!0)}workerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,o=Date.now();(function(c,l,u){const p=c[l];if(!p||typeof p!="string")return[c];c[l]="";const m=vo(JSON.stringify(c));let _=0;const E=[];let S=0;for(let T=0;T<p.length;T++)S+=p.charCodeAt(T)<=127?1:3,S<=u-m||(E[E.length]=ct(ct({},c),{},{[l]:p.substring(_,T)}),_=T,S=p.charCodeAt(T)<=127?1:3);return _!==p.length-1&&(E[E.length]=ct(ct({},c),{},{[l]:p.substring(_)})),E})(Ht(Ht(Ht({},i),e),{},{elapse:o-n.startTime,lts:o,productType:"WebRTC"}),"payload",1300).forEach(c=>this.send({type:je.WORKER_EVENT,data:c},!0))}apworkerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,o=Date.now(),c=Ht(Ht(Ht({},i),e),{},{elapse:o-n.startTime,lts:o});this.send({type:je.AP_WORKER_EVENT,data:c},!0)}joinWebProxyAP(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,o=Date.now(),c=Ht(Ht(Ht({},i),e),{},{elapse:o-n.startTime,lts:o,extend:e.extend||void 0});this.send({type:je.JOIN_WEB_PROXY_AP,data:c},!0)}WebSocketQuit(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,o=Date.now(),c=Ht(Ht(Ht({},i),e),{},{elapse:o-n.startTime,lts:o});this.send({type:je.WEBSOCKET_QUIT,data:c},!0)}async sendCustomReportMessage(t,e){if(this.customReportCount+=e.length,this.customReportCount>x("CUSTOM_REPORT_LIMIT"))throw new $(L.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=e.map(o=>({type:je.USER_ANALYTICS,data:Ht(Ht({sid:t},o),{},{lts:n})}));try{x("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(o){throw R.error("send custom report message failed",o.toString()),new $(L.CUSTOM_REPORT_SEND_FAILED,o.message)}}sendApiInvoke(t){const e=x("NOT_REPORT_EVENT");if(t.tag&&pt(e)&&pt(e).call(e,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const n=this.baseInfoMap.get(t.sid);if(!n)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:i,uid:o,cid:c}=n.info;let l;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof $){const{code:p,message:m}=t.error;l=p||m||t.error.toString()}else l=t.error.toString();const u={invokeId:t.invokeId,sid:t.sid,cname:i,cid:c,uid:o,lts:t.lts,success:t.success,elapse:t.lts-n.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?l:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:je.API_INVOKE,data:u},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const e=Array.from(this.sids).find(n=>n!==null);e&&t.forEach(n=>{n&&(n.sid=e,this.sendApiInvoke(Object.assign({},n)))}),t.length=0}send(t,e){if(e)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>x("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,e){const n=[],i=[];for(;t.length;){const c=t.shift();n.length<20?n.push(c):i.push(c)}t.push(...i);for(const c of[...n]){var o;this.ltsList.indexOf(c.data.lts)!==-1?(c.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(c.data.lts)):(this.ltsList.push(c.data.lts),Mc(o=this.ltsList).call(o,(l,u)=>l-u))}return e||(this.lastSendNormalEventTime=Date.now()),x("ENABLE_EVENT_REPORT")&&n.length&&(x("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((c=>l=>{x("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(c):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(c),this.normalEventUploadPendingItems.length>x("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-x("NORMAL_EVENT_QUEUE_CAPACITY")),R.warning("report: drop normal events"))))})(n)),t}async postDataToStatsCollector2(t){on.networkState===sr.OFFLINE&&await gt.race([on.onlineWaiter,xn(2*pn.maxRetryTimeout)]);const e=o=>{let c=new Uint8Array;return o.forEach(l=>{const u=Vy(JSON.stringify(l.data)),p=new ArrayBuffer(5),m=(E=>{let S=0;return Object.entries(je).forEach(T=>{let[A,I]=T;I===E.type&&(S=mQ[A])}),S})(l),_=new DataView(p);_.setUint16(0,u.byteLength,!0),_.setUint8(2,255&m),_.setUint8(3,m>>>8&255),_.setUint8(4,m>>>16&255),c=a1(c,new Uint8Array(p)),c=a1(c,u)}),c},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(x("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(x("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let o=0;o<2;o+=1){o===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(x("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(x("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await zy(i,{timeout:1e4,data:e(t),headers:Ht(Ht({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(c){if(o===1)throw c;continue}return}}async postDataToStatsCollector(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(u=>{const p=u&&u.data.sid&&this.baseInfoMap.get(u.data.sid);return p&&p.info.vid&&+p.info.vid||0})(t[0]),i=n?void 0:this._aid,o={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(u=>JSON.stringify(u)),vid:n,aid:i};on.networkState===sr.OFFLINE&&await gt.race([on.onlineWaiter,xn(2*pn.maxRetryTimeout)]);const c=e?"/events/proto-raws":"/events/messages";let l=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(x("EVENT_REPORT_DOMAIN"),"&p=").concat(x("STATS_COLLECTOR_PORT"),"&d=").concat(c):"https://".concat(x("EVENT_REPORT_DOMAIN"),":").concat(x("STATS_COLLECTOR_PORT")).concat(c));for(let u=0;u<2;u+=1){u===1&&(l=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(x("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(x("STATS_COLLECTOR_PORT"),"&d=").concat(c):"https://".concat(x("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(x("STATS_COLLECTOR_PORT")).concat(c)));try{e?await tQ(l,{timeout:1e4,data:o}):await zy(l,{timeout:1e4,data:o})}catch(p){if(u===1)throw p;continue}return}}createBaseInfo(t,e){const n=Object.assign({},fQ);return n.sid=t,this.baseInfoMap.set(t,{info:n,startTime:e}),n}reportResourceTiming(t,e){const n=performance.getEntriesByName(t),i=n[n.length-1];i&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:i,tag:We.TRACER}).onSuccess()}};M1.on("REPORT_LOG_UPLOAD",t=>{t.networkState=on.networkState,bt.reportApiInvoke(null,{name:"logUploadError",options:t,tag:We.TRACER}).onSuccess("logUploadError")});class Q extends ${constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Je(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,R)}throw(){super.throw(R)}}const Un={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function ae(){return Un}function V1(){return"setSinkId"in HTMLAudioElement.prototype&&(!x("RESTRICTION_SET_PLAYBACK_DEVICE")||(qo()||Xk())&&!My())}function v_(){return!Un.supportUnifiedPlan||x("CHROME_FORCE_PLAN_B")&&Xo()}function i0(t){return!(qe()||Jk(87)||v_()||!x("ENABLE_PRE_SUB")&&(t==null||!t.autoSubscribe||x("FORCE_DISABLE_AUTO_SUB")))}function F1(t){return!!x("ENABLE_INSTANT_VIDEO")||!(t==null||!t.autoSubscribe||x("FORCE_DISABLE_AUTO_SUB"))}let Vn=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function Al(t,e,n){return{sampleRate:t,stereo:e,bitrate:n}}function ce(t,e,n,i,o){return{width:t,height:e,frameRate:n,bitrateMin:i,bitrateMax:o}}function ms(t,e,n,i,o){return{width:{max:t},height:{max:e},frameRate:n,bitrateMin:i,bitrateMax:o}}function r0(t,e){return{numSpatialLayers:t,numTemporalLayers:e}}const _Q={"90p":ce(160,90),"90p_1":ce(160,90),"120p":ce(160,120,15,30,65),"120p_1":ce(160,120,15,30,65),"120p_3":ce(120,120,15,30,50),"120p_4":ce(212,120),"180p":ce(320,180,15,30,140),"180p_1":ce(320,180,15,30,140),"180p_3":ce(180,180,15,30,100),"180p_4":ce(240,180,15,30,120),"240p":ce(320,240,15,40,200),"240p_1":ce(320,240,15,40,200),"240p_3":ce(240,240,15,40,140),"240p_4":ce(424,240,15,40,220),"360p":ce(640,360,15,80,400),"360p_1":ce(640,360,15,80,400),"360p_3":ce(360,360,15,80,260),"360p_4":ce(640,360,30,80,600),"360p_6":ce(360,360,30,80,400),"360p_7":ce(480,360,15,80,320),"360p_8":ce(480,360,30,80,490),"360p_9":ce(640,360,15,80,800),"360p_10":ce(640,360,24,80,800),"360p_11":ce(640,360,24,80,1e3),"480p":ce(640,480,15,100,500),"480p_1":ce(640,480,15,100,500),"480p_2":ce(640,480,30,100,1e3),"480p_3":ce(480,480,15,100,400),"480p_4":ce(640,480,30,100,750),"480p_6":ce(480,480,30,100,600),"480p_8":ce(848,480,15,100,610),"480p_9":ce(848,480,30,100,930),"480p_10":ce(640,480,10,100,400),"720p":ce(1280,720,15,120,1130),"720p_auto":ce(1280,720,30,900,3e3),"720p_1":ce(1280,720,15,120,1130),"720p_2":ce(1280,720,30,120,2e3),"720p_3":ce(1280,720,30,120,1710),"720p_5":ce(960,720,15,120,910),"720p_6":ce(960,720,30,120,1380),"1080p":ce(1920,1080,15,120,2080),"1080p_1":ce(1920,1080,15,120,2080),"1080p_2":ce(1920,1080,30,120,3e3),"1080p_3":ce(1920,1080,30,120,3150),"1080p_5":ce(1920,1080,60,120,4780),"1440p":ce(2560,1440,30,120,4850),"1440p_1":ce(2560,1440,30,120,4850),"1440p_2":ce(2560,1440,60,120,7350),"4k":ce(3840,2160,30,120,8910),"4k_1":ce(3840,2160,30,120,8910),"4k_3":ce(3840,2160,60,120,13500)},gQ={"480p":ms(640,480,5),"480p_1":ms(640,480,5),"480p_2":ms(640,480,30),"480p_3":ms(640,480,15),"720p":ms(1280,720,5),"720p_auto":ce(1280,720,30,900,3e3),"720p_1":ms(1280,720,5),"720p_2":ms(1280,720,30),"720p_3":ms(1280,720,15),"1080p":ms(1920,1080,5),"1080p_1":ms(1920,1080,5),"1080p_2":ms(1920,1080,30),"1080p_3":ms(1920,1080,15)},EQ={"1SL1TL":r0(1,1),"3SL3TL":r0(3,3),"2SL3TL":r0(2,3)};function _s(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},_Q[t]):t}function s0(t){return typeof t=="string"?Object.assign({},gQ[t]):t}function T_(t){return typeof t=="string"?Object.assign({},EQ[t]):t}const SQ={speech_low_quality:Al(16e3,!1),speech_standard:Al(32e3,!1,18),music_standard:Al(48e3,!1),standard_stereo:Al(48e3,!0,56),high_quality:Al(48e3,!1,128),high_quality_stereo:Al(48e3,!0,192)};function y_(t){return typeof t=="string"?Object.assign({},SQ[t]):t}const Ol=[];function B1(t){return Tn(t,"mediaSource",["screen","window","application"]),!0}let yt=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),Ie=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),Nl=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),vQ=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),TQ=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),qc=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),Dl=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),Fr=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t.PLAY_START="play-start",t.PLAY_END="play-end",t.FIRST_FRAME_RENDER="first-frame-render",t}({}),Pl=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),Er=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const o0={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},a0={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},j1={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},yQ={uplinkNetworkQuality:0,downlinkNetworkQuality:0},W1={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let vi=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),Sr=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),Mh=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),Xc=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),Zn=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),yo=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const c0={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let R_=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function ne(t,e,n,i,o){var c,l,u={};return Object.keys(i).forEach(function(p){u[p]=i[p]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=os(c=ww(l=n.slice()).call(l)).call(c,function(p,m){return m(t,e,p)||p},u),o&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(o):void 0,u.initializer=void 0),u.initializer===void 0?(Object.defineProperty(t,e,u),null):u}function J(t,e,n){return(e=function(i){var o=function(c,l){if(typeof c!="object"||!c)return c;var u=c[Symbol.toPrimitive];if(u!==void 0){var p=u.call(c,"string");if(typeof p!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}(i);return typeof o=="symbol"?o:o+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function G1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function ke(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?G1(Object(n),!0).forEach(function(i){J(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):G1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class H1 extends Ke{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(qc.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,n){super(),J(this,"trackMediaType",void 0),J(this,"_ID",void 0),J(this,"_rtpTransceiver",void 0),J(this,"_lowRtpTransceiver",void 0),J(this,"_hints",[]),J(this,"_isClosed",!1),J(this,"_originMediaStreamTrack",void 0),J(this,"mediaStreamTrack",void 0),J(this,"_external",{}),this._ID=n||Ae(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(i){pt(Ol).call(Ol,i)||Ol.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||La(()=>{var n;bt.reportApiInvoke(null,{name:tn.GET_MEDIA_STREAM_TRACK,options:[],tag:We.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===Nl.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const n=Ol.indexOf(e);n!==-1&&Ol.splice(n,1)}(this),this.emit(Dl.CLOSED),this.removeAllListeners(qc.SEI_RECEIVED)}_updateRtpTransceiver(e,n){if(n===Nl.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(qc.TRANSCEIVER_UPDATED,e,n)}}class kl extends H1{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,n){super(e,n),J(this,"_enabled",!0),J(this,"_muted",!1),J(this,"_isExternalTrack",!1),J(this,"_isClosed",!1),J(this,"_enabledMutex",void 0),J(this,"processor",void 0),J(this,"_processorContext",void 0),J(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Qn("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,n;return(e=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,R.debug("[".concat(this.getTrackId(),"] close")),this.emit(yt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await we(this,yt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Dl.TRACK_ENDED)}stateCheck(e,n){if(R.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(n,"]")),Hs(n,e),this._enabled&&this._muted&&e==="enabled"&&n===!1)throw new $(L.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",R);if(!this._enabled&&!this._muted&&e==="muted"&&n===!0)throw new $(L.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",R)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():gt.resolve([])}}const z1=window.AudioContext||window.webkitAudioContext;let vr=null;const Re=new class extends Ke{constructor(){super(...arguments),J(this,"prevState",void 0),J(this,"curState",void 0),J(this,"currentTime",void 0),J(this,"currentTimeStuckAt",void 0),J(this,"interruptDetectorTrack",void 0),J(this,"onLocalAudioTrackMute",()=>{R.info("ios15-interruption-start"),this.emit(Vn.IOS_15_16_INTERRUPTION_START)}),J(this,"onLocalAudioTrackUnmute",async()=>{R.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?R.info("ios15-interruption-end-canceled"):(vr&&await vr.suspend(),this.emit(Vn.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){R.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){R.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Ll(){if(!vr){if(function(){if(!z1)return void R.error("your browser is not support web audio");R.info("create audio context");const t=ke({},x("WEBAUDIO_INIT_OPTIONS"));R.debug("audio context init option:",JSON.stringify(t)),vr=new z1(t),Re.curState=vr.state,vr.onstatechange=()=>{Re.prevState=Re.curState,Re.curState=vr?vr.state:void 0;const{prevState:e,curState:n}=Re,i=n==="running",o=n==="interrupted",c=e==="running",l=e==="suspended",u=e==="interrupted",p=ie().osVersion;(ai()||ps())&&c&&o&&(R.info("ios".concat(p,"-interruption-start")),Re.emit(Vn.IOS_INTERRUPTION_START)),(ai()||ps())&&(l||u)&&i&&(R.info("ios".concat(p,"-interruption-end")),Re.emit(Vn.IOS_INTERRUPTION_END)),e!==n&&Re.emit(Vn.STATE_CHANGE,n,e)},setInterval(()=>{var e;const n=(e=vr)===null||e===void 0?void 0:e.currentTime;Re.currentTime!==n?(Re.currentTimeStuckAt&&(R.debug("AudioContext current time resume at ".concat(n)),Re.currentTimeStuckAt=void 0),Re.currentTime=n):(n!==Re.currentTimeStuckAt&&(bt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:We.TRACER}).onSuccess(),R.warning("AudioContext current time stuck at ".concat(n))),Re.currentTimeStuckAt=n)},5e3),async function(e){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,o=!1,c=!1,l=!1;function u(I){e.state==="running"?p(!1):ai()||ps()?e.state==="suspended"&&(p(!0),I&&e.resume().then(m,m)):e.state!=="closed"&&(p(!0),I&&e.resume().then(m,m))}function p(I){if(o!==I){o=I;for(let w=0,P=n;w<P.length;w+=1){const D=P[w];I?window.addEventListener(D,_,{capture:!0,passive:!0}):window.removeEventListener(D,_,{capture:!0,passive:!0})}}}function m(){u(!1)}function _(){u(!0)}function E(I){if(!l)if(i.paused)if(I){let w;S(!1),l=!0;try{w=i.play(),w?w.then(T,T):(i.addEventListener("playing",T),i.addEventListener("abort",T),i.addEventListener("error",T))}catch{T()}}else S(!0);else S(!1)}function S(I){if(c!==I){c=I;for(let w=0,P=n;w<P.length;w++){const D=P[w];I?window.addEventListener(D,A,{capture:!0,passive:!0}):window.removeEventListener(D,A,{capture:!0,passive:!0})}}}function T(){i.removeEventListener("playing",T),i.removeEventListener("abort",T),i.removeEventListener("error",T),l=!1,E(!1)}function A(){E(!0)}if(ai()){const I=e.createMediaStreamDestination(),w=document.createElement("div");w.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=w.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=I.stream,E(!0)}Re.on(Vn.STATE_CHANGE,function(){u(!0)}),u(!1)}(vr)}(),!vr)throw new $(L.NOT_SUPPORTED,"can not create audio context");return vr}return vr}function Jc(t){if(function(){if(d0!==null)return d0;const i=Ll(),o=i.createBufferSource(),c=i.createGain(),l=i.createGain();o.connect(c),o.connect(l),o.disconnect(c);let u=!1;try{o.disconnect(c)}catch{u=!0}return o.disconnect(),d0=u,u}())return;const e=t.connect,n=t.disconnect;t.connect=(i,o,c)=>{var l;return t._inputNodes||(t._inputNodes=[]),pt(l=t._inputNodes).call(l,i)||(i instanceof AudioNode?(t._inputNodes.push(i),e.call(t,i,o,c)):e.call(t,i,o)),t},t.disconnect=(i,o,c)=>{n.call(t),i?h_(t._inputNodes,i):t._inputNodes=[];for(const l of t._inputNodes)e.call(t,l)}}let d0=null;function l0(t,e){let n=!1;const i=1/e;if(x("DISABLE_WEBAUDIO")){const o=window.setInterval(()=>{n?window.clearInterval(o):t(performance.now()/1e3)},1e3*i)}else{const o=Ll();let c=o.createGain();c.gain.value=0,c.connect(o.destination);const l=()=>{if(n)return void(c=null);const u=o.createOscillator();u.onended=l,u.connect(c),u.start(0),u.stop(o.currentTime+i),t(o.currentTime)};l()}return()=>{n=!0}}class K1{constructor(){J(this,"context",void 0),J(this,"analyserNode",void 0),J(this,"sourceNode",void 0),this.context=Ll(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ai()||ps()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let o=0;o<e.length;++o)e[o]=i[o]/128-1}const n=os(e).call(e,(i,o)=>i+o*o,0)/e.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,n;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{R.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class Y1 extends Ke{get processSourceNode(){return this.sourceNode}set processedNode(e){var n;if(!this.isDestroyed&&this._processedNode!==e){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),J(this,"outputNode",void 0),J(this,"outputTrack",void 0),J(this,"isPlayed",!1),J(this,"sourceNode",void 0),J(this,"context",void 0),J(this,"audioBufferNode",void 0),J(this,"destNode",void 0),J(this,"audioOutputLevel",0),J(this,"volumeLevelAnalyser",void 0),J(this,"_processedNode",void 0),J(this,"playNode",void 0),J(this,"isDestroyed",!1),J(this,"onNoAudioInput",void 0),J(this,"isNoAudioInput",!1),J(this,"_noAudioInputCount",0),this.context=Ll(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Jc(this.outputNode),this.volumeLevelAnalyser=new K1}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Er.ON_AUDIO_BUFFER,function(i){for(let o=0;o<i.outputBuffer.numberOfChannels;o+=1){const c=i.outputBuffer.getChannelData(o);for(let l=0;l<c.length;l+=1)c[l]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!ae().webAudioMediaStreamDest)throw new $(L.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&p_(()=>{Re.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ai()||ps()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let o=!1;for(let c=0;c<i.length;c++)i[c]!==0&&(o=!0);return o?(this.isNoAudioInput=!1,!0):(await xn(200),await this.checkHasAudioInput(e?e+1:1)&&o)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,n;(e=this.processedNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class q1 extends Y1{get isFreeze(){return!1}constructor(e,n,i){var o;if(super(),J(this,"sourceNode",void 0),J(this,"track",void 0),J(this,"clonedTrack",void 0),J(this,"audioElement",void 0),J(this,"isCurrentTrackCloned",!1),J(this,"isRemoteTrack",!1),J(this,"originVolumeLevelAnalyser",void 0),J(this,"rebuildWebAudio",async()=>{if(R.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void R.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>R.info("resume success")),R.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const u=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?u.stop():this.isCurrentTrackCloned=!0;const p=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(p),Jc(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const m=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(m,this.context.currentTime),Jc(this.outputNode),this.emit(Er.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=p,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new $(L.UNEXPECTED_ERROR);this.track=e;const c=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(c),Jc(this.sourceNode),i){const u=i.clone();u.enabled=!0,this.clonedTrack=u,R.debug("create an unmuted track ".concat(u.id," from the original track ").concat(i.id," to get the volume"));const p=this.context.createMediaStreamSource(new MediaStream([u]));Jc(p),this.originVolumeLevelAnalyser=new K1,this.originVolumeLevelAnalyser.updateSource(p)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=c;const l=ie();n&&l.os===bn.IOS&&Number((o=l.osVersion)===null||o===void 0?void 0:o.split(".")[0])<15&&(Re.on(Vn.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(u=>{u||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const n=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(n),Jc(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Er.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),Re.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const n=e.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),R.debug("create an unmuted track ".concat(n.id," from the original track ").concat(e.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));Jc(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function X1(t,e,n){const i=(c,l)=>c?typeof c!="number"?c.max||c.exact||c.ideal||c.min||l:c:l,o={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:i(e.height,1080),maxWidth:i(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(o.video.mandatory.maxFrameRate=e.frameRate.max,o.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(o.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(o)}async function RQ(t,e){const n=await J1(t.mediaSource),{sourceId:i,audio:o}=await function(c){let l=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new gt((u,p)=>{const m=document.createElement("div");m.innerText="share screen",m.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const _=document.createElement("div");_.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const E=document.createElement("div");E.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",E.setAttribute("style","height: 12%;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const T=document.createElement("div");T.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const A=document.createElement("button");A.innerHTML="cancel",A.setAttribute("style","width: 85px;"),A.onclick=()=>{document.body.removeChild(P);const D=new Error("NotAllowedError");D.name="NotAllowedError",p(D)};let I=l;const w=document.createElement("div");if(l){const D=document.createElement("input");D.setAttribute("type","checkbox");const U=document.createElement("span");D.setAttribute("style","margin-right: 6px;"),U.innerText="Share audio",D.checked=I,D.onchange=()=>{I=D.checked},w.appendChild(D),w.appendChild(U)}T.appendChild(w),T.appendChild(A),_.appendChild(E),_.appendChild(S),_.appendChild(T);const P=document.createElement("div");P.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),P.appendChild(m),P.appendChild(_),document.body.appendChild(P),c.map(D=>{if(D.id){const U=document.createElement("div");U.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let G=D.thumbnail;try{const{width:W}=G.getSize();W>1920&&(G=G.resize({width:1920}))}catch(W){throw W&&W.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),W}U.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+G.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+D.name.replace(/[\u00A0-\u9999<>\&]/g,function(W){return"&#"+W.charCodeAt(0)+";"})+"</span>",U.onclick=()=>{document.body.removeChild(P),u({sourceId:D.id,audio:I})},S.appendChild(U)}})})}(n,e);return await X1(i,t,o)}async function J1(t){let e=["window","screen"];t!=="application"&&t!=="window"||(e=["window"]),t==="screen"&&(e=["screen"]);const n=c1();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new $(L.ELECTRON_IS_NULL);let i=null;try{var o;i=((o=n.desktopCapturer)===null||o===void 0?void 0:o.getSources({types:e}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{i=null}i&&i.then||(i=new gt((c,l)=>{n.desktopCapturer.getSources({types:e},(u,p)=>{u?l(u):c(p)})}));try{return await i}catch(c){throw new $(L.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,c.toString())}}const u0=new Qn("safari");let Q1=!1,Z1=!1;async function Tr(t,e){let n=0,i=null;for(;n<2;)try{i=await CQ(t,e,n>0);break}catch(o){if(o instanceof $)throw R.error("[".concat(e,"] ").concat(o.toString())),o;const c=C_(o.name||o.code||o,o.message);if(c.code===L.MEDIA_OPTION_INVALID){R.debug("[".concat(e,"] detect media option invalid, retry")),n+=1,await xn(500);continue}throw R.error("[".concat(e,"] ").concat(c.toString())),c}if(!i)throw new $(L.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function CQ(t,e,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new $(L.NOT_SUPPORTED,"can not find getUserMedia");n&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const i=ae(),o=new MediaStream;if(t.audioSource&&o.addTrack(t.audioSource),t.videoSource&&o.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return R.debug("Using Video Source/ Audio Source"),o;if(t.screen)if(c1())t.screen.sourceId?Ml(o,await X1(t.screen.sourceId,t.screen,!!t.screenAudio)):Ml(o,await RQ(t.screen,!!t.screenAudio));else if(qo()&&t.screen.extensionId&&t.screen.mandatory){if(!i.getStreamFromExtension)throw new $(L.NOT_SUPPORTED,"This browser does not support screen sharing");R.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));const S=await(l=t.screen.extensionId,u=e,new gt((T,A)=>{try{chrome.runtime.sendMessage(l,{getStream:!0},I=>{if(!I||!I.streamId)return R.error("[".concat(u,"] No response from Chrome Plugin. Plugin not installed properly"),I),void A(new $(L.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));T(I.streamId)})}catch(I){R.error("[".concat(u,"] AgoraRTC screensharing plugin is not accessible(").concat(l,")"),I.toString()),A(new $(L.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=S,Ml(o,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(i.getDisplayMedia){var c;t.screen.mediaSource&&B1(t.screen.mediaSource);const S={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(c=t.screen.displaySurface)!==null&&c!==void 0?c:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:T,surfaceSwitching:A,systemAudio:I,preferCurrentTab:w}=t.screen,P={selfBrowserSurface:T,surfaceSwitching:A,systemAudio:I,preferCurrentTab:w};!T&&delete P.selfBrowserSurface,!A&&delete P.surfaceSwitching,!I&&delete P.systemAudio,!w&&delete P.preferCurrentTab,R.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:S,audio:t.screenAudio,controls:P})),Ml(o,await navigator.mediaDevices.getDisplayMedia(ke({video:S,audio:t.screenAudio},P)))}else{if(!qe())throw R.error("[".concat(e,"] This browser does not support screenSharing")),new $(L.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&B1(t.screen.mediaSource);const S={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};R.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(S))),Ml(o,await navigator.mediaDevices.getUserMedia(S))}}var l,u;if(!t.video&&!t.audio)return o;let p={video:t.video,audio:t.audio},m=x("MEDIA_DEVICE_CONSTRAINTS");if(m)try{typeof m=="string"&&(m=JSON.parse(m)),p=jy(p,m)}catch{}R.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(p)),ie();let _,E=null;(Hn()||ai()||l_())&&(E=await u0.lock());try{_=await navigator.mediaDevices.getUserMedia(p)}catch(S){throw E&&E(),S}return p.audio&&(Q1=!0),p.video&&(Z1=!0),Ml(o,_),E&&E(),o}function C_(t,e){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new $(L.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new $(L.DEVICE_NOT_FOUND,"".concat(t,": ").concat(e));case"NotSupportedError":return new $(L.NOT_SUPPORTED,"".concat(t,": ").concat(e));case"NotReadableError":return new $(L.NOT_READABLE,"".concat(t,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new $(L.PERMISSION_DENIED,"".concat(t,": ").concat(e));case"ConstraintNotSatisfiedError":return new $(L.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(e));default:return R.error("getUserMedia unexpected error",t),new $(L.UNEXPECTED_ERROR,"".concat(t,": ").concat(e))}}function Ml(t,e){const n=t.getVideoTracks()[0],i=t.getAudioTracks()[0],o=e.getVideoTracks()[0],c=e.getAudioTracks()[0];c&&(i&&t.removeTrack(i),t.addTrack(c)),o&&(n&&t.removeTrack(n),t.addTrack(o))}const yr=new class extends Ke{get state(){return this._state}set state(t){t!==this._state&&(this.emit(Xc.STATE_CHANGE,t),this._state=t)}constructor(){super(),J(this,"_state",Mh.IDLE),J(this,"isAccessMicrophonePermission",!1),J(this,"isAccessCameraPermission",!1),J(this,"lastAccessMicrophonePermission",!1),J(this,"lastAccessCameraPermission",!1),J(this,"checkdeviceMatched",!1),J(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(x("ENUMERATE_DEVICES_INTERVAL")||(u_()||d_()===bn.HARMONY_OS)&&Xo())&&this.updateDevicesInfo()},x("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>R.error(t.toString()))}async enumerateDevices(t,e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new $(L.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),o=this.checkMediaDeviceInfoIsOk(i);let c=!this.isAccessMicrophonePermission&&t,l=!this.isAccessCameraPermission&&e;o.audio&&(c=!1),o.video&&(l=!1);let u=null,p=null,m=null;if(!n&&(c||l)){if(u0.isLocked&&(R.debug("[device manager] wait GUM lock"),(await u0.lock())(),R.debug("[device manager] GUM unlock")),Q1&&(c=!1,this.isAccessMicrophonePermission=!0),Z1&&(l=!1,this.isAccessCameraPermission=!0),R.debug("[device manager] check media device permissions",t,e,c,l),c&&l){try{m=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(_){const E=C_(_.name||_.code||_,_.message);if(E.code===L.PERMISSION_DENIED)throw E;R.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(c){try{u=await navigator.mediaDevices.getUserMedia({audio:t})}catch(_){const E=C_(_.name||_.code||_,_.message);if(E.code===L.PERMISSION_DENIED)throw E;R.warning("getUserMedia failed in getDevices",E)}this.isAccessMicrophonePermission=!0}else if(l){try{p=await navigator.mediaDevices.getUserMedia({video:e})}catch(_){const E=C_(_.name||_.code||_,_.message);if(E.code===L.PERMISSION_DENIED)throw E;R.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0}R.debug("[device manager] mic permission",t,"cam permission",e)}try{const _=await navigator.mediaDevices.enumerateDevices();return u&&u.getTracks().forEach(E=>E.stop()),p&&p.getTracks().forEach(E=>E.stop()),m&&m.getTracks().forEach(E=>E.stop()),u=null,p=null,m=null,_}catch(_){return u&&u.getTracks().forEach(E=>E.stop()),p&&p.getTracks().forEach(E=>E.stop()),m&&m.getTracks().forEach(E=>E.stop()),u=null,p=null,m=null,new $(L.ENUMERATE_DEVICES_FAILED,_.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(t){let e=null;return this.deviceInfoMap.forEach(n=>{n.device.label===t&&(e=n.device.deviceId)}),e}async getDeviceById(t){const e=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===t);if(!e)throw new $(L.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return e}async init(){this.state=Mh.INITING;try{await this.updateDevicesInfo(),this.state=Mh.INITEND}catch(t){throw R.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=Mh.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new $(L.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),e=Date.now(),n=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const o=t.find(l=>l.kind==="audioinput"&&l.deviceId==="default"),c=t.find(l=>l.kind==="audiooutput"&&l.deviceId==="default");o&&c?c.groupId===o.groupId?R.debug("[device-check] default input ".concat(o.label," and output ").concat(c.label," is the same group")):R.debug("[device-check] default input ".concat(o.label," and output ").concat(c.label," is not the same group")):R.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(o=>{if(!o.deviceId)return;const c=this.deviceInfoMap.get("".concat(o.kind,"_").concat(o.deviceId));if((c?c.state:"INACTIVE")!=="ACTIVE"){const l={initAt:e,updateAt:e,device:o,state:"ACTIVE"};this.deviceInfoMap.set("".concat(o.kind,"_").concat(o.deviceId),l),n.push(l)}c&&(c.updateAt=e)}),this.deviceInfoMap.forEach((o,c)=>{o.state==="ACTIVE"&&o.updateAt!==e&&(o.state="INACTIVE",n.push(o))}),this.state!==Mh.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(o=>{switch(o.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Xc.RECORDING_DEVICE_CHANGED,o);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Xc.CAMERA_DEVICE_CHANGED,o);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Xc.PLAYOUT_DEVICE_CHANGED,o)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const e=t.filter(o=>o.kind==="audioinput"),n=t.filter(o=>o.kind==="videoinput"),i={audio:!1,video:!1};for(const o of e)if(o.label&&o.deviceId){i.audio=!0;break}for(const o of n)if(o.label&&o.deviceId){i.video=!0;break}return i}};let h0=!1;const Rr=new class extends Ke{constructor(){super(...arguments),J(this,"onAutoplayFailed",void 0),J(this,"onAudioAutoplayFailed",void 0)}};function $1(){if(ie(),!h0){const t=e=>{e.preventDefault(),h0=!1,bh()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};h0=!0,bh()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),R.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Rr.onAutoplayFailed?Rr.onAutoplayFailed():Rr.onAudioAutoplayFailed?R.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):R.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Rr.emit("autoplay-failed")}}function tL(t,e,n,i){if(!t)return;const o=bt.getBaseInfoBySessionId(t);if(!o)return;const c=o.info,l=Date.now(),u=ke(ke({},c),{},{vid:c.vid===void 0?0:Number(c.vid),lts:l,elapse:l-o.startTime,cbRegistered:Rr.onAutoplayFailed||Rr.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:e,trackId:i,extend:void 0});bt.send({type:je.AUTOPLAY_FAILED,data:u},!0)}const bQ=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Ni=new class{constructor(){J(this,"onAutoplayFailed",void 0),J(this,"elementMap",new Map),J(this,"elementStateMap",new Map),J(this,"elementsNeedToResume",[]),J(this,"sinkIdMap",new Map),J(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,i]=e;const o=this.elementStateMap.get(n),c=i.srcObject.getAudioTracks()[0],l=c&&c.readyState;if(R.debug("resume after interrupted, ele: ".concat(o," audio: ").concat(l," ").concat(t)),l==="live"){if(t)return i.pause(),void i.play();if(Re.curState==="running")return Tl()?(i.pause(),void i.play()):void(o&&o==="paused"&&i.play())}})}),J(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[e,n]=t;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(R.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),Re.on(Vn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Re.on(Vn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Re.on(Vn.STATE_CHANGE,()=>{ai()&&Re.prevState==="suspended"&&Re.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,e){const n=this.elementMap.get(t);if(this.sinkIdMap.set(t,e),n)try{await n.setSinkId(e)}catch(i){throw new $(L.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(t,e,n,i){if(this.elementMap.has(e))return;const o=document.createElement("audio");o.autoplay=!0,o.srcObject=new MediaStream([t]),this.bindAudioElementEvents(e,o),this.elementMap.set(e,o),this.elementStateMap.set(e,Zn.INIT),this.setVolume(e,n);const c=this.sinkIdMap.get(e);if(c)try{o.setSinkId(c).catch(u=>{R.warning("[".concat(e,"] set sink id failed"),u.toString())})}catch(u){R.warning("[".concat(e,"] set sink id failed"),u.toString())}const l=o.play();l&&l.then&&l.catch(u=>{i&&tL(i,"audio",u.message,e),R.warning("audio element play warning",u.toString()),this.elementMap.has(e)&&u.name==="NotAllowedError"&&(R.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(o),p_(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),$1()}))})}updateTrack(t,e){const n=this.elementMap.get(t);n&&(n.srcObject=new MediaStream([e]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,e){const n=this.elementMap.get(t);n&&(e=Math.max(0,Math.min(100,e)),n.volume=e/100)}stop(t){const e=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!e)return;const n=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(n,1),e.srcObject=null,e.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,e){bQ.forEach(n=>{e.addEventListener(n,i=>{const o=this.elementStateMap.get(t),c=i.type==="pause"?"paused":i.type;if(R.debug("[".concat(t,"] audio-element-status change ").concat(o," => ").concat(c)),i.type==="error"){const l=e==null?void 0:e.error;l&&R.error("[".concat(t,"] media error, code: ").concat(l.code,", message: ").concat(l.message))}this.elementStateMap.set(t,c)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(n=>{R.debug("Auto resume audio element success")}).catch(n=>{R.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new gt(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{bh()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function Ze(){return function(t,e,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new $(L.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",R);for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];const u=i.apply(this,c);return u instanceof gt?new gt((p,m)=>{u.then(p).catch(m)}):u}),n}}class eL extends Ke{constructor(e){super(),J(this,"name","VideoProcessorDestination"),J(this,"ID","0"),J(this,"_source",void 0),J(this,"videoContext",void 0),J(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new $(L.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new $(L.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(vi.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(vi.ON_TRACK,void 0)}}class nL extends Ke{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n){super(),J(this,"constraintsMap",new Map),J(this,"statsRegistry",[]),J(this,"usageRegistry",[]),J(this,"trackId",void 0),J(this,"direction",void 0),J(this,"_chained",!1),this.trackId=e,this.direction=n}async getConstraints(){return await Kn(this,Sr.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,n){var i;return R.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),we(this,Sr.REQUEST_UPDATE_CONSTRAINTS,Array.from(nr(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return R.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),we(this,Sr.REQUEST_UPDATE_CONSTRAINTS,Array.from(nr(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(o=>o.processorID===e.ID&&o.processorName===e.name&&o.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(o=>o.processorID===e.ID&&o.processorName===e.name&&o.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:o,cb:c}of this.statsRegistry)try{const l=c();e.push({processorID:n,processorName:i,type:o,stats:l})}catch(l){R.error(new $(L.UNEXPECTED_ERROR,l.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof gt&&(i=await i),e.push(ke(ke({},i),{},{direction:this.direction}))}catch(i){R.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class iL extends Ke{constructor(e){super(),J(this,"name","AudioProcessorDestination"),J(this,"ID","0"),J(this,"inputTrack",void 0),J(this,"inputNode",void 0),J(this,"audioProcessorContext",void 0),J(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new $(L.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new $(L.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(vi.ON_TRACK,void 0),this.emit(vi.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(vi.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(vi.ON_NODE,this.inputNode))}}class rL extends Ke{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n,i){super(),J(this,"constraintsMap",new Map),J(this,"statsRegistry",[]),J(this,"audioContext",void 0),J(this,"trackId",void 0),J(this,"direction",void 0),J(this,"usageRegistry",[]),J(this,"_chained",!1),this.audioContext=e,this.trackId=n,this.direction=i}async getConstraints(){return Kn(this,Sr.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,n){var i;return R.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),we(this,Sr.REQUEST_UPDATE_CONSTRAINTS,Array.from(nr(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),we(this,Sr.REQUEST_UPDATE_CONSTRAINTS,Array.from(nr(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(o=>o.processorID===e.ID&&o.processorName===e.name&&o.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(o=>o.processorID===e.ID&&o.processorName===e.name&&o.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:o,cb:c}of this.statsRegistry)try{const l=c();e.push({processorID:n,processorName:i,type:o,stats:l})}catch(l){R.error(new $(L.UNEXPECTED_ERROR,l.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof gt&&(i=await i),e.push(ke(ke({},i),{},{direction:this.direction}))}catch(i){R.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class p0 extends Ke{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),J(this,"context",void 0),J(this,"processSourceNode",void 0),J(this,"outputTrack",void 0),J(this,"processedNode",void 0),J(this,"clonedTrack",void 0),J(this,"outputNode",void 0),this.outputNode=new IQ}setVolume(){}createOutputTrack(){throw new $(L.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class IQ{disconnect(){}connect(){}}function sL(t){return new gt((e,n)=>{let i=!1;const o=document.createElement("video");o.setAttribute("autoplay",""),o.setAttribute("muted",""),o.muted=!0,o.autoplay=!0,o.setAttribute("playsinline",""),o.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(o);const c=ai()?"canplay":"playing";o.addEventListener(c,()=>{const l=o.videoWidth,u=o.videoHeight;!l&&qe()||(i=!0,o.srcObject=null,o.remove(),e([l,u]))}),o.srcObject=new MediaStream([t]),o.play().catch(f_),setTimeout(()=>{i||(o.srcObject=null,o.remove(),e([o.videoWidth,o.videoHeight]))},4e3)})}function b_(t){const e={};t.facingMode&&(e.facingMode=t.facingMode),t.cameraId&&(e.deviceId={exact:t.cameraId});const n=_s(t.encoderConfig);return n.width!=null&&(e.width=n.width),n.height!=null&&(e.height=n.height),!i1()&&n.frameRate&&(e.frameRate=n.frameRate),Xk()&&typeof e.frameRate=="object"&&(e.frameRate.max=60),qe()&&(e.frameRate={ideal:30,max:30}),e}function oL(t){const e={};return i1()||(t.AGC!==void 0&&(e.autoGainControl=t.AGC),t.AEC!==void 0&&(e.echoCancellation=t.AEC),t.ANS!==void 0&&(e.noiseSuppression=t.ANS,qo()&&t.ANS&&(e.googHighpassFilter=t.ANS))),e}function aL(t){const e=oL(t);if(t.encoderConfig){const n=y_(t.encoderConfig);e.channelCount=n.stereo?2:1,e.sampleRate=n.sampleRate,e.sampleSize=n.sampleSize}return t.microphoneId&&(e.deviceId={exact:t.microphoneId}),u_()&&(e.sampleRate=void 0),e}const wQ=t=>{const e=t._encoderConfig;if(!e)return;const{frameRate:n,width:i,height:o}=t.getMediaStreamTrackSettings();let{frameRate:c=n,width:l=i,height:u=o}=e;if(!c||!l||!u)return;l=Cl(l),u=Cl(u),c=Cl(c);const{max:p,min:m}=function(T,A,I){const w=200*Math.pow(I/15,.6)*Math.pow(T*A/640/360,.75);return{min:Math.floor(w),max:Math.floor(4*w)}}(l,u,c),{bitrateMax:_,bitrateMin:E}=e||{};_||R.debug("calculate bitrate: [w: ".concat(l,", h: ").concat(u,", fps: ").concat(c,"] => [brMax: ").concat(_,", brMin: ").concat(E,"]"));const{maxFramerate:S}=x("ENCODER_CONFIG_LIMIT");return S&&typeof S=="number"&&(c=Math.min(c,S)),{frameRate:c,bitrateMax:_||p,bitrateMin:E||m,scaleResolutionDownBy:1,scale:0}},cL=async(t,e,n)=>await(async(i,o,c)=>{const l=function(m){const _=[];for(let E=0;E<m.length;E+=2)_.push(parseInt(m.slice(E,E+2),16));return Uint8Array.from(_)}(S1(""+o+c)).slice(0,16),u=l.slice(0,12),p=await window.crypto.subtle.importKey("raw",l,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:u},p,i))})(t.buffer,e,n),f0=t=>{const e=document.createElement("canvas");return e.width=2,e.height=2,new gt((n,i)=>{e.toBlob(async o=>{if(e.remove(),o){const c=await dL(o);n({buffer:c,width:e.width,height:e.height})}else i(new $(L.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},dL=async t=>{const e=await t.arrayBuffer();return new Uint8Array(e)};var lL,uL,hL,pL,fL,mL,_L,gL,EL,SL,vL,TL,yL,RL,CL,bL,IL,wL,Ye,AL,OL,NL,DL,PL,kL,Ro,LL,ML,xL,UL,VL,FL,BL,jL,WL,GL,HL,zL,KL,qn;let $e=(lL=Pt({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),uL=Pt({argsMap:(t,e)=>[t.getTrackId(),e]}),hL=Ze(),pL=bl("LocalAudioTrack","_enabledMutex"),fL=Pt({argsMap:(t,e)=>[t.getTrackId(),e]}),mL=Ze(),_L=bl("LocalAudioTrack","_enabledMutex"),gL=Pt({argsMap:(t,e)=>[t.getTrackId(),e]}),EL=Ze(),SL=Ze(),vL=Ze(),TL=Pt({argsMap:t=>[t.getTrackId()]}),yL=Ze(),RL=Pt({argsMap:t=>[t.getTrackId()]}),CL=Ze(),bL=Pt({argsMap:t=>[t.getTrackId()]}),IL=Pt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),wL=Pt({argsMap:t=>[t.getTrackId()]}),ne((Ye=class extends kl{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Ni.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,n,i){super(t,n),J(this,"trackMediaType",Pl.AUDIO),J(this,"_encoderConfig",void 0),J(this,"_trackSource",void 0),J(this,"metadata",[]),J(this,"_enabled",!0),J(this,"_volume",100),J(this,"_useAudioElement",!0),J(this,"_bypassWebAudio",!1),J(this,"processor",void 0),J(this,"_processorContext",void 0),J(this,"_processorDestination",void 0),J(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!i,this._trackSource=new p0,x("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),x("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Hn()&&!vr?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){be(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Ni.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void R.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,we(this,yt.NEED_REPLACE_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{R.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!V1())throw new $(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ni.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,n){return this._setEnabled(t,e,n)}async _setEnabled(t,e,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await we(this,yt.NEED_ENABLE_TRACK,this),R.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(i){throw n||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await we(this,yt.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await we(this,yt.NEED_MUTE_TRACK,this):await we(this,yt.NEED_UNMUTE_TRACK,this))}getStats(){return La(()=>{R.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),_r(this,yt.GET_STATS)||ke({},o0)}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Er.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(Er.ON_AUDIO_BUFFER),this._source.on(Er.ON_AUDIO_BUFFER,n=>t(n))}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Ni.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Ni.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ni.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await we(this,yt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return gt.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new $(L.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new $(L.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(t){t.on(vi.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await we(this,yt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await we(this,yt.NEED_REPLACE_TRACK,this))}),t.on(vi.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(t){t.removeAllListeners(vi.ON_TRACK),t.removeAllListeners(vi.ON_NODE)}bindProcessorContextEvents(t){t.on(Sr.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(Sr.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof p0&&(this._trackSource=new q1(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new rL(this._source.context,this.getTrackId(),"local"),e=new iL(t);return this._processorContext=t,this._processorDestination=e,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(e),this._source.on(Er.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Ni.stop(this.getTrackId()),this._source.play()),we(this,yt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{R.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:t,processorDestination:e}}}).prototype,"setVolume",[lL],Object.getOwnPropertyDescriptor(Ye.prototype,"setVolume"),Ye.prototype),ne(Ye.prototype,"setPlaybackDevice",[uL,hL],Object.getOwnPropertyDescriptor(Ye.prototype,"setPlaybackDevice"),Ye.prototype),ne(Ye.prototype,"setEnabled",[pL,fL,mL],Object.getOwnPropertyDescriptor(Ye.prototype,"setEnabled"),Ye.prototype),ne(Ye.prototype,"setMuted",[_L,gL,EL],Object.getOwnPropertyDescriptor(Ye.prototype,"setMuted"),Ye.prototype),ne(Ye.prototype,"getStats",[SL],Object.getOwnPropertyDescriptor(Ye.prototype,"getStats"),Ye.prototype),ne(Ye.prototype,"setAudioFrameCallback",[vL],Object.getOwnPropertyDescriptor(Ye.prototype,"setAudioFrameCallback"),Ye.prototype),ne(Ye.prototype,"play",[TL,yL],Object.getOwnPropertyDescriptor(Ye.prototype,"play"),Ye.prototype),ne(Ye.prototype,"stop",[RL,CL],Object.getOwnPropertyDescriptor(Ye.prototype,"stop"),Ye.prototype),ne(Ye.prototype,"close",[bL],Object.getOwnPropertyDescriptor(Ye.prototype,"close"),Ye.prototype),ne(Ye.prototype,"pipe",[IL],Object.getOwnPropertyDescriptor(Ye.prototype,"pipe"),Ye.prototype),ne(Ye.prototype,"unpipe",[wL],Object.getOwnPropertyDescriptor(Ye.prototype,"unpipe"),Ye.prototype),Ye),xh=(AL=Pt({argsMap:(t,e)=>[t.getTrackId(),e]}),OL=Ze(),NL=bl("MicrophoneAudioTrack","_enabledMutex"),DL=Pt({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),PL=Ze(),kL=Pt({argsMap:t=>[t.getTrackId()]}),ne((Ro=class extends $e{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,n,i){super(t,e.encoderConfig?y_(e.encoderConfig):{},i,x("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),J(this,"_config",void 0),J(this,"_deviceName","default"),J(this,"_constraints",void 0),J(this,"_originalConstraints",void 0),J(this,"_enabled",!0),this._config=e,this._constraints=n,this._originalConstraints=n,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(Tl()||Ly())&&Re.bindInterruptDetectorTrack(this)}async setDevice(t){if(R.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await yr.getDeviceById(t),n={};n.audio=ke({},this._constraints),n.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let i=null;try{i=await Tr(n,this.getTrackId())}catch(o){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),i=await Tr({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await yr.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}R.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,n){if(e)return R.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),x("AUTO_RESET_AUDIO_ROUTE")&&(ai()||ps())){const l=navigator.audioSession;l&&(t||(l.type="playback"),l.type="auto")}if(!t){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await we(this,yt.NEED_DISABLE_TRACK,this)}catch(l){throw R.error("[".concat(this.getTrackId(),"] setEnabled false failed"),l.toString()),l}return}const o=ke({},this._constraints),c=yr.searchDeviceIdByName(this._deviceName);c&&!o.deviceId&&(o.deviceId=c);try{n||(this._enabled=!0);const l=await Tr({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!1),await we(this,yt.NEED_ENABLE_TRACK,this)}catch(l){throw n||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled true failed"),l.toString()),l}R.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Tl()||Ly())&&Re.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((ai()||ps())&&this._enabled&&!this._isClosed&&Re.duringInterruption){const t=async()=>{Re.off(Vn.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Re.on(Vn.IOS_INTERRUPTION_END,t)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Dl.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,n=yr.searchDeviceIdByName(this._deviceName);if(n&&!e.deviceId&&(e.deviceId=n),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const i=await Tr({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Sr.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const o=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(o),n()}catch(o){i(o)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Sr.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[AL,OL],Object.getOwnPropertyDescriptor(Ro.prototype,"setDevice"),Ro.prototype),ne(Ro.prototype,"setEnabled",[NL,DL,PL],Object.getOwnPropertyDescriptor(Ro.prototype,"setEnabled"),Ro.prototype),ne(Ro.prototype,"close",[kL],Object.getOwnPropertyDescriptor(Ro.prototype,"close"),Ro.prototype),Ro),AQ=(LL=Pt({argsMap:(t,e)=>[t.getTrackId(),e,t.duration]}),ML=Ze(),xL=Pt({argsMap:t=>[t.getTrackId()]}),UL=Ze(),VL=Pt({argsMap:t=>[t.getTrackId()]}),FL=Ze(),BL=Pt({argsMap:t=>[t.getTrackId()]}),jL=Ze(),WL=Pt({argsMap:t=>[t.getTrackId()]}),GL=Ze(),HL=Pt({argsMap:t=>[t.getTrackId()]}),zL=Pt({argsMap:t=>[t.getTrackId()]}),KL=Ze(),ne((qn=class extends $e{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,n,i){super(e.createOutputTrack(),n,i),J(this,"source",void 0),J(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=e,this._bufferSource.on(Er.AUDIO_SOURCE_STATE_CHANGE,o=>{this.safeEmit(Dl.SOURCE_STATE_CHANGE,o)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){be(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[LL,ML],Object.getOwnPropertyDescriptor(qn.prototype,"startProcessAudioBuffer"),qn.prototype),ne(qn.prototype,"pauseProcessAudioBuffer",[xL,UL],Object.getOwnPropertyDescriptor(qn.prototype,"pauseProcessAudioBuffer"),qn.prototype),ne(qn.prototype,"seekAudioBuffer",[VL,FL],Object.getOwnPropertyDescriptor(qn.prototype,"seekAudioBuffer"),qn.prototype),ne(qn.prototype,"resumeProcessAudioBuffer",[BL,jL],Object.getOwnPropertyDescriptor(qn.prototype,"resumeProcessAudioBuffer"),qn.prototype),ne(qn.prototype,"stopProcessAudioBuffer",[WL,GL],Object.getOwnPropertyDescriptor(qn.prototype,"stopProcessAudioBuffer"),qn.prototype),ne(qn.prototype,"close",[HL],Object.getOwnPropertyDescriptor(qn.prototype,"close"),qn.prototype),ne(qn.prototype,"setAudioBufferPlaybackSpeed",[zL,KL],Object.getOwnPropertyDescriptor(qn.prototype,"setAudioBufferPlaybackSpeed"),qn.prototype),qn);class gn extends $e{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=Ll().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,Ae(8,"track-mix-")),J(this,"trackList",void 0),J(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(R.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):R.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){R.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}h_(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(n=>{n instanceof gn?n.emit(qc.TRANSCEIVER_UPDATED,e):n._updateRtpTransceiver(e)}))}}class OQ extends Y1{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(Er.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),J(this,"audioBuffer",void 0),J(this,"sourceNode",void 0),J(this,"startPlayTime",0),J(this,"startPlayOffset",0),J(this,"pausePlayTime",0),J(this,"options",void 0),J(this,"currentLoopCount",0),J(this,"currentPlaybackSpeed",100),J(this,"_currentState","stopped"),this.audioBuffer=e,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):R.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const YL=new Map;function qL(t,e){if(t.length===0||e.length===0)return 1/0;const n=Wy(t),i=Wy(e);return Math.floor(i/n)}class m0{get rendFrameRate(){const e=Math.max(1,qL(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/e)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Zn.DESTROYED}set videoElementStatus(e){e!==this._videoElementStatus&&(R.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var n;e!==this._videoState&&(this._videoState=e,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(e){J(this,"trackId",void 0),J(this,"config",void 0),J(this,"onFirstVideoFrameDecoded",void 0),J(this,"onFirstVideoFrameRender",void 0),J(this,"onVideoStateChanged",void 0),J(this,"freezeTimeCounterList",[]),J(this,"renderFreezeAccTime",0),J(this,"renderFreezeAccTime2",0),J(this,"isKeepLastFrame",!1),J(this,"isDestroyed",!1),J(this,"timeUpdatedCount",0),J(this,"freezeTime",0),J(this,"playbackTime",0),J(this,"lastTimeUpdatedTime",0),J(this,"autoplayFailed",!1),J(this,"videoTrack",void 0),J(this,"videoElement",void 0),J(this,"cacheVideoElement",void 0),J(this,"internal",!1),J(this,"_render_interframe_delays",[]),J(this,"_render_interframe_delays_sizes",[]),J(this,"_videoState",yo.VideoStateStopped),J(this,"videoElementCheckInterval",void 0),J(this,"videoElementFreezeTimeout",void 0),J(this,"_videoElementStatus",Zn.NONE),J(this,"_isInPage",!0),J(this,"isGettingVideoDimensions",!1),J(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return R.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),J(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Re.curState==="running"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Yk())),e1()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),J(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":n.type==="play"&&R.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Zn.PLAYING;break;case"loadeddata":if(this.videoState=yo.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Zn.CANPLAY;break;case"stalled":this.videoElementStatus=Zn.STALLED;break;case"suspend":this.videoElementStatus=Zn.SUSPEND;break;case"pause":this.videoElementStatus=Zn.PAUSED,ai()||ps()||Hn()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Zn.WAITING;break;case"abort":this.videoElementStatus=Zn.ABORT;break;case"ended":this.videoElementStatus=Zn.ENDED;break;case"emptied":this.videoElementStatus=Zn.EMPTIED;break;case"error":{const i=this.videoElement.error;i&&(this.videoElementStatus=Zn.ERROR,R.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const o=i-this.lastTimeUpdatedTime,c=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,Co.lastVisibleTime<Co.lastHiddenTime||c<Co.lastHiddenTime||c<Co.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(o>x("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=o),this.playbackTime+=o;this.playbackTime>=6e3;){this.playbackTime-=6e3;const l=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(l),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),J(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Yk())),e1()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),Re.on(Vn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Re.on(Vn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const n=this.videoElement.play();n&&n.catch&&n.catch(o=>{e&&tL(e,"video",o.message,this.trackId),o.name==="NotAllowedError"?(R.warning("detected video element autoplay failed",o),this.autoplayFailed=!0,this.handleAutoPlayFailed()):R.warning("[".concat(this.trackId,"] play warning: "),o)});const i=ie();if((i.name==="Safari"&&Number(i.version)===15||Tl())&&n&&n.then){const o=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(o).catch(o)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");if(!n)return R.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height);return e.remove(),i}async getCurrentFrameToUint8Array(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const o=i.getContext("2d");return o?(o.drawImage(this.videoElement,0,0,i.width,i.height),new gt((c,l)=>{i.toBlob(async u=>{if(i.remove(),u){const p=await dL(u);c({buffer:p,width:i.width,height:i.height})}else l(new $(L.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,n<0?.1:n>1?1:n)})):await f0(e)}destroy(){this.isDestroyed=!0,Re.off(Vn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Re.off(Vn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=yo.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Zn.INIT,!this.videoElementCheckInterval&&(XL.forEach(c=>{this.videoElement.addEventListener(c,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(c){return c!==document.body&&document.body.contains(c)}(this.videoElement)},1e3),x("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,n;let c;const l=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",l),this.videoElementFreezeTimeout=window.setTimeout(u,x("VIDEO_FREEZE_DURATION")))},u=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===yo.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=yo.VideoStateFrozen:document.addEventListener("visibilitychange",l))},p=(m,_)=>{if(this.videoElementStatus===Zn.PLAYING){if(c){const T=_.presentationTime-c.presentationTime,A=_.presentedFrames-c.presentedFrames;this._render_interframe_delays_sizes.push(A),this._render_interframe_delays.push(T);const I=Wy(this._render_interframe_delays_sizes),w=I-this._render_interframe_delays_sizes[0];if(I>30&&w>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===yo.VideoStateStarting&&(this.videoState=yo.VideoStateDecoding),this.videoState===yo.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(u,x("VIDEO_FREEZE_DURATION"))),T<x("VIDEO_FREEZE_DURATION")&&this.videoState===yo.VideoStateFrozen&&(this.videoState=yo.VideoStateDecoding),T>x("VIDEO_FREEZE_DURATION")&&Co.lastVisibleTime>=Co.lastHiddenTime&&c.timestamp>Co.lastVisibleTime&&c.timestamp>Co.lastHiddenTime){const P=Math.min(66,qL(this._render_interframe_delays_sizes,this._render_interframe_delays)),D=Math.max(0,T-(A-1)*P);this.renderFreezeAccTime2+=D>P?D:0,this.renderFreezeAccTime+=T}}c=ke(ke({},_),{},{timestamp:m})}else this.isSkipCalcRenderFreezeTime()&&(c=ke(ke({},_),{},{timestamp:m}));var E,S;x("ENABLE_VIDEO_FRAME_CALLBACK")&&((E=(S=this.videoElement).requestVideoFrameCallback)===null||E===void 0||E.call(S,p))};(e=(n=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(n,p)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),u_()&&!x("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=ie();i.name==="Safari"&&Number(i.version)===15||Tl()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,qe()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,qe()&&this.videoElement.load());const o=this.videoElement.play();o!==void 0&&o.catch(c=>{R.debug("[".concat(this.trackId,"] playback interrupted"),c.toString())})}resetVideoElement(){XL.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Zn.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Zn.DESTROYED||this.internal}handleAutoPlayFailed(){const e=n=>{n.preventDefault(),this.videoElement.play().then(()=>{R.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{R.error(i)}),this.autoplayFailed=!1,bh()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};bh()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),$1()}}const XL=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class _0 extends m0{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(e),J(this,"container",void 0),J(this,"slot",void 0),this.slot=e.element,this.internal=n,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const n=e.element;var i;!this.internal||this.slot?(n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()):(this.slot=n,n&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(i=this.slot)===null||i===void 0||i.appendChild(this.container)):this.createElements())}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,i):await f0(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var e;this.container.remove(),(e=this.slot)===null||e===void 0||e.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var e;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",x("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(e=this.slot)===null||e===void 0||e.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var JL,QL,ZL,$L,tM,eM,nM,iM,rM,sM,oM,aM,cM,dM,lM,uM,hM,pM,fM,mM,_M,gM,EM,SM,vM,TM,yM,RM,Qt,CM,bM,IM,wM,AM,OM,NM,DM,Cr;let Me=(JL=Pt({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),QL=Ze(),ZL=Pt({argsMap:t=>[t.getTrackId()]}),$L=bl("LocalVideoTrack","_enabledMutex"),tM=Pt({argsMap:(t,e)=>[t.getTrackId(),e]}),eM=Ze(),nM=bl("LocalVideoTrack","_enabledMutex"),iM=Pt({argsMap:(t,e)=>[t.getTrackId(),e]}),rM=Ze(),sM=Pt({argsMap:(t,e)=>[t.getTrackId(),e,t._saveEncodeBitrateRatio]}),oM=Ze(),aM=Pt({argsMap:(t,e)=>[t.getTrackId(),e]}),cM=Ze(),dM=Ze(),lM=Pt({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),uM=Ze(),hM=Ze(),pM=Ze(),fM=Pt({argsMap:t=>[t.getTrackId()]}),mM=Ze(),_M=Ze(),gM=Ze(),EM=Ze(),SM=Ze(),vM=Pt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),TM=Pt({argsMap:t=>[t.getTrackId()]}),yM=Pt({argsMap:t=>[t.getTrackId()]}),RM=Pt({argsMap:(t,e,n)=>[t.getTrackId(),e.label,n]}),Qt=class T4 extends kl{get videoHeight(){if(Hn()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(Hn()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Zn.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,n,i,o,c,l){if(super(e,c),J(this,"trackMediaType",Pl.VIDEO),J(this,"_player",void 0),J(this,"isUseScaleResolutionDownBy",!1),J(this,"_videoVisibleTimer",null),J(this,"_previousVideoVisibleStatus",void 0),J(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),J(this,"_encoderConfig",void 0),J(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),J(this,"_optimizationMode",void 0),J(this,"_saveEncodeBitrateRatio",1),J(this,"_videoHeight",void 0),J(this,"_videoWidth",void 0),J(this,"_forceBitrateLimit",void 0),J(this,"_enabled",!0),J(this,"_processorDestination",void 0),J(this,"_processorContext",void 0),Hn()){const{width:u,height:p}=e.getSettings();this._videoWidth=u,this._videoHeight=p}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=i,this._optimizationMode=o,this._hints=l||[],n&&this._hints.indexOf(Ie.CUSTOM_TRACK)!==-1?this._encoderConfig=Ge(n):this._encoderConfig=n,this._hints.indexOf(Ie.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(Oy(ue.CHROME,115)&&d_().indexOf("Windows")!==-1){const u=function(p,m){if("VideoFrame"in window&&"TransformStream"in window&&ae().supportWebRTCInsertableStream){const _=new MediaStreamTrackProcessor(p),E=new MediaStreamTrackGenerator({kind:"video"});let S,T,A=Date.now();const I=()=>{w&&(clearInterval(w),w=void 0),S&&(S.close(),S=void 0),p.stop(),T=void 0,E.removeEventListener("ended",I)};let w=window.setInterval(()=>{if(T&&S&&Date.now()-A>(m??1e3))try{E.readyState==="live"?T.enqueue(S.clone()):I()}catch{I()}},m??1e3);const P=new TransformStream({transform:(D,U)=>{E.readyState==="live"?(T=U,A=Date.now(),S===void 0?(S=D,U.enqueue(D.clone())):(U.enqueue(S),S=D)):D.close()}});return E.addEventListener("ended",I),_.readable.pipeThrough(P).pipeTo(E.writable),E}}(e);u&&(R.info("local screen video track begin to inject frame"),this._mediaStreamTrack=u)}n&&this._hints.indexOf(Ie.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new nL(this.getTrackId(),"local"),this._processorDestination=new eL(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const o=document.getElementById(e);o?e=o:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=ke(ke(ke({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new m0(i):this._player=new _0(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(Dl.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},x("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await we(this,yt.NEED_DISABLE_TRACK,this)}catch(i){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await we(this,yt.NEED_ENABLE_TRACK,this)}catch(i){throw R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await we(this,yt.NEED_MUTE_TRACK,this):await we(this,yt.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*e),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*e),R.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(e)),this._saveEncodeBitrateRatio=1;try{await we(this,yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(R)}}}async setEncoderConfiguration(e,n){if(!this._enabled)throw new $(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=_s(e),x("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const i=b_({encoderConfig:e});(Hn()||ai()||ps())&&(i.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(o){const c=new $(L.UNEXPECTED_ERROR,o.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}}this._encoderConfig=e,this._hints.indexOf(Ie.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await we(this,yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(R)}}getStats(){return La(()=>{R.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),_r(this,yt.GET_STATS)||ke({},a0)}async setBeautyEffect(e){R.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,n):await f0(e)}async findClosestProfile(){const{width:e,height:n,frameRate:i}=this.getMediaStreamTrackSettings(),{width:o,height:c,frameRate:l}=this._encoderConfig||{},u=Cl(this._videoWidth||e||o||0),p=Cl(this._videoHeight||n||c||0),m=function(_,E,S){if(!Array.isArray(x("VIDEO_ENCODER_CONFIG_LIST"))||x("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const T=Math.min(_,E);return!(T>=480)&&ke(ke({},x("VIDEO_ENCODER_CONFIG_LIST").find(A=>A.height>T)),{},{frameRate:S})}(u,p,Cl(i||l||15));if(m)return R.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(u,"x").concat(p," => ").concat(JSON.stringify(m))),this.setEncoderConfiguration(m)}async setBitrateLimit(e){R.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void R.error(L.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=e,await we(this,yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=n,R.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}R.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return R.error(L.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,R.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){sL(this._originMediaStreamTrack).then(e=>{let[n,i]=e;this._videoHeight=i,this._videoWidth=n}).catch(f_)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new $(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");R.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=_s(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(Ie.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await we(this,yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(R)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!e||!n||!i)return;const{bitrateMax:o,bitrateMin:c}=this._encoderConfig;if(c==null||o==null){const{max:l,min:u}=function(p,m,_,E,S){const T=x("BITRATE_ADAPTER_TYPE");if(T==="DEFAULT_BITRATE")return{min:E,max:S};if(S===void 0){const A=Math.floor(200*Math.pow(_/15,.6)*Math.pow(p*m/640/360,.75));S=T==="STANDARD_BITRATE"?4*A:2*A,E=E??A}else E=E??Math.floor(S/10);return{min:E,max:S}}(e,n,i,c,o);if(this._encoderConfig.bitrateMin=u,this._encoderConfig.bitrateMax=l,x("VIDEO_STANDARD_BITRATE_VERSION")&&c==null&&o==null){const[p,m]=function(_,E,S){const T=4*Math.floor(2e5*Math.pow(S/15,.6)*Math.pow(_*E/230400,.75)),A=_*E,I=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),w=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let P=nr(I).call(I).next().value,D=1;if(I.has(A))P=I.get(A);else{var U;const at=Mc(U=Array.from(I.entries())).call(U,(Xt,Ut)=>{let[me]=Xt,[he]=Ut;return me-he}),Kt=at.find(Xt=>{let[Ut]=Xt;return Ut>A});if(Kt){const Xt=at.indexOf(Kt);if(Xt>0){const Ut=at[Xt-1],me=(A-Ut[0])/(Kt[0]-Ut[0]);P=Ut[1]+me*(Kt[1]-Ut[1])}else P=Kt[1]}else P=at[at.length-1][1]}if(w.has(A))D=w.get(A);else{var G;const at=Mc(G=Array.from(w.entries())).call(G,(Xt,Ut)=>{let[me]=Xt,[he]=Ut;return me-he}),Kt=at.find(Xt=>{let[Ut]=Xt;return Ut>A});if(Kt){const Xt=at.indexOf(Kt);if(Xt>0){const Ut=at[Xt-1],me=(A-Ut[0])/(Kt[0]-Ut[0]);D=Ut[1]+me*(Kt[1]-Ut[1])}else D=Kt[1]}else D=at[at.length-1][1]}const W=x("VIDEO_NEW_BITRATE_RATIO");W&&W>0&&(P=W/100);const F=Math.floor(T*P),X=Math.floor(65e4*Math.pow(_*E/230400,.5)*Math.pow(S/15,.69));let tt=F;const nt=x("VIDEO_STANDARD_BITRATE_VERSION");return nt&&nt>0&&(nt===1?tt=T:nt===2?tt=F:nt===3&&(tt=X)),[Math.floor(tt/1e3),D]}(e,n,i);this._encoderConfig.bitrateMax=p,this._encoderConfig.bitrateMin=u?Math.min(u,p):p,this._saveEncodeBitrateRatio=m,R.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(e,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else R.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(l,", brMin: ").concat(u,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var e,n;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:c,slot:l}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&l instanceof HTMLElement){const u=o1.checkOneElementVisible(c),p=Object.assign({},u);if(p.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=p.visible;const m=bt.reportApiInvoke(null,{tag:We.TRACER,name:tn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});p.visible?m.onSuccess("Video is visible"):m.onSuccess("Invisible because of ".concat(p.reason))}return p}return}catch(i){throw new $(L.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new $(L.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=ke(ke({},i),_s(e))),i=Hc(i);const o=Ae(8,"track-video-cloned-"),c=new T4(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,Hc(this._scalabilityMode),this._optimizationMode,o,Hc(this._hints));return e&&i&&c.setEncoderConfiguration(i),R.debug("clone video track from ".concat(this.getTrackId()," to ").concat(o,", clone ").concat(n)),c}async replaceTrack(e,n){if(!(e instanceof MediaStreamTrack))throw new $(L.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new $(L.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(La(()=>{bt.reportApiInvoke(null,{name:tn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:We.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!x("ENABLE_VIDEO_SEI")||!x("ENABLE_ENCODED_TRANSFORM"))return void R.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new $(L.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void R.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(i.codecs.length===0)return;const o=i.codecs[0].mimeType.toLocaleLowerCase();o==="video/h264"||o==="video/h265"?this.safeEmit("sei-to-send",e):R.warning("SEI is not supported by ".concat(o))}bindProcessorDestinationEvents(){this.processorDestination.on(vi.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await we(this,yt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await we(this,yt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(vi.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Sr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Sr.REQUEST_CONSTRAINTS)}},ne(Qt.prototype,"play",[JL,QL],Object.getOwnPropertyDescriptor(Qt.prototype,"play"),Qt.prototype),ne(Qt.prototype,"stop",[ZL],Object.getOwnPropertyDescriptor(Qt.prototype,"stop"),Qt.prototype),ne(Qt.prototype,"setEnabled",[$L,tM,eM],Object.getOwnPropertyDescriptor(Qt.prototype,"setEnabled"),Qt.prototype),ne(Qt.prototype,"setMuted",[nM,iM,rM],Object.getOwnPropertyDescriptor(Qt.prototype,"setMuted"),Qt.prototype),ne(Qt.prototype,"setSaveEncodeBitrateRatio",[sM,oM],Object.getOwnPropertyDescriptor(Qt.prototype,"setSaveEncodeBitrateRatio"),Qt.prototype),ne(Qt.prototype,"setEncoderConfiguration",[aM,cM],Object.getOwnPropertyDescriptor(Qt.prototype,"setEncoderConfiguration"),Qt.prototype),ne(Qt.prototype,"getStats",[dM],Object.getOwnPropertyDescriptor(Qt.prototype,"getStats"),Qt.prototype),ne(Qt.prototype,"setBeautyEffect",[lM,uM],Object.getOwnPropertyDescriptor(Qt.prototype,"setBeautyEffect"),Qt.prototype),ne(Qt.prototype,"getCurrentFrameData",[hM],Object.getOwnPropertyDescriptor(Qt.prototype,"getCurrentFrameData"),Qt.prototype),ne(Qt.prototype,"getCurrentFrameImage",[pM],Object.getOwnPropertyDescriptor(Qt.prototype,"getCurrentFrameImage"),Qt.prototype),ne(Qt.prototype,"findClosestProfile",[fM,mM],Object.getOwnPropertyDescriptor(Qt.prototype,"findClosestProfile"),Qt.prototype),ne(Qt.prototype,"setBitrateLimit",[_M],Object.getOwnPropertyDescriptor(Qt.prototype,"setBitrateLimit"),Qt.prototype),ne(Qt.prototype,"setOptimizationMode",[gM],Object.getOwnPropertyDescriptor(Qt.prototype,"setOptimizationMode"),Qt.prototype),ne(Qt.prototype,"setScalabiltyMode",[EM],Object.getOwnPropertyDescriptor(Qt.prototype,"setScalabiltyMode"),Qt.prototype),ne(Qt.prototype,"updateMediaStreamTrackResolution",[SM],Object.getOwnPropertyDescriptor(Qt.prototype,"updateMediaStreamTrackResolution"),Qt.prototype),ne(Qt.prototype,"pipe",[vM],Object.getOwnPropertyDescriptor(Qt.prototype,"pipe"),Qt.prototype),ne(Qt.prototype,"unpipe",[TM],Object.getOwnPropertyDescriptor(Qt.prototype,"unpipe"),Qt.prototype),ne(Qt.prototype,"close",[yM],Object.getOwnPropertyDescriptor(Qt.prototype,"close"),Qt.prototype),ne(Qt.prototype,"replaceTrack",[RM],Object.getOwnPropertyDescriptor(Qt.prototype,"replaceTrack"),Qt.prototype),Qt),I_=(CM=Pt({argsMap:(t,e)=>[t.getTrackId(),e]}),bM=Ze(),IM=bl("CameraVideoTrack","_enabledMutex"),wM=Pt({argsMap:(t,e)=>[t.getTrackId(),e]}),AM=Ze(),OM=Pt({argsMap:(t,e)=>[t.getTrackId(),e]}),NM=Ze(),DM=Pt({argsMap:t=>[t.getTrackId()]}),Cr=class y4 extends Me{get __className__(){return"CameraVideoTrack"}constructor(e,n,i,o,c,l){super(e,_s(n.encoderConfig),o,c,l),J(this,"_config",void 0),J(this,"_originalConstraints",void 0),J(this,"_constraints",void 0),J(this,"_enabled",!0),J(this,"_deviceName","default"),J(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Tl()||Ly())&&!function(){const u=ie();if(u.os!==bn.IOS||!u.osVersion)return!1;const p=u.osVersion.split(".");return Number(p[0])===15&&Number(p[1])>=2}()&&n1()&&this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=e.label,this._encoderConfig=_s(this._config.encoderConfig),Re.on(Vn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Re.on(Vn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(R.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const n=await yr.getDeviceById(e),i={};i.video=ke({},this._constraints),i.video.deviceId={exact:e},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let o=null;try{o=await Tr(i,this.getTrackId())}catch(c){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await Tr({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await yr.getDeviceById(e);this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}R.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){R.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const n={video:ke(ke({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await Tr(n,this.getTrackId())}catch(o){throw R.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),o.toString()),i=await Tr({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=ke({},n.video),R.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await Tr({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await we(this,yt.NEED_ENABLE_TRACK,this)}catch(i){throw R.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await we(this,yt.NEED_DISABLE_TRACK,this)}catch(i){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,n){if(!this._enabled)throw new $(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=_s(e),x("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const i=Ge(this._config);i.encoderConfig=e;const o=b_(i);(Hn()||ai()||ps())&&(o.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const l=new $(L.UNEXPECTED_ERROR,c.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),l.toString()),l}this._config=i,this._constraints=o,this._originalConstraints=o,this._encoderConfig=e,this._hints.indexOf(Ie.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await we(this,yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(c){return c.throw(R)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ai()||ps())&&this._enabled&&!this._isClosed&&Re.duringInterruption){const e=async()=>{Re.off(Vn.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Re.on(Vn.IOS_INTERRUPTION_END,e)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Dl.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,i=yr.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId={exact:i}),this._enabled){const o=await Tr({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Re.off(Vn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Re.off(Vn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=ke(ke({},i),_s(e))),i=Hc(i);const o=Ae(8,"track-cam-cloned-"),c=new y4(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,Hc(ke(ke({},this._config),{},{encoderConfig:i})),Hc(this._constraints),Hc(this._scalabilityMode),this._optimizationMode,o);return e&&i&&c.setEncoderConfiguration(i),R.debug("clone track from ".concat(this.getTrackId()," to ").concat(o,", clone ").concat(n)),c}bindProcessorContextEvents(){this.processorContext.on(Sr.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const o=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(o),n()}catch(o){i(o)}}),this.processorContext.on(Sr.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},ne(Cr.prototype,"setDevice",[CM,bM],Object.getOwnPropertyDescriptor(Cr.prototype,"setDevice"),Cr.prototype),ne(Cr.prototype,"setEnabled",[IM,wM,AM],Object.getOwnPropertyDescriptor(Cr.prototype,"setEnabled"),Cr.prototype),ne(Cr.prototype,"setEncoderConfiguration",[OM,NM],Object.getOwnPropertyDescriptor(Cr.prototype,"setEncoderConfiguration"),Cr.prototype),ne(Cr.prototype,"close",[DM],Object.getOwnPropertyDescriptor(Cr.prototype,"close"),Cr.prototype),Cr);function g0(t,e,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=ke(ke({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(e.contentHint=n.optimizationMode,e.contentHint===n.optimizationMode?R.debug("[".concat(t,"] set content hint to"),n.optimizationMode):R.debug("[".concat(t,"] set content hint failed")))):R.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var PM,kM,LM,MM,Br,xM,UM,VM,FM,BM,jM,pi;class WM extends H1{getUserId(){return this._userId}constructor(e,n,i,o){super(e,"track-".concat(e.kind,"-").concat(n,"-").concat(o.clientId,"_").concat(Ae(5,""))),J(this,"_userId",void 0),J(this,"_uintId",void 0),J(this,"_isDestroyed",!1),J(this,"store",void 0),J(this,"processor",void 0),J(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=o}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,R.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let xl=(PM=Pt({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),kM=Pt({argsMap:t=>[t.getTrackId()]}),LM=Pt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),MM=Pt({argsMap:t=>[t.getTrackId()]}),ne((Br=class extends WM{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Zn.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,n,i,o){super(t,e,n,i),J(this,"_videoVisibleTimer",null),J(this,"_previousVideoVisibleStatus",void 0),J(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),J(this,"trackMediaType",Pl.VIDEO),J(this,"_videoWidth",void 0),J(this,"_videoHeight",void 0),J(this,"_player",void 0),J(this,"_prePlayer",void 0),J(this,"processorDestination",void 0),J(this,"processorContext",void 0),this._prePlayer=o,this.updateMediaStreamTrackResolution(),this.processorContext=new nL(this.getTrackId(),"remote"),this.processorDestination=new eL(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return La(()=>{R.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),_r(this,yt.GET_STATS)||ke({},W1)}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Fr.PLAY_START),typeof t=="string"){const i=document.getElementById(t);i?t=i:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const n=ke(ke({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});if(this._player)this._player.updateConfig(n);else{let i=!1,o=!1;t instanceof HTMLVideoElement?(this._player=new m0(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,o=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,i=this._player.videoState>0,this._player.updateConfig(n)):this._player=new _0(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Fr.FIRST_FRAME_DECODED),o&&this.safeEmit(Fr.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=c=>{this.safeEmit(Fr.VIDEO_STATE_CHANGED,c)},i&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(Fr.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},x("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Fr.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){sL(this._originMediaStreamTrack).then(t=>{let[e,n]=t;this._videoHeight=n,this._videoWidth=e}).catch(f_)}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:o,slot:c}=i;if(this.isPlaying&&o instanceof HTMLVideoElement&&c instanceof HTMLElement){const l=o1.checkOneElementVisible(o),u=Object.assign({},l);if(u.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=u.visible;const p=bt.reportApiInvoke(null,{tag:We.TRACER,name:tn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});u.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(u.reason))}return u}return}catch(n){throw new $(L.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new $(L.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(vi.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(vi.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(qc.SEI_RECEIVED,t)}}).prototype,"play",[PM],Object.getOwnPropertyDescriptor(Br.prototype,"play"),Br.prototype),ne(Br.prototype,"stop",[kM],Object.getOwnPropertyDescriptor(Br.prototype,"stop"),Br.prototype),ne(Br.prototype,"pipe",[LM],Object.getOwnPropertyDescriptor(Br.prototype,"pipe"),Br.prototype),ne(Br.prototype,"unpipe",[MM],Object.getOwnPropertyDescriptor(Br.prototype,"unpipe"),Br.prototype),Br),Ul=(xM=Pt({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),UM=Pt({argsMap:(t,e)=>[t.getTrackId(),e]}),VM=Pt({argsMap:t=>[t.getTrackId()]}),FM=Pt({argsMap:t=>[t.getTrackId()]}),BM=Pt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),jM=Pt({argsMap:t=>[t.getTrackId()]}),ne((pi=class extends WM{get isPlaying(){return this._useAudioElement?Ni.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,n,i){super(t,e,n,i),J(this,"trackMediaType",Pl.AUDIO),J(this,"_source",void 0),J(this,"_useAudioElement",!0),J(this,"_volume",100),J(this,"processorContext",void 0),J(this,"processorDestination",void 0),J(this,"_played",!1),J(this,"_bypassWebAudio",!1),x("DISABLE_WEBAUDIO")?(this._source=new p0,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new q1(t,!0),x("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Er.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Fr.FIRST_FRAME_DECODED)}),this.processorContext=new rL(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new iL(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Er.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Er.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(Er.ON_AUDIO_BUFFER),this._source.on(Er.ON_AUDIO_BUFFER,n=>t(n))}setVolume(t){this._volume=t,this._useAudioElement?Ni.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!V1())throw new $(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ni.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return La(()=>{R.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),_r(this,yt.GET_STATS)||ke({},j1)}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] use audio element to play")),Ni.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Ni.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ni.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new $(L.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new $(L.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new $(L.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(vi.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(vi.ON_NODE,t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(vi.ON_TRACK),this.processorDestination.removeAllListeners(vi.ON_NODE)}}).prototype,"setVolume",[xM],Object.getOwnPropertyDescriptor(pi.prototype,"setVolume"),pi.prototype),ne(pi.prototype,"setPlaybackDevice",[UM],Object.getOwnPropertyDescriptor(pi.prototype,"setPlaybackDevice"),pi.prototype),ne(pi.prototype,"play",[VM],Object.getOwnPropertyDescriptor(pi.prototype,"play"),pi.prototype),ne(pi.prototype,"stop",[FM],Object.getOwnPropertyDescriptor(pi.prototype,"stop"),pi.prototype),ne(pi.prototype,"pipe",[BM],Object.getOwnPropertyDescriptor(pi.prototype,"pipe"),pi.prototype),ne(pi.prototype,"unpipe",[jM],Object.getOwnPropertyDescriptor(pi.prototype,"unpipe"),pi.prototype),pi);const Co=new class extends Ke{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),J(this,"_lastHiddenTime",0),J(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),R.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class GM extends Ke{constructor(e,n){super(),J(this,"trackMediaType",Pl.DATA),J(this,"_version",1),J(this,"_type",3),J(this,"_config",void 0),J(this,"_originDataChannel",void 0),J(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),J(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),J(this,"_datachannelEventMap",new Map),this._config=e,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return x("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new gt((e,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();const i=setTimeout(()=>{var o;n(new $(L.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((o=this._originDataChannel)===null||o===void 0?void 0:o.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new $(L.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new $(L.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[R_.OPEN,R_.CLOSE,R_.ERROR].forEach(n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),e.addEventListener(n,i)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[i,o]=n;e.removeEventListener(i,o)}),this._datachannelEventMap.clear()}}class NQ extends GM{constructor(e){super(e),J(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),o=new DataView(i).getUint8(3);if(o!==this.id)return void(x("SHOW_DATASTREAM2_LOG")&&R.debug("invalid datachannel id: ".concat(o," !== ").concat(this.id)));let c=n.data.slice(this._dataStreamPacketHeader.byteLength);c=this._dataStreamPacketHandler.deserialize(c),this.emit(R_.MESSAGE,c)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class DQ extends GM{send(e){if(this._originDataChannel){let n=e;n=this._dataStreamPacketHandler.serialize(e);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function w_(){const t=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>Im.revokeObjectURL(t),0),new Worker(Im.createObjectURL(t))}const HM=71,E0=1,S0=2,v0=1,zM=2;var Ua=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(Ua||{});function T0(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=t.getUint8(0);if(n!==HM)return;const i=t.getUint16(1),o=E0+S0+i,c=new Uint8Array(t.byteLength-o);c.set(new Uint8Array(t.buffer,o,t.byteLength-o));const l={m:n,tlvLen:i,tlv:[],frame:c};let u=E0+S0;for(;u<o;){const p=t.getUint8(u),m=t.getUint16(u+v0),_=v0+zM;if(p===Ua.AUDIO_LEVEL){let E=t.getUint8(u+_);for(let S=1;S<m;S++)E=E<<8|t.getUint8(u+_+S);l.tlv.push({tag:p,length:m,value:e?127^E>>1:127&E})}else if(p===Ua.METADATA||p===Ua.AUDIO_64_BIT_PTS){const E=new Uint8Array(m);for(let S=0;S<m;S++)E[S]=t.getUint8(u+_+S);l.tlv.push({tag:p,length:m,value:E})}u+=_+m}return l}const A_=new Map,O_=127,Qc=1e-10,y0=139/13,N_=new Map;function R0(t,e,n){const i="".concat(t,"-").concat(e,"-").concat(n);let o=0;return N_.has(i)?o=N_.get(i):(o=Math.log(function(l,u){const p=l-u;u<p&&(u=p);let m=1;for(let _=l,E=1;_>u;_--,E++)m=m*_/E;return m}(e,t))+t*Math.log(.5)+(e-t)*Math.log(1-.5)-Math.log(n)+n*t,N_.set(i,o)),o<Qc&&(o=Qc),o}function KM(t,e,n){const i=e.length,o=t.length/i;let c=!1;for(let l=0,u=0;l<i;l++){let p=0;for(let m=u+o;u<m;u++)t[u]>n&&p++;e[l]!==p&&(e[l]=p,c=!0)}return c}window.cache=N_;let PQ=0;class YM{constructor(e){J(this,"id",void 0),J(this,"immediates",[]),J(this,"lastNonSilence",-1),J(this,"immediateSpeechActivityScore",Qc),J(this,"lastLevelChangedTime",Date.now()),J(this,"levels",[]),J(this,"longs",[]),J(this,"longSpeechActivityScore",Qc),J(this,"mediums",[]),J(this,"mediumSpeechActivityScore",Qc),J(this,"minLevel",0),J(this,"nextMinLevel",0),J(this,"nextMinLevelWindowLength",0),J(this,"energyScore",0),this.id=e||"".concat(PQ++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const e=this.immediates,n=this.levels,i=this.minLevel+y0;let o=!1;for(let c=0;c<e.length;++c){let l=n[c];l<i&&(l=0);const u=Math.floor(l/y0);e[c]!==u&&(e[c]=u,o=!0)}return o}computeLongs(){return KM(this.mediums,this.longs,4)}computeMediums(){return KM(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=R0(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=R0(this.longs[0],10,47),this.longSpeechActivityScore>Qc&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=R0(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(ww(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let i=e;return e<0&&(i=0),e>O_&&(i=O_),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+y0?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(e!==0){if(this.minLevel===0||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>O_&&(n=O_),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class kQ{constructor(e){J(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?e=!0:setTimeout(this.execute.bind(this),n)}catch{e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class C0{constructor(e,n,i){J(this,"isDominant",void 0),J(this,"energyRanking",void 0),J(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=n,this.energyScore=i}}class LQ extends Ke{constructor(e){super(),J(this,"dominantId",null),J(this,"lastDecisionTime",0),J(this,"lastLevelChangedTime",0),J(this,"lastLevelIdleTime",0),J(this,"relativeSpeechActivities",[]),J(this,"speakers",new Map),J(this,"enableSilence",!1),J(this,"timeoutToSilenceInterval",0),J(this,"decisionMaker",null),J(this,"loudest",[]),J(this,"numLoudestToTrack",3),J(this,"energyExpireTimeMs",250),J(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,n!=null&&(this.energyExpireTimeMs=n),i!=null&&(this.energyAlphaPct=i),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some(n=>n.id===e)}levelChanged(e,n){const i=Date.now(),o=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());const c=o.levelChanged(n,i);return this.updateLoudestList(o,c,i)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(e){e.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(e){let n=this.speakers.get(e);return n||(n=new YM(e),this.speakers.set(e,n),this.maybeStartDecisionMaker()),n}updateLoudestList(e,n,i){const o=e.id===this.dominantId;if(n<0){let p=0;for(;p<this.loudest.length&&this.loudest[p]!==e;)++p;return new C0(o,p,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*e.energyScore+50)/100),this.numLoudestToTrack===0)return new C0(o,0,e.energyScore);const c=i-this.energyExpireTimeMs;let l=0;for(;l<this.loudest.length;){const p=this.loudest[l];if(p.getLastLevelChangedTime()<c&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(l,1);else if(p.id!==e.id)++l;else if(this.loudest.splice(l,1),this.loudest.length<this.numLoudestToTrack)break}let u=0;for(;u<this.loudest.length&&!(this.loudest[u].energyScore<e.energyScore);)++u;return u<this.numLoudestToTrack&&(this.loudest.splice(u,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new C0(o,u,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new kQ(this),this.decisionMaker.execute())}makeDecision(e){let n=null,i=null;const o=this.speakers.size;let c=null;if(o===0)c=null;else if(o===1){var l;const u=nr(l=this.speakers).call(l).next().value;this.enableSilence&&u&&(c=u.id,u.evaluateSpeechActivityScores(e),e-u.lastNonSilence>this.timeoutToSilenceInterval&&(c=null))}else{let u=this.dominantId==null?null:this.speakers.get(this.dominantId);if(u==null){const _=this.speakers.entries().next();_.value&&(c=_.value[0],u=_.value[1])}else c=u.id;u!=null&&u.evaluateSpeechActivityScores(e);const p=this.relativeSpeechActivities;let m=2;for(const _ of this.speakers.entries()){const[E,S]=_;if(S===u)continue;S.evaluateSpeechActivityScores(e);for(let w=0;w<p.length;++w){const P=u==null?Qc:u.getSpeechActivityScore(w);p[w]=Math.log(S.getSpeechActivityScore(w)/P)}const T=p[0],A=p[1],I=p[2];T>3&&A>2&&I>0&&A>m&&(m=A,c=E)}this.enableSilence&&u!=null&&c===u.id&&e-u.lastNonSilence>this.timeoutToSilenceInterval&&(c=null)}c==null&&!this.enableSilence||c===this.dominantId||(n=this.dominantId,this.dominantId=c,i=this.dominantId),i==null&&!this.enableSilence||i===n||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){const e=Date.now(),n=300-(e-this.lastLevelIdleTime);let i=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):i=n;let o=300-(e-this.lastDecisionTime);return o<=0&&(this.lastDecisionTime=e,this.makeDecision(e),o=300-(Date.now()-e)),o>0&&i>o&&(i=o),i}timeoutIdleLevels(e){const n=[];for(const o of nr(i=this.speakers).call(i)){var i;const c=e-o.getLastLevelChangedTime();36e5<c&&(this.dominantId==null||o.id!==this.dominantId)?n.push(o.id):300<c&&o.levelTimedOut()}n.forEach(o=>this.speakers.delete(o))}}const Vl=new Map;let Ys=null,D_=null;const qM=3;let Zc=[];const qs=new Map,P_=new Map;class MQ{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,n){J(this,"id",void 0),J(this,"track",void 0),J(this,"score",0),J(this,"active",!0),J(this,"muted",!1),J(this,"timer",0),J(this,"actives",0),J(this,"inactives",0),this.id=e,this.track=n,this.setActive(qs.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const e=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:i}=function(){const o=[],c=[];return Array.from(nr(qs).call(qs)).forEach(l=>{l.active?o.push(l):c.push(l)}),{actives:o,inactives:c}}();if(n.length>3){let o;n.forEach(c=>{(!o||o.score>c.score)&&(o=c)}),o&&o.setActive(!1)}if(n.length<3&&i.length>0){let o;i.forEach(c=>{(!o||o.score<c.score)&&c.id!==this.id&&(o=c)}),o&&e&&!this.active&&(o.samples>40&&o.activeRate-this.activeRate>.4?o.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const e=function(n){let i;return Array.from(nr(qs).call(qs)).forEach(o=>{!o.active||o.id===n||o.samples<40||(!i||o.score<i.score)&&(i=o)}),i}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const e=function(n){let i;return Array.from(nr(qs).call(qs)).forEach(o=>{o.active||o.id===n||o.samples<40||(!i||o.score>i.score)&&(i=o)}),i}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let k_;function XM(t){const e=qs.get(t);e&&(qs.delete(t),e.clearTimer())}const L_=new Map,xQ=new Map,b0="video/h264",I0="video/h265";function JM(t,e,n){let i=new Uint8Array(t,e,n),o=[],c=0;for(;o.length<n;)c+3<n&&i[c]===0&&i[c+1]===0&&i[c+2]===3&&(i[c+3]===0||i[c+3]===1||i[c+3]===2||i[c+3]===3)?(o.push(i[c],i[c+1],i[c+3]),c+=4):(o.push(i[c]),c++);return new Uint8Array(o)}function QM(t){const e=t.length;let n=[],i=0;for(;i<e;)i+2<e&&t[i]===0&&t[i+1]===0&&(t[i+2]===0||t[i+2]===1||t[i+2]===2||t[i+2]===3)?(n.push(t[i],t[i+1],3,t[i+2]),i+=3):(n.push(t[i]),i++);return new Uint8Array(n)}function ZM(t){if(t.length<5)return"";let e=-1;for(let o=0;o<t.length-3;o++){if(t[o]===0&&t[o+1]===0&&t[o+2]===1){e=o;break}if(o<t.length-4&&t[o]===0&&t[o+1]===0&&t[o+2]===0&&t[o+3]===1){e=o;break}}if(e===-1)return"";const n=e+(t[e+2]===0?4:3);if(n>=t.length)return"";const i=t[n];return 128&i?"":(i>>1&63)>=32||n+1<t.length&&!(248&t[n+1])?I0:(31&i)<=31?b0:""}const M_=new Map,Uh=new Map;(function(){const t=ie();Un.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Un.getStreamFromExtension=t.name===ue.CHROME&&Number(t.version)>34,Un.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let n=!1;try{e.addTransceiver("audio"),n=!0}catch{}return e.close(),n}(),Un.supportMinBitrate=t.name===ue.CHROME||t.name===ue.EDGE,Un.supportSetRtpSenderParameters=function(){const e=ie();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Xo()||!(!Hn()&&!l_())||e.name===ue.FIREFOX&&Number(e.version)>=64)}(),t.name===ue.SAFARI&&(Number(t.version)>=14?Un.supportDualStream=!0:Un.supportDualStream=!1),Un.webAudioMediaStreamDest=function(){const e=ie();return!(e.name===ue.SAFARI&&Number(e.version)<12)}(),Un.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Un.supportWebGL=typeof WebGLRenderingContext<"u",Un.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Xo()||(Un.webAudioWithAEC=!0),Un.supportShareAudio=function(){const e=ie();return(e.os===bn.WIN_10||e.os===bn.WIN_81||e.os===bn.WIN_7||e.os===bn.LINUX||e.os===bn.MAC_OS||e.os===bn.CHROMIUM_OS)&&e.name===ue.CHROME&&Number(e.version)>=74}(),Un.supportDataChannel=!!(vl(76)||Dy(68)||Qk(14)),Un.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!qe()&&!!e&&e.prototype.setConfiguration instanceof Function}(),Un.supportWebRTCEncodedTransform=vl(87)||qk()||Dy(117),Un.supportWebRTCInsertableStream=function(){const e=ie();return(e.name===ue.CHROME||e.name===ue.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Un.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Un.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,p_(()=>{Un.supportDualStreamEncoding=function(){const e=ie();return!!x("DISABLE_WEBAUDIO")||e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&x("CHROME_DUAL_STREAM_USE_ENCODING"))}(),R.debug("browser ua: ",navigator.userAgent),R.info("browser info: ",t),R.info("browser compatibility: ",Un)})})();const UQ=["CHINA","GLOBAL"],$M=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],$c=[],Fl=[];function td(t,e){return!!e&&$c.some(n=>n.uid===t&&n.channelName===e)}function w0(){return Fl.length>0}var VQ=fP.forEach,tx=Vf("forEach")?[].forEach:function(t){return VQ(this,t,arguments.length>1?arguments[1]:void 0)};ve({target:"Array",proto:!0,forced:[].forEach!==tx},{forEach:tx});var FQ=ss("Array","forEach"),BQ=Ca,jQ=si,WQ=M,GQ=FQ,A0=Array.prototype,HQ={DOMTokenList:!0,NodeList:!0},zQ=function(t){var e=t.forEach;return t===A0||WQ(A0,t)&&e===A0.forEach||jQ(HQ,BQ(t))?GQ:e},KQ=h(zQ),YQ=fo,ex=Hf;ve({target:"Object",stat:!0,forced:f(function(){ex(1)})},{keys:function(t){return ex(YQ(t))}});var qQ=h(Bi.Object.keys),XQ=h(Cw),JQ=h(Iw),QQ=ve,nx=Xu,ZQ=rm,$Q=ri,ix=zS,tZ=Ra,eZ=Lr,nZ=lT,iZ=_n,rZ=Ia,sZ=rP("slice"),oZ=iZ("species"),O0=Array,aZ=Math.max;QQ({target:"Array",proto:!0,forced:!sZ},{slice:function(t,e){var n,i,o,c=eZ(this),l=tZ(c),u=ix(t,l),p=ix(e===void 0?l:e,l);if(nx(c)&&(n=c.constructor,(ZQ(n)&&(n===O0||nx(n.prototype))||$Q(n)&&(n=n[oZ])===null)&&(n=void 0),n===O0||n===void 0))return rZ(c,u,p);for(i=new(n===void 0?O0:n)(aZ(p-u,0)),o=0;u<p;u++,o++)u in c&&nZ(i,o,c[u]);return i.length=o,i}});var cZ=ss("Array","slice"),dZ=M,lZ=cZ,N0=Array.prototype,uZ=function(t){var e=t.slice;return t===N0||dZ(N0,t)&&e===N0.slice?lZ:e},hZ=h(uZ);function Ct(t,e,n,i,o){var c,l,u,p={};return KQ(c=qQ(i)).call(c,function(m){p[m]=i[m]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=XQ(l=JQ(u=hZ(n).call(n)).call(u)).call(l,function(m,_){return _(t,e,m)||m},p),o&&p.initializer!==void 0&&(p.value=p.initializer?p.initializer.call(o):void 0,p.initializer=void 0),p.initializer===void 0?(tP(t,e,p),null):p}let x_=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),D0=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),gs=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),Ti=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),Nt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),Le=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),Vt=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),Mt=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t.DOWNGRADE_CODEC="downgrade_codec",t}({}),Vh=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),ee=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),yi=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),Gt=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function U_(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw R.error("Invalid Channel Name ".concat(t)),new Q(L.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function V_(t){if(e=t,!(typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295||s1(t,1,255)))throw new Q(L.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var e;typeof t=="string"&&R.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let bo=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const pZ={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},P0={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function k0(t,e){Mn(t.url,"".concat(e,".url"),1,1e3,!1),Xe(t.x)||be(t.x,"".concat(e,".x"),0,1e4),Xe(t.y)||be(t.y,"".concat(e,".y"),0,1e4),Xe(t.width)||be(t.width,"".concat(e,".width"),0,1e4),Xe(t.height)||be(t.height,"".concat(e,".height"),0,1e4),Xe(t.zOrder)||be(t.zOrder,"".concat(e,".zOrder"),0,255),Xe(t.alpha)||be(t.alpha,"".concat(e,".alpha"),0,1,!1)}const fZ={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Va=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),L0=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),En=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function rx(t){if(!t.channelName)throw new Q(L.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new Q(L.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&Mn(t.token,"info.token",1,2047),V_(t.uid),U_(t.channelName),!0}let Ri=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),Qo=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Hi=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),Bl=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),Ee=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),Nn=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),F_=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),In=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),pe=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const sx=[pe.AFRICA,pe.ASIA,pe.CHINA,pe.EUROPE,pe.GLOBAL,pe.INDIA,pe.JAPAN,pe.NORTH_AMERICA,pe.OCEANIA,pe.OVERSEA,pe.SOUTH_AMERICA];let $n=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const B_={CHINA:{},ASIA:{CODE:$n.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:$n.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:$n.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:$n.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:$n.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:$n.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:$n.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:$n.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:$n.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:$n.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:$n.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:$n.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:$n.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};Qy&&(B_.CHINA={CODE:$n.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Fh=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function ox(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class ax extends Ke{constructor(e,n){super(),N(this,"onICEConnectionStateChange",void 0),N(this,"onConnectionStateChange",void 0),N(this,"onDTLSTransportStateChange",void 0),N(this,"onDTLSTransportError",void 0),N(this,"onICETransportStateChange",void 0),N(this,"onFirstAudioReceived",void 0),N(this,"onFirstVideoReceived",void 0),N(this,"onFirstAudioDecoded",void 0),N(this,"onFirstVideoDecoded",void 0),N(this,"onFirstVideoRender",void 0),N(this,"onFirstVideoDecodedTimeout",void 0),N(this,"onSelectedLocalCandidateChanged",void 0),N(this,"onSelectedRemoteCandidateChanged",void 0),N(this,"onICECandidateError",void 0),N(this,"getLocalVideoStats",void 0)}}class cx extends ax{constructor(e,n){super(e,n),N(this,"establishPromise",void 0)}}let St=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),ti=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),Zo=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const dx=["disconnected","failed"];let st=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),ge=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),It=function(t){return t.AudioMetadata="audioMetadata",t.AudioPts="audioPts",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),Es=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Ss=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Dn=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),lx=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),Io=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),jr=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Xs=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),jl=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),rn=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),Wl=function(t){return t.ABORT="abort",t}({}),Fa=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),mZ=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const _Z={[x_.ACCESS_POINT]:{[Ti.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ti.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ti.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ti.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ti.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ti.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[x_.UNILBS]:{[gs.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[gs.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[gs.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[gs.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[gs.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[gs.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[gs.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[gs.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[gs.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[gs.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[gs.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[gs.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[x_.STRING_UID_ALLOCATOR]:{[D0.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[D0.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[D0.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Gl(t){const e=_Z[Math.floor(t/1e4)];if(!e)return{desc:"unknown error",retry:!1};const n=e[t%1e4];if(!n){if(Math.floor(t/1e4)===x_.ACCESS_POINT){const i=t%1e4;if(i.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const gZ={[Nt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Nt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Nt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Nt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Nt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Nt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Nt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Nt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Nt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Nt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Nt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Nt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Nt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Nt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Nt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Nt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Nt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Nt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Nt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Nt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Nt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Nt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Nt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Nt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Nt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Nt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Nt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Nt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Nt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Nt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Nt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Nt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Nt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Nt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Nt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Nt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Nt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Nt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Nt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Nt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Nt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Nt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Nt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Nt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Nt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Nt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Nt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Nt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Nt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Nt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Nt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Nt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Nt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Nt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Nt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Nt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Nt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Nt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Nt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Nt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Nt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Nt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Nt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Nt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Bh(t){return gZ[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function ux(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function M0(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ux(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ux(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function x0(t,e){if(typeof t=="string")return t;const{proxy:n,host:i,port:o}=t;if(e){const c=x("JOIN_GATEWAY_FALLBACK_PORT")||443;return c===443?"wss://".concat(i,"/ws/?p=").concat(Number(o)+150):"wss://".concat(i,":").concat(c,"/ws/?p=").concat(Number(o)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(o):"wss://".concat(i,":").concat(o)}const EZ=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,SZ=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,vZ=/wss:\/\/(.+):([0-9]+)\/?/,TZ=/wss:\/\/(.[^\/]+)\/?/;let yZ=0;class RZ{constructor(e,n){N(this,"id",0),N(this,"store",void 0),N(this,"recordIndex",void 0),N(this,"websockets",[]),N(this,"try443PortDuration",2e3),N(this,"forceCloseWSDuration",5e3),N(this,"try443PortTimeout",null),N(this,"forceCloseTimeout",null),N(this,"isTry443PortFailed",!1),N(this,"isNormalPortFailed",!1),N(this,"useDoubleDomain",!1),N(this,"useProxy",!1),N(this,"startTime",Date.now()),this.id=++yZ,this.try443PortDuration=x("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;const n=Date.now()-this.startTime;for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];R.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...o)}createWebSocket(e,n,i){this.logger("createWebSocket:",e,{isTry443Port:n,hasTimeoutDetection:i});const o=x("GATEWAY_DOMAINS"),c=Date.now(),l=[],u=o.find(S=>{var T;return pt(T=e.host).call(T,S)});u||(this.useDoubleDomain=!1);const p=[];if(this.useDoubleDomain)o.forEach(S=>{p.push(x0(M0(M0({},e),{},{host:e.host.replace(u,S)}),n))});else{const S=M0({},e);if(n&&u){const T=o.find(A=>A!==u);T&&(S.host=S.host.replace(u,T))}p.push(x0(S,n))}try{p.forEach(S=>{const T=new WebSocket(S);T.binaryType="arraybuffer",l.push(T),this.logger("ws is connecting:",T.url)})}catch(S){if(this.logger("ws create failed"),l.forEach(T=>T.close()),l.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,n,i);if(!n&&Number(e.port)!==443)return this.createWebSocket(e,!0,i);throw new Q(L.WS_ERR,"init websocket failed! Error: ".concat(S.toString()))}const m=Ch();this.store&&this.store.recordJoinChannelService({urls:l.map(S=>S.url),service:"gateway"},this.recordIndex),l.forEach(S=>{S.onopen=()=>{this.logger("onopen: ws ".concat(S.url," open cost ").concat(Date.now()-c,"ms")),this.websockets.forEach(T=>{T!==S&&(T.onopen=null,T.onclose=null,T.onmessage=null,T.close(),this.logger("close backup websocket: ".concat(T.url)))}),this.websockets.length=0,m.resolve(S)},S.onclose=T=>{this.logger("onclose: ws ".concat(S.url," closed cost ").concat(Date.now()-c,"ms state: ").concat(S.readyState));const A=l.every(I=>I.readyState===WebSocket.CLOSED||I.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(A)),A&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(T.reason)),m.reject({code:T.code,reason:F_.A_ROUND_WS_FAILED})):!n&&A&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),E()),n?this.isTry443PortFailed=A:this.isNormalPortFailed=A},S.onmessage=T=>this.logger("".concat(S.url," onmessage: ").concat(T.data))}),this.websockets.push(...l);const _=()=>{this.websockets.forEach(S=>S.readyState!==WebSocket.OPEN&&S.close())},E=()=>{if(m.isResolved)return _();ie().os===bn.MAC_OS&&qe()&&_(),this.createWebSocket(e,!0,!0).then(S=>{m.resolve(S)}).catch(S=>{this.isNormalPortFailed&&m.reject(S),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",m.isResolved),this.forceCloseTimeout=null,_()},this.forceCloseWSDuration)};return i||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,_()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",m.isResolved),this.try443PortTimeout=null,E()},this.try443PortDuration)})(),m.promise}chooseBestWebsocket(e,n,i,o){return this.useDoubleDomain=!!n,typeof e=="string"&&(e=function(c){let l,u,p;return[,l,u,p]=c.match(EZ)||[],l||([,u,p]=c.match(SZ)||[]),u&&p||([,u,p]=c.match(vZ)||[]),u&&p||([,u]=c.match(TZ)||[]),u||R.warning("un-destructible url: ",c),{proxy:l,host:u,port:p||"443"}}(e)),this.recordIndex=o,this.useProxy=!!e.proxy,i&&this.useProxy&&(R.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(e,!!i,!1).finally(()=>this.clearTimeout())}}function hx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}class px extends Ke{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var n;pt(n=["tryNext","recover"]).call(n,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(Gt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Gt.CONNECTED):this._state==="closed"?this.emit(Gt.CLOSED):this._state==="failed"&&this.emit(Gt.FAILED))}resetReconnectCount(e){R.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=arguments.length>3&&arguments[3]!==void 0&&arguments[3],c=arguments.length>4&&arguments[4]!==void 0&&arguments[4],l=arguments.length>5?arguments[5]:void 0;super(),N(this,"_websocketUrl",null),N(this,"connectionID",0),N(this,"currentURLIndex",0),N(this,"urls",[]),N(this,"_reconnectMode","tryNext"),N(this,"reconnectReason",void 0),N(this,"_initMutex",void 0),N(this,"name",void 0),N(this,"_state","closed"),N(this,"reconnectInterrupter",void 0),N(this,"websocket",void 0),N(this,"retryConfig",void 0),N(this,"reconnectCount",0),N(this,"forceCloseTimeout",5e3),N(this,"onlineReconnectListener",void 0),N(this,"useCompress",void 0),N(this,"tryDoubleDomain",!1),N(this,"use443PortOnly",!1),N(this,"wsInflateLength",0),N(this,"wsDeflateLength",0),N(this,"closeEstablishingWs",()=>{}),N(this,"store",void 0),N(this,"joinGatewayRecordIndex",void 0),this.store=l,this.name=e,this.retryConfig=function(E){for(var S=1;S<arguments.length;S++){var T=arguments[S]!=null?arguments[S]:{};S%2?hx(Object(T),!0).forEach(function(A){N(E,A,T[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(T)):hx(Object(T)).forEach(function(A){Object.defineProperty(E,A,Object.getOwnPropertyDescriptor(T,A))})}return E}({},n),this.useCompress=i,this.tryDoubleDomain=o,this.use443PortOnly=c,this._initMutex=new Qn("websocket",l?l.clientId:void 0);const{timeout:u,timeoutFactor:p}=n,m=Math.max(300,Math.floor(3*u/5)),_=Math.max(1.2,Math.floor(8*p)/10);sr.ONLINE&&(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=_),on.on(yl.NETWORK_STATE_CHANGE,(E,S)=>{E!==S&&(this.resetReconnectCount("network state change: ".concat(S," -> ").concat(E)),E===sr.ONLINE?(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=_):(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=p))})}getConnection(){return this.websocket||void 0}async init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=e,this.state="connecting";try{var o;const c=Ch(),l=this.urls[this.currentURLIndex];(o=this.store)===null||o===void 0||o.beforeConnect(),function(u){return!(v_()||x("USE_NEW_TOKEN")||!x("ENABLE_PREALLOC_PC")&&(u==null||!u.autoSubscribe||x("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(lx.PRE_CONNECT_PC),this.createWebSocketConnection(l).then(c.resolve).catch(c.reject),this.once(Gt.CLOSED,()=>{c.reject(new $(L.WS_DISCONNECT))}),this.once(Gt.CONNECTED,c.resolve),await c.promise}catch{}finally{i()}}close(e,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0,this._websocketUrl=null}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,n){if(!this.websocket)return void R.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),R.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new $(L.WS_ABORT,"websocket is not ready");try{n||(e=JSON.stringify(e)),this.websocket.send(e)}catch(i){throw new $(L.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var n;const i=Ch();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const o=_=>{var E;(E=this.store)===null||E===void 0||E.signalChannelOpen(),R.debug("[".concat(this.name,"] websocket opened:"),_),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},c=async _=>{var E;if(R.debug("[".concat(this.name,"] websocket close ").concat((E=this.websocket)===null||E===void 0?void 0:E.url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new $(L.WS_DISCONNECT,"websocket close: ".concat(_.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");const S=_r(this,Gt.WILL_RECONNECT,this.reconnectMode,_.reason)||this.reconnectMode,T=await this.reconnectWithAction(S);if(this.state==="closed")return void R.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!T)return i.reject(new $(L.WS_DISCONNECT,"websocket reconnect failed: ".concat(_.code))),this.close(!0);i.resolve()}},l=_=>{this.emit(Gt.ON_MESSAGE,_)},u=_=>{R.warn("[".concat(this.connectionID,"] ws open error ").concat(_))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),x("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=x("GATEWAY_WSS_ADDRESS")),R.debug("[".concat(this.name,"] start connect, url:"),e);const p=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var m;this._websocketUrl=x0(e);const _=await this.chooseBestWebsocketConnection(e);this.websocket=_,o&&o(this.websocket.url),this.websocket.onclose=c,this.websocket.onmessage=l,this.websocket.onerror=u,(m=this.store)===null||m===void 0||m.recordJoinChannelService({endTs:Date.now(),status:"success"},p),this.joinGatewayRecordIndex=p}catch(_){const E=this.state==="closed",S=_ instanceof $,T=S&&_.code===L.WS_ABORT,A=S&&_.code===L.WS_ERR,I=S?_.message:_&&(_.reason||_.toString());R.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(I)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:T?"aborted":"error",errors:[_]},p),E||A?(i.reject(E?new $(L.WS_DISCONNECT,"websocket is closed: ".concat(I)):new $(L.WS_ERR,"init websocket failed: ".concat(I))),A&&R.error("[".concat(this.name,"] init websocket failed: ").concat(I))):c&&c(_)}return i.promise}async reconnectWithAction(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;R.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||on.isOnline||!on.onlineWaiter||(this.onlineReconnectListener=on.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,n){const l=Gy(this.reconnectCount,this.retryConfig);R.debug("[".concat(this.name,"] wait ").concat(l,"ms to reconnect websocket, mode: ").concat(e)),await gt.race([xn(l),this.onlineReconnectListener||new gt(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const o=async(l,u)=>{this.emit(Gt.RECONNECT_CREATE_CONNECTION,u),await this.createWebSocketConnection(l)};try{if(e==="retry")await o(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);R.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await o(this.urls[this.currentURLIndex],e)}else e==="recover"&&(R.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Kn(this,Gt.REQUEST_NEW_URLS),this.currentURLIndex=0,await o(this.urls[this.currentURLIndex],e))}catch(l){var c;R.error("[".concat(this.name,"] reconnect failed ").concat(l&&l.toString()));const u=l==null||(c=l.data)===null||c===void 0?void 0:c.desc;return Array.isArray(u)&&pt(u).call(u,"dynamic key expired")?(this.emit(Gt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,n)}return!0}}class U0 extends px{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){const i=Ch(),o=function(l,u){return new RZ(l,u)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),o.closeAllWebsockets(),i.reject(new $(L.WS_ABORT,"choose best websocket aborted"))};const c=x("GATEWAY_DOMAINS");return R.debug("[choose-best-ws] currentDomain: ",e,", domains: ",c,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),o.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,n).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class jh extends px{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){return new gt((i,o)=>{let c=!1;const l=[];this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),l.forEach(A=>{A.onclose=null,A.onopen=null,A.onmessage=null,A.close()}),o(new $(L.WS_ABORT,"choose best websocket aborted"))};const u=x("GATEWAY_DOMAINS");let p;const m=e.indexOf("?h="),_=u.find(A=>m!==-1?pt(e).call(e,A,m):pt(e).call(e,A));R.debug("[choose-best-ws] currentDomain: ",_,", domains: ",u);let E=!this.tryDoubleDomain||!_;if(!E&&_){var S;const A=Date.now();try{u.forEach(I=>{const w=m===-1?e.replace(_,I):e.substr(0,m)+e.substr(m).replace(_,I),P=new WebSocket(w);P.binaryType="arraybuffer",l.push(P),R.debug("[choose-best-ws] ws is connecting:",P.url)})}catch{for(R.debug("[choose-best-ws] ws create failed, fallback to single url"),l.forEach(w=>w.close());l.length;)l.pop();E=!0}(S=this.store)===null||S===void 0||S.recordJoinChannelService({urls:l.map(I=>I.url),service:"gateway"},n),l.forEach(I=>{I.onopen=()=>{if(c)return;const w=Date.now()-A;R.debug("[choose-best-ws] ws open cost ".concat(w,"ms")),l.filter(P=>P!==I).forEach(P=>{R.debug("[choose-best-ws]close backup websocket: ".concat(P.url)),P.close()}),c=!0,i(I)},I.onclose=w=>{p=w,!c&&(l.find(P=>!(P.readyState===WebSocket.CLOSED||P.readyState===WebSocket.CLOSING))||(R.debug("[choose-best-ws] all websocket is closed"),c=!0,o(p)))},I.onmessage=w=>{R.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(w.data))}}),xn(this.forceCloseTimeout).then(()=>{l.forEach(I=>{I.readyState!==WebSocket.OPEN&&I.close()})})}if(E){var T;let A;R.debug("[choose-best-ws] use single url: ",e),(T=this.store)===null||T===void 0||T.recordJoinChannelService({urls:[e],service:"gateway"},n);try{A=new WebSocket(e),l.push(A),A.binaryType="arraybuffer"}catch(I){const w=new $(L.WS_ERR,"init websocket failed! Error: ".concat(I.toString()));return R.error("[".concat(this.name,"]").concat(w)),void o(w)}A.onopen=()=>{i(A)},A.onclose=I=>{o(I)},A.onmessage=I=>{R.debug("[choose-best-ws]".concat(A.url," onmessage: ").concat(I.data))},xn(this.forceCloseTimeout).then(()=>{A&&A.readyState!==WebSocket.OPEN&&A.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class CZ extends Ke{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Le.CONNECTED?this.emit(Vt.WS_CONNECTED):e===Le.RECONNECTING?this.emit(Vt.WS_RECONNECTING,this._websocketReconnectReason):e===Le.CLOSED&&this.emit(Vt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),N(this,"_disconnectedReason",void 0),N(this,"_websocketReconnectReason",void 0),N(this,"_connectionState",Le.CLOSED),N(this,"reconnectToken",void 0),N(this,"websocket",void 0),N(this,"openConnectionTime",void 0),N(this,"clientId",void 0),N(this,"lastMsgTime",Date.now()),N(this,"uploadCache",[]),N(this,"uploadCacheInterval",void 0),N(this,"rttRolling",new T1(5)),N(this,"pingpongTimer",void 0),N(this,"wsInflateDataTimer",void 0),N(this,"pingpongTimeoutCount",0),N(this,"ortc",void 0),N(this,"joinResponse",void 0),N(this,"multiIpOption",void 0),N(this,"initError",void 0),N(this,"spec",void 0),N(this,"store",void 0),N(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Vt.ON_BINARY_DATA,i.data);const o=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const c="res-@".concat(o._id);this.emit(c,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){if(this.emit(o._type,o._message),o._type===ee.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===ee.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(_e.UID_BANNED);break;case 15:this.close(_e.IP_BANNED);break;case 16:this.close(_e.CHANNEL_BANNED)}if(o._type===ee.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case Nt.ERR_LICENSE_MISSING:this.close(_e.LICENSE_MISSING);break;case Nt.ERR_LICENSE_EXPIRED:this.close(_e.LICENSE_EXPIRED);break;case Nt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(_e.LICENSE_MINUTES_EXCEEDED);break;case Nt.ERR_LICENSE_PERIOD_INVALID:this.close(_e.LICENSE_PERIOD_INVALID);break;case Nt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(_e.LICENSE_MULTIPLE_SDK_SERVICE);break;case Nt.ERR_LICENSE_ILLEGAL:this.close(_e.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new U0("gateway-".concat(this.clientId),this.spec.retryConfig,!0,x("JOIN_GATEWAY_USE_DUAL_DOMAIN"),x("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Le.CONNECTED&&this.reconnect("retry",zn.OFFLINE)})}async request(e,n,i,o){const c=Ae(6,""),l={_id:c,_type:e,_message:n},u=this.websocket.connectionID,p=()=>new gt((A,I)=>{if(this.connectionState===Le.CONNECTED)return A();const w=()=>{this.off(Vt.WS_CLOSED,P),A()},P=()=>{this.off(Vt.WS_CONNECTED,w),I(new Q(L.WS_ABORT))};this.once(Vt.WS_CONNECTED,w),this.once(Vt.WS_CLOSED,P),e!==Mt.PUBLISH&&e!==Mt.PUBLISH_DATASTREAM&&e!==Mt.SUBSCRIBE&&e!==Mt.SUBSCRIBE_DATASTREAM&&e!==Mt.UNSUBSCRIBE&&e!==Mt.UNSUBSCRIBE_DATASTREAM&&e!==Mt.UNPUBLISH&&e!==Mt.UNPUBLISH_DATASTREAM&&e!==Mt.CONTROL&&e!==Mt.RESTART_ICE||this.once(Vt.DISCONNECT_P2P,()=>{I(new Q(L.DISCONNECT_P2P))}),e!==Mt.PUBLISH&&e!==Mt.RESTART_ICE||this.once(Vt.ABORT_P2P_EXECUTION,()=>{I(new Q(L.DISCONNECT_P2P))})});if(this.connectionState!==Le.CONNECTING&&this.connectionState!==Le.RECONNECTING||e===Mt.JOIN||e===Mt.REJOIN||await p(),this.websocket.sendMessage(l,!0),o)return;const m=new gt((A,I)=>{let w=!1;const P=(U,G)=>{w=!0,A({isSuccess:U==="success",message:G||{}}),this.off(Vt.WS_CLOSED,D),this.off(Vt.WS_RECONNECTING,D),this.emit(Vt.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(c),P);const D=()=>{I(new Q(L.WS_ABORT,"type: ".concat(e))),this.off(Vt.WS_CLOSED,D),this.off(Vt.WS_RECONNECTING,D),this.off("res-@".concat(c),P)};this.once(Vt.WS_CLOSED,D),this.once(Vt.WS_RECONNECTING,D),xn(x("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||w||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(Vt.REQUEST_TIMEOUT,e,n))})});let _=null;try{_=await m}catch(A){if(this.connectionState===Le.CLOSED||e===Mt.LEAVE)throw new Q(L.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?A.throw():e===Mt.JOIN||e===Mt.REJOIN?null:(await p(),await this.request(e,n))}if(_.isSuccess)return _.message;const E=Number(_.message.error_code||_.message.code),S=Bh(E),T=new Q(L.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(_.message.error_str),{code:E,data:_.message,desc:S.desc});return S.action==="success"?_.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(E,", message: ").concat(S.desc,", action: ").concat(S.action)),E===Nt.ERR_TOO_MANY_BROADCASTERS?((e===Mt.JOIN||e===Mt.REJOIN)&&(this.initError=T,this.close()),T.throw()):S.action==="failed"?T.throw():S.action==="quit"?(this.initError=T,this.close(),T.throw()):(E===Nt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",zn.MULTI_IP)):this.reconnect(S.action,zn.SERVER_ERROR),e===Mt.JOIN||e===Mt.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new gt(i=>{const o=c=>{(!n||n(c))&&(this.off(e,o),i(c))};this.on(e,o)})}uploadWRTCStats(e){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Vh.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const c=x("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Le.CONNECTED)return;const l=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(l._type,l._message)},x("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new gt((n,i)=>{this.once(Vt.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Vt.WS_CLOSED,o=>i(this.initError||new Q(L.WS_ABORT,o))),this.connectionState=Le.CONNECTING,this.websocket.init(e).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||_e.LEAVE,this.connectionState=Le.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Vt.ABORT_P2P_EXECUTION),this.store.signalConnected();const e=await Kn(this,Vt.REQUEST_JOIN_INFO);this.store.joinReq();const n=await this.request(Mt.JOIN,e);if(this.ortc=e==null?void 0:e.ortc,this.store.joinRep(),!n)return this.emit(Vt.REPORT_JOIN_GATEWAY,F_.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Vt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Le.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Q(L.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=Oh(this,Vt.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const n=await this.request(Mt.REJOIN,e);return!!n&&(this.connectionState=Le.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(ee.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(ee.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(ee.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(ee.MUTE_AUDIO,{uid:i.uid}):this.emit(ee.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(ee.MUTE_VIDEO,{uid:i.uid}):this.emit(ee.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(ee.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(ee.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(ee.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(ee.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(ee.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}async downgradeCodec(e){if(!this.ortc)return!1;const n={downgrade_codec:e,ortc:this.ortc};return!!await this.request(Mt.DOWNGRADE_CODEC,n)}handleNotification(e){R.debug("[".concat(this.clientId,"] receive notification: "),e);const n=Bh(e.code);if(e.code===28&&"detail"in e&&(R.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(Vt.RECOVER_NOTIFICATION,e.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(_e.UID_BANNED),void this.close()):void this.reconnect(n.action,zn.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=x("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(R.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>x("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",zn.TIMEOUT):this.request(Mt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),x("REPORT_STATS")&&this.send(Mt.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:n}=this.websocket.getWsInflateData();e!==0&&n!==0&&this.upload(Vh.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(Gt.RECONNECT_CREATE_CONNECTION,e=>{this.emit(Vt.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Gt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Gt.CLOSED,()=>{this.connectionState=Le.CLOSED}),this.websocket.on(Gt.FAILED,()=>{this._disconnectedReason=_e.NETWORK_ERROR,this.connectionState=Le.CLOSED}),this.websocket.on(Gt.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Le.CONNECTED?this.connectionState=Le.RECONNECTING:this.connectionState=Le.CONNECTING}),this.websocket.on(Gt.WILL_RECONNECT,(e,n,i)=>{const o=Oh(this,Vt.IS_P2P_DISCONNECTED),c=o||e!=="retry";o&&e==="retry"&&(R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",n=F_.P2P_DISCONNECTED),c&&(R.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(Vt.REPORT_JOIN_GATEWAY,n||F_.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Vt.DISCONNECT_P2P)),i(e)}),this.websocket.on(Gt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",zn.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(Vt.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof Q){if(e.code===L.UNEXPECTED_RESPONSE&&e.data.code===Nt.ERR_NO_AUTHORIZED)return this.initError=new Q(L.TOKEN_EXPIRE,"dynamic key expired"),void this.close(_e.TOKEN_EXPIRE);R.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",zn.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(Gt.REQUEST_NEW_URLS,(e,n)=>{Kn(this,Vt.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(Gt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ee.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(lx.PRE_CONNECT_PC,()=>{this.emit(Vt.PRE_CONNECT_PC)})}}let bZ=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),an=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function fx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function j_(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?fx(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):fx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Ba(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(x("TURN_DOMAIN")):(R.debug("Cannot recognized as ip address: ".concat(t,", use as host2")),t)}function W_(t){try{const e=x("GATEWAY_DOMAINS").concat(x("TURN_DOMAIN")).find(n=>pt(t).call(t,n));return e?t.split(".".concat(e))[0].replace(/-/g,"."):t}catch{return R.debug("serverUrlToIp error, fallback to url",t),t}}function V0(t,e){t.addresses||(t.addresses=[]);const n=function(u,p){if(x("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return u.map(E=>{let{ip:S,port:T}=E;return{address:"".concat(S,":").concat(T)}});const m=x("GATEWAY_DOMAINS");let _=m[1]&&pt(p).call(p,m[1])?1:0;return u.map(E=>{let{domain_prefix:S,port:T,ip:A}=E;if(S)return{address:"".concat(S,".").concat(m[_++%m.length],":").concat(T)};const I=/^[\.\:\d]+$/.test(A),w=I?"".concat(A.replace(/[^\d]/g,"-"),".").concat(m[_++%m.length],":").concat(T):"".concat(A,":").concat(T);return I||R.debug("Cannot recognized as ip address: ".concat(A,", use as host3")),{ip:A,port:T,address:w}})}(t.addresses,e),i=Array.isArray(t.detail)&&t.detail[18];if(i&&typeof i=="string"){const u=i.split(";");for(let p=0;p<u.length;p++){var o;const m=hi(o=u[p]).call(o);n[p]&&m&&(n[p].ip6=m)}}const c=t.detail&&t.detail.candidate;let l;if(c){const[u,p]=c.split(":");u&&p&&(l={port:Number(p),ip:u,address:"".concat(u,":").concat(p)})}return{gatewayAddrs:n,apGatewayAddress:l,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function or(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function mx(t){const e=t._encoderConfig;if(!e)return{};const n={resolution:e.width&&e.height?"".concat(or(e.width),"x").concat(or(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(n.maxFrameRate=e.frameRate,n.minFrameRate=e.frameRate):e.frameRate&&(n.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,n.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),n}function _x(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function Wh(t,e){let n,i,o;switch(e){case an.CHOOSE_SERVER:i=4096,o="choose server";break;case an.CLOUD_PROXY:i=1048576,o="proxy";break;case an.CLOUD_PROXY_5:i=4194304,o="proxy5";break;case an.CLOUD_PROXY_FALLBACK:i=4194310,o="proxy fallback";break;default:throw new Q(L.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(c=>{c.buffer&&c.buffer.flag===i&&(n={code:c.buffer.code,addresses:(c.buffer.edges_services||[]).map(l=>j_(j_({},l),{},{ticket:c.buffer.cert})),server_ts:t.enter_ts,uid:c.buffer.uid,cid:c.buffer.cid,cname:c.buffer.cname,detail:j_(j_({},c.buffer.detail),t.detail),flag:c.buffer.flag,opid:t.opid,cert:c.buffer.cert})}),!n)throw new Q(L.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(o," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return n}async function gx(t,e){return await gt.all(t.addresses.map(async n=>({address:Ba(n.ip),tcpport:n.port,udpport:n.port,username:e&&x("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():Yn.username,password:e&&x("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Fy(e.toString()):Yn.password})))}function F0(t,e){const n=e.getMediaStreamTrack(!0).getSettings(),i=e.videoHeight||n.height,o=e.videoWidth||n.width;return i&&o?Math.max(Math.min(i,o)/Math.min(or(t.height),or(t.width)),1):(R.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function ja(t){let{candidateType:e,relayProtocol:n,type:i,address:o,port:c,protocol:l}=t;const u={candidateType:e,relayProtocol:n,protocol:l};if(i!=="local-candidate"){const p=o.split(".");p.length>=4&&(p[1]="*",p[2]="*"),u.address=p.join("."),u.port=c}return u}function ed(t){const e=t.split(":"),n=t.split(/[-.]/),i=pt(t).call(t,"-")?"-":".";let o=t;return e.length>1?n.length>1?(n[1]="**",o=n[0]+i+"**:"+e[e.length-1]):o=e.length>2?e[0]+i+"**:"+e[e.length-1]:"**:"+e[e.length-1]:n.length>1&&(o=n[0]+i+"**"),o}function G_(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:x("SVC_MODE");if(x("ENABLE_SVC"))return function(e){return e in g_}(t)?t:g_.L1T3}const Ex={[St.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[St.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function H_(t,e,n){e.forEach(i=>{var o;const c=Ex[t].find(u=>{var p;let{key:m}=u;return pt(p=i.extensionName).call(p,m)});if(!c)return;const l=n.find(u=>{let{extensionName:p}=u;return pt(p).call(p,c.key)});l&&pt(o=l.extensionName).call(o,"gdpr_forbidden")&&(i.extensionName=l.extensionName)})}function Hl(t,e){e.forEach(n=>{var i;const o=Ex[t].find(c=>{var l;let{key:u}=c;return pt(l=n.extensionName).call(l,u)});pt(i=n.extensionName).call(i,"gdpr_forbidden")&&o&&(n.extensionName=o.extensionName)})}function Sx(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||pt(t).call(t,"abs-send-time")}function z_(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||pt(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function vx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function Tx(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?vx(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Gh(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:o,filterVideoFec:c,filterAudioFec:l,filterAudioCodec:u,filterVideoCodec:p,unsupportedVideoUplinkCodec:m,unsupportedVideoDownlinkCodec:_}=e,{useXR:E}=n;let S=[],T=[],A=[],I=[],w=!1,P=!1;if(Wi(t).mediaDescriptions.forEach(U=>{i&&i!==U.attributes.direction||(U.media.mediaType!=="video"||w||(T=U.attributes.payloads,I=U.attributes.extmaps,w=!0),U.media.mediaType!=="audio"||P||(S=U.attributes.payloads,A=U.attributes.extmaps,P=!0))}),!I||T.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!A||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(T.forEach(U=>{var G;(G=U.rtpMap)!==null&&G!==void 0&&G.clockRate&&(U.rtpMap.clockRate=parseInt(U.rtpMap.clockRate)),E&&U.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(U=>{var G;(G=U.rtpMap)!==null&&G!==void 0&&G.clockRate&&(U.rtpMap.clockRate=parseInt(U.rtpMap.clockRate)),E&&U.rtcpFeedbacks.push({type:"rrtr"})}),o&&(S=S.filter(U=>{var G;return((G=U.rtpMap)===null||G===void 0?void 0:G.encodingName.toLowerCase())!=="rtx"}),T=T.filter(U=>{var G;return((G=U.rtpMap)===null||G===void 0?void 0:G.encodingName.toLowerCase())!=="rtx"})),c){const U=T.filter(F=>{var X;return/(red)|(ulpfec)|(flexfec)/i.test(((X=F.rtpMap)===null||X===void 0?void 0:X.encodingName)||"")}),G=Ga(U,T).map(F=>F.payloadType),W=[...U.map(F=>F.payloadType),...G];T=T.filter(F=>!pt(W).call(W,F.payloadType))}if(l&&(S=S.filter(U=>{var G;return!/(red)|(ulpfec)|(flexfec)/i.test(((G=U.rtpMap)===null||G===void 0?void 0:G.encodingName)||"")})),u&&(u==null?void 0:u.length)>0&&(S=S.filter(U=>{var G;return pt(u).call(u,((G=U.rtpMap)===null||G===void 0?void 0:G.encodingName.toLowerCase())||"")})),p&&(p==null?void 0:p.length)>0){const U=T.filter(G=>{var W;return pt(p).call(p,((W=G.rtpMap)===null||W===void 0?void 0:W.encodingName.toLowerCase())||"")});T=U.concat(o?[]:Ga(U,T))}const D=x("UNSUPPORTED_VIDEO_CODEC");if(D&&D.length>0){const U=T.filter(F=>F.rtpMap&&pt(D).call(D,F.rtpMap.encodingName.toLowerCase())),G=Ga(U,T),W=U.concat(G).map(F=>F.payloadType);T=T.filter(F=>!pt(W).call(W,F.payloadType)),R.debug("unsupportedVideoCodec: ".concat(D,", toBeRemoved: ").concat(W))}if(m&&m.length>0&&i==="sendonly"){const U=T.filter(F=>F.rtpMap&&pt(m).call(m,F.rtpMap.encodingName.toLowerCase())),G=Ga(U,T),W=U.concat(G).map(F=>F.payloadType);T=T.filter(F=>!pt(W).call(W,F.payloadType)),R.debug("unsupportedVideoUplinkCodec: ".concat(m,", toBeRemoved: ").concat(W))}if(_&&_.length>0&&i==="recvonly"){const U=T.filter(F=>F.rtpMap&&pt(_).call(_,F.rtpMap.encodingName.toLowerCase())),G=Ga(U,T),W=U.concat(G).map(F=>F.payloadType);T=T.filter(F=>!pt(W).call(W,F.payloadType)),R.debug("unsupportedVideoDownlinkCodec: ".concat(_,", toBeRemoved: ").concat(W))}return{audioCodecs:S,videoCodecs:T,audioExtensions:A,videoExtensions:I}}function Wa(t){const e=Wi(t);let n,i;for(const o of e.mediaDescriptions){if(!n){const c=o.attributes.iceUfrag,l=o.attributes.icePwd;if(!c||!l)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:c,icePwd:l}}if(!i){const c=o.attributes.fingerprints;c.length>0&&(i={fingerprints:c})}}if(!i&&e.attributes.fingerprints.length>0&&(i={fingerprints:e.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function yx(t,e){const n=[],i=t.attributes.ssrcGroups.filter(l=>l.semantic==="FID"),o=t.attributes.ssrcGroups.find(l=>l.semantic==="SIM"),c=t.attributes.ssrcs;if(o)o.ssrcIds.forEach(l=>{var u;const p=(u=i.find(m=>m.ssrcIds[0]===l))===null||u===void 0?void 0:u.ssrcIds[1];n.push({ssrcId:l,rtx:e?p:void 0})});else if(i.length>0){const l=i[0].ssrcIds[0],u=i[0].ssrcIds[1];n.push({ssrcId:l,rtx:e?u:void 0})}else{if(c.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:c[0].ssrcId})}return n}function Rx(t,e,n){const{cname:i}=t;let o=[];e&&(o=Cx(e)),o.length===0&&(o=t.iceParameters.candidates.map(_=>({foundation:_.foundation,componentId:"1",transport:_.protocol,priority:_.priority.toString(),connectionAddress:_.ip,port:_.port.toString(),type:_.type,extension:{}})),R.debug("Using candidates from gateway."));const c={fingerprints:t.dtlsParameters.fingerprints.map(_=>({hashFunction:_.algorithm,fingerprint:_.fingerprint}))},l={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let u;switch(t.dtlsParameters.role){case"server":u="passive";break;case"client":u="active";break;case"auto":u="actpass"}const p=Y_(t.rtpCapabilities),m=[];return Array.isArray(n)&&n.length>0&&n.forEach(_=>{m.push({kind:St.VIDEO,ssrcMsg:[{ssrcId:_.v,rtx:_.v_rtx}],mslabel:"".concat(_.v,"_").concat(_.a)},{kind:St.AUDIO,ssrcMsg:[{ssrcId:_.a}],mslabel:"".concat(_.v,"_").concat(_.a)})}),{dtlsParameters:c,iceParameters:l,candidates:o,rtpCapabilities:p,setup:u,cname:i,preSSRCs:m}}function Cx(t){let e=[];return t.ip&&typeof t.port=="number"&&(e=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],R.debug("Using remote candidate from AP ".concat(ed(t.ip),":").concat(t.port)),t.ip6&&(e.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),R.debug("Using IPV6 remote candidate from AP ".concat(ed(t.ip6),":").concat(t.port)))),e}function Hh(t,e,n){const i=[],o=[];return t.forEach(c=>{let{ssrcId:l,rtx:u}=c;const p=Ae(8,"track-"),m={ssrcId:l,attributes:Tx({label:p,mslabel:n=n||Ae(10,""),msid:"".concat(n," ").concat(p)},e&&{cname:e})};if(i.push(m),u!==void 0){const _={ssrcId:u,attributes:Tx({label:p,mslabel:n,msid:"".concat(n," ").concat(p)},e&&{cname:e})};i.push(_),o.push({semantic:"FID",ssrcIds:[l,u]})}}),t.length>1&&o.push({semantic:"SIM",ssrcIds:t.map(c=>{let{ssrcId:l}=c;return l})}),{ssrcs:i,ssrcGroups:o}}function zl(t,e){e instanceof $e&&t.attributes.payloads.forEach(n=>{var i;const o=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!o||["opus","pcmu","pcma","g722"].indexOf(o)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),o==="opus"&&typeof x("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=x("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const c=e._encoderConfig;c&&(o!=="pcmu"&&o!=="pcma"&&o!=="g722"&&(c.bitrate&&!qe()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*c.bitrate))),c.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(c.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(c.sampleRate)),c.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),e instanceof xh&&o==="opus"&&e._config.DTX&&(n.fmtp.parameters.usedtx="1"))})}function B0(t){const e=t.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");e!==-1&&t.attributes.unrecognized.splice(e,1)}function j0(t,e){var n;if(!(e instanceof Me&&e._encoderConfig&&e._hints.indexOf(Ie.SCREEN_TRACK)===-1))return;const i=e._encoderConfig;ae().supportMinBitrate&&i.bitrateMin&&t.attributes.payloads.forEach(o=>{var c,l;pt(c=["h264","h265","vp8","vp9","av1"]).call(c,((l=o.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())||"")&&(o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),ae().supportMinBitrate&&!pt(n=e._hints).call(n,Ie.LOW_STREAM)&&i.bitrateMax&&t.attributes.payloads.forEach(o=>{var c,l;pt(c=["h264","h265","vp8","vp9","av1"]).call(c,((l=o.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())||"")&&(o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters["x-google-start-bitrate"]="".concat(x("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function bx(t){if(t.media.mediaType!=="video")return;const e=ie();if(e.name!==ue.SAFARI&&e.os!==bn.IOS)return;const n=t.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&t.attributes.extmaps.splice(n,1)}function K_(t,e,n){if(!e)return;let i,o;if(t.media.mediaType==="video"?(i=n.videoExtensions,o=n.videoCodecs):(i=n.audioExtensions,o=n.audioCodecs),e.twcc===!0){const c=i.find(l=>z_(l.extensionName));if(c){const l=c.extensionName;t.attributes.extmaps.find(p=>z_(p.extensionName))||t.attributes.extmaps.push({entry:c.entry,extensionName:l}),function(p,m){return m.filter(_=>!!p.find(E=>E.payloadType===_.payloadType&&!!E.rtcpFeedbacks.find(S=>S.type==="transport-cc")))}(o,t.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(m=>m.type==="transport-cc")||p.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(e.twcc===!1){const c=t.attributes.extmaps.findIndex(l=>z_(l.extensionName));c!==-1&&t.attributes.extmaps.splice(c,1),t.attributes.payloads.forEach(l=>{const u=l.rtcpFeedbacks.findIndex(p=>p.type==="transport-cc");u!==-1&&l.rtcpFeedbacks.splice(u,1)})}if(e.remb===!0){const c=i.find(l=>Sx(l.extensionName));if(c){const l=c.extensionName;t.attributes.extmaps.find(p=>p.extensionName===l)||t.attributes.extmaps.push({entry:c.entry,extensionName:l}),function(p,m){return m.filter(_=>!!p.find(E=>E.payloadType===_.payloadType&&!!E.rtcpFeedbacks.find(S=>S.type==="goog-remb")))}(o,t.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(m=>m.type==="goog-remb")||p.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(e.remb===!1){const c=t.attributes.extmaps.findIndex(l=>Sx(l.extensionName));c!==-1&&t.attributes.extmaps.splice(c,1),t.attributes.payloads.forEach(l=>{const u=l.rtcpFeedbacks.findIndex(p=>p.type==="goog-remb");u!==-1&&l.rtcpFeedbacks.splice(u,1)})}}function Ix(t,e,n){if(qe()||t.media.mediaType!=="video"||!(e instanceof Me)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!x("SIMULCAST")||n==="vp9"&&x("ENABLE_SVC")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:e._scalabilityMode.numSpatialLayers,o=t.attributes.ssrcs[0],c=t.attributes.ssrcGroups.find(u=>u.semantic==="FID"&&u.ssrcIds[0]===o.ssrcId),l={semantic:"SIM",ssrcIds:[o.ssrcId]};for(let u=1;u<i;u++)t.attributes.ssrcs.push({ssrcId:o.ssrcId+u,attributes:Ge(o.attributes)}),l.ssrcIds.push(o.ssrcId+u),c&&(t.attributes.ssrcs.push({ssrcId:c.ssrcIds[1]+u,attributes:Ge(o.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[o.ssrcId+u,c.ssrcIds[1]+u]}));t.attributes.ssrcGroups.unshift(l)}async function wx(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:o,recv:c,sendrecv:l}=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;const _=Gh(m,u,p,"sendonly"),E=Gh(m,u,p,"recvonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(vs(_,E,"videoExtensions",S,T,A),vs(_,E,"videoCodecs",S,T,A),vs(_,E,"audioExtensions",S,T,A),vs(_,E,"audioCodecs",S,T,A),x("RAISE_H264_BASELINE_PRIORITY")){const I=[],w=[];if(A.videoCodecs.forEach((P,D)=>{var U;if(((U=P.rtpMap)===null||U===void 0?void 0:U.encodingName.toLocaleLowerCase())==="h264"){var G,W;const F=A.videoCodecs[D+1],X=F&&Px(P,F),tt=(G=P.fmtp)===null||G===void 0?void 0:G.parameters["profile-level-id"],nt=(W=P.fmtp)===null||W===void 0?void 0:W.parameters["packetization-mode"];!tt||tt!==x("FIRST_H264_PROFILE_LEVEL_ID")||x("FIRST_PACKETIZATION_MODE")&&nt!==x("FIRST_PACKETIZATION_MODE")?X?w.push([P,F]):w.push([P]):X?I.push([P,F]):I.push([P])}}),I.length>0&&w.length>0){R.debug("raising H264 baseline profile priority"),A.videoCodecs.forEach((D,U)=>{var G;if(((G=D.rtpMap)===null||G===void 0?void 0:G.encodingName.toLocaleLowerCase())==="h264"){const W=Px(D,A.videoCodecs[U+1]),F=I.shift()||w.shift()||[];F.length>0&&(W?A.videoCodecs.splice(U,2,...F):A.videoCodecs.splice(U,1,...F))}});const P=T.videoCodecs.filter(D=>{var U,G;return((U=D.rtpMap)===null||U===void 0?void 0:U.encodingName.toLocaleLowerCase())==="h264"&&((G=D.fmtp)===null||G===void 0?void 0:G.parameters["profile-level-id"])!==x("FIRST_H264_PROFILE_LEVEL_ID")});if(P.length>0){const D=Ga(P,T.videoCodecs).map(G=>G.payloadType),U=[...P.map(G=>G.payloadType),...D];T.videoCodecs=T.videoCodecs.filter(G=>!pt(U).call(U,G.payloadType))}x("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(D=>{var U,G;return!(((U=D.rtpMap)===null||U===void 0?void 0:U.encodingName.toLocaleLowerCase())==="h264"&&((G=D.fmtp)===null||G===void 0?void 0:G.parameters["profile-level-id"])!==x("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:S,recv:T,sendrecv:A}}return{send:S,recv:T,sendrecv:A}}(t,e,i);try{n.close()}catch{}return{send:o,recv:c,sendrecv:l}}function Ax(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=Gh(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(vs(t,e,"videoExtensions",n,i,o),vs(t,e,"videoCodecs",n,i,o),vs(t,e,"audioExtensions",n,i,o),vs(t,e,"audioCodecs",n,i,o),x("RAISE_H264_BASELINE_PRIORITY")){const c=o.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]==="42001f");if(c!==-1){const l=o.videoCodecs.findIndex(u=>u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(l<c){R.debug("raising H264 baseline profile priority");const u=o.videoCodecs[c];o.videoCodecs.splice(c,1),o.videoCodecs.splice(l,0,u)}l!==-1&&(i.videoCodecs=i.videoCodecs.filter(u=>!(u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&u.fmtp&&u.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:i,sendrecv:o}}function vs(t,e,n,i,o,c){if(n==="videoExtensions"||n==="audioExtensions"){const l=[];return t[n].forEach(u=>{e[n].some((p,m)=>{if(u.entry===p.entry&&u.extensionName===p.extensionName)return l.push(m),!0})?c[n].push(u):i[n].push(u)}),void e[n].forEach((u,p)=>{l.indexOf(p)===-1&&o[n].push(u)})}if(n==="videoCodecs"||n==="audioCodecs"){const l=[];return t[n].forEach(u=>{e[n].some((p,m)=>{if(u.payloadType===p.payloadType&&JSON.stringify(u)===JSON.stringify(p))return l.push(m),!0})?c[n].push(u):i[n].push(u)}),void e[n].forEach((u,p)=>{l.indexOf(p)===-1&&o[n].push(u)})}}function Y_(t){const{send:e,recv:n,sendrecv:i}=t;if(!i){if(!e||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:n}}let o,c;return e?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...e.audioCodecs,...i.audioCodecs],o.videoCodecs=[...e.videoCodecs,...i.videoCodecs],o.audioExtensions=[...e.audioExtensions,...i.audioExtensions],o.videoExtensions=[...e.videoExtensions,...i.videoExtensions]):o=i,n?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...n.audioCodecs,...i.audioCodecs],c.videoCodecs=[...n.videoCodecs,...i.videoCodecs],c.audioExtensions=[...n.audioExtensions,...i.audioExtensions],c.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):c=i,{send:o,recv:c}}function Kl(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(e=>{var n;return((n=e.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function zh(t,e,n,i){let o=[];if(t===St.VIDEO){if(x("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(o=e.videoCodecs.filter(c=>{var l;return pt(l=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(l,i)&&c&&c.fmtp&&c.fmtp.parameters["profile-level-id"]===x("H264_PROFILE_LEVEL_ID")})),!Array.isArray(o)||o.length===0){let c=[];const l=[],u=[],p=[];if(n.videoCodecs.forEach(m=>{const _=m.rtpMap&&m.rtpMap.encodingName.toLowerCase()||"";pt(_).call(_,i)?c.push(m):pt(_).call(_,"vp9")?l.push(m):pt(_).call(_,"vp8")?u.push(m):pt(_).call(_,"h264")&&p.push(m)}),c.length===0){let m="";l.length!==0?(c=l,m="vp9"):u.length!==0?(c=u,m="vp8"):p.length!==0&&(c=p,m="h264"),R.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(m))}c.length!==0&&(o=e.videoCodecs.filter(m=>c.some(_=>_.payloadType===m.payloadType)))}if(o.length===0&&(R.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),o=e.videoCodecs),x("USE_PUB_RTX")||x("USE_SUB_RTX")){const c=Ga(o,e.videoCodecs);o=[...o,...c]}}else{o=e.audioCodecs.filter(l=>{var u;return pt(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,i)});const c=e.audioCodecs.filter(l=>{var u;return pt(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,"red")});o.length===0&&(R.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),o=e.audioCodecs.filter(l=>{var u;return pt(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,"opus")})),x("ENABLE_AUDIO_RED")&&c.length!==0&&(o=[...c,...o])}return o}function Ga(t,e){const n=t.map(i=>i.payloadType.toString());return e.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&pt(n).call(n,i.fmtp&&i.fmtp.parameters.apt))}async function Ha(t,e,n){const i=e.toString(),o=Nx(i,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:i});const c=await t.createAnswer();if(!c.sdp)throw new Error("cannot get answer sdp");let l=c.sdp;l=Ox(l,n||{}),o==null||o(l||""),await t.setLocalDescription({type:"answer",sdp:l})}function Ox(t,e,n){const i=Wi(t),{useXR:o}=e;return i.mediaDescriptions.forEach(c=>{var l;c.attributes.mid&&(Array.isArray(n)&&!pt(n).call(n,c.attributes.mid)||(c.media.mediaType==="audio"&&Kl(c),o&&pt(l=["audio","video"]).call(l,c.media.mediaType)&&c.attributes.payloads.forEach(u=>{u.rtcpFeedbacks.findIndex(p=>p.type==="rrtr")===-1&&u.rtcpFeedbacks.push({type:"rrtr"})})))}),xa(i)}function Nx(t,e,n,i){if(x("SDP_LOGGING"))return R.upload("exchanging ".concat(n," ").concat(e," SDP during P2PConnection.").concat(i,`
`),t),e==="offer"?o=>{Nx(o,"answer",n==="local"?"remote":"local",i)}:void 0}function Dx(t){const e=x("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(e)&&e.length>0)&&e.some(n=>pt(t).call(t,n))}function Px(t,e){try{var n;return((n=t.fmtp)===null||n===void 0?void 0:n.parameters.apt)===e.payloadType.toString()}catch{return!1}}function kx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function br(t,e){return typeof x(t)===e?x(t):void 0}function IZ(){try{const t=x("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?kx(Object(i),!0).forEach(function(o){N(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):kx(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}({},t)}catch(t){return R.debug("handle gateway attributes failed: ",t),{}}}const Lx={};function za(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&R.debug("install service ".concat(t.name)),Lx[t.name]=t}function $o(t){const e=Lx[t];if(!e)throw new $(L.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return e}function Mx(t,e){return $o("DataStream").create(t,e)}function q_(){return $o("InterceptFrame").create()}function xx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function ci(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?xx(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):xx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const W0=new Map;class wZ extends Ke{get state(){return this._state}set state(e){if(e===this._state)return;const n=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(Nn.CONNECTION_STATE_CHANGE,e,n,this._disconnectedReason):this.emit(Nn.CONNECTION_STATE_CHANGE,e,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){R.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,n){var i,o,c;super(),N(this,"store",void 0),N(this,"joinInfo",void 0),N(this,"key",void 0),N(this,"ntpOffset",0),N(this,"signal",void 0),N(this,"role",void 0),N(this,"isPreallocation",void 0),N(this,"isPreSub",void 0),N(this,"inChannelInfo",{joinAt:null,duration:0}),N(this,"spec",void 0),N(this,"_state","DISCONNECTED"),N(this,"_statsCollector",void 0),N(this,"_disconnectedReason",void 0),N(this,"isSignalRecover",!1),N(this,"hasChangeBGPAddress",!1),N(this,"trafficStatsInterval",void 0),N(this,"networkQualityInterval",void 0),N(this,"_joinGatewayStartTime",0),N(this,"_signalTimeout",!1),N(this,"_clientRoleOptions",void 0),N(this,"_isProactiveJoin",!1),this.store=e,this.spec=n,this.signal=this.store.useP2P?(i={spec:ci(ci({},n),{},{retryConfig:n.websocketRetryConfig}),store:e},(o=(c=$o("P2PChannel")).createSubmodule)===null||o===void 0?void 0:o.call(c,i)):new CZ(ci(ci({},n),{},{retryConfig:n.websocketRetryConfig}),e),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(e,n,i){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const o=Date.now();let c=W0.get(e.cname);if(c||(c=new Map,W0.set(e.cname,c)),this._isProactiveJoin=!0,c.has(e.uid)){const m=new Q(L.UID_CONFLICT);throw bt.joinGateway(e.sid,{lts:o,succ:!1,ec:m.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),m}c.set(e.uid,!0),this.joinInfo=e,this.key=n;let l=0;this.joinGatewayStartTime=o;const u=e.proxyServer;try{R.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(l));const m=e.gatewayAddrs.map(_=>{let{address:E}=_;const[S,T]=E.split(":"),A={host:S,port:T};return e.proxyServer&&(A.proxy=e.proxyServer),A});l=(await this.signal.init(m)).uid,R.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(l," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(m){var p;throw R.error("[".concat(this.store.clientId,"] User join failed"),m.toString()),bt.joinGateway(e.sid,{lts:o,succ:!1,ec:((p=m.data)===null||p===void 0?void 0:p.desc)||m.code,errorMsg:m.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!u,signalChannel:"0",preload:e.preload}),c.delete(e.uid),this.signal.close(),m}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),R.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(m=>{R.warning("[".concat(this.store.clientId,"] get traffic stats error"),m.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Nn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Nn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Nn.NETWORK_QUALITY,{uplinkNetworkQuality:_x(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:_x(this._statsCollector.trafficStats.B_dnq)}):this.emit(Nn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),l}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==_e.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==Le.CONNECTED||await function(i,o){return o===1/0?i:gt.race([i,ZJ(o)])}(this.signal.request(Mt.LEAVE,void 0,!0),3e3)}catch(i){R.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==_e.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:x("PUB_EXTEND"),twcc:!!x("PUBLISH_TWCC"),rtx:!!x("USE_PUB_RTX")};try{return(await this.signal.request(Mt.PUBLISH,o,!0))._message}catch(c){if(i&&c.data&&c.data.code===Nt.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),c.toString()),await this.tryUnpubBeforeRepub(e,n),this.publish(e,n,!1);throw c}}async publishDataChannel(e,n,i){var o;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(o=n.maxRetransmits)!==null&&o!==void 0?o:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(Mt.PUBLISH_DATASTREAM,c,!0)}catch(l){if(i&&l.data&&l.data.code===Nt.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),l.toString()),await this.tryUnpubDataChannelBeforeRepub(e,n),this.publishDataChannel(e,n,!1);throw l}}async unpublish(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Mt.UNPUBLISH,{stream_id:n,ortc:e},!0)}catch(i){R.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await gt.all(e.map(n=>this.signal.request(Mt.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){R.warning("unpublish datachannels warning: ",n)}}async presubscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const o={stream_id:e,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!x("SUBSCRIBE_TWCC"),rtx:!!x("USE_SUB_RTX")||void 0,extend:x("SUB_EXTEND"),svc:Array.isArray(x("SVC"))&&x("SVC").length!==0?x("SVC"):void 0};try{return await this.signal.request(Mt.PRE_SUBSCRIBE,o,!0)}catch(c){if(i&&c.data&&c.data.code===Nt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),c.toString()),this.presubscribe(e,n,!1);throw c}}async subscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const o={stream_id:e,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!x("SUBSCRIBE_TWCC"),rtx:!!x("USE_SUB_RTX"),extend:x("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(x("SVC"))&&x("SVC").length!==0?x("SVC"):void 0};try{return(await this.signal.request(Mt.SUBSCRIBE,o,!0))._message}catch(c){if(i&&c.data&&c.data.code===Nt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),c.toString()),await this.tryUnsubBeforeResub(e,n),await this.subscribe(e,n,!1);throw c}}async subscribeDataChannel(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const o={uid:e,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(Mt.SUBSCRIBE_DATASTREAM,o,!0)}catch(c){if(i&&c.data&&c.data.code===Nt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),c.toString()),await this.tryUnsubDataChannelBeforeResub(e,n),await this.subscribeDataChannel(e,n,!1);throw c}}async subscribeAll(e,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!x("USE_SUB_RTX"),twcc:!!x("SUBSCRIBE_TWCC"),svc:Array.isArray(x("SVC"))&&x("SVC").length!==0?x("SVC"):void 0};try{return await this.signal.request(Mt.SUBSCRIBE_STREAMS,i,!0)}catch(o){if(n&&o.data&&o.data.code===Nt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),o.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw o}}async setVideoProfile(e){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let o=i.frameRate,c=i.width,l=i.height,u=!0;return typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(u=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(u=!1)),typeof l!="number"&&(l=l.exact||l.ideal||l.max||l.min||0,o||(u=!1)),u?{stream_type:0,width:c,height:l,fps:o,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(e);if(n)return this.signal.request(Mt.SET_VIDEO_PROFILE,n);R.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,n){try{await this.signal.request(Mt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:n},!0)}catch(i){R.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await gt.all(e.map(i=>this.signal.request(Mt.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:n},!0)))}catch(i){R.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(e){try{await this.signal.request(Mt.UNSUBSCRIBE_STREAMS,e,!0)}catch(n){R.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(e){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:o}=e;return{gatewayEstablishParams:await this.signal.request(Mt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:o}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Mt.GATEWAY_INFO)}async renewToken(e){await this.signal.request(Mt.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,n){n&&(this._clientRoleOptions=Object.assign({},n)),x("CLIENT_ROLE_OPTIONS")&&(R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(x("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},x("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),x("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},x("CLIENT_ROLE_OPTIONS")),R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(x("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=e);let i,o=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,o=1):o=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:o=0;const c=Object.assign({},n);delete c.delay,delete c.level,await this.signal.request(Mt.SET_CLIENT_ROLE,ci(ci({role:e,level:o,delay:i},c),{},{client_ts:Date.now()})),this.role=e}async setRemoteVideoStreamType(e,n){await this.signal.request(Mt.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:n})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(Mt.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,n){await this.signal.request(Mt.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:n})}async pickSVCLayer(e,n){await this.signal.request(Mt.PICK_SVC_LAYER,{stream_id:e,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(e){await this.signal.request(Mt.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,n,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,n,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),ci({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Mt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=W0.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:Yn.username,password:Yn.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(ci(ci({},Yn),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const e=await this.signal.request(Mt.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(o=>o.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&p_(()=>{this.emit(Nn.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){var n,i;if(!this.joinInfo||!this.key)throw new Q(L.UNEXPECTED_ERROR,"can not generate join message, no join info");const o=Object.assign({},this.joinInfo.apResponse);let c=x("REPORT_APP_SCENARIO");if(typeof c!="string")try{c=JSON.stringify(c)}catch{c=void 0}var l;c&&c.length>128&&(c=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Nn.UPDATE_GATEWAY_CONFIG),l=this.store.clientId,pt(Fl).call(Fl,l)||Fl.push(l);const u=i0(this.store),p=!((n=this.isPreallocation)===null||n===void 0||!n.call(this)),m=F1(this.store),_=IZ(),E=vl(87)||qk()||Dy(117),S=(function(){const A=ie();if(A.name!==ue.SAFARI||!A.browserVersion)return!1;const I=A.browserVersion.split(".");return Number(I[0])>18||Number(I[0])===18&&Number(I[1])>=4}()||Zk(18,4,!1))&&Py(18,6,!0)&&this.spec.codec==="h264"&&x("ENABLE_ABSSENDTIME_AS_SENTTS"),T=ci({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Ur,browser:navigator.userAgent,process_id:x("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:o,extend:x("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:c,attributes:{userAttributes:ci(ci({enableEncodedTransform:(!!x("ENABLE_AUDIO_METADATA")||!!x("ENABLE_AUDIO_PTS"))&&E||!!x("ENABLE_AUDIO_TOPN")&&Oy(ue.CHROME,87,116)||void 0,enableAudioMetadata:!!x("ENABLE_AUDIO_METADATA")&&E,enableAudioPts:!!x("ENABLE_AUDIO_PTS")&&E,topnSmoothLevel:x("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:x("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:x("TOPN_SWITCH_HOLD_MS"),topnAudioGain:x("TOPN_AUDIO_GAIN"),enablePublishedUserList:x("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:x("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:br("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:br("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:br("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:x("USE_PUB_RTX")===!0||x("USE_SUB_RTX")===!0||void 0,disableFEC:x("DISABLE_FEC"),enableNTPReport:!!x("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:m,enableFulllinkAvSync:!!x("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:br("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!x("FORCE_ENABLE_AUT_CC")||!v_()&&(!!x("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!x("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:br("USE_XR","boolean"),enableLossbasedBwe:br("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!x("FORCE_ENABLE_AUT_CC")||!v_()&&(!!x("ENABLE_AUT_CC")||void 0),enableCCFallback:br("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:p,preSubNum:u?br("PRE_SUB_NUM","number"):void 0,enablePubTWCC:br("PUBLISH_TWCC","boolean"),enableSubTWCC:br("SUBSCRIBE_TWCC","boolean"),enablePubRTX:br("USE_PUB_RTX","boolean"),enableSubRTX:br("USE_SUB_RTX","boolean"),enableSubSVC:x("ENABLE_SVC")?x("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(x("SVC"))&&x("SVC").length!==0?x("SVC"):void 0,enableSvcExtended:x("ENABLE_SVC")&&Array.isArray(x("SVC_EXTENDED"))&&x("SVC_EXTENDED").length!==0?x("SVC_EXTENDED"):void 0},_),{},{audioDuplicate:br("ENABLE_AUDIO_RED","boolean")?(i=br("AUDIO_DUPLICATE_NUM","number"))!==null&&i!==void 0?i:2:void 0,senttsUsesAbsSendTime:!!S||void 0})},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(T.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(T.aes_mode=this.joinInfo.aesmode,x("ENCRYPT_AES")?(T.aes_secret=this.joinInfo.aespassword,T.aes_encrypt=!0):T.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(T.aes_salt=this.joinInfo.aessalt)),o.addresses[this.signal.websocket.currentURLIndex]&&(T.ap_response.ticket=o.addresses[this.signal.websocket.currentURLIndex].ticket,delete o.addresses),this.joinInfo.defaultVideoStream!==void 0&&(T.default_video_stream=this.joinInfo.defaultVideoStream),T}getRejoinMessage(){if(!this.joinInfo)throw new Q(L.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Vt.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Vt.WS_RECONNECTING,e=>{this.joinInfo&&bt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||zn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",bt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Vt.WS_CLOSED,e=>{let n;switch(e){case _e.LEAVE:n=zn.LEAVE;break;case _e.UID_BANNED:case _e.IP_BANNED:case _e.CHANNEL_BANNED:case _e.SERVER_ERROR:n=zn.SERVER_ERROR;break;case _e.FALLBACK:n=zn.FALLBACK;break;case _e.LICENSE_MISSING:case _e.LICENSE_EXPIRED:case _e.LICENSE_MINUTES_EXCEEDED:case _e.LICENSE_PERIOD_INVALID:case _e.LICENSE_MULTIPLE_SDK_SERVICE:case _e.LICENSE_ILLEGAL:case _e.TOKEN_EXPIRE:n=e;break;default:n=zn.NETWORK_ERROR}R.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+zn.NETWORK_ERROR)),this.joinInfo&&bt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===_e.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=e,e!==_e.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Vt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const e=x("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(R.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(bt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void R.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));ye("EVENT_REPORT_DOMAIN",e[1]),ye("EVENT_REPORT_BACKUP_DOMAIN",e[1]),ye("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on(ee.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(Vt.REQUEST_RECOVER,(e,n,i)=>{if(!this.joinInfo)return i(new Q(L.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Kn(this,Nn.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(Vt.REQUEST_JOIN_INFO,async(e,n,i)=>{var o,c,l;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const u=Ge((o=this.joinInfo)===null||o===void 0?void 0:o.turnServer);if(x("NEW_TURN_MODE")&&u&&((c=this.joinInfo)===null||c===void 0?void 0:c.cloudProxyServer)==="disabled"){var p;let S=u.servers.map(I=>"turnServerURL"in I&&x("USE_TURN_IP")?ci(ci({},I),{},{turnServerURL:W_(I.turnServerURL)}):I),T=(p=u.serversFromGateway)===null||p===void 0?void 0:p.map(I=>x("USE_TURN_IP")?ci(ci({},I),{},{turnServerURL:W_(I.turnServerURL)}):I);const A=this.signal.currentURLIndex;S.length>0&&(S=[S[A%S.length]],u.servers=S),Array.isArray(T)&&T.length>0&&(T=[T[0]],u.serversFromGateway=T),R.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(A))}const{iceParameters:m,dtlsParameters:_,rtpCapabilities:E}=await Kn(this,Nn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u,cloudProxyServer:(l=this.joinInfo)===null||l===void 0?void 0:l.cloudProxyServer});try{e(this.getJoinMessage({ortc:{iceParameters:m,dtlsParameters:_,rtpCapabilities:E,version:"2"}}))}catch(S){n(S)}}),this.signal.on(Vt.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(Vt.REPORT_JOIN_GATEWAY,(e,n)=>{if(!this.joinInfo)return;let i,o="";var c;e instanceof Q?(i=((c=e.data)===null||c===void 0?void 0:c.desc)||e.code,o=e.message):i=e,bt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:o,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Vt.IS_P2P_DISCONNECTED,e=>{e(Oh(this,Nn.IS_P2P_DISCONNECTED))}),this.signal.on(Vt.DISCONNECT_P2P,()=>{this.emit(Nn.DISCONNECT_P2P)}),this.signal.on(Vt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Vt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Vt.JOIN_RESPONSE,e=>{const n=this.getCurrentGatewayAddress();this.emit(Nn.JOIN_RESPONSE,e,n)}),this.signal.on(Vt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var e,n;this.updateTurnConfigFromSignal();const o=this.getCurrentGatewayAddress(),c=Ge((e=this.joinInfo)===null||e===void 0?void 0:e.turnServer);if(x("NEW_TURN_MODE")&&c&&((n=this.joinInfo)===null||n===void 0?void 0:n.cloudProxyServer)==="disabled"){var i;let u=c.servers.map(_=>"turnServerURL"in _&&x("USE_TURN_IP")?ci(ci({},_),{},{turnServerURL:W_(_.turnServerURL)}):_),p=(i=c.serversFromGateway)===null||i===void 0?void 0:i.map(_=>x("USE_TURN_IP")?ci(ci({},_),{},{turnServerURL:W_(_.turnServerURL)}):_);const m=this.signal.currentURLIndex;u.length>0&&(u=[u[m%u.length]],c.servers=u),Array.isArray(p)&&p.length>0&&(p=[p[0]],c.serversFromGateway=p),R.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(m,",in pre pc"))}const l=x("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(o&&l){const u=Cx(o);this.emit(Nn.PRE_CONNECT_PC,{candidates:u,fingerprint:l,turnServer:c})}}}),this.signal.on(Vt.RECOVER_NOTIFICATION,e=>{this.joinInfo&&typeof x("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(x("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,n){try{await this.signal.request(Mt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[n]},!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(e,n){try{await this.signal.request(Mt.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(i){throw R.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(e,n){try{await this.signal.request(Mt.UNPUBLISH,{stream_id:e,ortc:n},!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(e,n){try{await this.signal.request(Mt.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(i){throw R.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(e){const n={users:e.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(Mt.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(e,n){const i={action:e.find(o=>o.stream_type===Ee.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(Mt.CONTROL,i,!0,!0)}catch(o){throw R.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),o),o}}async unmuteLocal(e,n){const i={action:e.find(o=>o.stream_type===Ee.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(Mt.CONTROL,i,!0,!0)}catch(o){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),o),o}}async muteRemote(e,n){const i={action:e===St.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Mt.CONTROL,i,!0,!0)}catch(o){throw R.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),o),o}}async unmuteRemote(e,n){const i={action:e===St.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Mt.CONTROL,i,!0,!0)}catch(o){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),o),o}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,n){this.signal.upload(e,n)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(Mt.RESTART_ICE,n,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(e,n){this.state==="CONNECTED"&&this.signal.reconnect(e||void 0,n||zn.P2P_FAILED)}getCurrentGatewayAddress(){var e,n;if(!x("GATEWAY_WSS_ADDRESS"))return x("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(R.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(Mt.SET_PARAMETER,{enablePublishAudioFilter:e})}downgradeCodec(e){this.signal.downgradeCodec(e)}}let X_=0,G0=0;function Js(t,e,n,i){return new gt((o,c)=>{e.timeout=e.timeout||x("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),X_+=vo(e.data)):n&&(e.data.size?X_+=e.data.size:e.data instanceof FormData?X_+=f1(e.data):X_+=vo(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,Oi.request(e).then(l=>{typeof l.data=="string"?G0+=vo(l.data):l.data instanceof ArrayBuffer||l.data instanceof Uint8Array?G0+=l.data.byteLength:G0+=vo(JSON.stringify(l.data)),i&&o({data:l.data,headers:l.headers}),o(l.data)}).catch(l=>{Oi.isCancel(l)?c(new Q(L.OPERATION_ABORTED,"cancel token canceled")):l.code==="ECONNABORTED"?c(new Q(L.NETWORK_TIMEOUT,l.message)):l.response?c(new Q(L.NETWORK_RESPONSE_ERROR,l.response.status)):c(new Q(L.NETWORK_ERROR,l.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function e(et){var ut=0;return function(){return ut<et.length?{done:!1,value:et[ut++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(et,ut,Tt){return et==Array.prototype||et==Object.prototype||(et[ut]=Tt.value),et},i,o=function(et){et=[typeof globalThis=="object"&&globalThis,et,typeof window=="object"&&window,typeof self=="object"&&self,typeof d=="object"&&d];for(var ut=0;ut<et.length;++ut){var Tt=et[ut];if(Tt&&Tt.Math==Math)return Tt}throw Error("Cannot find global object")}(this);function c(et,ut){if(ut)t:{var Tt=o;et=et.split(".");for(var rt=0;rt<et.length-1;rt++){var b=et[rt];if(!(b in Tt))break t;Tt=Tt[b]}(ut=ut(rt=Tt[et=et[et.length-1]]))!=rt&&ut!=null&&n(Tt,et,{configurable:!0,writable:!0,value:ut})}}function l(et){return(et={next:et})[Symbol.iterator]=function(){return this},et}function u(et){var ut=typeof Symbol<"u"&&Symbol.iterator&&et[Symbol.iterator];return ut?ut.call(et):{next:e(et)}}if(c("Symbol",function(et){function ut(b,V){this.A=b,n(this,"description",{configurable:!0,writable:!0,value:V})}if(et)return et;ut.prototype.toString=function(){return this.A};var Tt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",rt=0;return function b(V){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new ut(Tt+(V||"")+"_"+rt++,V)}}),c("Symbol.iterator",function(et){if(et)return et;et=Symbol("Symbol.iterator");for(var ut="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Tt=0;Tt<ut.length;Tt++){var rt=o[ut[Tt]];typeof rt=="function"&&typeof rt.prototype[et]!="function"&&n(rt.prototype,et,{configurable:!0,writable:!0,value:function(){return l(e(this))}})}return et}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var p;t:{var m={};try{m.__proto__={a:!0},p=m.a;break t}catch{}p=!1}i=p?function(et,ut){if(et.__proto__=ut,et.__proto__!==ut)throw new TypeError(et+" is not extensible");return et}:null}var _=i;function E(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function S(et){if(et.m)throw new TypeError("Generator is already running");et.m=!0}function T(et,ut){return et.h=3,{value:ut}}function A(et){this.g=new E,this.G=et}function I(et,ut,Tt,rt){try{var b=ut.call(et.g.j,Tt);if(!(b instanceof Object))throw new TypeError("Iterator result "+b+" is not an object");if(!b.done)return et.g.m=!1,b;var V=b.value}catch(B){return et.g.j=null,et.g.s(B),w(et)}return et.g.j=null,rt.call(et.g,V),w(et)}function w(et){for(;et.g.h;)try{var ut=et.G(et.g);if(ut)return et.g.m=!1,{value:ut.value,done:!1}}catch(Tt){et.g.v=void 0,et.g.s(Tt)}if(et.g.m=!1,et.g.l){if(ut=et.g.l,et.g.l=null,ut.F)throw ut.D;return{value:ut.return,done:!0}}return{value:void 0,done:!0}}function P(et){this.next=function(ut){return et.o(ut)},this.throw=function(ut){return et.s(ut)},this.return=function(ut){return function(Tt,rt){S(Tt.g);var b=Tt.g.j;return b?I(Tt,"return"in b?b.return:function(V){return{value:V,done:!0}},rt,Tt.g.return):(Tt.g.return(rt),w(Tt))}(et,ut)},this[Symbol.iterator]=function(){return this}}function D(et,ut){return ut=new P(new A(ut)),_&&et.prototype&&_(ut,et.prototype),ut}if(E.prototype.o=function(et){this.v=et},E.prototype.s=function(et){this.l={D:et,F:!0},this.h=this.C||this.u},E.prototype.return=function(et){this.l={return:et},this.h=this.u},A.prototype.o=function(et){return S(this.g),this.g.j?I(this,this.g.j.next,et,this.g.o):(this.g.o(et),w(this))},A.prototype.s=function(et){return S(this.g),this.g.j?I(this,this.g.j.throw,et,this.g.o):(this.g.s(et),w(this))},c("Array.prototype.entries",function(et){return et||function(){return function(ut,Tt){ut instanceof String&&(ut+="");var rt=0,b=!1,V={next:function(){if(!b&&rt<ut.length){var B=rt++;return{value:Tt(B,ut[B]),done:!1}}return b=!0,{done:!0,value:void 0}}};return V[Symbol.iterator]=function(){return V},V}(this,function(ut,Tt){return[ut,Tt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var U=function(et,ut){for(var Tt=0;Tt<et.length;Tt++)ut(et[Tt])},G=function(et){return et.replace(/\r?\n|\r/g,`\r
`)},W=function(et,ut,Tt){return ut instanceof Blob?(Tt=Tt!==void 0?Tt+"":typeof ut.name=="string"?ut.name:"blob",ut.name===Tt&&Object.prototype.toString.call(ut)!=="[object Blob]"||(ut=new File([ut],Tt)),[String(et),ut]):[String(et),String(ut)]},F=function(et,ut){if(et.length<ut)throw new TypeError(ut+" argument required, but only "+et.length+" present.")},X=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,tt=X.FormData,nt=X.XMLHttpRequest&&X.XMLHttpRequest.prototype.send,at=X.Request&&X.fetch,Kt=X.navigator&&X.navigator.sendBeacon,Xt=X.Element&&X.Element.prototype,Ut=X.Symbol&&Symbol.toStringTag;Ut&&(Blob.prototype[Ut]||(Blob.prototype[Ut]="Blob"),"File"in X&&!File.prototype[Ut]&&(File.prototype[Ut]="File"));try{new File([],"")}catch{X.File=function(ut,Tt,rt){return ut=new Blob(ut,rt||{}),Object.defineProperties(ut,{name:{value:Tt},lastModified:{value:+(rt&&rt.lastModified!==void 0?new Date(rt.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Ut&&Object.defineProperty(ut,Ut,{value:"File"}),ut}}var me=function(et){return et.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},he=function(et){this.i=[];var ut=this;et&&U(et.elements,function(Tt){if(Tt.name&&!Tt.disabled&&Tt.type!=="submit"&&Tt.type!=="button"&&!Tt.matches("form fieldset[disabled] *"))if(Tt.type==="file"){var rt=Tt.files&&Tt.files.length?Tt.files:[new File([],"",{type:"application/octet-stream"})];U(rt,function(b){ut.append(Tt.name,b)})}else Tt.type==="select-multiple"||Tt.type==="select-one"?U(Tt.options,function(b){!b.disabled&&b.selected&&ut.append(Tt.name,b.value)}):Tt.type==="checkbox"||Tt.type==="radio"?Tt.checked&&ut.append(Tt.name,Tt.value):(rt=Tt.type==="textarea"?G(Tt.value):Tt.value,ut.append(Tt.name,rt))})};if((t=he.prototype).append=function(et,ut,Tt){F(arguments,2),this.i.push(W(et,ut,Tt))},t.delete=function(et){F(arguments,1);var ut=[];et=String(et),U(this.i,function(Tt){Tt[0]!==et&&ut.push(Tt)}),this.i=ut},t.entries=function et(){var ut,Tt=this;return D(et,function(rt){if(rt.h==1&&(ut=0),rt.h!=3)return ut<Tt.i.length?rt=T(rt,Tt.i[ut]):(rt.h=0,rt=void 0),rt;ut++,rt.h=2})},t.forEach=function(et,ut){F(arguments,1);for(var Tt=u(this),rt=Tt.next();!rt.done;rt=Tt.next()){var b=u(rt.value);rt=b.next().value,b=b.next().value,et.call(ut,b,rt,this)}},t.get=function(et){F(arguments,1);var ut=this.i;et=String(et);for(var Tt=0;Tt<ut.length;Tt++)if(ut[Tt][0]===et)return ut[Tt][1];return null},t.getAll=function(et){F(arguments,1);var ut=[];return et=String(et),U(this.i,function(Tt){Tt[0]===et&&ut.push(Tt[1])}),ut},t.has=function(et){F(arguments,1),et=String(et);for(var ut=0;ut<this.i.length;ut++)if(this.i[ut][0]===et)return!0;return!1},t.keys=function et(){var ut,Tt,rt,b,V=this;return D(et,function(B){if(B.h==1&&(ut=u(V),Tt=ut.next()),B.h!=3)return Tt.done?void(B.h=0):(rt=Tt.value,b=u(rt),T(B,b.next().value));Tt=ut.next(),B.h=2})},t.set=function(et,ut,Tt){F(arguments,2),et=String(et);var rt=[],b=W(et,ut,Tt),V=!0;U(this.i,function(B){B[0]===et?V&&(V=!rt.push(b)):rt.push(B)}),V&&rt.push(b),this.i=rt},t.values=function et(){var ut,Tt,rt,b,V=this;return D(et,function(B){if(B.h==1&&(ut=u(V),Tt=ut.next()),B.h!=3)return Tt.done?void(B.h=0):(rt=Tt.value,(b=u(rt)).next(),T(B,b.next().value));Tt=ut.next(),B.h=2})},he.prototype._asNative=function(){for(var et=new tt,ut=u(this),Tt=ut.next();!Tt.done;Tt=ut.next()){var rt=u(Tt.value);Tt=rt.next().value,rt=rt.next().value,et.append(Tt,rt)}return et},he.prototype._blob=function(){var et="----formdata-polyfill-"+Math.random(),ut=[],Tt="--"+et+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(rt,b){return typeof rt=="string"?ut.push(Tt+me(G(b))+`"\r
\r
`+G(rt)+`\r
`):ut.push(Tt+me(G(b))+'"; filename="'+me(rt.name)+`"\r
Content-Type: `+(rt.type||"application/octet-stream")+`\r
\r
`,rt,`\r
`)}),ut.push("--"+et+"--"),new Blob(ut,{type:"multipart/form-data; boundary="+et})},he.prototype[Symbol.iterator]=function(){return this.entries()},he.prototype.toString=function(){return"[object FormData]"},Xt&&!Xt.matches&&(Xt.matches=Xt.matchesSelector||Xt.mozMatchesSelector||Xt.msMatchesSelector||Xt.oMatchesSelector||Xt.webkitMatchesSelector||function(et){for(var ut=(et=(this.document||this.ownerDocument).querySelectorAll(et)).length;0<=--ut&&et.item(ut)!==this;);return-1<ut}),Ut&&(he.prototype[Ut]="FormData"),nt){var ni=X.XMLHttpRequest.prototype.setRequestHeader;X.XMLHttpRequest.prototype.setRequestHeader=function(et,ut){ni.call(this,et,ut),et.toLowerCase()==="content-type"&&(this.B=!0)},X.XMLHttpRequest.prototype.send=function(et){et instanceof he?(et=et._blob(),this.B||this.setRequestHeader("Content-Type",et.type),nt.call(this,et)):nt.call(this,et)}}at&&(X.fetch=function(et,ut){return ut&&ut.body&&ut.body instanceof he&&(ut.body=ut.body._blob()),at.call(this,et,ut)}),Kt&&(X.navigator.sendBeacon=function(et,ut){return ut instanceof he&&(ut=ut._asNative()),Kt.call(this,et,ut)}),X.FormData=he}})();const Kh=()=>{const t=x("AREAS");return t.length===0&&t.push(pe.GLOBAL),os(t).call(t,(e,n,i)=>{const o=Ux(n);return o?i===0?o:"".concat(e,",").concat(o):e},"")},Ux=t=>t===pe.OVERSEA?"".concat($n.ASIA,",").concat($n.EUROPE,",").concat($n.AFRICA,",").concat($n.NORTH_AMERICA,",").concat($n.SOUTH_AMERICA,",").concat($n.OCEANIA):$n[t],AZ=t=>{const e={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(n=>{const i=B_[n],o=Object.keys(i);o&&o.map(c=>{c!=="CODE"&&(e[c]=e[c].concat(i[c]))})}),e},J_={GLOBAL:{ASIA:[pe.CHINA,pe.JAPAN,pe.INDIA,pe.KOREA,pe.HKMC],EUROPE:[],NORTH_AMERICA:[pe.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Q_=Object.keys(J_[pe.GLOBAL]),H0=[pe.CHINA,pe.NORTH_AMERICA,pe.EUROPE,pe.ASIA,pe.JAPAN,pe.INDIA,pe.OCEANIA,pe.SOUTH_AMERICA,pe.AFRICA,pe.KOREA,pe.HKMC,pe.US],OZ=function(t,e){let n=[];if(pt(t).call(t,pe.GLOBAL)){const c=[pe.GLOBAL,pe.OVERSEA],l=Object.keys(B_);if(e===pe.GLOBAL)throw new Q(L.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===pe.CHINA)n=[pe.OVERSEA];else if(o=e,pt(Q_).call(Q_,o)){const u=(i=e,J_[pe.GLOBAL][i]||[]),p=[...c,e,...u];n=l.filter(m=>!pt(p).call(p,m))}else if(function(u){let p=!1;return Q_.forEach(m=>{var _;pt(_=J_[pe.GLOBAL][m]).call(_,u)&&(p=!0)}),p}(e)){const u=function(m){let _;return Q_.forEach(E=>{var S;pt(S=J_[pe.GLOBAL][E]).call(S,m)&&(_=E)}),_}(e),p=[...c,u,e];n=l.filter(m=>!pt(p).call(p,m))}else n=t;n=function(u){const p=[];return H0.forEach(m=>{pt(u).call(u,m)&&p.push(m)}),p.concat(u.filter(m=>!pt(H0).call(H0,m)))}(n)}else n=t;var i,o;return n};function Vx(t){var e,n;if(!t&&pt(e=x("AREAS")).call(e,pe.EXTENSIONS))return R.debug("update area from ap : reset"),void z0(UQ,!0);if(!pt(n=x("AREAS")).call(n,pe.GLOBAL)||!t)return;let i=B_.EXTENSIONS;i&&(i={CODE:Ux(pe.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},R.debug("update area from ap success: ".concat(t,",config is "),i),ye("AREAS",[pe.EXTENSIONS],!0),Object.keys(i).map(o=>{o==="LOG_UPLOAD_SERVER"||o==="EVENT_REPORT_DOMAIN"||o==="EVENT_REPORT_BACKUP_DOMAIN"||o==="PROXY_SERVER_TYPE3"?ye(o,i[o][0]):ye(o,i[o])}))}function z0(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=bt.reportApiInvoke(null,{name:tn.SET_AREA,options:t,tag:We.TRACER});try{let i=[];if(typeof t=="string"&&(i=[t]),Array.isArray(t)&&(t.forEach(c=>{if(!pt(sx).call(sx,c))throw new Q(L.INVALID_PARAMS,"invalid area code")}),i=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:c,excludedArea:l}=t;if(!c)throw new Q(L.INVALID_PARAMS,"area code is needed");let u=c;typeof c=="string"&&(u=[c]),i=l?OZ(u,l):u}if(!e){if(Ks.AREAS){const c=new Q(L.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(c),void R.warning("setArea is prohibited because of config-distribute")}if(pt(i).call(i,pe.GLOBAL)&&x("AREAS")===pe.EXTENSIONS){const c=new Q(L.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(c),void R.warning("setArea is prohibited because of ap extensions")}}ye("AREAS",i,e);const o=AZ(i);Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?ye(c,o[c][0]):ye(c,o[c])}),R.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function Fx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function wo(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Fx(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Fx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let K0=1;function NZ(t,e,n,i,o){K0+=1;const c={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:K0,requestId:K0,version:Ur,cname:n.cname},l={service_name:e,json_body:JSON.stringify(c)};let u,p,m=t[0];return zs(async()=>{u=Date.now();const _=await Js(m,{data:l,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(p=Date.now()-u,_.code!==0){const T=new Q(L.UNEXPECTED_RESPONSE,"live streaming ap error, code"+_.code,{retry:!0,responseTime:p});throw R.error(T.toString()),T}const E=JSON.parse(_.json_body);if(E.code!==200){const T=new Q(L.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(E.code,", reason: ").concat(E.reason),{code:E.code,responseTime:p});throw R.error(T.toString()),T}if(!E.servers||E.servers.length===0){const T=new Q(L.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:E.code,responseTime:p});throw R.error(T.toString()),T}const S=function(T,A){return{addressList:T.servers.map(I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(x("WORKER_DOMAIN"),":").concat(I.wss,"?serviceName=").concat(encodeURIComponent(A))),workerToken:T.workerToken,vid:T.vid}}(E,e);return x("LIVE_STREAMING_ADDRESS")&&(S.addressList=x("LIVE_STREAMING_ADDRESS")instanceof Array?x("LIVE_STREAMING_ADDRESS"):[x("LIVE_STREAMING_ADDRESS")]),wo(wo({},S),{},{responseTime:p})},(_,E)=>(bt.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(_.addressList),firstSuccess:E===0,responseTime:p,serverIp:t[E%t.length]}),!1),(_,E)=>(bt.apworkerEvent(n.sid,{success:!1,sc:_.data&&_.data.code||200,serviceName:e,responseTime:p,serverIp:t[E%t.length]}),!!(_.code!==L.OPERATION_ABORTED&&_.code!==L.UNEXPECTED_RESPONSE||_.data&&_.data.retry)&&(m=t[(E+1)%t.length],!0)),o)}let Y0=1;function Bx(t,e,n,i){let{url:o,areaCode:c}=t;const{clientId:l,sid:u}=e,p=Date.now();let m;const _=e.role,[E,S]=X0(e,c,[an.CHOOSE_SERVER]);let T=on.networkState;return zs(async()=>{T&&on.networkState===sr.OFFLINE&&on.onlineWaiter&&await gt.race([on.onlineWaiter,xn(i&&i.maxRetryTimeout||pn.maxRetryTimeout)]),T=on.networkState;const{data:A,headers:I}=await Js(o,{data:E,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);m=I.http3==="1"?1:-1,bt.reportResourceTiming(o,u),Wx(A,o,e,p,[an.CHOOSE_SERVER],m);const w=Wh(A,an.CHOOSE_SERVER);return q0(w),V0(w,o)},A=>(A&&bt.joinChooseServer(u,{role:_,lts:p,succ:!0,csAddr:o,opid:S,serverList:A.gatewayAddrs.map(I=>I.address),ec:null,cid:A.cid.toString(),uid:A.uid.toString(),csIp:A.csIp,unilbsServerIds:[an.CHOOSE_SERVER].toString(),isHttp3:m,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:A.res.detail&&A.res.detail[38]}),!1),A=>A.code!==L.OPERATION_ABORTED&&(A.code===L.CAN_NOT_GET_GATEWAY_SERVER?A.data.retry:(bt.joinChooseServer(u,{role:_,lts:p,succ:!1,csAddr:o,serverList:null,opid:S,ec:A.code,csIp:A.data&&A.data.csIp,unilbsServerIds:[an.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:T}),isHttp3:m,corssRegionTagReq:e.apRequestDetail}),R.warning("[".concat(l||"sid-".concat(u.slice(0,6)),"] Choose server network error, retry"),A),!0)),i)}function jx(t,e,n,i){let o,{url:c,areaCode:l,serviceIds:u}=t;const p=Date.now(),m=e.role,[_,E]=X0(e,l,u);let S;return zs(async()=>{S&&on.networkState===sr.OFFLINE&&on.onlineWaiter&&await gt.race([on.onlineWaiter,xn(i&&i.maxRetryTimeout||pn.maxRetryTimeout)]),S=on.networkState;const{data:T,headers:A}=await Js(c,{data:_,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);o=A.http3==="1"?1:-1,bt.reportResourceTiming(c,e.sid),Wx(T,c,e,p,u,o);const I=Wh(T,an.CHOOSE_SERVER),w=Wh(T,e.cloudProxyServer==="proxy5"?an.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?an.CLOUD_PROXY:an.CLOUD_PROXY_FALLBACK),P=performance.getEntriesByName(c),D=P[P.length-1];let U;return D&&(U={name:D.name,protocol:"nextHopProtocol"in D?D.nextHopProtocol:"",dnscost:"domainLookupEnd"in D&&"domainLookupStart"in D&&typeof D.domainLookupEnd=="number"&&typeof D.domainLookupStart=="number"?D.domainLookupEnd-D.domainLookupStart:-1,tcpTlsCost:"connectEnd"in D&&"connectStart"in D&&typeof D.connectEnd=="number"&&typeof D.connectStart=="number"?D.connectEnd-D.connectStart:-1,reqCost:"requestStart"in D&&typeof D.requestStart=="number"&&"responseEnd"in D&&typeof D.responseEnd=="number"?D.responseEnd-D.requestStart:-1,handleCost:"leave_ts"in T&&"enter_ts"in T&&typeof T.leave_ts=="number"&&typeof T.enter_ts=="number"?T.leave_ts-T.enter_ts:-1}),q0(I),{gatewayInfo:V0(I,c),proxyInfo:w,url:c,resourceTimingInfo:U}},T=>(T.gatewayInfo&&bt.joinChooseServer(e.sid,{role:m,lts:p,succ:!0,csAddr:c,serverList:T.gatewayInfo.gatewayAddrs.map(A=>A.address),ec:null,opid:E,cid:T.gatewayInfo.cid.toString(),uid:T.gatewayInfo.uid.toString(),csIp:T.gatewayInfo.csIp,unilbsServerIds:u.toString(),isHttp3:o,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:T.gatewayInfo.res.detail&&T.gatewayInfo.res.detail[38],resourceTimingInfo:T.resourceTimingInfo?JSON.stringify(T.resourceTimingInfo):void 0}),T.proxyInfo&&bt.joinWebProxyAP(e.sid,{lts:p,sucess:1,apServerAddr:c,turnServerAddrList:T.proxyInfo.addresses.map(A=>A.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:u.toString()}),!1),T=>T.code!==L.OPERATION_ABORTED&&(T.code===L.CAN_NOT_GET_GATEWAY_SERVER?T.data.retry:(bt.joinWebProxyAP(e.sid,{lts:p,sucess:0,apServerAddr:c,turnServerAddrList:null,errorCode:T.code,eventType:e.cloudProxyServer,unilbsServerIds:u.toString(),extend:JSON.stringify({networkState:S})}),R.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),T),!0)),i)}const Wx=(t,e,n,i,o,c)=>{const{sid:l,clientId:u,cloudProxyServer:p}=n,m=[],_=E=>{E.flag===4096?bt.joinChooseServer(l,{role:n.role,lts:i,succ:!1,csAddr:e,opid:t.opid,serverList:null,ec:E.error.message,csIp:E.error.data&&E.error.data.csIp,unilbsServerIds:o.toString(),isHttp3:c,corssRegionTagReq:n.apRequestDetail}):E.flag!==1048576&&E.flag!==4194304&&E.flag!==4194310||bt.joinWebProxyAP(l,{lts:i,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:E.error.code,eventType:p,unilbsServerIds:o.toString()})};if(t.response_body.forEach(E=>{const S=E.buffer.code;if(E.uri===23&&S===0&&!E.buffer.edges_services)if(E.buffer.flag===4194310)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),E.buffer.edges_services=[];else{const T={error:new Q(L.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:E.buffer.flag};m.push(T),_(T)}if(S!==0){const T=Gl(S),A={error:new Q(L.CAN_NOT_GET_GATEWAY_SERVER,T.desc,{desc:T.desc,retry:T.retry,csIp:t.detail[502]}),flag:E.buffer.flag};E.buffer.flag===4194310?R.warning(A.error.toString()):m.push(A),_(A)}}),m.length)throw R.warning("[".concat(u||"sid-".concat(l.slice(0,6)),"] multi unilbs ").concat(e," failed, ").concat(m.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message,", retry: ").concat(E.error.data.retry)).join(" | "))),new Q(L.CAN_NOT_GET_GATEWAY_SERVER,m.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message)).join(" | "),{retry:!!m.find(E=>E.error.data.retry),csIp:t.detail[502],desc:[...new Set(m.map(E=>{var S;return E==null||(S=E.error)===null||S===void 0||(S=S.data)===null||S===void 0?void 0:S.desc}).filter(E=>!!E))]})},q0=t=>{var e,n,i,o;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new Q(L.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(x("AP_AREA")&&((i=t.detail)!==null&&i!==void 0&&i[23]&&typeof((o=t.detail)===null||o===void 0?void 0:o[23])=="string"?Vx(t.detail[23].toLowerCase()):Vx()),(e=t.detail)!==null&&e!==void 0&&e[19]&&typeof((n=t.detail)===null||n===void 0?void 0:n[19])=="string"){const l=t.detail[19],u=l==null?void 0:l.split(";");for(let p=0;p<u.length;p++){var c;const m=hi(c=u[p]).call(c);t.addresses[p]&&u&&(t.addresses[p].fingerprint=m)}}if(x("GATEWAY_ADDRESS")&&x("GATEWAY_ADDRESS").length>0){R.debug("assign gateway address to",x("GATEWAY_ADDRESS"));const l=x("GATEWAY_ADDRESS").map(u=>{var p,m;const _=(p=(m=t.addresses.find(E=>E.ip===u.ip&&E.port===u.port))===null||m===void 0?void 0:m.fingerprint)!==null&&p!==void 0?p:"";return{ip:u.ip,port:u.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:_}});t.addresses=l}},DZ=(t,e)=>{if(t.response_body&&t.response_body.length){const n=t.response_body[0];if(n.buffer.code!==0){const i=Gl(n.buffer.code);throw new Q(L.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw R.debug("update ticket request received ap response without response body:",e),new Q(L.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},X0=(t,e,n)=>{const i=Math.floor(Math.random()*1e12),o=t.role==="host"?"1":t.role==="audience"?"2":void 0,c={appid:t.appId,client_ts:Date.now(),opid:i,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:wo(wo(wo({6:t.stringUid,11:e,12:x("USE_NEW_TOKEN")?"1":void 0},o?{17:o}:{}),{},{22:e},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:n,uid:t.uid||0}}]};c.request_bodies.forEach(u=>{t.multiIP&&t.multiIP.gateway_ip&&(u.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const l=new FormData;return l.append("request",JSON.stringify(c)),[l,i]},PZ=(t,e)=>{const n=Math.floor(Math.random()*1e12),i={appid:t.appId,client_ts:Date.now(),opid:n,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:e,uid:t.uid||0,edges_services:t.apResponse.addresses.map(c=>({ip:c.ip,port:c.port}))}}]},o=new FormData;return o.append("request",JSON.stringify(i)),[o,n]};let Yl=0;function ql(t){return gt.all(t.map(e=>e.then(n=>{throw n},n=>n))).then(e=>{throw e},e=>e)}const Yh=async t=>{let{fragementLength:e,referenceList:n,asyncMapHandler:i,allFailedhandler:o,promisesCollector:c}=t,l=0;const u=e;let p,m=0;const _=async()=>{const E=(()=>{const S=l*u,T=S+u;return n.slice(S,T).map(i)})();c&&c.push(...E);try{p=await ql(E)}catch(S){if(m+=u,l++,!(m>=n.length))return void await _();o(S)}E.forEach(S=>S.cancel())};return await _(),p},Gx=async t=>{let{referenceList:e,asyncMapHandler:n,closeFn:i}=t;const o=e.length;let c=0;const l=async()=>{const u=n(e.shift());try{return await u}catch(p){if(c++,c>=o||i!=null&&i(p))throw p;return l()}};return l()};async function kZ(){if(typeof VideoDecoder>"u")return!0;let t;const e=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],o=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],c=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],l=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new gt((p,m)=>{let _;(async function(){t&&t.state!=="closed"||await async function(){t=new VideoDecoder({output:S=>{S.close(),clearTimeout(_),p(!0)},error:S=>{clearTimeout(_),p(!1)}}),await t.configure({codec:"av01.0.05M.08",width:160,height:90})}();const E=[e,n,i,o,c,l];for(let S=0;S<E.length;S++){const T=new EncodedVideoChunk({type:S==0?"key":"delta",timestamp:33333*S,duration:33333,data:new Uint8Array(E[S])});try{await t.decode(T)}catch{return void p(!1)}}})(),_=setTimeout(()=>{p(!1)},5e3)})}async function J0(t,e,n,i){return{gatewayInfo:await async function(c,l,u,p){let m=null;const _=[],E=async()=>{const T=x("WEBCS_DOMAIN").slice(0,x("AJAX_REQUEST_CONCURRENT")).map(w=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(w+"/api/v2/transpond/webrtc?v=2"):"https://".concat(w,"/api/v2/transpond/webrtc?v=2"),areaCode:Kh()})),A=p.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(w=>w.url)}),I=await Yh({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:w=>(R.debug("[".concat(c.clientId,"] Connect to choose_server:"),w.url),Bx(w,c,l,u)),allFailedhandler:w=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},A),w[0]},promisesCollector:_});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},A),I},S=async()=>{if(await xn(1e3),m!==null)return m;const T=x("WEBCS_DOMAIN_BACKUP_LIST").map(w=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(w+"/api/v2/transpond/webrtc?v=2"):"https://".concat(w,"/api/v2/transpond/webrtc?v=2"),areaCode:Kh()})),A=p.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(w=>w.url)}),I=await Yh({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:w=>(R.debug("[".concat(c.clientId,"] Connect to backup choose_server:"),w.url),Bx(w,c,l,u)),allFailedhandler:w=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},A),w[0]},promisesCollector:_});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},A),I};try{return m=await ql([E(),S()]),_.length&&_.forEach(T=>T.cancel&&typeof T.cancel=="function"&&T.cancel()),m}catch(T){throw T[0]}}(t,e,n,i)}}async function Hx(t,e,n,i,o){const c=t.cloudProxyServer;if(c==="disabled"){if(!i)return;if(t.useLocalAccessPoint)return await J0(t,e,n,o);if(x("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:S,proxyInfo:T}=await Yx(t,e,n,o);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:S};const A=T.map(I=>({turnServerURL:I.address,tcpport:I.tcpport||Yn.tcpport,udpport:I.udpport||Yn.udpport,username:I.username||Yn.username,password:I.password||Yn.password,forceturn:!1,security:!0}));if(o.useP2P){var l;const I=(l=t.uid)!==null&&l!==void 0?l:S.uid,w="glb:".concat(I.toString()),P=await Fy(w),D=T.map(U=>({turnServerURL:U.address,tcpport:U.tcpport||Yn.tcpport,udpport:U.udpport||Yn.udpport,username:w,password:P,forceturn:!1,security:!0}));A.push(...D)}return t.turnServer={mode:"manual",servers:A},{gatewayInfo:S}}return await J0(t,e,n,o)}const{proxyInfo:u,gatewayInfo:p}=await Yx(t,e,n,o),m={gatewayInfo:p},_=u.map(S=>({turnServerURL:S.address,tcpport:c==="proxy3"?void 0:S.tcpport?S.tcpport:Yn.tcpport,udpport:c==="proxy4"?void 0:S.udpport?S.udpport:Yn.udpport,username:S.username||Yn.username,password:S.password||Yn.password,forceturn:c!=="proxy4",security:c==="proxy5"}));if(o.useP2P){var E;const S=(E=t.uid)!==null&&E!==void 0?E:p.uid,T="glb:".concat(S.toString()),A=await Fy(T),I=u.map(w=>({turnServerURL:w.address,tcpport:c==="proxy3"?void 0:w.tcpport||Yn.tcpport,udpport:c==="proxy4"?void 0:w.udpport||Yn.udpport,username:T,password:A,forceturn:c!=="proxy4",security:c==="proxy5"}));_.push(...I)}return t.turnServer={mode:"manual",servers:_},R.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(c)),m}async function zx(t,e,n,i,o){const c=x("ACCOUNT_REGISTER").slice(0,x("AJAX_REQUEST_CONCURRENT"));let l=[];l=e.proxyServer?c.map(p=>"https://".concat(e.proxyServer,"/ap/?url=").concat(p+"/api/v1")):c.map(p=>"https://".concat(p,"/api/v1"));const u=o==null?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:l});try{const p=await async function(m,_,E,S,T){const A=Date.now(),I={sid:E.sid,opid:10,appid:E.appId,string_uid:_};let w=m[0];const P=await zs(()=>Js(w+"".concat(w.indexOf("?")===-1?"?":"&","action=stringuid"),{data:I,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(D,U)=>{if(D.code===0){if(D.uid<=0||D.uid>=Math.pow(2,32))throw R.error("Invalid Uint Uid ".concat(_," => ").concat(D.uid),D),bt.reqUserAccount(I.sid,{lts:A,success:!1,serverAddr:w,stringUid:I.string_uid,uid:D.uid,errorCode:L.INVALID_UINT_UID_FROM_STRING_UID,extend:I}),new Q(L.INVALID_UINT_UID_FROM_STRING_UID);return bt.reqUserAccount(I.sid,{lts:A,success:!0,serverAddr:w,stringUid:I.string_uid,uid:D.uid,errorCode:null,extend:I}),!1}const G=Gl(D.code);return G.retry&&(w=m[(U+1)%m.length]),bt.reqUserAccount(I.sid,{lts:A,success:!1,serverAddr:w,stringUid:I.string_uid,uid:D.uid,errorCode:G.desc,extend:I}),G.retry},(D,U)=>D.code!==L.OPERATION_ABORTED&&(bt.reqUserAccount(I.sid,{lts:A,success:!1,serverAddr:w,stringUid:I.string_uid,uid:null,errorCode:D.code,extend:I}),w=m[(U+1)%m.length],!0),T);if(P.code!==0){const D=Gl(P.code);throw new Q(L.UNEXPECTED_RESPONSE,D.desc)}return P}(l,t,e,n,i);return o==null||o.recordJoinChannelService({status:"success",endTs:Date.now()},u),p.uid}catch(p){throw o==null||o.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[p]},u),p}}async function LZ(t,e,n){const i=x("ACCOUNT_REGISTER");let o=[];o=e.proxyServer?i.map(c=>"https://".concat(e.proxyServer,"/ap/?url=").concat(c+"/api/v1")):i.map(c=>"https://".concat(c,"/api/v1"));try{return await Gx({referenceList:o,asyncMapHandler:l=>async function(u,p,m,_){const E=Date.now(),S={sid:m.sid,opid:10,appid:m.appId,string_uid:p};try{const T=await Js(u+"".concat(u.indexOf("?")===-1?"?":"&","action=stringuid"),{data:S,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(T.code!==0){const A=Gl(T.code);throw new Q(L.UNEXPECTED_RESPONSE,"preload sua error:".concat(A.desc),A)}if(T.uid<=0||T.uid>=Math.pow(2,32))throw new Q(L.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:E,url:u,req:S,uid:T.uid,elapse:Date.now()-E}}catch(T){throw T}}(l,t,e,n),closeFn:l=>l.code===L.OPERATION_ABORTED||l.code===L.UNEXPECTED_RESPONSE&&!l.data.retry})}catch(c){throw c}}async function MZ(t,e,n){const i=x("CDS_AP").slice(0,x("AJAX_REQUEST_CONCURRENT")).map(p=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(p+"/api/v1"):"https://".concat(p,"/api/v1?action=config")),o=i.map(p=>function(m,_,E,S){const T=ie(),A={flag:64,cipher_method:0,features:wo(wo(wo(wo(wo({install_id:Jy(),device:T.name,system:T.os,system_general:navigator.userAgent,vendor:_.appId,version:Ur,cname:_.cname,session_id:_.sid,proxyServer:_.proxyServer,sdk_type:bZ.WEB_RTC,browser_name:T.name,browser_version:T.version,user_agent:navigator.userAgent,channel_name:_.cname},_.stringUid&&{string_uid:_.stringUid}),_.uid&&{uid:_.uid+""}),T.os&&{os_name:T.os}),T.osVersion&&{os_version:T.osVersion}),{},{detail:""})};return zs(()=>Js(m,{data:A,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,I=>I.code!==L.OPERATION_ABORTED,S)}(p,t,e,n));let c=null,l=null,u={};try{c=await ql(o)}catch(p){if(p.code===L.OPERATION_ABORTED)throw p;l=p}if(o.forEach(p=>p.cancel()),bt.reportApiInvoke(t.sid,{name:tn.REQUEST_CONFIG_DISTRIBUTE,options:{error:l,res:c}}).onSuccess(),c&&c.test_tags)try{u=function(p){if(!p.test_tags)return{};const m=p.test_tags,_=Object.keys(m),E={};return _.forEach(S=>{var T;const A=hi(T=S.slice(4)).call(T),I=JSON.parse(m[S]),w=I[1];E[A]={tag:I[0]||"",value:w}}),E}(c)}catch{}return u}async function Kx(t,e){const n=x("WEBCS_DOMAIN").concat(x("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:Kh(),serviceIds:[an.CHOOSE_SERVER,an.CLOUD_PROXY_FALLBACK]}));try{return await Gx({referenceList:n,asyncMapHandler:o=>async function(c,l,u){let p,{url:m,areaCode:_,serviceIds:E}=c;const S=Date.now(),[T,A]=X0(l,_,E);let I=on.networkState;try{I&&on.networkState===sr.OFFLINE&&on.onlineWaiter&&await gt.race([on.onlineWaiter,xn(pn.maxRetryTimeout)]),I=on.networkState;const{data:w,headers:P}=await Js(m,{data:T,cancelToken:u,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p=P.http3==="1"?1:-1,(W=>{const F=[];if(W.response_body.forEach(X=>{const tt=X.buffer.code;if(X.uri===23&&tt===0&&!X.buffer.edges_services)if(X.buffer.flag===4194310)X.buffer.edges_services=[];else{const nt={error:new Q(L.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:W.detail[502]}),flag:X.buffer.flag};F.push(nt)}if(tt!==0){const nt=Gl(tt),at={error:new Q(L.CAN_NOT_GET_GATEWAY_SERVER,nt.desc,{desc:nt.desc,retry:nt.retry,csIp:W.detail[502]}),flag:X.buffer.flag};X.buffer.flag===4194310?R.warning(at.error.toString()):F.push(at)}}),F.length)throw new Q(L.CAN_NOT_GET_GATEWAY_SERVER,F.map(X=>"flag: ".concat(X.flag,", message: ").concat(X.error.message)).join(" | "),{retry:!!F.find(X=>X.error.data.retry),csIp:W.detail[502],desc:[...new Set(F.map(X=>{var tt;return X==null||(tt=X.error)===null||tt===void 0||(tt=tt.data)===null||tt===void 0?void 0:tt.desc}).filter(X=>!!X))]})})(w);const U=Wh(w,an.CHOOSE_SERVER),G=Wh(w,an.CLOUD_PROXY_FALLBACK);return q0(U),{gatewayInfo:V0(U,m),proxyInfo:G,opid:A,requestTime:S,url:m,isHttp3:p,elapse:Date.now()-S}}catch(w){throw w}}(o,t,e),closeFn:o=>o.code===L.OPERATION_ABORTED||o.code===L.CAN_NOT_GET_GATEWAY_SERVER&&!o.data.retry})}catch(i){throw i}}async function Yx(t,e,n,i){const o=x("PROXY_SERVER_TYPE3"),c=(T,A,I)=>{let w=I||o;return Array.isArray(w)&&(w=A%2==0&&o[1]||o[0]),"https://".concat(w,"/ap/?url=").concat(T)};let l=null;const u=[],p=async()=>{const T=x("WEBCS_DOMAIN").slice(0,x("AJAX_REQUEST_CONCURRENT")).map((w,P)=>{let D;return D=t.cloudProxyServer==="disabled"&&t.proxyServer?c("".concat(w,"/api/v2/transpond/webrtc?v=2"),P,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(w,"/api/v2/transpond/webrtc?v=2"):c("".concat(w,"/api/v2/transpond/webrtc?v=2"),P),{url:D,areaCode:Kh(),serviceIds:[an.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?an.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?an.CLOUD_PROXY:an.CLOUD_PROXY_FALLBACK]}}),A=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(w=>w.url)}),I=await Yh({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:w=>(R.debug("[".concat(t.clientId,"] Connect to choose_server:"),w.url),jx(w,t,e,n)),allFailedhandler:w=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},A),w[0]},promisesCollector:u});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},A),I},m=async()=>{if(await xn(1e3),l!==null)return l;const T=x("WEBCS_DOMAIN_BACKUP_LIST").map((w,P)=>{let D;return D=t.cloudProxyServer==="disabled"&&t.proxyServer?c("".concat(w,"/api/v2/transpond/webrtc?v=2"),P,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(w,"/api/v2/transpond/webrtc?v=2"):c("".concat(w,"/api/v2/transpond/webrtc?v=2"),P),{url:D,areaCode:Kh(),serviceIds:[an.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?an.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?an.CLOUD_PROXY:an.CLOUD_PROXY_FALLBACK]}}),A=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(w=>w.url)}),I=await Yh({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:w=>(R.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),w.url),jx(w,t,e,n)),allFailedhandler:w=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},A),w[0]},promisesCollector:u});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},A),I};let _,E,S;try{({gatewayInfo:_,proxyInfo:E,url:S}=await ql([p(),m()]))}catch(T){throw T[0]}if(u.length&&u.forEach(T=>T.cancel&&typeof T.cancel=="function"&&T.cancel()),!_||!E)throw new Q(L.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=S,t.cloudProxyServer!=="disabled"&&Array.isArray(o)&&S){const T=/^https?:\/\/(.+?)(\/.*)?$/.exec(S)[1];pt(o).call(o,T)&&(t.proxyServer=T,R.setProxyServer(T),bt.setProxyServer(T))}return l={gatewayInfo:_,proxyInfo:await gx(E,_.uid)},l}async function xZ(t,e,n){const i=x("UAP_AP").slice(0,x("AJAX_REQUEST_CONCURRENT")).map(c=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(c+"/api/v1?action=uap"):"https://".concat(c,"/api/v1?action=uap")),o=i.map(c=>function(l,u,p,m){const _={command:"convergeAllocateEdge",sid:u.sid,appId:u.appId,token:u.token,ts:Date.now(),version:Ur,cname:u.cname,uid:u.uid.toString(),requestId:Y0,seq:Y0};Y0+=1;const E={service_name:"tele_channel",json_body:JSON.stringify(_)};return zs(async()=>{const S=await Js(l,{data:E,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(S.code!==0){const A=new Q(L.UNEXPECTED_RESPONSE,"cross channel ap error, code"+S.code,{retry:!0});throw R.error(A.toString()),A}const T=JSON.parse(S.json_body);if(T.code!==200){const A=new Q(L.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(T.code,", reason: ").concat(T.reason));throw R.error(A.toString()),A}if(!T.servers||T.servers.length===0){const A=new Q(L.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw R.error(A.toString()),A}return{vid:T.vid,workerToken:T.workerToken,addressList:(x("CHANNEL_MEDIA_RELAY_SERVERS")||T.servers).map(A=>"wss://".concat(A.address.replace(/\./g,"-"),".").concat(x("WORKER_DOMAIN"),":").concat(A.wss))}},void 0,S=>!!(S.code!==L.OPERATION_ABORTED&&S.code!==L.UNEXPECTED_RESPONSE||S.data&&S.data.retry),m)}(c,t,e,n));try{const c=await ql(o);return o.forEach(l=>l.cancel()),c}catch(c){throw c[0]}}async function UZ(t,e,n){let i=null;const o=[],c=async l=>{const u=x(l?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(p=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(p+"/api/v2/transpond/webrtc?v=2"):"https://".concat(p,"/api/v2/transpond/webrtc?v=2"));return l&&(await xn(1e3),i!==null)?i:await Yh({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:u,asyncMapHandler:p=>(R.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(l?"backup":""," choose_server:"),p),function(m,_,E,S){const[T]=PZ(_,[an.CHOOSE_SERVER]);let A=on.networkState;return zs(async()=>{A&&on.networkState===sr.OFFLINE&&on.onlineWaiter&&await gt.race([on.onlineWaiter,xn(S&&S.maxRetryTimeout||pn.maxRetryTimeout)]),A=on.networkState;const I=await Js(m,{data:T,cancelToken:E,headers:{"Content-Type":"multipart/form-data;"}},!0);return DZ(I,m)},()=>!1,I=>I.code!==L.OPERATION_ABORTED&&(I.code===L.UPDATE_TICKET_FAILED?I.data.retry:(R.warning("[".concat(_.clientId,"] update ticket network error, retry"),I),!0)),S)}(p,t,e,n)),allFailedhandler:p=>{throw p[0]},promisesCollector:o})};try{return i=await ql([c(!1),c(!0)]),o.length&&o.forEach(l=>l.cancel&&typeof l.cancel=="function"&&l.cancel()),i}catch(l){throw l[0]}}function qx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function Q0(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?qx(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):qx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class VZ extends Ke{get isSuccess(){return!!this.configs}constructor(e,n){super(),N(this,"configs",void 0),N(this,"store",void 0),N(this,"joinInfo",void 0),N(this,"cancelToken",void 0),N(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),N(this,"interval",void 0),N(this,"mutex",void 0),N(this,"mutableParamsRead",!1),N(this,"configCache",{}),N(this,"limit_bitrate",void 0),this.mutex=new Qn("config-distribute",e),this.store=n}startGetConfigDistribute(e,n){this.joinInfo=e,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),x("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},x("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,bt.reportApiInvoke(null,{options:void 0,name:tn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:We.TRACER}).onSuccess(JSON.stringify(Ks))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void R.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const n=await this.mutex.lock();try{e=await MZ(this.joinInfo,this.cancelToken,this.retryConfig),R.debug("[config-distribute] get config distribute",JSON.stringify(e));const i=function(o){var c;const l=Mc(c=Object.keys(o).filter(m=>/^webrtc_ng_global_parameter/.test(m))).call(c);for(let m=0;m<l.length;m++)for(let _=l.length-1;_>m;_--){const E=l[_],S=o[E].value;if(typeof S.__priority=="number"){const T=S.__priority,A=l[_-1],I=o[A].value;if(typeof I.__priority=="number"){if(!(T>I.__priority))continue;{const w=E;l[_]=l[_-1],l[_-1]=w}}else{const w=E;l[_]=l[_-1],l[_-1]=w}}}const u=Date.now();let p={};return l.forEach(m=>{const _=o[m].value.__expires;_&&_<=u||(p[m]=o[m])}),p}(e);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){const o=new Q(L.NETWORK_RESPONSE_ERROR,i);R.warning("[config-distribute] ".concat(o.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){ox(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(Fh.UPDATE_BITRATE_LIMIT,e):this.emit(Fh.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&Q0({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{const n={},i=Object.keys(e),o=[];i.forEach(c=>{const l=e[c].value;n[c]=l;const u=l.__id;if(u&&this.configCache[c]&&this.configCache[c].__id===u)return;const p=l.__type,m=e[c].value,_=e[c].tag;let E=0;p?p===N1.REALTIME&&(E=1):Object.keys(m).some(S=>Object.prototype.hasOwnProperty.call(t0,S)||!w0()&&Object.prototype.hasOwnProperty.call(E_,S)?(E=1,!0):void 0),o.push({tag:_,isApplied:E,feature:c,params:JSON.stringify(l)})}),o.forEach(c=>{let{tag:l,feature:u,params:p,isApplied:m}=c;this.store.sessionId&&bt.abTest(this.store.sessionId,{intSucc:1,isApplied:m,tag:l,feature:u,params:p,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){R.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(e){const n=function(o){const c={};return Object.keys(o).forEach(l=>{const u=o[l].value,p=u.__expires,m=u.__type;Object.keys(u).forEach(_=>{_==="__id"||_==="__type"||_==="__priority"||_==="__expires"||Object.prototype.hasOwnProperty.call(c,_)||(c[_]=Q0(Q0({value:u[_]},p&&{expires:p}),m&&{type:m}))})}),c}(e);try{var i;const o=(i=n.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete n.LIMIT_BITRATE,o&&ox(o)&&this.handleBitrateLimit(o),this.limit_bitrate=o,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(e),function(u){try{const p=Date.now();Object.keys(u).forEach(m=>{const{value:_,type:E,expires:S}=u[m];S&&S<=p||((E===N1.REALTIME||Object.prototype.hasOwnProperty.call(t0,m))&&(Ks[m]=_,Be[m]=_,R.debug("Update realtime parameters from config distribute",m,_)),E||w0()||!Object.prototype.hasOwnProperty.call(E_,m)||(Ks[m]=_,Be[m]=_,R.debug("Update gateway parameters from config distribute",m,_)))})}catch(p){R.error("Error update config immediately: ".concat(u),p.message)}}(n);const c=JSON.stringify(n),l=window.btoa(c);window.localStorage.setItem("websdk_ng_global_parameter",l),R.debug("Caching global parameters ".concat(c))}catch(o){R.error("Error caching global parameters:",o.message)}}handleGlobalParameterConfig(e){try{const n=Date.now();Object.keys(e).forEach(i=>{if(i==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Be,i)){const{value:o,expires:c}=e[i];if(c&&c<=n)return;(function(l,u){try{return typeof l=="object"&&typeof u=="object"&&JSON.stringify(l)===JSON.stringify(u)}catch{return!1}})(Be[i],o)||(Ks[i]=o,Be[i]=o,this.emit(Fh.UPDATE_CLIENT_ROLE_OPTIONS,o),R.debug("Updating client role options: ".concat(JSON.stringify(o))))}})}catch(n){R.error("Error handling global parameter config:",n.message)}}}class FZ extends Ke{constructor(){super(...arguments),N(this,"resultStorage",new Map)}setLocalAudioStats(e,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(e,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(i)),!n.muted&&this.record("VIDEO_ENCODE_FAILED",e,this.checResolutionSent(i))}setRemoteAudioStats(e,n){const i=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(e,n){const i=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(e,n,i){if(x("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const o=this.resultStorage.get(e);if(!o)return;o.result.push(i);const c=e==="VIDEO_ENCODE_FAILED"?x("ENCODE_EXCEPTION_TIMES"):5;if(o.result.length>=c){var l;const u=pt(l=o.result).call(l,!0);o.isPrevNormal&&!u&&this.emit("exception",Z0[e],e,n),!o.isPrevNormal&&u&&this.emit("exception",Z0[e]+2e3,e+"_RECOVER",n),o.isPrevNormal=u,o.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,n){return n instanceof gn&&!n.isActive||!!n.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=or(n._encoderConfig.frameRate));const o=e.captureFrameRate;return!i||!o||!(i>10&&o<5||i<10&&i>=5&&o<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checResolutionSent(e){var n;return!(!e.codecType||pt(n=x("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(n,e.codecType.toLocaleLowerCase()))||!e.captureFrameRate||e.sendFrameRate!==0||e.sendResolutionWidth!==0||e.sendResolutionHeight!==0}checkSendVideoBitrate(e,n){return!!n.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,n){return n instanceof gn&&!n.isActive||!!n.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}const Z0={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},ei=new class{markSubscribeStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(e))}markPublishStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(e))}measureFromSubscribeStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function Xx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function nd(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Xx(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Xx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class qh{constructor(e){N(this,"store",void 0),N(this,"onStatsException",void 0),N(this,"onUploadPublishDuration",void 0),N(this,"onStatsChanged",void 0),N(this,"onVideoCodecChanged",void 0),N(this,"localStats",new Map),N(this,"remoteStats",new Map),N(this,"updateStatsInterval",void 0),N(this,"trafficStats",void 0),N(this,"trafficStatsPeerList",[]),N(this,"uplinkStats",void 0),N(this,"exceptionMonitor",void 0),N(this,"p2pChannel",void 0),N(this,"scalabilityMode",g_.L1T1),N(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new FZ,this.exceptionMonitor.on("exception",(n,i,o)=>{this.onStatsException&&this.onStatsException(n,i,o)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(st.LocalAudioTrack)||nd({},o0)}getLocalVideoTrackStats(){return this.localStats.get(st.LocalVideoTrack)||nd({},a0)}getRemoteAudioTrackStats(e){const n=(c,l)=>{if(!this.trafficStats)return l;const u=this.trafficStats.peer_delay.find(p=>p.peer_uid===c);return u&&(l.publishDuration=u.B_ppad+(Date.now()-this.trafficStats.timestamp)),l},i={};if(e){var o;const c=(o=this.remoteStats.get(e))===null||o===void 0?void 0:o.audioStats;c&&(i[e]=n(e,c))}else Array.from(this.remoteStats.entries()).forEach(c=>{let[l,{audioStats:u}]=c;u&&(i[l]=n(l,u))});return i}getRemoteNetworkQualityStats(e){const n={};if(e){var i;const o=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.networkStats;o&&(n[e]=o)}else Array.from(this.remoteStats.entries()).forEach(o=>{let[c,{networkStats:l}]=o;l&&(n[c]=l)});return n}getRemoteVideoTrackStats(e){const n=(c,l)=>{if(!this.trafficStats)return l;const u=this.trafficStats.peer_delay.find(p=>p.peer_uid===c);return u&&(l.publishDuration=u.B_ppvd+(Date.now()-this.trafficStats.timestamp)),l},i={};if(e){var o;const c=(o=this.remoteStats.get(e))===null||o===void 0?void 0:o.videoStats;c&&(i[e]=n(e,c))}else Array.from(this.remoteStats.entries()).forEach(c=>{let[l,{videoStats:u}]=c;u&&(i[l]=n(l,u))});return i}getRTCStats(){let e=0,n=0,i=0,o=0;const c=this.localStats.get(st.LocalAudioTrack);c&&(e+=c.sendBytes,n+=c.sendBitrate);const l=this.localStats.get(st.LocalVideoTrack);l&&(e+=l.sendBytes,n+=l.sendBitrate);const u=this.localStats.get(st.LocalVideoLowTrack);u&&(e+=u.sendBytes,n+=u.sendBitrate),this.remoteStats.forEach(m=>{let{audioStats:_,videoStats:E}=m;_&&(i+=_.receiveBytes,o+=_.receiveBitrate),E&&(i+=E.receiveBytes,o+=E.receiveBitrate)});let p=1;return this.trafficStats&&(p+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:p,SendBitrate:n,SendBytes:e,RecvBytes:i,RecvBitrate:o,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),e.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const o=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),c=o!=null&&o.videoSSRC?ei.measureFromSubscribeStart(this.store.clientId,o.videoSSRC):0,l=o!=null&&o.audioSSRC?ei.measureFromSubscribeStart(this.store.clientId,o.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,c>l?c:l),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&R.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,n,i){if(!e)return!1;const o=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,c=!i||n.framesDecodeCount>i.framesDecodeCount;return o||!c}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(n=>{let[i,o]=n;switch(i){case st.LocalVideoTrack:case st.LocalVideoLowTrack:{const u=o,p=nd({},a0),m=e.getStats(),_=e.getLocalMedia(i);if(m){const E=m.videoSend.find(S=>S.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(E){const S=e.getLocalVideoSize(),T=e.getEncoderConfig(st.LocalVideoTrack);var c;(E.codec==="H264"||E.codec==="H265"||E.codec==="VP8"||E.codec==="VP9"||E.codec==="AV1X"||E.codec==="AV1")&&(p.codecType=E.codec,(u==null?void 0:u.codecType)!==E.codec&&((c=this.onVideoCodecChanged)===null||c===void 0||c.call(this,E.codec.toLocaleLowerCase()))),p.sendBytes=E.bytes,p.sendBitrate=u?8*Math.max(0,p.sendBytes-u.sendBytes):0,E.inputFrame?(p.captureFrameRate=E.inputFrame.frameRate,p.captureResolutionHeight=E.inputFrame.height,p.captureResolutionWidth=E.inputFrame.width):S&&(p.captureResolutionWidth=S.width,p.captureResolutionHeight=S.height),E.sentFrame?(p.sendFrameRate=E.sentFrame.frameRate,p.sendResolutionHeight=E.sentFrame.height,p.sendResolutionWidth=E.sentFrame.width):S&&(p.sendResolutionWidth=S.width,p.sendResolutionHeight=S.height),E.avgEncodeMs&&(p.encodeDelay=E.avgEncodeMs),T&&T.bitrateMax?p.targetSendBitrate=1e3*T.bitrateMax:E.targetBitrate&&(p.targetSendBitrate=E.targetBitrate),p.sendPackets=E.packets,p.sendPacketsLost=E.packetsLost,p.sendJitterMs=E.jitterMs,p.sendRttMs=E.rttMs,p.totalDuration=u?u.totalDuration+1:1,p.totalFreezeTime=u?u.totalFreezeTime:0,this.isLocalVideoFreeze(E)&&(p.totalFreezeTime+=1),E.scalabilityMode&&this.scalabilityMode!==E.scalabilityMode&&(R.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(E.scalabilityMode)),this.scalabilityMode=E.scalabilityMode)}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var l;this.localStats.set(i,p),((u==null?void 0:u.sendResolutionWidth)!==p.sendResolutionWidth||(u==null?void 0:u.sendResolutionHeight)!==p.sendResolutionHeight)&&((l=this.onStatsChanged)===null||l===void 0||l.call(this,"resolution",{width:p.sendResolutionWidth,height:p.sendResolutionHeight})),p&&_&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,_.track,p);break}case st.LocalAudioTrack:{const u=o,p=nd({},o0),m=e.getStats(),_=e.getLocalMedia(i);if(m){const E=m.audioSend.find(S=>S.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(E){if(E.codec!=="opus"&&E.codec!=="aac"&&E.codec!=="PCMU"&&E.codec!=="PCMA"&&E.codec!=="G722"||(p.codecType=E.codec),E.inputLevel)p.sendVolumeLevel=Math.round(32767*E.inputLevel);else{const S=e.getLocalAudioVolume();S&&(p.sendVolumeLevel=Math.round(32767*S))}p.sendBytes=E.bytes,p.sendPackets=E.packets,p.sendPacketsLost=E.packetsLost,p.sendJitterMs=E.jitterMs,p.sendRttMs=E.rttMs,p.sendBitrate=u?8*Math.max(0,p.sendBytes-u.sendBytes):0}}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(st.LocalAudioTrack,p),p&&_&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,_.track,p);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(n=>{var i,o;let[c,{videoStats:l,audioStats:u,videoPcStats:p}]=n;const m=u,_=l,E=p,S=nd({},j1),T=nd({},W1),A=nd({},yQ),{audioTrack:I,videoTrack:w,audioSSRC:P,videoSSRC:D}=e.getRemoteMedia(c);let U;U=this.store.useP2P?e.getStats(!0):e.getStats();const G=(i=U)===null||i===void 0?void 0:i.audioRecv.find(tt=>tt.ssrc===P),W=(o=U)===null||o===void 0?void 0:o.videoRecv.find(tt=>tt.ssrc===D),F=this.trafficStats&&this.trafficStats.peer_delay.find(tt=>tt.peer_uid===c);if(G&&(G.codec!=="opus"&&G.codec!=="aac"&&G.codec!=="PCMU"&&G.codec!=="PCMA"&&G.codec!=="G722"||(S.codecType=G.codec),G.outputLevel?S.receiveLevel=Math.round(32767*G.outputLevel):I&&(S.receiveLevel=Math.round(32767*I.getVolumeLevel())),S.receiveBytes=G.bytes,S.receivePackets=G.packets,S.receivePacketsLost=G.packetsLost,S.receivePacketsDiscarded=G.packetsDiscarded,S.packetLossRate=S.receivePacketsLost/(S.receivePackets+S.receivePacketsLost),S.receiveBitrate=m?8*Math.max(0,S.receiveBytes-m.receiveBytes):0,S.totalDuration=m?m.totalDuration+1:1,S.totalFreezeTime=m?m.totalFreezeTime:0,S.freezeRate=S.totalFreezeTime/S.totalDuration,S.receiveDelay=G.jitterBufferMs,S.totalDuration>10&&qh.isRemoteAudioFreeze(I)&&(S.totalFreezeTime+=1)),W){var X;W.codec!=="H264"&&W.codec!=="H265"&&W.codec!=="VP8"&&W.codec!=="VP9"&&W.codec!=="AV1X"&&W.codec!=="AV1"||(T.codecType=W.codec),T.receiveBytes=W.bytes,T.receiveBitrate=_?8*Math.max(0,T.receiveBytes-_.receiveBytes):0,T.decodeFrameRate=W.decodeFrameRate<0?0:W.decodeFrameRate,T.renderFrameRate=W.decodeFrameRate<0?0:W.decodeFrameRate,W.outputFrame&&(T.renderFrameRate=W.outputFrame.frameRate),W.receivedFrame?(T.receiveFrameRate=W.receivedFrame.frameRate,T.receiveResolutionHeight=W.receivedFrame.height,T.receiveResolutionWidth=W.receivedFrame.width):w&&(T.receiveResolutionHeight=w._videoHeight||0,T.receiveResolutionWidth=w._videoWidth||0),W.framesRateFirefox!==void 0&&(T.receiveFrameRate=Math.round(W.framesRateFirefox)),T.receivePackets=W.packets,T.receivePacketsLost=W.packetsLost,T.packetLossRate=T.receivePacketsLost/(T.receivePackets+T.receivePacketsLost);const tt=_?_.totalFreezeTime:0,nt=_?_.totalDuration:0;T.totalDuration=_?_.totalDuration+1:1,T.totalFreezeTime=(X=W.totalFreezesDuration)!==null&&X!==void 0?X:tt||0,T.receiveDelay=W.jitterBufferMs||0;const at=!!D&&e.getRemoteVideoIsReady(D);W.totalFreezesDuration===void 0&&w&&at&&qh.isRemoteVideoFreeze(w,W,E)&&(T.totalFreezeTime+=1),T.freezeRate=Math.max(0,Math.min((T.totalFreezeTime-tt)/(T.totalDuration-nt),1))}F&&(S.end2EndDelay=F.B_ad,T.end2EndDelay=F.B_vd,S.transportDelay=F.B_ed,T.transportDelay=F.B_ed,S.currentPacketLossRate=F.B_ealr4/100,T.currentPacketLossRate=F.B_evlr4/100,A.uplinkNetworkQuality=F.B_punq?F.B_punq:0,A.downlinkNetworkQuality=F.B_pdnq?F.B_pdnq:0),this.remoteStats.set(c,{audioStats:S,videoStats:T,videoPcStats:W,networkStats:A}),I&&this.exceptionMonitor.setRemoteAudioStats(I,S),w&&this.exceptionMonitor.setRemoteVideoStats(w,T)})}}class Jx{constructor(){N(this,"destChannelMediaInfos",new Map),N(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){rx(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){rx(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){U_(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function Qx(t){if(!(t instanceof Jx))return new Q(L.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=t.getSrcChannelMediaInfo(),n=t.getDestChannelMediaInfo();if(!e)return new Q(L.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new Q(L.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Ka{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,n){N(this,"uid",void 0),N(this,"_uintid",void 0),N(this,"_trust_in_room_",!0),N(this,"_trust_audio_enabled_state_",!0),N(this,"_trust_video_enabled_state_",!0),N(this,"_trust_audio_mute_state_",!0),N(this,"_trust_video_mute_state_",!0),N(this,"_audio_muted_",!1),N(this,"_video_muted_",!1),N(this,"_audio_enabled_",!0),N(this,"_video_enabled_",!0),N(this,"_audio_added_",!1),N(this,"_video_added_",!1),N(this,"_is_pre_created",!1),N(this,"_video_pre_subscribed",!1),N(this,"_audio_pre_subscribed",!1),N(this,"_trust_video_stream_added_state_",!0),N(this,"_trust_audio_stream_added_state_",!0),N(this,"_audioTrack",void 0),N(this,"_videoTrack",void 0),N(this,"_dataChannels",[]),N(this,"_audioSSRC",void 0),N(this,"_videoSSRC",void 0),N(this,"_audioOrtc",void 0),N(this,"_videoOrtc",void 0),N(this,"_cname",void 0),N(this,"_rtxSsrcId",void 0),N(this,"_videoMid",void 0),N(this,"_audioMid",void 0),this.uid=e,this._uintid=n}}function Zx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function $0(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Zx(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Zx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const Z_="9",tR=2e4,$_=4e4;function $x(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function ta(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?$x(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$x(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var Xl=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(Xl||{});const tg=new Map;function t2(t,e,n,i){let{scale:o}=t;if(o===0&&i===Xl.UP||o>=e.length-1&&i===Xl.DOWN)return t;let c=ta(ta({},t),{},{scale:i===Xl.DOWN?++o:--o});switch(n){case"maintain-framerate":c=ta(ta({},c),e[o].motion);break;case"maintain-resolution":c=ta(ta({},c),e[o].detail);break;case"balanced":c=ta(ta({},c),e[o].balanced)}return c}function e2(t,e){if(e){const n={overUse:0,underUse:0,adaptationList:n2(e)};tg.set(t,n)}else tg.delete(t)}function n2(t){const e=ta({},t),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:o,bitrateMin:c}=e,{MIN_FRAME_RATE:l,MAX_THRESHOLD_FRAMERATE:u,MAX_SCALE:p,BITRATE_MIN_THRESHOLD:m,BITRATE_MAX_THRESHOLD:_,BWE_SCALE_UP_THRESHOLD:E,BWE_SCALE_DOWN_THRESHOLD:S,PERF_SCALE_DOWN_THRESHOLD:T,PERF_SCALE_UP_THRESHOLD:A,BALANCE_BITRATE_FACTOR:I,BALANCE_FRAMERATE_FACTOR:w,BALANCE_RESOLUTION_FACTOR:P,MOTION_RESOLUTION_FACTOR:D,MOTION_BITRATE_FACTOR:U,DETAIL_FRAMERATE_FACTOR:G,DETAIL_BITRATE_FACTOR:W}=Zy,F=Math.min(e.frameRate,u),X=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(S,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(T,1)*F),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:c},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:c},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:c}}];for(let tt=1;tt<=p;tt++){const nt={bwe_up:Math.round(Math.pow(E,tt)*n),bwe_down:Math.round(Math.pow(S,tt+1)*n),fps_up:Math.round(Math.pow(A,tt)*F),fps_down:Math.round(Math.pow(T,tt+1)*F)},at={scaleResolutionDownBy:o/Math.pow(P,tt),frameRate:Math.max(Math.round(Math.pow(w,tt)*i),l),bitrateMax:Math.max(Math.round(Math.pow(I,tt)*n),_),bitrateMin:Math.max(Math.round(Math.pow(I,tt)*c),m)},Kt={scaleResolutionDownBy:o/Math.pow(D,tt),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(U,tt)*n),_),bitrateMin:Math.max(Math.round(Math.pow(U,tt)*c),m)},Xt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(G,tt)*i),l),bitrateMax:Math.max(Math.round(Math.pow(W,tt)*n),_),bitrateMin:Math.max(Math.round(Math.pow(W,tt)*c),m)};X.push({scale:tt,threshold:nt,balanced:at,motion:Kt,detail:Xt})}return X}function BZ(t,e,n,i,o,c){const l=tg.get(t)||{overUse:0,underUse:0,adaptationList:n2(o)},{adaptationList:u}=l;tg.set(t,l);const{OVERUSE_TIMES_THRESHOLD:p,UNDERUSE_TIMES_THRESHOLD:m}=Zy,{scale:_}=i;let E,S;return typeof e=="number"&&e>0&&function(T,A,I,w){if(A>=I.length)return!1;let{threshold:{fps_down:P}}=I[A];return x("FORCE_AG_HIGH_FRAMERATE")&&w==="maintain-framerate"&&(P=I[0].threshold.fps_down),T<P}(e,_,u,c)&&(l.overUse++,S=Dh.CPU,l.overUse>p)||typeof n=="number"&&n>0&&function(T,A,I){if(A>=I.length)return!1;const{threshold:{bwe_down:w}}=I[A];return T<w}(n,_,u)&&(l.overUse++,S=Dh.BANDWIDTH,l.overUse>p)?(l.overUse=0,l.underUse=0,E=t2(i,u,c,Xl.DOWN),[E,S]):(typeof e=="number"&&e>0&&typeof n=="number"&&n>0&&function(T,A,I,w){if(A===0)return;let{threshold:{fps_up:P}}=I[A];return x("FORCE_AG_HIGH_FRAMERATE")&&w==="maintain-framerate"&&(P=I[1].threshold.fps_up),T>P}(e,_,u,c)&&function(T,A,I){if(A===0)return;const{threshold:{bwe_up:w}}=I[A];return T>w}(n,_,u)&&(l.underUse++,l.underUse>m&&(l.overUse=0,l.underUse=0,E=t2(i,u,c,Xl.UP),E.scale===0&&(S=Dh.NONE))),[E,S])}function i2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function eR(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?i2(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const eg=new Map;function ng(t,e){const n=eg.get(t);if(n){const{timer:i}=n;window.clearTimeout(i),eg.delete(t)}e.qualityLimitationReason=Dh.NONE,e2(t)}function jZ(t,e){var n;let i;switch(e){case st.LocalAudioTrack:i=Ee.Audio;break;case st.LocalVideoTrack:i=pt(n=t._hints).call(n,Ie.SCREEN_TRACK)?Ee.Screen:Ee.High;break;case st.LocalVideoLowTrack:i=Ee.Low}return i}function nR(t){const e=ae();if(t.some(n=>n._bypassWebAudio))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function iR(t,e){nR(t);const n=e||new gn;return t.forEach(i=>n.addAudioTrack(i)),n}const WZ=!ae().supportUnifiedPlan||x("CHROME_FORCE_PLAN_B")&&Xo();function ig(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return WZ?(n={spec:e,store:t},$o("PlanBConnection").create(n)):new Wr(e,t)}function rR(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function r2(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(Ah(t.turnServer.servers))return!1;if(x("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch{return!1}}var re;function s2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function Qs(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?s2(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let Wr=(re=class Rd extends cx{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return pt(n=Object.keys(kh)).call(n,e)}))]}constructor(e,n){super(e,n),N(this,"id",Ae(5,"connection-")),N(this,"store",void 0),N(this,"peerConnection",void 0),N(this,"forceTurn",!1),N(this,"remoteSDP",void 0),N(this,"initialOffer",void 0),N(this,"transportEventReceiver",void 0),N(this,"statsFilter",void 0),N(this,"extension",{useXR:x("USE_XR")}),N(this,"localCapabilities",void 0),N(this,"remoteCodecs",void 0),N(this,"localCandidateCount",0),N(this,"allCandidatesReceived",!1),N(this,"isPreallocation",!1),N(this,"preMediaMap",new Map),N(this,"dataStreamChannelMap",new Map),N(this,"establishPromise",void 0),N(this,"recoveredDataChannelIds",[]),N(this,"currentDataChannelId",1),N(this,"supportAV1RtpSpec",!1),N(this,"mutex",void 0),N(this,"qualityLimitationReason",Dh.NONE),N(this,"isFirstConnected",!1),this.store=n,this.forceTurn=r2(e),this.mutex=new Qn("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Rd.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=Xy(this.peerConnection,x("STATS_UPDATE_INTERVAL"),void 0,qe()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,e.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(e){return this.preMediaMap.get(e)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(e,n){if(this.remoteCodecs=n,!this.remoteSDP)return void R.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(e,n,this.store.codec)){const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const c=this.remoteSDP.toString();o==null||o(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}else R.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const o=Wa(i.sdp),c=await wx({filterRTX:!x("USE_PUB_RTX")&&!x("USE_SUB_RTX"),filterVideoFec:x("FILTER_VIDEO_FEC"),filterAudioFec:x("FILTER_AUDIO_FEC"),filterVideoCodec:x("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:x("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:x("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=Y_(c),this.initialOffer=i,x("ENABLE_SVC")&&this.store.codec=="av1"){const u=await async function(){try{const p=new RTCPeerConnection;p.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:g_.L1T3}]});const m=await p.createOffer();if(!m.sdp)return void p.close();const _=Wi(m.sdp).mediaDescriptions[0];if(!_)return;const E=_.attributes.extmaps.find(S=>S.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return p.close(),E}catch{return}}();var e;u&&(this.supportAV1RtpSpec=!0,(e=c.send)===null||e===void 0||e.videoExtensions.push(u))}let l;return i.sdp&&Dx(i.sdp)&&(l=Ge(c),(n=l).send&&(Hl(St.VIDEO,n.send.videoExtensions),Hl(St.AUDIO,n.send.audioExtensions)),n.recv&&(Hl(St.VIDEO,n.recv.videoExtensions),Hl(St.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(Hl(St.VIDEO,n.sendrecv.videoExtensions),Hl(St.AUDIO,n.sendrecv.audioExtensions))),Qs(Qs({},o),{},{rtpCapabilities:l||c,offerSDP:i.sdp})}catch(i){throw new $(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}var n}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&Dx(this.initialOffer.sdp)&&(n=e.rtpCapabilities,i=this.localCapabilities,n.send&&(H_(St.VIDEO,n.send.videoExtensions,i.send.videoExtensions),H_(St.AUDIO,n.send.audioExtensions,i.send.audioExtensions)),n.recv&&(H_(St.VIDEO,n.recv.videoExtensions,i.recv.videoExtensions),H_(St.AUDIO,n.recv.audioExtensions,i.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Ge(this._localCapabilities)}get rtpCapabilities(){return Ge(this._rtpCapabilities)}get candidates(){return Ge(this._candidates)}get iceParameters(){return Ge(this._iceParameters)}get dtlsParameters(){return Ge(this._dtlsParameters)}constructor(p){let m=arguments.length>1&&arguments[1]!==void 0&&arguments[1],_=arguments.length>2&&arguments[2]!==void 0&&arguments[2];N(this,"sessionDesc",void 0),N(this,"_localCapabilities",void 0),N(this,"_rtpCapabilities",void 0),N(this,"_candidates",void 0),N(this,"_originCandidates",void 0),N(this,"_iceParameters",void 0),N(this,"_isUseExtmapAllowMixed",void 0),N(this,"_isUseLocalCodecs",void 0),N(this,"_dtlsParameters",void 0),N(this,"setup",void 0),N(this,"currentMidIndex",void 0),N(this,"cname",void 0),N(this,"useLocalCodecsMids",[]),N(this,"preloadSsrcs",[]),N(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=m,this._isUseLocalCodecs=_,p=Ge(p);const{iceParameters:E,dtlsParameters:S,candidates:T,rtpCapabilities:A,setup:I,localCapabilities:w,cname:P}=p;this._rtpCapabilities=A,this._candidates=T,this._originCandidates=Ge(T),this._iceParameters=E,this._dtlsParameters=S,this._localCapabilities=w,this.setup=I,this.cname=P,[this.sessionDesc]=this.updateRemoteRTPCapabilities(A),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(p){return p.length===this.preloadSsrcs.length&&p.every(m=>{var _;return pt(_=this.preloadSsrcs).call(_,m)})}preloadRemoteMedia(p){let m=0;const _=[],E=[];for(;p>0;){const S=[$0({ssrcId:$_+m},x("USE_SUB_RTX")?{rtx:$_+m+1}:{})],T="".concat($_+m,"_").concat(tR+m),{ssrcs:A,ssrcGroups:I}=Hh(S,this.cname,x("SYNC_GROUP")?T:void 0),w=this.preCreateOrRecycleSendMedia("video",A,I,void 0),P=[{ssrcId:tR+m}],D="".concat($_+m,"_").concat(tR+m),{ssrcs:U,ssrcGroups:G}=Hh(P,this.cname,x("SYNC_GROUP")?D:void 0),W=this.preCreateOrRecycleSendMedia("audio",U,G,void 0);p--,m+=2,_.push(w,W),E.push(A[0].ssrcId,U[0].ssrcId)}return this.useLocalCodecsMids.push(..._),this.preloadSsrcs=E,{mids:_,preSSRCs:E,isAvailable:!0}}preCreateOrRecycleSendMedia(p,m,_,E){const S=this.rtpCapabilities.send.videoCodecs,T=this._isUseLocalCodecs||S.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;R.debug("create or recycle send media without remote rtp capabilities, ssrcs ",m[0].ssrcId);const A=p===St.VIDEO?T.videoCodecs:T.audioCodecs,I=p===St.VIDEO?T.videoExtensions:T.audioExtensions;this.currentMidIndex+=1;const w="".concat(this.currentMidIndex);let P={media:{mediaType:p,port:Z_,protos:["UDP","TLS","RTP","SAVPF"],fmts:A.map(D=>D.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:I,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:m,ssrcGroups:_,rtcpFeedbackWildcards:[],payloads:A,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(w)}};return P=this.mungSendMediaDesc(P,E),this.sessionDesc.mediaDescriptions.push(P),this.updateBundleMids(),w}toString(){return xa(this.sessionDesc)}send(p,m,_,E){const{ssrcs:S,ssrcGroups:T}=Hh(m,this.cname,x("SYNC_GROUP")?_:void 0),A=this.findPreloadMediaDesc(S);if(A){if(qe()&&this.firefoxSsrcMidMap.set(S[0].ssrcId,A.attributes.mid),E&&(E.twcc||E.remb)){const I=this.sessionDesc.mediaDescriptions.indexOf(A);return this.sessionDesc.mediaDescriptions[I]=this.mungSendMediaDesc(A,E),{mid:A.attributes.mid,needExchangeSDP:!0}}return{mid:A.attributes.mid,needExchangeSDP:!1}}{const I=this.findAvailableMediaIndex(p,S);let w;return I===-1||I===1&&(Hn()||function(){const P=ie();return!(P.name!==ue.CHROME||!P.osVersion)&&Number(P.version)<=90}()||x("ENABLE_ENCODED_TRANSFORM")&&qo())||I===0&&!function(P){const D=ie();return!(D.name!==ue.FIREFOX||!D.osVersion)&&Number(D.version)===P}(138)&&x("USE_SUB_RTX")||t1()?(w=this.createOrRecycleSendMedia(p,S,T,"sendonly",E),this.updateBundleMids()):(w=Ge(this.sessionDesc.mediaDescriptions[I]),w.attributes.direction="sendonly",w.attributes.ssrcs=S,w.attributes.ssrcGroups=T,this.sessionDesc.mediaDescriptions[I]=this.mungSendMediaDesc(w,E)),qe()&&this.firefoxSsrcMidMap.set(S[0].ssrcId,w.attributes.mid),{mid:w.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:p,needExchangeSDP:m}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:p.attributes.mid,needExchangeSDP:m}}batchSend(p){const m=p.map(S=>{let{kind:T,ssrcMsg:A,mslabel:I}=S;return this.send(T,A,I)}),_=[];let E=!1;return m.forEach(S=>{let{mid:T,needExchangeSDP:A}=S;A&&(E=!0),_.push(T)}),{mids:_,needExchangeSDP:E}}stopSending(p){const m=this.sessionDesc.mediaDescriptions.filter(_=>_.attributes.mid&&p.indexOf(_.attributes.mid)!==-1);if(m.length!==p.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");m.forEach(_=>{_.attributes.mid==="0"||qe()||t1()?_.attributes.ssrcs=[]:(_.attributes.ssrcs=[],_.attributes.direction="inactive",_.media.port="0")}),this.updateBundleMids()}mute(p){const m=this.sessionDesc.mediaDescriptions.find(_=>_.attributes.mid===p);if(!m)throw new Error("mediaDescription not found with ".concat(p," in remote SDP when calling RemoteSDP.mute."));m.attributes.direction="inactive"}unmute(p){const m=this.sessionDesc.mediaDescriptions.find(_=>_.attributes.mid===p);if(!m)throw new Error("mediaDescription not found with ".concat(p," in remote SDP when calling RemoteSDP.unmute."));m.attributes.direction="sendonly"}muteRemote(p){const m=this.sessionDesc.mediaDescriptions.filter(_=>pt(p).call(p,_.attributes.mid||""));if(m.length!==p.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");m.forEach(_=>{_.attributes.direction="inactive"})}unmuteRemote(p){const m=this.sessionDesc.mediaDescriptions.filter(_=>pt(p).call(p,_.attributes.mid||""));if(m.length!==p.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");m.forEach(_=>{_.attributes.direction="recvonly"})}receive(p,m,_,E){p.forEach((S,T)=>{this.createOrRecycleRecvMedia(S,[],"recvonly",m,_,E[T])}),this.updateBundleMids()}stopReceiving(p){const m=this.sessionDesc.mediaDescriptions.filter(_=>p.indexOf(_.attributes.mid)!==-1);if(m.length!==p.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");m.forEach(_=>{_.media.port="0",_.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(p){const m=this.sessionDesc||Wi((_=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(_?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var _;this._rtpCapabilities=p;let E=!1;const S=this.rtpCapabilities.send,T=this.localCapabilities.send,A=this.localCapabilities.recv,I=A.videoCodecs,w=A.audioCodecs,P=A.videoExtensions,D=A.audioExtensions;for(const F of m.mediaDescriptions){var U;if(F.attributes.direction!=="sendonly"||typeof F.attributes.mid!="string"||!pt(U=this.useLocalCodecsMids).call(U,F.attributes.mid)){if(E=!0,F.attributes.iceUfrag=this._iceParameters.iceUfrag,F.attributes.icePwd=this._iceParameters.icePwd,F.attributes.fingerprints=this._dtlsParameters.fingerprints,F.attributes.candidates=this._candidates,F.attributes.setup=this.setup,F.media.mediaType==="application"&&(F.attributes.sctpPort="5000"),F.media.mediaType==="video")if(this._isUseLocalCodecs&&F.attributes.direction==="sendonly"){var G;F.media.fmts=I.map(tt=>tt.payloadType.toString(10)),F.attributes.payloads=I,F.attributes.extmaps=P;const X=F.attributes.mid;typeof X!="string"||pt(G=this.useLocalCodecsMids).call(G,X)||this.useLocalCodecsMids.push(X)}else if(S.videoCodecs.length===0){const X=T.videoCodecs.filter(tt=>{var nt,at;return(nt=tt.rtpMap)===null||nt===void 0?void 0:pt(at=nt.encodingName.toLowerCase()).call(at,"vp8")})||[T.videoCodecs[0]];F.media.fmts=X.map(tt=>tt.payloadType.toString(10)),F.attributes.payloads=X,F.attributes.extmaps=[]}else F.media.fmts=S.videoCodecs.map(X=>X.payloadType.toString(10)),F.attributes.payloads=S.videoCodecs,F.attributes.extmaps=S.videoExtensions;if(F.media.mediaType==="audio")if(this._isUseLocalCodecs&&F.attributes.direction==="sendonly"){var W;F.media.fmts=w.map(tt=>tt.payloadType.toString(10)),F.attributes.payloads=w,F.attributes.extmaps=D;const X=F.attributes.mid;typeof X!="string"||pt(W=this.useLocalCodecsMids).call(W,X)||this.useLocalCodecsMids.push(X)}else if(S.audioCodecs.length===0){const X=T.audioCodecs.filter(tt=>{var nt,at;return(nt=tt.rtpMap)===null||nt===void 0?void 0:pt(at=nt.encodingName.toLowerCase()).call(at,"opus")})||[T.audioCodecs[0]];F.media.fmts=X.map(tt=>tt.payloadType.toString(10)),F.attributes.payloads=X,F.attributes.extmaps=[]}else F.media.fmts=S.audioCodecs.map(X=>X.payloadType.toString(10)),F.attributes.payloads=S.audioCodecs,F.attributes.extmaps=S.audioExtensions,Kl(F)}}return this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1,[this.sessionDesc,E]}updateCandidates(p){const m=this._originCandidates.filter(E=>E.transport==="udp"),_=[];if(m.forEach(E=>{_.push($0($0({},E),{},{foundation:"tcpcandidate",priority:Number(E.priority)-1+"",transport:"tcp",port:Number(E.port)+90+""}))}),m.length!==0){switch(p){case ti.TCP_RELAY:this._candidates=_;break;case ti.UDP_TCP_RELAY:case ti.RELAY:this._candidates=[...m,..._];break;default:this._candidates=m}for(const E of this.sessionDesc.mediaDescriptions)E.attributes.candidates=this.candidates}}restartICE(p){p=Ge(p),this._iceParameters=p,this.sessionDesc.mediaDescriptions.forEach(m=>{m.attributes.iceUfrag=p.iceUfrag,m.attributes.icePwd=p.icePwd})}predictReceivingMids(p){const m=[];for(let _=0;_<p;_++)m.push((this.currentMidIndex+_+1).toString(10));return m}findAvailableMediaIndex(p,m){return this.sessionDesc.mediaDescriptions.findIndex(_=>{const E=_.media.mediaType===p&&_.media.port!=="0"&&(_.attributes.direction==="sendonly"||_.attributes.direction==="sendrecv")&&_.attributes.ssrcs.length===0;if(qe()){if(E){const S=this.firefoxSsrcMidMap.get(m[0].ssrcId);return!(S||_.attributes.mid!=="0"&&_.attributes.mid!=="1")||!(!S||S!==_.attributes.mid)}return!1}return E})}createOrRecycleDataChannel(){for(const _ of this.sessionDesc.mediaDescriptions)if(_.media.mediaType==="application")return{mediaDesc:_,needExchangeSDP:!1};this.currentMidIndex+=1;const p="".concat(this.currentMidIndex),m={media:{mediaType:"application",port:Z_,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(p),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(m),{mediaDesc:m,needExchangeSDP:!0}}createOrRecycleRecvMedia(p,m,_,E,S,T){const A=p._mediaStreamTrack.kind,I=this.rtpCapabilities.recv,w=zh(A,I,this.localCapabilities.send,A===St.VIDEO?E:S),P=A===St.VIDEO?I.videoExtensions:I.audioExtensions;this.currentMidIndex+=1;const D="".concat(this.currentMidIndex);let U={media:{mediaType:A,port:Z_,protos:["UDP","TLS","RTP","SAVPF"],fmts:w.map(W=>W.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:P,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:m,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:w,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:_,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(D)}};U=this.mungRecvMediaDsec(U,p,T);const G=this.findFirstClosedMedia(A);if(G){const W=this.sessionDesc.mediaDescriptions.indexOf(G);this.sessionDesc.mediaDescriptions[W]=U}else this.sessionDesc.mediaDescriptions.push(U);return U}updateRemoteDtlsParameters(p){const m=new Set(this._dtlsParameters.fingerprints.map(S=>S.fingerprint)),_=new Set(p.map(S=>S.fingerprint));let E=!1;m.size!==_.size&&(E=!0);for(const S of m)_.has(S)||(E=!0);return E}updateRemoteCodec(p,m,_){const E=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(U=>U.rtpMap&&U.rtpMap.encodingName.toLowerCase()||"").filter(U=>{var G;return pt(G=Object.keys(kh)).call(G,U)}))],S=new Set(m);if(E.every(U=>S.has(U)))return R.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(m)),!1;const T=this._rtpCapabilities.recv.videoCodecs.filter(U=>m.some(G=>{var W;return pt(W=U.rtpMap&&U.rtpMap.encodingName.toLowerCase()||"").call(W,G)}));if(T.length===0)return R.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(E," codecs: ").concat(m)),!1;const A=[...new Set(T.map(U=>U.rtpMap&&U.rtpMap.encodingName.toLowerCase()||""))];let I;if(R.debug("updateRemoteCodec, from ".concat(E," to ").concat(A)),p.length===0)I=this.sessionDesc.mediaDescriptions.filter(U=>U.media.mediaType==="video"&&U.attributes.direction==="recvonly");else if(I=this.sessionDesc.mediaDescriptions.filter(U=>U.attributes.mid&&U.media.mediaType==="video"&&pt(p).call(p,U.attributes.mid)&&U.attributes.direction==="recvonly"),I.length!==p.length)return R.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(p,", codecs: ").concat(m)),!1;if(x("USE_PUB_RTX")||x("USE_SUB_RTX")){const U=Ga(T,this.rtpCapabilities.recv.videoCodecs);T.push(...U)}this._rtpCapabilities.recv.videoCodecs=T;const w=this.localCapabilities.send,P=this.rtpCapabilities.recv,D=zh(St.VIDEO,P,w,_);return I.forEach(U=>{const G=D.map(W=>W.payloadType.toString(10));R.debug("updateRemoteCodec mid: ".concat(U.attributes.mid,", from"),U.attributes.payloads,"to",D),U.attributes.payloads=D,U.media.fmts=G}),!0}createOrRecycleSendMedia(p,m,_,E,S){const T=this.rtpCapabilities.send.videoCodecs,A=this._isUseLocalCodecs||T.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,I=p===St.VIDEO?A.videoCodecs:A.audioCodecs,w=p===St.VIDEO?A.videoExtensions:A.audioExtensions;this.currentMidIndex+=1;const P="".concat(this.currentMidIndex);let D={media:{mediaType:p,port:Z_,protos:["UDP","TLS","RTP","SAVPF"],fmts:I.map(G=>G.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:w,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:m,ssrcGroups:_,rtcpFeedbackWildcards:[],payloads:I,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:E,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(P)}};D=this.mungSendMediaDesc(D,S);const U=this.findFirstClosedMedia(p);if(U){const G=this.sessionDesc.mediaDescriptions.indexOf(U);this.sessionDesc.mediaDescriptions[G]=D}else this.sessionDesc.mediaDescriptions.push(D);return D}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(p=>p.media.port!=="0").map(p=>p.attributes.mid)}mungRecvMediaDsec(p,m,_){const E=Ge(p);return B0(E),zl(E,m),j0(E,m),bx(E),K_(E,_,this.localCapabilities.send),E}mungSendMediaDesc(p,m){const _=Ge(p);return K_(_,m,this.localCapabilities.recv),Kl(_),_}updateRecvMedia(p,m){const _=this.sessionDesc.mediaDescriptions.findIndex(E=>E.attributes.mid===p);if(_!==-1){const E=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[_],m);this.sessionDesc.mediaDescriptions[_]=E}}bumpMid(p){this.currentMidIndex+=p}findFirstClosedMedia(p){return this.sessionDesc.mediaDescriptions.find(m=>qe()?m.media.port==="0"&&m.media.mediaType===p:m.media.port==="0")}findPreloadMediaDesc(p){return this.sessionDesc.mediaDescriptions.find(m=>{var _;return((_=m.attributes)===null||_===void 0||(_=_.ssrcs[0])===null||_===void 0?void 0:_.ssrcId)===p[0].ssrcId})}getSSRC(p){var m;return(m=this.sessionDesc.mediaDescriptions.find(_=>_.attributes.mid===p))===null||m===void 0?void 0:m.attributes.ssrcs}}(Qs(Qs({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!x("ENABLE_PRE_SUB_WITH_PRE_PC")||!x("PRE_USE_LOCAL_CODECS"))&&i0(this.store)),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const o=this.remoteSDP.toString(),c=Ox(this.initialOffer.sdp,this.extension),l=this.logSDPExchange(c||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),l==null||l(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o});const u=this.peerConnection.getTransceivers()[0];if(u!=null&&u.receiver&&this.tryBindTransportEvents(u.receiver),i0(this.store))if(e.preallocation&&x("ENABLE_PRE_SUB_WITH_PRE_PC")){const p=x("PRE_SUB_NUM"),{mids:m,preSSRCs:_}=this.remoteSDP.preloadRemoteMedia(p);await Ha(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(_)),this.presetMedia(m,_)}else{const{preSSRCs:p=[]}=e,m=p.map(E=>E.ssrcMsg[0].ssrcId);if(p.length===0)return;const{mids:_}=this.remoteSDP.batchSend(p.map(E=>Object.assign({},E)));await Ha(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(m)),this.presetMedia(_,m)}}catch(o){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(o.toString()))}var n,i}presetMedia(e,n){e.forEach((i,o)=>{this.peerConnection.getTransceivers().forEach(c=>{if(c.mid!=null&&i===c.mid&&c.receiver.track){const l=c.receiver.track;let u;l.kind==="video"&&x("ENABLE_PRE_RENDER")&&(u=new _0({trackId:"track-".concat(l.kind,"-unknown-").concat(this.store.clientId,"_").concat(Ae(5,""))},!0),u.updateVideoTrack(l),u.onFirstVideoFrameRender=()=>{var p;const m=this.preMediaMap.get(n[o]);m&&(m.firstVideoRender=Date.now()),(p=this.onFirstVideoRender)===null||p===void 0||p.call(this,n[o])},u.play(this.store.sessionId||void 0)),this.preMediaMap.set(n[o],{mid:i,track:l,player:u,transceiver:c})}}),this.store.peerReceiver()})}checkDtlsParameters(e){return!!this.remoteSDP&&e.length>0&&this.remoteSDP.updateRemoteDtlsParameters(e)}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:i}=e;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const l=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||l}const{preSSRCs:o=[]}=e,c=o.map(l=>l.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(c)){const l=[],u=[];if(Array.from(this.preMediaMap.entries()).every(p=>{let[m,{mid:_,player:E,track:S}]=p;return l.push(_),u.push(m),this.preMediaMap.delete(m),E&&E.destroy(),!0}),l.length>0&&(this.remoteSDP.stopSending(l),await Ha(this.peerConnection,this.remoteSDP,this.extension),R.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(u)),bt.reportApiInvoke(this.store.sessionId,{name:tn.PRELOAD_MEDIA_FAILED,options:[o,u],tag:We.TRACER}).onSuccess()),o.length>0){const{mids:p}=this.remoteSDP.batchSend(o.map(m=>Object.assign({},m)));await Ha(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(c)),this.presetMedia(p,c)}}n?(await Ha(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):R.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(e,n,i){var o=this;return xr(function*(){const c=yield oe(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=[],u=G_();e.forEach(w=>{const P=o.peerConnection.addTransceiver(w._mediaStreamTrack,Qs({direction:"sendonly"},w.trackMediaType==="video"&&o.supportAV1RtpSpec&&u?{sendEncodings:[{scalabilityMode:u}]}:{}));l.push(P),w._updateRtpTransceiver(P)}),qe()&&x("SIMULCAST")===!0&&(yield oe(o.applySimulcastForFirefox(l,e)));const p=yield oe(o.peerConnection.createOffer()),m=o.remoteSDP.predictReceivingMids(e.length),_=o.mungSendOfferSDP(p.sdp,e,m),E=Wi(_),S=m.map(w=>{const P=E.mediaDescriptions.find(D=>D.attributes.mid===w);if(!P)throw new Error("Cannot extract ssrc from mediaDescription.");return yx(P,x("USE_PUB_RTX"))});let T;try{T=yield S}catch(w){T=[],o.remoteSDP.receive(e,n,i,T);const P=o.remoteSDP.toString();throw yield oe(o.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield oe(o.peerConnection.setRemoteDescription({type:"answer",sdp:P})),yield oe(o.stopSending(m,!0)),w}o.remoteSDP.receive(e,n,i,T);const A=o.remoteSDP.toString(),I=o.logSDPExchange(_,"offer","local","send");return yield oe(o.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield oe(o.applySimulcastEncodings(l,e)),yield oe(o.applySendEncodings(l,e)),I==null||I(A),yield oe(o.peerConnection.setRemoteDescription({type:"answer",sdp:A})),l.map((w,P)=>{const D=m[P];return{localSSRC:S[P],id:D,transceiver:w}})}catch(l){throw l instanceof $?l:new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{c()}})()}async createDataChannels(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(e);if(i&&i.readyState==="open")R.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const c=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof c!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:c,negotiated:!0,ordered:!1,maxRetransmits:x("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,i)}n.forEach(c=>{c._updateOriginDataChannel(i)});const{needExchangeSDP:o}=this.remoteSDP.sendDataChannel();if(o){const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:c});const l=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(l),R.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else R.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof $?i:new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(e){try{const n=this.dataStreamChannelMap.get(e);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(e)}catch(n){throw n instanceof $?n:new $(L.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(p=>e.indexOf(p.mid)!==-1);if(o.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");o.map(p=>{var m;ng(this.id+p.mid,this),p.direction="inactive",(m=p.stop)===null||m===void 0||m.call(p)});const c=await this.peerConnection.createOffer(),l=this.logSDPExchange(c.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(e);const u=this.remoteSDP.toString();l==null||l(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{i&&i()}}async receive(e,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:c,needExchangeSDP:l}=this.remoteSDP.send(e,n,i,o);l&&(await Ha(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const u=this.peerConnection.getTransceivers().find(p=>p.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}}catch(c){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(e);return i&&(await Ha(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(o=>{const c=this.peerConnection.getTransceivers().find(l=>l.mid===o);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:o,transceiver:c}})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(c=>{Array.from(this.preMediaMap.entries()).some(l=>{let[u,{mid:p,player:m}]=l;if(p===c)return this.preMediaMap.delete(u),m&&m.destroy(),!0})}),this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(l=>l.mid&&e.indexOf(l.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(l=>{l.direction="inactive"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const c=this.remoteSDP.toString();o==null||o(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(l=>l.mid&&e.indexOf(l.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(l,u)=>{l.direction="sendonly"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString();o==null||o(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return xr(function*(){const i=yield oe(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const o=ae().supportPCSetConfiguration,c=x("FORCE_TURN_TCP")||n.forceTurn;if(e===ti.RELAY&&!o)return;if(o&&!c){const E=e===ti.RELAY?"relay":"all",S=n.peerConnection.getConfiguration();S.iceTransportPolicy!==E&&(R.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(S.iceTransportPolicy,"] to [").concat(E,"]")),S.iceTransportPolicy=E,n.peerConnection.setConfiguration(S))}n.remoteSDP.updateCandidates(e);const l=yield oe(n.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const u=Wa(l.sdp),{remoteIceParameters:p}=yield u.iceParameters;n.remoteSDP.restartICE(p);const m=n.remoteSDP.toString(),_=n.logSDPExchange(l.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield oe(n.peerConnection.setLocalDescription(l)),_==null||_(m),yield oe(n.peerConnection.setRemoteDescription({type:"answer",sdp:m}))}catch(o){R.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(ti.TCP_RELAY),await Ha(this.peerConnection,this.remoteSDP,this.extension)}catch(n){R.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach(n=>{ng(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:i}=n;i&&i.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Qs(Qs({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const c=this.remoteSDP.toString(),l=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),l==null||l(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new $(L.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(o=>o.mid===e);i.length===1&&(this.isVP8Simulcast(n)?qe()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(o=>o.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:o}=n.getSelectedCandidatePair();return{local:Qs(Qs({},To),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Qs(Qs({},To),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var n;const i="code: ".concat(e.errorCode,", message: ").concat(e.errorText),o=e.port?"local: ".concat(e.port):"",c=ed(e.url||"");R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(c||"",", host_candidate:").concat(o)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},x("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[]},i=e.cloudProxyServer||"disabled";return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&(Ah(e.turnServer.servers)?n.iceServers=e.turnServer.servers:x("NEW_TURN_MODE")&&n.iceServers&&i==="disabled"?(x("USE_TURN_SERVER_OF_GATEWAY")?e.turnServer.serversFromGateway&&n.iceServers.push(...Rd.newTurnServerConfigToIceServers(e.turnServer.serversFromGateway)):n.iceServers.push(...Rd.newTurnServerConfigToIceServers(e.turnServer.servers)),x("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):e.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...Rd.turnServerConfigToIceServers(e.turnServer.servers)),x("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...Rd.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),x("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(n.iceTransportPolicy="relay")}))),x("ENABLE_ENCODED_TRANSFORM")&&ae().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Ba(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!x("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{const o=x("NEW_TURN_MODE");o===1?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):o===2?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):o===3?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Ba(i.turnServerURL),":443?transport=tcp")}):o===4&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Ba(i.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(e){const n=e.transport;if(n){this.transportEventReceiver=e,n.onstatechange=()=>{var o;n!=null&&n.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,n.state))},n.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const o=n==null?void 0:n.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:o,remote:c}=i.getSelectedCandidatePair()||{};if(o&&c){const l=o.address+":"+o.port,u=c.address+":"+c.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(ed(l)),", remote ").concat(JSON.stringify(ed(u))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i,o;if(n||(n=this.peerConnection.getSenders().find(w=>w.track===e._mediaStreamTrack)),!n)return R.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ae().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},l={};switch(e._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;case"balanced":c.degradationPreference="balanced"}const u=function(I,w){return I.getTransceivers().find(P=>P.sender.track===w||P.receiver.track===w)}(this.peerConnection,e._mediaStreamTrack),p=wQ(e);if(function(I){var w;return!(!x("ENABLE_AG_ADAPTATION")||!(I instanceof I_||pt(w=I._hints).call(w,Ie.CUSTOM_TRACK))||!x("FORCE_SUPPORT_AG_ADAPTATION")&&!(Zk(14,0,!1)&&$k(17,4,!0)||Qk(14)&&Py(17,4,!0)))}(e)&&u&&n&&p&&this.getLocalVideoStats&&pt(i=["vp8","vp9"]).call(i,this.store.codec)){var m;const I=c.degradationPreference||(pt(m=e._hints).call(m,Ie.CUSTOM_TRACK)?x("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(w,P,D,U,G,W){if(ng(w,D),G(P),U!=="balanced"&&U!=="maintain-framerate"&&U!=="maintain-resolution")return;let F=-1;e2(w,P);const X=window.setInterval(()=>{const nt=eg.get(w);if(!x("ENABLE_AG_ADAPTATION")||!nt)return ng(w,D),void G(P);const at=W();if(at.sendPackets>0&&at.OutgoingAvailableBandwidth>0){if(F===-1)return void(F=Date.now());if(Date.now()-F<1e3)return;const Kt=at.sendFrameRate,Xt=at.OutgoingAvailableBandwidth,[Ut,me]=BZ(w,Kt,Xt,nt.adaptationConfig,P,U);me&&(D.qualityLimitationReason=me),Ut&&nt.adaptationConfig.scale!==Ut.scale&&(R.debug("[".concat(w,"] applyAdaptation: ").concat(D.qualityLimitationReason,`
           sendFps `).concat(Kt,", bwe ").concat(Xt,", switch from ").concat(nt.adaptationConfig.scale," to ").concat(Ut.scale," ")),nt.adaptationConfig=eR(eR({},nt.adaptationConfig),Ut),G(Ut))}},x("CHECK_LOCAL_STATS_INTERVAL")),tt=eR({},P);eg.set(w,{timer:X,adaptationConfig:tt,originConfig:P,adaptationFunc:G}),R.debug("[".concat(w,"] start adaptation, originConfig: ").concat(JSON.stringify(P),", degradationPreference: ").concat(U))})(this.id+u.mid,p,this,I,w=>{n&&this.updateAdaptation(n,w)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var _;const{bitrateMax:I,frameRate:w,scaleResolutionDownBy:P}=e._encoderConfig;I&&(l.maxBitrate=1e3*I),(pt(_=e._hints).call(_,Ie.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(w&&(l.maxFramerate=or(w)),P&&P>=1&&(l.scaleResolutionDownBy=P))}const{maxFramerate:E}=x("ENCODER_CONFIG_LIMIT");if(E&&typeof E=="number"&&(l.maxFramerate=l.maxFramerate?Math.min(l.maxFramerate,E):E),x("DSCP_TYPE")&&Xo()){var S;const I=x("DSCP_TYPE");pt(S=["very-low","low","medium","high"]).call(S,I)&&(l.networkPriority=I)}const T=n.getParameters(),A=(o=T.encodings)===null||o===void 0?void 0:o[0];qe()&&!A&&(c.encodings=[l]),A&&Object.assign(A,l),Object.assign(T,c),R.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(T.encodings))),await n.setParameters(T),await async function(I,w,P){try{var D;if(!ae().supportSetRtpSenderParameters||!function(X){return X==="vp9"||X==="av1"}(I)||!x("ENABLE_SVC"))return;const U={},G={},W=w.getParameters(),F=(D=W.encodings)===null||D===void 0?void 0:D[0];G.scalabilityMode=G_(P),F&&Object.assign(F,G),Object.assign(W,U),await w.setParameters(W),R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(W.encodings)))}catch(U){R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",U)}}(this.store.codec,n,x("SVC_MODE"))}async updateAdaptation(e,n){var i,o;if(!e)return R.debug("[updateAdaptation] no rtpSender found");if(!ae().supportSetRtpSenderParameters)return R.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const c={},{bitrateMax:l,frameRate:u,scaleResolutionDownBy:p}=n;l&&(c.maxBitrate=1e3*l),u&&(c.maxFramerate=or(u)),p&&p>=1&&pt(i=["vp8","vp9"]).call(i,this.store.codec)&&(c.scaleResolutionDownBy=p);const m=e.getParameters(),_=(o=m.encodings)===null||o===void 0?void 0:o[0];_&&Object.assign(_,c),Object.assign(m,{});try{await e.setParameters(m),R.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(m.encodings)))}catch(E){!("transport"in e)||e.transport&&e.transport.state==="connected"?this.peerConnectionState!=="connected"?R.debug("[updateAdaptation] peerConnection not connected}"):R.debug("[updateAdaptation] updateRtpSenderEncodings failed",E):R.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,n){try{if(!ae().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const o=e[i],c=n[i];c instanceof Me&&!this.isVP8Simulcast(c)&&await this.updateRtpSenderEncodings(c,o.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const o=Wi(e);return n.forEach((c,l)=>{const u=i[l],p=o.mediaDescriptions.find(m=>m.attributes.mid===u);p&&(zl(p,c),Ix(p,c,this.store.codec))}),xa(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let p=0;p<e.length;p++){var i,o,c,l,u;const m=e[p],_=n[p];if(_ instanceof Me&&!pt(i=_._hints).call(i,Ie.LOW_STREAM)&&(o=_._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=_._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(l=_._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=_._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},S={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const T=m.sender.getParameters();await m.sender.setParameters(Object.assign(T,E))}}}async applySimulcastEncodings(e,n){if(!qe()&&e.length===n.length)for(let i=0;i<e.length;i++){const o=n[i];if(o instanceof Me&&this.isVP8Simulcast(o)){const c=e[i],l={},u={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};l.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const p=c.sender.getParameters();await c.sender.setParameters(Object.assign(p,l))}}}isVP8Simulcast(e){var n,i,o,c,l;return!!(e instanceof Me&&x("SIMULCAST")&&this.store.codec==="vp8"&&!pt(n=e._hints).call(n,Ie.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=e._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(c=e._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=e._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1)}logSDPExchange(e,n,i,o){if(x("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(o,`
`),e),n==="offer"?c=>{this.logSDPExchange(c,"answer",i==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(e){if(ae().supportPCSetConfiguration){const n=Rd.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}e.isPreallocation&&(this.isPreallocation=!0)}},Ct(re.prototype,"updateRemoteRTPCapabilities",[Di],Object.getOwnPropertyDescriptor(re.prototype,"updateRemoteRTPCapabilities"),re.prototype),Ct(re.prototype,"connect",[Di],Object.getOwnPropertyDescriptor(re.prototype,"connect"),re.prototype),Ct(re.prototype,"updateRemoteConnect",[Di],Object.getOwnPropertyDescriptor(re.prototype,"updateRemoteConnect"),re.prototype),Ct(re.prototype,"createDataChannels",[Di],Object.getOwnPropertyDescriptor(re.prototype,"createDataChannels"),re.prototype),Ct(re.prototype,"receive",[Di],Object.getOwnPropertyDescriptor(re.prototype,"receive"),re.prototype),Ct(re.prototype,"batchReceive",[Di],Object.getOwnPropertyDescriptor(re.prototype,"batchReceive"),re.prototype),Ct(re.prototype,"stopReceiving",[Di],Object.getOwnPropertyDescriptor(re.prototype,"stopReceiving"),re.prototype),Ct(re.prototype,"muteRemote",[Di],Object.getOwnPropertyDescriptor(re.prototype,"muteRemote"),re.prototype),Ct(re.prototype,"unmuteRemote",[Di],Object.getOwnPropertyDescriptor(re.prototype,"unmuteRemote"),re.prototype),Ct(re.prototype,"muteLocal",[Di],Object.getOwnPropertyDescriptor(re.prototype,"muteLocal"),re.prototype),Ct(re.prototype,"unmuteLocal",[Di],Object.getOwnPropertyDescriptor(re.prototype,"unmuteLocal"),re.prototype),Ct(re.prototype,"close",[Di],Object.getOwnPropertyDescriptor(re.prototype,"close"),re.prototype),Ct(re.prototype,"updateEncoderConfig",[Di],Object.getOwnPropertyDescriptor(re.prototype,"updateEncoderConfig"),re.prototype),Ct(re.prototype,"updateSendParameters",[Di],Object.getOwnPropertyDescriptor(re.prototype,"updateSendParameters"),re.prototype),Ct(re.prototype,"replaceTrack",[Di],Object.getOwnPropertyDescriptor(re.prototype,"replaceTrack"),re.prototype),Ct(re.prototype,"updateAdaptation",[Di],Object.getOwnPropertyDescriptor(re.prototype,"updateAdaptation"),re.prototype),Ct(re.prototype,"getRemoteSSRC",[Di],Object.getOwnPropertyDescriptor(re.prototype,"getRemoteSSRC"),re.prototype),re);function Di(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,c=await o.lock("From P2PConnection.".concat(e));try{for(var l=arguments.length,u=new Array(l),p=0;p<l;p++)u[p]=arguments[p];return await i.apply(this,u)}finally{c()}},n}function sR(t,e){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=or(e.width),i.height=or(e.height);const o=or(e.framerate||15);document.body.append(n),document.body.append(i);let c=t._mediaStreamTrack;n.srcObject=new MediaStream([c]),n.play();const l=i.getContext("2d");if(!l)throw new Q(L.UNEXPECTED_ERROR,"can not get canvas context");const u=ae(),p=i.captureStream(u.supportRequestFrame?0:o).getVideoTracks()[0];p.canvas||(p.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const _=n.videoWidth,E=n.videoHeight/_,S=i.width*E;Math.abs(S-i.height)>=2&&(R.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(S)),i.height=S)}l.drawImage(n,0,0,i.width,i.height),p.requestFrame&&p.requestFrame(),c!==t._mediaStreamTrack&&(c=t._mediaStreamTrack,n.srcObject=new MediaStream([c]))},i.stopCapture=l0(()=>i.startCapture&&i.startCapture(),o);const m=p.stop;return p.stop=()=>{m.call(p),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),R.debug("clean low stream renderer")},p}var o2=function(t){return t[t.Video_Send_Type=190]="Video_Send_Type",t}(o2||{}),Zs=function(t){return t[t.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",t[t.Video_Send_Freeze=2082]="Video_Send_Freeze",t[t.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",t[t.Video_Recv_Freeze=2084]="Video_Recv_Freeze",t[t.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",t[t.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",t[t.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",t[t.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",t}(Zs||{}),jt=function(t){return t[t.Video_Send_Retransmit=2062]="Video_Send_Retransmit",t[t.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",t[t.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",t[t.Video_Send_Transmit=2066]="Video_Send_Transmit",t[t.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",t[t.Video_Capture_Height=2033]="Video_Capture_Height",t[t.Video_Capture_Width=2035]="Video_Capture_Width",t[t.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",t[t.Video_Send_Low_Height=2073]="Video_Send_Low_Height",t[t.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",t[t.Video_Send_Low_Width=2077]="Video_Send_Low_Width",t[t.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",t[t.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",t[t.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",t[t.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",t[t.Video_Send_Width=2003]="Video_Send_Width",t[t.Video_Send_Height=2004]="Video_Send_Height",t[t.Video_Send_Disabled=2095]="Video_Send_Disabled",t[t.Video_Send_Adaptation=2032]="Video_Send_Adaptation",t[t.Video_Send_Player_Status=2128]="Video_Send_Player_Status",t[t.Video_Send_Nacks=2009]="Video_Send_Nacks",t[t.Video_Send_Plis=2010]="Video_Send_Plis",t[t.Video_Send_Firs=2011]="Video_Send_Firs",t[t.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",t[t.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",t[t.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",t[t.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",t[t.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",t[t.Video_Send_Bitrate=2012]="Video_Send_Bitrate",t[t.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",t[t.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",t[t.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",t[t.Audio_Send_Level=2038]="Audio_Send_Level",t[t.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",t[t.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",t[t.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",t[t.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",t[t.Audio_Send_Freeze=2081]="Audio_Send_Freeze",t[t.Audio_Send_Disabled=2096]="Audio_Send_Disabled",t[t.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",t[t.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",t[t.Video_Recv_Height=2019]="Video_Recv_Height",t[t.Video_Recv_Width=2018]="Video_Recv_Width",t[t.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",t[t.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",t[t.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",t[t.Video_Recv_Nacks=2026]="Video_Recv_Nacks",t[t.Video_Recv_Plis=2027]="Video_Recv_Plis",t[t.Video_Recv_Firs=2028]="Video_Recv_Firs",t[t.Video_Recv_Disabled=2101]="Video_Recv_Disabled",t[t.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",t[t.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",t[t.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",t[t.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",t[t.Audio_Render_Level=2043]="Audio_Render_Level",t[t.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",t[t.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",t[t.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",t[t.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",t[t.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",t[t.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",t[t.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",t[t.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",t[t.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",t[t.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",t[t.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",t[t.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",t}(jt||{}),Fn=function(t){return t[t.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",t[t.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",t[t.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",t[t.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",t[t.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",t[t.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",t[t.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",t[t.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",t[t.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",t[t.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",t[t.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",t[t.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",t[t.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",t[t.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",t[t.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",t[t.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",t[t.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",t[t.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",t[t.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",t[t.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",t[t.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",t}(Fn||{}),Pi=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(Pi||{}),rg=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(rg||{});const id=1e3,sg=6,Xh=3,GZ=Math.max(sg,Xh,60);function Dt(t,e,n){n!=null&&Number.isFinite(n)&&(t[e]=Math.round(Math.max(0,n)))}function a2(t){const e={[Pi.CONN_TYPE]:0,[Pi.RTT]:t.rtt,[Pi.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=t.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(e[Pi.CONN_TYPE]=1),n==="tcp"&&(e[Pi.CONN_TYPE]=3),n==="tls"&&(e[Pi.CONN_TYPE]=4);break}case"srflx":e[Pi.CONN_TYPE]=2;break;case"unknown":e[Pi.CONN_TYPE]=5;break;default:e[Pi.CONN_TYPE]=0}return e}function c2(t){let e=0;switch(t){case"none":e=0;break;case"cpu":e=1;break;case"bandwidth":e=2;break;case"other":e=3}return e}class d2 extends Ke{constructor(e){super(),N(this,"store",void 0),N(this,"uploadWRTCStatsTimer",void 0),N(this,"uploadOutboundDenoiserStatsTimer",void 0),N(this,"uploadExtStatsTimer",void 0),N(this,"uploadExtUsageStatsTimer",void 0),N(this,"uploadInboundExtStatsTimer",void 0),N(this,"requestStats",void 0),N(this,"requestTransportStats",void 0),N(this,"requestLocalMedia",void 0),N(this,"requestRemoteMedia",void 0),N(this,"requestAllTracks",void 0),N(this,"requestVideoIsReady",void 0),N(this,"requestUploadStats",void 0),N(this,"requestUpload",void 0),N(this,"uploadOutboundStarted",!1),N(this,"uploadInboundStarted",!1),N(this,"uploadTransportStarted",!1),N(this,"uploadBaseStatsStarted",!1),N(this,"uploadExtensionUsageStarted",!1),N(this,"lastRecvStats",void 0),N(this,"lastSendStats",void 0),N(this,"lastRefRecvStats",void 0),N(this,"lastRefSendStats",void 0),N(this,"lastNormalRecvStats",void 0),N(this,"lastNormalSendStats",void 0),N(this,"lastExtendStats",{}),N(this,"needUploadStats",{}),N(this,"needUploadRenderFreezeTime",!0),N(this,"lastUploadCompensateTime",-1),N(this,"uploadCompensateDeltaTime",0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;const n=e%Xh==0,i=e%sg==0,o=e%60==0;let c,l;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(l=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!l&&this.uploadInboundStarted&&(l=this.requestStats(!0)),c||l){var u;const p={};if(this.uploadTransportStarted&&c){const _=this.getTransportStats(c,l,n);_&&(p.misc=[_])}if(this.uploadOutboundStarted&&c){const _=this.getOutboundStats(c,i?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats,o);_&&(p.outbound=[_])}if(this.uploadInboundStarted&&l){this.uploadCompensateStats(e);const _=this.getInboundStats(l,i?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);_&&(p.inbound=_)}const m=(u=this.requestTransportStats)===null||u===void 0?void 0:u.call(this).connectState;m&&(Array.isArray(p.misc)?p.misc[0]&&p.misc[0].addition&&(p.misc[0].addition[rg.RTC_PEER_CONNECTION_STATE]=qy[m]):p.misc=[{addition:{[rg.RTC_PEER_CONNECTION_STATE]:qy[m]}}]),this.needUploadStats.sendType&&(Array.isArray(p.outbound)&&p.outbound[0]&&p.outbound[0].high&&(p.outbound[0].high[o2.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(p)}this.lastRecvStats=l,this.lastSendStats=c,i&&(this.lastNormalRecvStats=l,this.lastNormalSendStats=c),n&&(this.lastRefRecvStats=l,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,i;const o=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(o&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[rg.RTC_PEER_CONNECTION_STATE]:qy[o.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===GZ+1&&(e=1)},id)}uploadCompensateStats(e){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const n=e%Xh==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const i=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=i,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const o=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*o;const c=this.requestStats(!0);new Array(o).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const l={};if(this.uploadInboundStarted&&c){const u=this.requestRemoteMedia()||[],p=[];u.forEach(m=>{let[_,E]=m;const S={peer:_.uid};if(_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)&&E.has(St.VIDEO)&&_.videoTrack){const T=function(A,I,w){if(!I.videoRecv.find(D=>D.ssrc===A))return;const P={};if(w&&w._player){const D=w._player,{renderFreezeAccTime2:U,videoElementStatus:G}=D;if(Co.visibility==="visible"&&G===Zn.PLAYING&&ae().supportRequestVideoFrameCallback){const W=Math.min(6e3,U);D.renderFreezeAccTime2=Math.max(0,U-W),Dt(P,Zs.Video_Render_Freeze_Time_Render2,W),x("USE_NEW_RENDER_FREEZE_TIME")&&Dt(P,Zs.Video_Render_Freeze_Time_Render,W)}}return P}(_._videoSSRC,c,_.videoTrack);T&&(S.video=T)}S.video&&p.push(S)}),p.length>0&&(l.inbound=p,this.requestUploadStats(l))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(e,n,i){if(!this.requestStats)return;if(!i)return e.rtt==null?void 0:{addition:{[Pi.RTT]:e.rtt,[Pi.CONN_TYPE]:void 0,[Pi.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};const o=a2(e);if(this.store.useP2P){if(n){const c=a2(n);o[Pi.CONN_TYPE]+=c[Pi.CONN_TYPE]<<3}o[Pi.CONN_TYPE]+=110}else o[Pi.CONN_TYPE]+=100;return{addition:o}}getOutboundStats(e,n,i,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const l=this.requestLocalMedia();if(!l||l.length===0)return;let u,p,m;return l.forEach(_=>{let[E,{track:S,ssrcs:T}]=_;switch(E){case st.LocalVideoLowTrack:case st.LocalVideoTrack:if(E===st.LocalVideoTrack){var A;const I=function(U,G,W,F,X,tt){const nt=G.videoSend.find(Ut=>Ut.ssrc===U);if(!nt)return;const at={},{sentFrame:Kt,inputFrame:Xt}=nt;if(F&&(Dt(at,Zs.Video_Send_Qp_Sum,nt.qpSumPerFrame),Xt&&Kt)){const Ut=Xt.frameRate,me=Kt.frameRate;at[Zs.Video_Send_Freeze]=function(he,ni){let et=!0;return et=!(he<=5)&&(he<=10?ni<3:he<=20?ni<4:ni<5),et}(Ut,me)?1:0}if(X){switch(Kt&&(Dt(at,jt.Video_Send_Height,Kt.height),Dt(at,jt.Video_Send_Width,Kt.width),Dt(at,jt.Video_Send_Frame_Rate,Kt.frameRate)),at[jt.Video_Send_Disabled]=W._originMediaStreamTrack&&!W._originMediaStreamTrack.enabled||W._mediaStreamTrack&&!W._mediaStreamTrack.enabled?1:0,nt.adaptionChangeReason){case"none":at[jt.Video_Send_Adaptation]=0;break;case"cpu":at[jt.Video_Send_Adaptation]=1;break;case"bandwidth":at[jt.Video_Send_Adaptation]=2;break;case"other":at[jt.Video_Send_Adaptation]=3}let Ut=0;nt.adaptionChangeReason&&(Ut+=c2(nt.adaptionChangeReason)),G.qualityLimitationReason&&(Ut+=c2(G.qualityLimitationReason)<<3),at[jt.Video_Send_Adaptation]=Ut,at[jt.Video_Send_Player_Status]=c0[W._player?W._player.videoElementStatus:"uninit"],Dt(at,jt.Video_Send_Nacks,nt.nacksCount),Dt(at,jt.Video_Send_Plis,nt.plisCount),Dt(at,jt.Video_Send_Firs,nt.firsCount),Dt(at,jt.Video_Send_Avg_Encode,nt.avgEncodeMs),Dt(at,jt.Video_Send_Huge_Frame_Sent,nt.hugeFramesSent),Dt(at,jt.Video_Send_Bytes_Retransmit,nt.retransmittedBytesSent),Dt(at,jt.Video_Send_Packages_Retransmit,nt.retransmittedPacketsSent),Dt(at,jt.Video_Send_Key_Frames_Encoded,nt.keyFramesEncoded);const me=X.videoSend.find(he=>he.ssrc===U);if(me){let he=id*Xh;me.timestamp&&nt.timestamp&&(he=nt.timestamp-me.timestamp),me.packets!=null&&nt.packets!=null&&Dt(at,jt.Video_Send_Package_Rate,1e3*(nt.packets-me.packets)/he),nt.packetsLost!=null&&me.packetsLost!=null&&Dt(at,jt.Video_Send_Package_Lost,nt.packetsLost-me.packetsLost),me.bytes!=null&&nt.bytes!=null&&Dt(at,jt.Video_Send_Bitrate,8*(nt.bytes-me.bytes)/he)}}return at}(T[0].ssrcId,e,S,n,i),w=S.__className__==="CameraVideoTrack"?3:pt(A=S._hints).call(A,Ie.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==w||c)&&(this.needUploadStats={sendType:w},this.lastExtendStats.sendType=w);const P=S&&function(U,G,W,F){const X=G.videoSend.find(nt=>nt.ssrc===U);if(!X)return null;const tt={};if(F){const nt=X.inputFrame,at=nt&&nt.height||W.videoHeight||0,Kt=nt&&nt.width||W.videoWidth||0,Xt=nt&&nt.frameRate||0;Dt(tt,jt.Video_Capture_Height,at),Dt(tt,jt.Video_Capture_Width,Kt),Dt(tt,jt.Video_Capture_Frame_Rate,Xt)}return tt}(T[0].ssrcId,e,S,!!i),D=function(U,G){const W={};return G&&(Dt(W,jt.Video_Send_Retransmit,U.bitrate.retransmit),Dt(W,jt.Video_Send_Target_Encoded,U.bitrate.targetEncoded),Dt(W,jt.Video_Send_Actual_Encoded,U.bitrate.actualEncoded),Dt(W,jt.Video_Send_Transmit,U.bitrate.transmit),Dt(W,jt.Video_Send_Bandwidth,U.sendBandwidth)),W}(e,!!i);p=Object.assign({},I,P,D)}else m=function(I,w,P,D,U){const G=w.videoSend.find(F=>F.ssrc===I);if(!G)return;const W={};if(D){const F=G.sentFrame;F&&(Dt(W,jt.Video_Send_Low_Height,F.height),Dt(W,jt.Video_Send_Low_Width,F.width),Dt(W,jt.Video_Send_Low_Frame_Rate,F.frameRate));const X=D.videoSend.find(tt=>tt.ssrc===I);if(X){let tt=id*sg;X.timestamp&&G.timestamp&&(tt=G.timestamp-X.timestamp),X.packets!=null&&G.packets!=null&&Dt(W,jt.Video_Send_Low_Package_Rate,1e3*(G.packets-X.packets)/tt),G.packetsLost!=null&&X.packetsLost!=null&&Dt(W,jt.Video_Send_Low_Package_Lost,G.packetsLost-X.packetsLost),X.bytes!=null&&G.bytes!=null&&Dt(W,jt.Video_Send_Low_Bitrate,8*(G.bytes-X.bytes)/tt)}}return W}(T[0].ssrcId,e,0,i);break;case st.LocalAudioTrack:u=S&&function(I,w,P,D,U,G){const W=w.audioSend.find(X=>X.ssrc===I);if(!W)return;const F={};if(U){F[jt.Audio_Send_Disabled]=P._originMediaStreamTrack&&!P._originMediaStreamTrack.enabled||P._mediaStreamTrack&&!P._mediaStreamTrack.enabled?1:0;const X=100*P._source.getAccurateVolumeLevel(),tt=W.inputLevel;if(tt!=null){const at=Math.ceil(50*Math.log10(100*tt+1));Dt(F,jt.Audio_Send_Level,at)}Dt(F,jt.Audio_Capture_PCM_Level,X),Dt(F,jt.Audio_Send_AEC_Return_Loss,W.aecReturnLoss),Dt(F,jt.Audio_Send_AEC_Return_Loss_Enhancement,W.aecReturnLossEnhancement),Dt(F,jt.Audio_Send_Bytes_Retransmit,W.retransmittedBytesSent),Dt(F,jt.Audio_Send_Packages_Retransmit,W.retransmittedPacketsSent),F[jt.Audio_Send_Freeze]=0;const nt=U.audioSend.find(at=>at.ssrc===I);if(nt){let at=id*sg;nt.timestamp&&W.timestamp&&(at=W.timestamp-nt.timestamp),nt.bytes!=null&&W.bytes!=null&&Dt(F,jt.Audio_Send_Bitrate,8*(W.bytes-nt.bytes)/at),nt.packets!=null&&W.packets!=null&&Dt(F,jt.Audio_Send_Package_Rate,1e3*(W.packets-nt.packets)/at)}}return F}(T[0].ssrcId,e,S,0,i)}}),{high:p,low:m,audio:u}}getInboundStats(e,n,i,o){if(!this.requestRemoteMedia)return;const c=this.requestRemoteMedia()||[],l=[];return c.forEach(u=>{let[p,m]=u;const _={peer:p.uid};if(m.has(St.VIDEO)&&p.videoTrack){const E=p._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(p._videoSSRC)||!1,S=p.videoTrack?function(T,A,I,w,P,D,U,G){const W=A.videoRecv.find(Ut=>Ut.ssrc===T);if(!W)return;const F={},{receivedFrame:X,outputFrame:tt,decodeFrameRate:nt}=W;Dt(F,Fn.Video_Render_Frame_Rate_Decode,nt),W.framesRateFirefox&&Dt(F,Fn.Video_Recv_Frame_Rate,W.framesRateFirefox),X&&Dt(F,Fn.Video_Recv_Frame_Rate,X.frameRate),Dt(F,Fn.Video_Recv_Frame_Dropped,W.framesDroppedCount),Dt(F,Fn.Video_Recv_Bytes_Retransmit,W.retransmittedBytesReceived),Dt(F,Fn.Video_Recv_Packages_Retransmit,W.retransmittedPacketsReceived),Dt(F,Fn.Video_Recv_Packages_Discarded,W.packetsDiscarded),Dt(F,Fn.Video_Recv_Avg_Decode,W.avgDecodeMs),Dt(F,Fn.Video_Recv_Avg_Processing_Delay,W.avgProcessingDelayMs),Dt(F,Fn.Video_Recv_Avg_Assembly_Time,W.avgFramesAssembledFromMultiplePacketsMs),Dt(F,Fn.Video_Recv_Avg_Inter_Frame_Delay,W.avgInterFrameDelayMs),Dt(F,Fn.Video_Recv_Key_Frames_Decoded,W.keyFramesDecoded);const at=G&&G.videoRecv.find(Ut=>Ut.ssrc===T);if(at){const Ut=A.timestamp-G.timestamp||id;W.packetsLost!=null&&at.packetsLost!=null&&Dt(F,Fn.Video_Recv_Package_Lost,W.packetsLost-at.packetsLost),at.bytes!=null&&W.bytes!=null&&Dt(F,Fn.Video_Recv_Bitrate,8*(W.bytes-at.bytes)/Ut),at.packets!=null&&W.packets!=null&&Dt(F,Fn.Video_Recv_Package_Rate,1e3*(W.packets-at.packets)/Ut)}const Kt=D&&D.videoRecv.find(Ut=>Ut.ssrc===T);if(Kt&&(Dt(F,Zs.Video_Recv_Qp_Sum,W.qpSumPerFrame),F[Zs.Video_Recv_Freeze]=w&&qh.isRemoteVideoFreeze(I,W,Kt)?1:0),U){var Xt;const Ut=U.videoRecv.find(he=>he.ssrc===T);X?(Dt(F,jt.Video_Recv_Height,X.height),Dt(F,jt.Video_Recv_Width,X.width)):I&&(Dt(F,jt.Video_Recv_Height,I._videoHeight||0),Dt(F,jt.Video_Recv_Width,I._videoWidth||0)),tt&&Dt(F,jt.Video_Recv_Frame_Rate_Output,tt.frameRate);const me=(Xt=I._player)===null||Xt===void 0?void 0:Xt.rendFrameRate.toFixed(0);if(me&&Dt(F,jt.Video_Render_Frame_Rate_Render,+me),Dt(F,jt.Video_Recv_Jitter_Buffer,W.jitterBufferMs),Dt(F,jt.Video_Recv_Current_Delay,W.currentDelayMs),Dt(F,jt.Video_Recv_Firs,W.firsCount),Dt(F,jt.Video_Recv_Nacks,W.nacksCount),Dt(F,jt.Video_Recv_Plis,W.plisCount),I){F[jt.Video_Recv_Disabled]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1;const he=I._player;if(he){const{freezeTimeCounterList:ni,renderFreezeAccTime:et,renderFreezeAccTime2:ut,videoElementStatus:Tt}=he;if(ni&&ni.length>0&&Dt(F,Zs.Video_Render_Freeze_Time,ni.splice(0,1)[0]),P&&Co.visibility==="visible"&&Tt===Zn.PLAYING&&ae().supportRequestVideoFrameCallback){const rt=Math.min(6e3,ut);he.renderFreezeAccTime2=Math.max(0,ut-rt),Dt(F,Zs.Video_Render_Freeze_Time_Render2,rt);const b=Math.min(6e3,et);he.renderFreezeAccTime=Math.max(0,et-b),Dt(F,Zs.Video_Render_Freeze_Time_Render,x("USE_NEW_RENDER_FREEZE_TIME")?rt:b)}if(typeof W.totalFreezesDuration=="number"){const rt=Ut&&Ut.totalFreezesDuration?W.totalFreezesDuration-Ut.totalFreezesDuration:W.totalFreezesDuration;Dt(F,jt.Video_Render_Freeze_Duration,1e3*rt)}}}if(F[jt.Video_Recv_Player_Status]=c0[I._player?I._player.videoElementStatus:"uninit"],Ut&&W.totalInterFrameDelay!==void 0&&W.totalSquaredInterFrameDelay!==void 0&&Ut.totalInterFrameDelay!==void 0&&Ut.totalSquaredInterFrameDelay!==void 0){const he=W.totalInterFrameDelay-Ut.totalInterFrameDelay,ni=W.totalSquaredInterFrameDelay-Ut.totalSquaredInterFrameDelay,et=W.framesDecodeCount-Ut.framesDecodeCount,ut=he/et*1e3,Tt=Math.round(1e3*Math.sqrt((ni-Math.pow(he,2)/et)/et));!isNaN(Tt)&&ut+Tt>Math.max(3*ut,ut+150)&&(F[jt.Video_Recv_I_Frame_Delay]=Tt)}}return F}(p._videoSSRC,e,p.videoTrack,E===!0,this.needUploadRenderFreezeTime,n,i,o):void 0;S&&(_.video=S)}if(m.has(St.AUDIO)&&p.audioTrack){const E=p.audioTrack?function(S,T,A,I,w,P){const D=T.audioRecv.find(F=>F.ssrc===S);if(!D)return;const U={};Dt(U,Fn.Audio_Recv_Jitter,D.jitterMs),Dt(U,Fn.Audio_Recv_Bytes_Retransmit,D.retransmittedBytesReceived),Dt(U,Fn.Audio_Recv_Packages_Retransmit,D.retransmittedPacketsReceived),Dt(U,Fn.Audio_Recv_Packages_Discarded,D.packetsDiscarded),Dt(U,Fn.Audio_Recv_Avg_Processing_Delay,D.avgProcessingDelayMs);const G=P&&P.audioRecv.find(F=>F.ssrc===S);if(G){const F=id;D.packets!=null&&G.packets!=null&&Dt(U,Fn.Audio_Recv_Package_Rate,1e3*(D.packets-G.packets)/F),D.packetsLost!=null&&G.packetsLost!=null&&Dt(U,Fn.Audio_Recv_Package_Lost,D.packetsLost-G.packetsLost)}if(I){const{receivedFrames:F,droppedFrames:X}=D;F!=null&&X!=null&&(U[Zs.Audio_Recv_Freeze]=(W=F)===0||100*X/W>20?1:0)}var W;if(w){const F=100*A._source.getAccurateVolumeLevel(),X=D.outputLevel;if(X!=null){const nt=Math.ceil(50*Math.log10(100*X+1));Dt(U,jt.Audio_Render_Level,nt)}Dt(U,jt.Audio_Recv_PCM_Level,F),A&&(U[jt.Audio_Recv_Disabled]=A._originMediaStreamTrack.enabled&&A._mediaStreamTrack.enabled?0:1),Dt(U,jt.Audio_Recv_Jitter_Buffer,D.jitterBufferMs),Dt(U,jt.Audio_Recv_Current_Delay,D.jitterBufferMs),U[jt.Audio_Recv_Player_Status]=c0[Ni.getPlayerState(A.getTrackId())];const tt=w.audioRecv.find(nt=>nt.ssrc===S);if(tt){tt.bytes!=null&&D.bytes!=null&&Dt(U,jt.Audio_Recv_Bitrate,8*(D.bytes-tt.bytes)/(id*Xh));const nt=D.concealedSamples-tt.concealedSamples;nt>0&&Dt(U,jt.Audio_Recv_Concealed_Samples,nt);const at=D.totalSamplesReceived-tt.totalSamplesReceived;at>0&&Dt(U,jt.Audio_Recv_Total_Samples_Received,at);const Kt=D.freezeSamples80-tt.freezeSamples80;Kt>0&&Dt(U,jt.Audio_Render_Freeze_Samples_80ms,Kt);const Xt=D.freezeSamples200-tt.freezeSamples200;Xt>0&&Dt(U,jt.Audio_Render_Freeze_Samples_200ms,Xt);const Ut=D.freezeMs80-tt.freezeMs80;Dt(U,jt.Audio_Render_Freeze_Time_80ms,Ut<0?0:Ut);const me=D.freezeMs200-tt.freezeMs200;Dt(U,jt.Audio_Render_Freeze_Time_200ms,me<0?0:me)}}return U}(p._audioSSRC,e,p.audioTrack,n,i,o):void 0;E&&(_.audio=E)}(_.video||_.audio)&&l.push(_)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,l}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(n=>n instanceof xh);if(e&&e._external.getDenoiserStats){const n=e._external.getDenoiserStats();n&&this.requestUpload(Vh.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[n,i]=e;i.has(St.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)}),i.has(St.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),i={connectionInterval:x("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let o=[];const c=this.requestAllTracks&&this.requestAllTracks()||[];for(const m of c)!m.muted&&m.enabled&&(o=o.concat(await m.getProcessorUsage()));const l=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[m,_]of l)_.has(St.VIDEO)&&m.videoTrack&&(o=o.concat(await m.videoTrack.getProcessorUsage())),_.has(St.AUDIO)&&m.audioTrack&&(o=o.concat(await m.audioTrack.getProcessorUsage()));if(o.length===0)return;i.details=function(m,_){const E={};for(const{id:I,value:w,level:P,direction:D}of m){var S;const U=(S=_.get(I))!==null&&S!==void 0?S:0,G=w===2?U+x("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:U;var T,A;_.set(I,G),E[I]?(w===2&&(E[I].value=w),P>E[I].level&&(E[I].level=P),D==="remote"&&(E[I].remoteUidCount+=1),E[I].totalTs=(T=_.get(I))!==null&&T!==void 0?T:0):E[I]={value:w,level:P,remoteUidCount:D==="local"?0:1,totalTs:(A=_.get(I))!==null&&A!==void 0?A:0}}return Object.keys(E).map(I=>{const{level:w,value:P,totalTs:D}=E[I];return{id:I,level:w,value:P,totalTs:D}})}(o,e);const u=Date.now(),p=u>n?u:n+1;this.requestUpload&&this.requestUpload(Vh.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:p})},x("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const HZ=x("ICE_RESTART_INTERVAL");let og=new Map,Jl=new Map,Ya=[ti.UDP_TCP_RELAY,ti.TCP_RELAY,ti.RELAY],oR=x("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&ae().supportPCSetConfiguration;function l2(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=og.get(t.id);n&&(window.clearTimeout(n),og.delete(t.id));const i=Jl.get(t.id);e&&i&&i.index===Ya.length-1&&(R.debug("[".concat(t.id,"] reset ICE restart policy")),Jl.delete(t.id))}function u2(t,e,n){if(og.size===0&&Jl.size===0&&(Array.isArray(x("RESTART_SEQUENCE"))&&x("RESTART_SEQUENCE").length>0&&!function(u,p){if(u.length!==p.length)return!1;for(let m=0;m<u.length;m+=1){const _=u[m];if(u.filter(E=>E===_).length!==p.filter(E=>E===_).length)return!1}return!0}(Ya,x("RESTART_SEQUENCE"))&&(Ya=x("RESTART_SEQUENCE").filter(u=>{var p;if(pt(p=Object.values(ti)).call(p,u))return!0}),R.debug("use reconnection policy from config distribution, queues: ".concat(Ya.join(" => ")))),oR=x("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&ae().supportPCSetConfiguration),Ya.length===0)return void n();let i,{index:o=0,type:c}=Jl.get(t.id)||{};if(oR&&c===ti.RELAY)return void n();let l=c&&o>=Ya.length-1;if(oR)c=ti.RELAY;else{if(l)return void n();c?(o++,c=Ya[o]):(c=Ya[0],o=0)}R.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(c,", index: ").concat(o)),e(c),Jl.set(t.id,{index:o,type:c}),i=window.setTimeout(()=>u2(t,e,n),HZ),og.set(t.id,i)}var Zt;function h2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function Ao(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?h2(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function p2(t){var e,n,i,o=2;for(typeof Symbol<"u"&&(n=vy,i=Symbol.iterator);o--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new ag(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function ag(t){function e(n){if(Object(n)!==n)return gt.reject(new TypeError(n+" is not an object."));var i=n.done;return gt.resolve(n.value).then(function(o){return{value:o,done:i}})}return ag=function(n){this.s=n,this.n=n.next},ag.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?gt.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?gt.reject(n):e(i.apply(this.s,arguments))}},new ag(t)}let Jh=(Zt=class extends Ke{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(It.StateChange,e,this._state)}constructor(t,e){super(),N(this,"isPlanB",void 0),N(this,"store",void 0),N(this,"statsUploader",void 0),N(this,"connection",void 0),N(this,"localTrackMap",new Map),N(this,"remoteUserMap",new Map),N(this,"localDataChannels",[]),N(this,"remoteDataChannelMap",new Map),N(this,"pendingLocalTracks",[]),N(this,"pendingRemoteTracks",[]),N(this,"pendingLocalDataChannels",[]),N(this,"pendingRemoteDataChannels",[]),N(this,"statsCollector",void 0),N(this,"shouldForwardP2PCreation",void 0),N(this,"iceFailedCount",0),N(this,"dtlsFailedCount",0),N(this,"mutex",void 0),N(this,"_state",ge.Disconnected),N(this,"_pcStatsUploadType",x("NEW_ICE_RESTART")?Zo.FIRST_CONNECTION:Zo.OLD_FIRST_CONNECTION),N(this,"_isStartRestartIce",!1),N(this,"_restartTimer",void 0),N(this,"_isTryConnecting",!1),N(this,"_iceError",null),N(this,"_forceTurn",!1),N(this,"_isWaitPcToRePub",!1),N(this,"handleMuteLocalTrack",async(n,i,o)=>{const c=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==ge.Connected)return void o(new $(L.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const l=this.filterTobeMutedTracks(n);if(l.length===0)return void i();const u=l.find(m=>m[0]==="videoLowTrack");if(u){const m=u[1];this.store.enableInstantMuteRestore?(m.track._originMediaStreamTrack.enabled=!1,R.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):m.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?R.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(l.map(m=>{let[,{id:_}]=m;return _}));const p=this.createMuteMessage(l);await we(this,It.RequestMuteLocal,p),i()}catch(l){o(l)}finally{c()}}),N(this,"handleUnmuteLocalTrack",async(n,i,o)=>{const c=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==ge.Connected)return void o(new $(L.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const l=this.filterTobeUnmutedTracks(n);if(l.length===0)return void i();const u=l.find(m=>m[0]==="videoLowTrack");if(u){const m=u[1];if(this.store.enableInstantMuteRestore)m.track._originMediaStreamTrack.enabled=!0,R.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(m.track._originMediaStreamTrack.stop(),!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&ae().supportDualStreamEncoding){const _=n._mediaStreamTrack.clone();m.track._mediaStreamTrack=_,m.track._originMediaStreamTrack=_}else{const _=sR(n,Oh(this,It.RequestLowStreamParameter));m.track._mediaStreamTrack=_,m.track._originMediaStreamTrack=_}await new gt((_,E)=>{this.handleReplaceTrack(m.track,_,E,!0)})}}this.store.enableInstantMuteRestore?R.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(l.map(m=>{let[,{id:_}]=m;return _}));const p=this.createUnmuteMessage(l);await we(this,It.RequestUnmuteLocal,p),i()}catch(l){o(l)}finally{c()}}),N(this,"handleUpdateVideoEncoder",async(n,i,o,c)=>{let l;c||(l=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const p=this.localTrackMap.get(st.LocalVideoTrack);if(!this.connection||!p||p.track!==n||this.state!==ge.Connected)return void i();const{id:m,track:_}=p;await this.connection.updateSendParameters(m,_),await this.connection.updateEncoderConfig(m,_),this.emit(It.UpdateVideoEncoder,_),i()}catch(p){o(p)}finally{var u;(u=l)===null||u===void 0||u()}}),N(this,"handleUpdateVideoSendParameters",async(n,i,o)=>{const c=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const l=this.localTrackMap.get(st.LocalVideoTrack);if(!this.connection||!l||l.track!==n||this.state!==ge.Connected)return void i();const{id:u,track:p}=l;await this.connection.updateSendParameters(u,p),i()}catch(l){o(l)}finally{c()}}),N(this,"handleReplaceMixingTrack",async(n,i,o,c)=>{if(!this.connection||this.state!==ge.Connected)return void i();const l=iR([n]);let u;R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(l.getTrackId(),"]")),typeof c=="boolean"&&c||(u=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,l),i()}catch(m){o(m)}finally{var p;(p=u)===null||p===void 0||p()}}),N(this,"handleReplaceTrack",async(n,i,o,c)=>{let l;R.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof c=="boolean"&&c||(l=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var u;const m=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:E}]=_;return n===E});if(!this.connection||!m||this.state!==ge.Connected)return void i();if(await((u=this.connection)===null||u===void 0?void 0:u.replaceTrack(n,m[1].id)),this.isPlanB){const _=m[1];_.id=n._mediaStreamTrack.id,this.localTrackMap.set(m[0],_)}if(m[0]===st.LocalVideoTrack&&!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&ae().supportDualStreamEncoding){const _=this.localTrackMap.get(st.LocalVideoLowTrack);if(_){const E=n._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=E,_.track._originMediaStreamTrack=E,await new gt((S,T)=>{this.handleReplaceTrack(_.track,S,T,!0)})}}i()}catch(m){o(m)}finally{var p;(p=l)===null||p===void 0||p()}}),N(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),N(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),N(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),N(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),N(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new d2(this.store),this.bindStatsUploaderEvents(),this.mutex=new Qn("P2PChannel-mutex",this.store.clientId),this.isPlanB=!ae().supportUnifiedPlan||x("CHROME_FORCE_PLAN_B")&&Xo(),this.shouldForwardP2PCreation=x("FORWARD_P2P_CREATION")&&ae().supportPCSetConfiguration&&My(),this.shouldForwardP2PCreation&&(this.connection=ig(this.store),this.emit(It.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t,e){var n;this.state=ge.New,this._forceTurn=r2(t),R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||i||e)&&((i||e)&&this.connection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=ig(this.store,t),this.emit(It.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new $(L.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=x("NEW_ICE_RESTART")?Zo.FIRST_CONNECTION:Zo.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new $(L.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===ge.Connected){if(this.connection instanceof Wr&&this.connection.checkDtlsParameters(t.dtlsParameters.fingerprints))return R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),bt.reportApiInvoke(this.store.sessionId,{name:tn.MISMATCH_DTLS_PARAMETERS,options:[t.dtlsParameters.fingerprints],tag:We.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(It.RequestReconnect)});await this.connection.updateRemoteConnect(t)}else this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ge.Connected}updateRemoteRTPCapabilities(t){const e=Array.from(this.localTrackMap.entries()).filter(o=>{var c;let[l]=o;return pt(c=[st.LocalVideoLowTrack,st.LocalVideoTrack]).call(c,l)}),n=e.map(o=>{let[,{id:c}]=o;return c}),i=e.map(o=>{let[c]=o;return c});if(this.connection instanceof Wr){if(bt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!pt(t).call(t,this.store.codec)){const o=["vp9","vp8","h264"].find(c=>pt(t).call(t,c));o&&(this.store.codec=o,R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(o,".")))}this.connection.updateRemoteRTPCapabilities(n,t)}}async getEstablishParams(){var t;if(this.connection instanceof Wr&&this.connection.peerConnectionState!=="closed"&&pt(t=[ge.New,ge.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==ge.Connected){if(this.state===ge.Disconnected)throw new $(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(n=>{var i;pt(i=this.pendingLocalDataChannels).call(i,n)||this.pendingLocalDataChannels.push(n)}),[]}const e=this.filterTobePublishedDataChannels(t);return e.length===0?[]:(e.forEach(n=>{const i=Date.now();this.store.publish(n.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(n=>{this.localDataChannels.push(n);const i=Date.now();this.store.publish(n.id+"","datachannel",void 0,i)}),t.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(t,e,n){var i=this;return xr(function*(){const o=yield oe(i.mutex.lock("From P2PChannel.publish"));try{var c;const l=i.connection&&pt(c=["disconnected","failed"]).call(c,i.connection.peerConnectionState);if(!i.connection||i.state!==ge.Connected||l){if(i.state===ge.Disconnected)throw new $(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(t);const p=t.filter(m=>i.pendingLocalTracks.indexOf(m)===-1);return i.pendingLocalTracks=i.pendingLocalTracks.concat(p),void(l&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,ei.markPublishStart(i.store.clientId,i.store.pubId);const u=i.filterTobePublishedTracks(t,e,n);if(u.length===0)return void(yield oe(i.tryToUnmuteAudio(t)));yield*$m(p2(i.doPublish(i.connection,u)))}finally{o()}})()}doPublish(t,e){var n=this;return xr(function*(){e.forEach(S=>{let{track:T,type:A}=S;const I=Date.now();n.store.publish(T.getTrackId(),A===st.LocalAudioTrack?"audio":"video",I)}),n.bindLocalTrackEvents(e);const i=e.map(S=>{let{track:T}=S;return T}),o=yield oe(t.send(i,n.store.codec,n.store.audioCodec)),c=(yield oe(o.next())).value,l=n.createGatewayPublishMessage(e,c);let u;try{u=yield l}catch(S){throw o.throw(S),(S==null?void 0:S.code)===L.WS_ABORT&&e.forEach(T=>{let{track:A}=T;n.pendingLocalTracks.indexOf(A)===-1&&n.pendingLocalTracks.push(A)}),n.unbindLocalTrackEvents(e),S}const p=n.mapPubResToRemoteConfig(l,u,i),m=(yield oe(o.next(p))).value;if(n.state===ge.Disconnected)throw new $(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");x("ENABLE_VIDEO_SEI");const _=x("ENABLE_ENCODED_TRANSFORM"),E=x("ENABLE_AUDIO_METADATA");i.forEach(async S=>{const T=S.getRTCRtpTransceiver();if(!T||!_)return;const{interceptLocalVideoFrame:A,interceptLocalAudioFrame:I}=q_();S.trackMediaType===St.VIDEO?await A(T.sender,S):S.trackMediaType===St.AUDIO&&await I(T.sender,{metadata:E?()=>{const w=S.metadata.shift();return w&&w.value}:void 0})}),e.forEach(S=>{let{type:T}=S;n.statsCollector.addLocalStats(T)}),n.assignLocalTracks(e,m),n.statsUploader.startUploadOutboundStats(),e.forEach(S=>{let{track:T,type:A}=S;const I=Date.now();n.store.publish(T.getTrackId(),A===st.LocalAudioTrack?"audio":"video",void 0,I)})})()}async updateVideoStreamParameter(t,e){const n=this.localTrackMap.get(e);if(!n||!this.connection)return;if(!(n.track instanceof Me))return R.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:i}=n,o=function(c,l){const u={};return c.height&&c.width&&(u.scaleResolutionDownBy=F0(c,l)),u.maxFramerate=c.framerate?or(c.framerate):void 0,u.maxBitrate=c.bitrate?1e3*c.bitrate:void 0,u}(t,i);if(i._encoderConfig||(i._encoderConfig={}),e!==st.LocalVideoLowTrack||!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&ae().supportDualStreamEncoding)o.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=o.scaleResolutionDownBy);else{const c=i._originMediaStreamTrack;if(!c.canvas)return R.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(l,u){const p=l.canvas;u.width&&(p.width=or(u.width)),u.height&&(p.height=or(u.height)),u.framerate&&(p.stopCapture&&p.stopCapture(),p.stopCapture=l0(()=>{!p.startCapture&&p.stopCapture&&p.stopCapture(),p.startCapture&&p.startCapture()},or(u.framerate)))})(c,t)}o.maxBitrate!=null&&(i._encoderConfig.bitrateMax=o.maxBitrate/1e3),o.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=o.maxFramerate:i._encoderConfig.frameRate={max:o.maxFramerate}),R.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(t){var e=this;return xr(function*(){if(!e.connection||e.state!==ge.Connected)return;const n=yield oe(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const o=e.localTrackMap.get(st.LocalVideoTrack);if(!o)throw new $(L.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(st.LocalVideoLowTrack))throw new $(L.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const c=[{track:e.getLowVideoTrack(o.track,t),type:st.LocalVideoLowTrack}];if(yield*$m(p2(e.doPublish(e.connection,c))),o.track.muted||!o.track.enabled){var i;const l=(i=e.localTrackMap.get(st.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;l!==void 0&&(yield oe(e.connection.muteLocal([l])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Kn(this,It.RequestRePublish,this.pendingLocalTracks),this.emit(It.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(R.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Kn(this,It.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:n,kind:i}=this.pendingRemoteTracks[e];(i!==St.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==St.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(t)await Kn(this,It.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:n}of this.pendingRemoteTracks)await this.subscribe(e,n,n===St.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:n}=e;this.emit(It.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==ge.Connected)return void t.forEach(i=>{const o=this.pendingLocalTracks.indexOf(i);o!==-1&&this.pendingLocalTracks.splice(o,1)});const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==ge.Connected)return void t.forEach(n=>{const i=this.pendingLocalDataChannels.indexOf(n);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});const e=this.filterTobeUnpublishedDataChannels(t);return e.length!==0?(e.forEach(n=>{const i=this.localDataChannels.indexOf(n);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==ge.Connected)return;const t=this.localTrackMap.get(st.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[st.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const n=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map(i=>{let[,{id:o}]=i;return o})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(i=>{let[o,{track:c}]=i;return{type:o,track:c}})),e.forEach(i=>{let[o]=i;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(t,e){if(!this.connection||this.state!==ge.Connected)throw new $(L.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=e.filter(i=>{var o;return!((o=this.remoteDataChannelMap.get(t))!==null&&o!==void 0&&o.get(i.id))});if(n.length!==0)return await this.connection.createDataChannels(t.uid,n),n.forEach(i=>{var o;this.remoteDataChannelMap.has(t)?(o=this.remoteDataChannelMap.get(t))===null||o===void 0||o.set(i.id,i):this.remoteDataChannelMap.set(t,new Map([[i.id,i]]));const c=this.pendingRemoteDataChannels.findIndex(l=>{let{user:u,id:p}=l;return u.uid===t.uid&&p===i.id});c!==-1&&this.pendingRemoteDataChannels.splice(c,1)}),n.map(i=>i.id)}async subscribe(t,e,n,i,o){var c;if(!this.connection||this.state!==ge.Connected)throw new $(L.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((c=this.remoteUserMap.get(t))!==null&&c!==void 0&&c.has(e))return;let l,u,p,m;const _=this.connection.getPreMedia(n);if(_)R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),p=_.transceiver,l=_.track,u=_.mid,m=_.player,_.firstVideoRender&&this.store.firstVideoFrameDecoded(t.uid,{firstPreRender:_.firstVideoRender});else if(o){const T=o.find(I=>{let{stream_type:w}=I;return w===e});if(!T)throw new $(L.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const A=await this.connection.receive(e,T.ssrcs,String(t._uintid),T.attributes);this.connection instanceof Wr&&(p=A.transceiver),l=A.track,u=A.id}else{const T=await this.connection.receive(e,[{ssrcId:n,rtx:i}],String(t._uintid),void 0);this.connection instanceof Wr&&(p=T.transceiver),l=T.track,u=T.id}if(e===St.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(l):(t._audioTrack=new Ul(l,t.uid,t._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),p&&t._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(l):(t._videoTrack=new xl(l,t.uid,t._uintid,this.store,m),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId())),t._videoTrack.once(Fr.PLAY_START,()=>{this.store.firstVideoFrameDecoded(t.uid,{playStart:Date.now()})}),t._videoTrack.once(Fr.PLAY_END,()=>{this.store.firstVideoFrameDecoded(t.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(t)}),m?t._videoTrack.once(Fr.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)}):t._videoTrack.once(Fr.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)})),p&&t._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(t,t._videoTrack)),p&&x("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:T,interceptRemoteAudioFrame:A}=q_();e==St.VIDEO?await T(p.receiver,{onSei:x("ENABLE_VIDEO_SEI")&&(I=>{var w;return(w=t._videoTrack)===null||w===void 0?void 0:w._onSei(I)})}):e==St.AUDIO&&await A(p.receiver,{enableTopn:!!x("ENABLE_AUDIO_TOPN"),enableMetadata:!!x("ENABLE_AUDIO_METADATA"),enablePts:!!x("ENABLE_AUDIO_PTS"),onMetadata:I=>{this.safeEmit(It.AudioMetadata,I)},onPts:I=>{this.safeEmit(It.AudioPts,I)}})}const E=this.remoteUserMap.get(t);E?E.set(e,u):this.remoteUserMap.set(t,new Map([[e,u]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const S=this.pendingRemoteTracks.findIndex(T=>{let{user:A,kind:I}=T;return A.uid===t.uid&&e===I});S!==-1&&(this.pendingRemoteTracks.splice(S,1),this.emit(It.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==ge.Connected)throw new $(L.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(o=>{var c;let{user:l,mediaType:u}=o;return!((c=this.remoteUserMap.get(l))!==null&&c!==void 0&&c.has(u))});const e=[],n=new Map;t.forEach(o=>{if(!this.connection)return;const c=this.connection.getPreMedia(o.ssrcId);if(c){const{track:l,mid:u,transceiver:p,player:m}=c;n.set(o.ssrcId,{track:l,id:u,transceiver:p,player:m})}else e.push(o)});const i=await this.connection.batchReceive(e.map(o=>{let{user:c,mediaType:l,ssrcId:u,rtxSsrcId:p}=o;return{kind:l,ssrcMsg:[{ssrcId:u,rtx:p}],mslabel:String(c._uintid)}}));e.forEach((o,c)=>{n.set(o.ssrcId,i[c])});for(const{user:o,mediaType:c,ssrcId:l}of t){const u=n.get(l);if(!u)return void R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(o.uid," subscribe data,").concat(c,", ").concat(l));const{track:p,id:m,transceiver:_,player:E}=u;if(_&&x("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:A,interceptRemoteAudioFrame:I}=q_();c==St.VIDEO?await A(_.receiver,{onSei:x("ENABLE_VIDEO_SEI")&&(w=>{var P;return(P=o._videoTrack)===null||P===void 0?void 0:P._onSei(w)})}):c==St.AUDIO&&await I(_.receiver,{enableTopn:!!x("ENABLE_AUDIO_TOPN"),enableMetadata:!!x("ENABLE_AUDIO_METADATA"),enablePts:!!x("ENABLE_AUDIO_PTS"),onMetadata:w=>{this.safeEmit(It.AudioMetadata,w)},onPts:w=>{this.safeEmit(It.AudioPts,w)}})}if(c===St.AUDIO?(o._audioTrack?o._audioTrack._updateOriginMediaStreamTrack(p):(o._audioTrack=new Ul(p,o.uid,o._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o._audioTrack.getTrackId()))),_&&o._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(o,o._audioTrack)):(o._videoTrack?o._videoTrack._updateOriginMediaStreamTrack(p):(o._videoTrack=new xl(p,o.uid,o._uintid,this.store,E),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o._videoTrack.getTrackId()))),_&&o._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(o,o._videoTrack)),x("ENABLE_VIDEO_SEI")&&_){const{interceptRemoteVideoFrame:A,interceptRemoteAudioFrame:I}=q_();c==St.VIDEO?await A(_.receiver,{onSei:w=>{var P;(P=o._videoTrack)===null||P===void 0||P._onSei(w)}}):c==St.AUDIO&&await I(_.receiver)}const S=this.remoteUserMap.get(o);S?S.set(c,m):this.remoteUserMap.set(o,new Map([[c,m]])),this.statsCollector.addRemoteStats(o.uid),this.statsUploader.startUploadInboundStats();const T=this.pendingRemoteTracks.findIndex(A=>{let{user:I,kind:w}=A;return I.uid===o.uid&&c===w});T!==-1&&(this.pendingRemoteTracks.splice(T,1),this.emit(It.MediaReconnectEnd,o.uid))}}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:p}=l;return e!==void 0?u.uid===t.uid&&e===p:u.uid===t.uid});if(i.forEach(l=>{const u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),this.connection&&this.state===ge.Connected||n||i.forEach(l=>{let{kind:u}=l;var p;if(u===St.AUDIO)(p=t._audioTrack)===null||p===void 0||p._destroy(),t._audioTrack=void 0;else if(u===St.VIDEO){var m;(m=t._videoTrack)===null||m===void 0||m._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==ge.Connected)return;const o=this.filterTobeUnSubscribedTracks(t,e);if(o.length===0)return;await this.connection.stopReceiving(o.map(l=>{let[,{id:u}]=l;return u}));const c=this.createUnsubscribeMessage(o);return this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),o.forEach(l=>{let[u,{kind:p}]=l;var m,_;if(p===St.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),p===St.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),n||((_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0);else if(p===St.AUDIO){var E;this.unbindRemoteTrackEvents(u._audioTrack),!n&&((E=u._audioTrack)===null||E===void 0||E._destroy(),u._audioTrack=void 0)}}),c}async unsubscribeDataChannel(t,e){if(e.forEach(o=>{const c=this.pendingRemoteDataChannels.findIndex(l=>l.id===o.id);c!==-1&&this.pendingRemoteDataChannels.splice(c,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(t,e);if(n.length===0)return;e.forEach(o=>{o._close()});const i=this.remoteDataChannelMap.get(t);return n.forEach(o=>{i&&i.delete(o.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),n.map(o=>o.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:o,mediaType:c}of t){const l=this.pendingRemoteTracks.filter(u=>{let{user:p,kind:m}=u;return c!==void 0?p.uid===o.uid&&c===m:p.uid===o.uid});l.forEach(u=>{const p=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(p,1)}),e=e.concat(l)}if(!this.connection||this.state!==ge.Connected)return void e.forEach(o=>{let{user:c,kind:l}=o;var u;if(l===St.AUDIO)(u=c._audioTrack)===null||u===void 0||u._destroy(),c._audioTrack=void 0;else if(l===St.VIDEO){var p;(p=c._videoTrack)===null||p===void 0||p._destroy(),c._videoTrack=void 0}});const n=os(t).call(t,(o,c)=>{let{user:l,mediaType:u}=c;const p=this.filterTobeUnSubscribedTracks(l,u);return o.concat(p)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(o=>{let[,{id:c}]=o;return c}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(o=>{let[c,{kind:l}]=o;var u,p;if(l===St.VIDEO&&c._videoSSRC&&((u=this.connection)===null||u===void 0||u.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===St.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),(p=c._videoTrack)===null||p===void 0||p._destroy(),c._videoTrack=void 0;else if(l===St.AUDIO){var m;this.unbindRemoteTrackEvents(c._audioTrack),(m=c._audioTrack)===null||m===void 0||m._destroy(),c._audioTrack=void 0}}),i}isPreSubScribe(t){return!this.connection||this.state!==ge.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===St.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}addAudioMetadata(t){const e=this.localTrackMap.get(st.LocalAudioTrack),n=e&&e.track;n&&n.metadata.push(t)}getAllTracks(t){const e=this.localTrackMap.get(st.LocalAudioTrack);if((e==null?void 0:e.track)instanceof gn){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return o!==st.LocalAudioTrack}).filter(i=>{let[o]=i;return!(t&&o===st.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===st.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,n,i,o){if(t){const l=this.localTrackMap.get(st.LocalAudioTrack),u=i?this.localTrackMap.get(st.LocalVideoLowTrack):this.localTrackMap.get(st.LocalVideoTrack);bt.publish(this.store.sessionId,{eventElapse:ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:l==null?void 0:l.track.getTrackLabel(),videoName:u==null?void 0:u.track.getTrackLabel(),screenshare:(u==null?void 0:u.track._hints.indexOf(Ie.SCREEN_TRACK))!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var c;n||(n=[]);const l=n.find(p=>p instanceof $e),u=i?(c=this.localTrackMap.get(st.LocalVideoTrack))===null||c===void 0?void 0:c.track:n.find(p=>p instanceof Me);bt.publish(this.store.sessionId,{eventElapse:ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:l==null?void 0:l.getTrackLabel(),videoName:u==null?void 0:u.getTrackLabel(),screenshare:(u==null?void 0:u._hints.indexOf(Ie.SCREEN_TRACK))!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(t,e,n,i){const o=i===St.VIDEO?n._videoSSRC:n._audioSSRC;o&&bt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===St.VIDEO,audio:i===St.AUDIO,peerid:n.uid,subscribeRequestid:o,p2pid:this.store.p2pId,eventElapse:ei.measureFromSubscribeStart(this.store.clientId,o),preSsrc:this.isPreSubScribe(o)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Qn("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=ig(this.store),this.emit(It.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(st.LocalAudioTrack);if((t==null?void 0:t.track)instanceof gn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=ge.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(st.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(st.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof Me||e&&e.track instanceof $e?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(Gi(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(st.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Mc(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.connection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=ge.Reconnecting,x("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=ig(this.store),this.emit(It.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case st.LocalVideoTrack:pt(e=i._hints).call(e,Ie.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case st.LocalAudioTrack:i instanceof gn?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case st.LocalVideoLowTrack:}}),this.emit(It.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(Gi(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(It.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[e,n]=t;Array.from(Gi(n).call(n)).forEach(i=>{this.setPendingRemoteDataChannel(e,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const n of this.pendingRemoteDataChannels){const{user:i,id:o}=n;if((t instanceof Ka?t.uid:t)===i.uid&&o===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:o}=n;if((t instanceof Ka?t.uid:t)===i.uid&&e===o)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return xr(function*(){if(!e.connection||e.state!==ge.Connected)return;const n=yield oe(e.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield oe(e.connection.restartICE(t));const c=yield oe(i.next());if(c.done)return;const l=c.value,u=yield l;switch(rR(e.connection)&&e.reportPCStats(Date.now(),!1,e._pcStatsUploadType),t){case ti.UDP_TCP_RELAY:e._pcStatsUploadType=Zo.UDP_TCP_RESTART;break;case ti.TCP_RELAY:e._pcStatsUploadType=Zo.TCP_RESTART;break;case ti.RELAY:e._pcStatsUploadType=Zo.RELAY_RESTART;break;default:e._pcStatsUploadType=Zo.OLD_RESTART}e._isTryConnecting=!0,i.next(u)}catch(c){var o;(o=i)===null||o===void 0||o.throw(c)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(st.LocalVideoTrack),n=this.localTrackMap.get(st.LocalAudioTrack),i=t.videoSend.find(T=>T.ssrc===(e==null?void 0:e.ssrcs[0].ssrcId)),o=t.audioSend.find(T=>T.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!o)return 1;const c=_r(this,It.NeedSignalRTT),l=i?i.rttMs:void 0,u=o?o.rttMs:void 0,p=l&&u?(l+u)/2:l||u,m=(p&&c?(p+c)/2:p||c)||0,_=100*t.sendPacketLossRate*.7/50+.3*m/1500,E=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,S=e==null?void 0:e.track;if(S&&S._encoderConfig&&S._hints.indexOf(Ie.SCREEN_TRACK)===-1){const T=S._encoderConfig.bitrateMax,A=t.bitrate.actualEncoded;if(T&&A){const I=(1e3*T-A)/(1e3*T);return $M[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const o=i._audioSSRC,c=i._videoSSRC,l=t.audioRecv.find(A=>A.ssrc===o),u=t.videoRecv.find(A=>A.ssrc===c);if(!l&&!u)return void(e+=1);const p=_r(this,It.NeedSignalRTT),m=t.rtt,_=(m&&p?(m+p)/2:m||p)||0,E=l?l.jitterMs:void 0,S=t.recvPacketLossRate;let T=.7*S*100/50+.3*_/1500;E&&(T=.6*S*100/50+.2*_/1500+.2*E/400),e+=T<.1?1:T<.17?2:T<.36?3:T<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new gt((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}async replaceTrack(t,e){var n;if(R.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(e.getTrackId(),"]")),!this.connection||this.state!==ge.Connected)return;const i=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:l}]=c;return t===l});if(!i)return;const o=i[0];if(t!==e&&(this.unbindLocalTrackEvents([{track:t,type:o}]),this.bindLocalTrackEvents([{track:e,type:o}]),i[1].track=e),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(e,i[1].id)),this.isPlanB){const c=i[1];c.id=e._mediaStreamTrack.id,this.localTrackMap.set(o,c)}if(o===st.LocalVideoTrack&&!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&ae().supportDualStreamEncoding){const c=this.localTrackMap.get(st.LocalVideoLowTrack);if(c){const l=t._mediaStreamTrack.clone();c.track._originMediaStreamTrack.stop(),c.track._mediaStreamTrack=l,c.track._originMediaStreamTrack=l,await new gt((u,p)=>{this.handleReplaceTrack(c.track,u,p,!0)})}}}filterTobePublishedTracks(t,e,n){const i=[],o=this.getAllTracks();t=Rl(t=t.filter(p=>o.indexOf(p)===-1));let c,l=!1;const u=this.localTrackMap.get(st.LocalAudioTrack);for(const p of t){if(p instanceof Me&&(this.localTrackMap.has(st.LocalVideoTrack)||l?new $(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:p,type:st.LocalVideoTrack}),l=!0),e)){const m=this.getLowVideoTrack(p,n);i.push({track:m,type:st.LocalVideoLowTrack})}if(p instanceof $e)if(u){const m=u.track;if(m instanceof gn)nR([p]),m.addAudioTrack(p),this.bindLocalAudioTrackEvents(p,!0);else{const _=iR([m,p]);R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(_.getTrackId(),"]")),this.replaceTrack(m,_)}}else c instanceof gn?(nR([p]),c.addAudioTrack(p)):c||!p._useAudioElement&&ae().webAudioMediaStreamDest&&!p._bypassWebAudio?c=iR(c?[p,c]:[p]):c=p}return c&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(c.getTrackId(),"]")),i.push({track:c,type:st.LocalAudioTrack})),i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=Rl(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof $e){const o=this.localTrackMap.get(st.LocalAudioTrack);if(!o)continue;o.track instanceof gn?(o.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),o.track.trackList.length===0&&(e.push([st.LocalAudioTrack,o]),o.track.close())):e.push([st.LocalAudioTrack,o])}if(i instanceof Me){const o=this.localTrackMap.get(st.LocalVideoTrack);if(!o)continue;e.push([st.LocalVideoTrack,o]);const c=this.localTrackMap.get(st.LocalVideoLowTrack);c&&e.push([st.LocalVideoLowTrack,c])}}return e}filterTobePublishedDataChannels(t){return t=(t=Rl(t)).filter(e=>this.localDataChannels.findIndex(n=>n.id===e.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Rl(t)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case st.LocalVideoTrack:n.addListener(yt.GET_STATS,this.handleGetLocalVideoStats),n.addListener(yt.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case st.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case st.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof gn?t.trackList.forEach(n=>{n.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||(t.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(yt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case st.LocalVideoTrack:n.off(yt.GET_STATS,this.handleGetLocalVideoStats),n.off(yt.GET_RTC_STATS,this.handleGetRTCStats),n.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case st.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case st.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof gn?t.trackList.forEach(e=>{e.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(yt.GET_STATS,this.handleGetLocalAudioStats),e.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(yt.GET_STATS,this.handleGetLocalAudioStats),t.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(yt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof xl&&e.addListener(yt.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof Ul&&e.addListener(yt.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(yt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(St.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(St.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var o;let c,l,{track:u,type:p}=n;switch(p){case st.LocalAudioTrack:c=Ee.Audio,l={dtx:u instanceof xh&&u._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case st.LocalVideoTrack:c=pt(o=u._hints).call(o,Ie.SCREEN_TRACK)?Ee.Screen:Ee.High,l=Ao(Ao({},mx(u)),{},{codec:this.store.codec,svc_mode:G_()});break;case st.LocalVideoLowTrack:c=Ee.Low,l=Ao(Ao({},mx(u)),{},{codec:this.store.codec,svc_mode:G_()})}return{stream_type:c,attributes:l,ssrcs:e[i]}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[o,{track:c,ssrcs:l,id:u}]=e;switch(o){case st.LocalVideoTrack:i=pt(n=c._hints).call(n,Ie.SCREEN_TRACK)?Ee.Screen:Ee.High;break;case st.LocalAudioTrack:i=Ee.Audio;break;case st.LocalVideoLowTrack:i=Ee.Low}return{stream_type:i,ssrcs:l,mid:u}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:o,type:c}=n;this.localTrackMap.set(c,{track:o,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(It.PeerConnectionStateChange,e),e==="connecting"&&t instanceof Wr&&!qe()&&x("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{e==="connecting"&&t.extendCandidate()},x("FIRST_TCP_CANDIDATE_INTERVAL")),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof Wr&&l2(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Zo.DISCONNECTED_OR_FAILED,_r(this,It.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(o=>o.getTrackId()),i=this.pendingLocalDataChannels.map(o=>"dc_".concat(o.id));bt.reportApiInvoke(this.store.sessionId,{name:tn.REPUB_AFTER_PC_CONNECTED,options:n.concat(i),tag:We.TRACER}).onSuccess(),this.republish()}if(x("NEW_ICE_RESTART")&&t instanceof Wr&&!qe()&&!this._forceTurn){if(pt(dx).call(dx,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=o=>{rR(t)&&(R.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(o)),_r(this,It.QueryClientConnectionState)==="CONNECTED"&&this.emit(It.RequestRestartICE,o))},i=()=>{rR(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),R.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(It.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{u2(t,n,i)},800))}}else{if(e==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&x("ICE_RESTART")&&_r(this,It.QueryClientConnectionState)==="CONNECTED"&&this.emit(It.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(It.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(It.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),bt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:We.TRACER}).onSuccess(),this.emit(It.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(Gi(n=this.remoteUserMap).call(n)).find(c=>c._audioSSRC===e);var o;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(o=i.audioTrack)===null||o===void 0||o.emit(Fr.FIRST_FRAME_DECODED),bt.firstRemoteFrame(this.store.sessionId,yn.FIRST_AUDIO_DECODE,je.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(Gi(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===e);i&&bt.firstRemoteFrame(this.store.sessionId,yn.FIRST_AUDIO_RECEIVED,je.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{var o;const c=Array.from(Gi(o=this.remoteUserMap).call(o)).find(l=>l._videoSSRC===e);c&&this.store.firstVideoFrameDecoded(c.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoRender=e=>{var n;const i=Array.from(Gi(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===e);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(i))},t.onFirstVideoReceived=e=>{var n;const i=Array.from(Gi(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===e);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstReceived:Date.now()}),bt.firstRemoteFrame(this.store.sessionId,yn.FIRST_VIDEO_RECEIVED,je.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",o=n.candidateType==="relay";n.candidateType!=="unknown"&&i===o||this.emit(It.ConnectionTypeChange,i),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ja(n))," -> ").concat(JSON.stringify(ja(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ja(n))," -> ").concat(JSON.stringify(ja(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return Ao(Ao({},e),n)},t.onICECandidateError=e=>{this._iceError=e}}resetConnection(t){t instanceof Wr&&function(e){Jl.delete(e.id),l2(e)}(t),t.close(),this.emit(It.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(st.LocalAudioTrack);if(t instanceof $e&&(n==null?void 0:n.track)instanceof gn)return n.track.isActive||e.push([st.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:c}]=o;return t===c});if(i&&(e.push(i),i[0]===st.LocalVideoTrack)){const o=this.localTrackMap.get(st.LocalVideoLowTrack);o&&e.push([st.LocalVideoLowTrack,o])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(st.LocalAudioTrack);if(t instanceof $e&&(n==null?void 0:n.track)instanceof gn)return n.track.isActive&&e.push([st.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:c}]=o;return t===c});if(i)if(i[0]===st.LocalVideoTrack){e.push(i);const o=this.localTrackMap.get(st.LocalVideoLowTrack);o&&e.push([st.LocalVideoLowTrack,o])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[o,{track:c,ssrcs:l,id:u}]=e;switch(o){case st.LocalAudioTrack:i=Ee.Audio;break;case st.LocalVideoTrack:i=pt(n=c._hints).call(n,Ie.SCREEN_TRACK)?Ee.Screen:Ee.High;break;case st.LocalVideoLowTrack:i=Ee.Low}return{stream_type:i,ssrcs:l,mid:u}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[o,{track:c,ssrcs:l,id:u}]=e;switch(o){case st.LocalAudioTrack:i=Ee.Audio;break;case st.LocalVideoTrack:i=pt(n=c._hints).call(n,Ie.SCREEN_TRACK)?Ee.Screen:Ee.High;break;case st.LocalVideoLowTrack:i=Ee.Low}return{stream_type:i,ssrcs:l,mid:u}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const o=i.get(e);if(!o)return n;n.push([t,{kind:e,id:o}])}else Array.from(i.entries()).forEach(o=>{let[c,l]=o;n.push([t,{kind:c,id:l}])});return n}filterTobeUnSubscribedDataChannels(t,e){const n=[];return e.forEach(i=>{var o;(o=this.remoteDataChannelMap.get(t))!==null&&o!==void 0&&o.has(i.id)&&n.push(i)}),n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:o,id:c}]=n;switch(o){case St.VIDEO:return void(i._videoSSRC&&e.push({stream_type:St.VIDEO,ssrcId:i._videoSSRC}));case St.AUDIO:return void(i._audioSSRC&&e.push({stream_type:St.AUDIO,ssrcId:i._audioSSRC}))}}),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach(n=>{let[i,{kind:o}]=n;if(e.has(i)){let c=e.get(i);o===St.VIDEO?c|=In.Video:c|=In.Audio,e.set(i,c)}else o===St.VIDEO?e.set(i,In.Video):e.set(i,In.Audio)}),{users:Array.from(e.entries()).map(n=>{let[i,o]=n;return{stream_id:i.uid,stream_type:o}})}}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const o=this.remoteUserMap.get(n);o&&(o.delete(i),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(st.LocalVideoTrack),n=this.localTrackMap.get(st.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new gt((i,o)=>{this.handleUpdateVideoEncoder(e.track,i,o,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new gt((i,o)=>{this.handleUpdateVideoEncoder(n.track,i,o,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof Wr&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof Wr&&this.connection.isPreSub()}mapPubResToRemoteConfig(t,e,n){return t.map((i,o)=>{var c;let{stream_type:l}=i;const u=(c=e.find(p=>{let{stream_type:m}=p;return l===m}))===null||c===void 0?void 0:c.attributes;if(u&&x("DISABLE_SCREEN_SHARE_REMB")){const p=n[o]._hints;(pt(p).call(p,Ie.SCREEN_TRACK)||pt(p).call(p,Ie.SCREEN_LOW_TRACK))&&(u.remb=!1,R.debug("disable remb for screen share, hints:",p))}return u})}async tryToUnmuteAudio(t){for(let n=0;n<t.length;n++)if(t[n]instanceof $e){var e;const i=this.filterTobeUnmutedTracks(t[n]);if(i.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(i.map(c=>{let[,{id:l}]=c;return l})));const o=this.createUnmuteMessage(i);return void await we(this,It.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(It.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(It.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await xn(Gy(this.dtlsFailedCount,pn)),this.emit(It.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await Kn(this,It.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(It.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(st.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Me)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof Me).length>1)throw new $(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof $e).length>1&&(t.some(e=>e instanceof $e&&e._bypassWebAudio)||!ae().webAudioMediaStreamDest))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof Me&&this.pendingLocalTracks.some(n=>n instanceof Me))throw new $(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof $e&&this.pendingLocalTracks.some(n=>n instanceof $e)&&(!ae().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof $e&&n._bypassWebAudio)))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){var n;const i=!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&ae().supportDualStreamEncoding,o=Ao(Ao({},{width:160,height:120,framerate:15,bitrate:50}),e);let c;c=i?t._mediaStreamTrack.clone():sR(t,o);const l=Ae(8,"track-low-"),u=new Me(c,Ao(Ao({},i&&{scaleResolutionDownBy:F0(o,t)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,l);return u.on(qc.TRANSCEIVER_UPDATED,p=>{t._updateRtpTransceiver(p,Nl.LOW_STREAM)}),u._hints.push(Ie.LOW_STREAM),pt(n=t._hints).call(n,Ie.SCREEN_TRACK)&&u._hints.push(Ie.SCREEN_LOW_TRACK),t.on("sei-to-send",p=>{u.emit("sei-to-send",p)}),t.addListener(yt.NEED_CLOSE,()=>{u.close()}),u}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Wr){var o,c,l,u;const p=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:m,dtlsTransportState:_,peerConnectionState:E}=this.connection,{local:S,remote:T}=await this.connection.getSelectedCandidatePair();bt.pcStats(this.store.sessionId,{startTime:p,eventElapse:t-p||0,iceconnectionsate:m,dtlsstate:_,connectionstate:E,intSucc:e?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(o=S==null?void 0:S.protocol)!==null&&o!==void 0?o:"",selectedLocalCandidateType:(c=S.candidateType)!==null&&c!==void 0?c:"",selectedLocalCandidateAddress:"".concat(S.address,":").concat(S.port),selectedRemoteCandidateProtocol:(l=T.protocol)!==null&&l!==void 0?l:"",selectedRemoteCandidateType:(u=T.candidateType)!==null&&u!==void 0?u:"",selectedRemoteCandidateAddress:"".concat(T.address,":").concat(T.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(t){const e=this.store.keyMetrics,n=e.firstVideoFrameDecoded.find(_=>_.userId===t.uid);if(!n)return;const{isInternalUpload:i,isExternalUpload:o}=n;if(i&&o)return;const{subscribeEnd:c,firstPreRender:l,peerPublishDuration:u,peerPubStatusMs:p}=n;let{firstRender:m=0}=n;if(c&&(m||l)&&u&&p){n.isInternalUpload=!0;const{playEnd:_}=n;_&&(n.isExternalUpload=!0);const{firstPreRender:E=0}=n;m=E||m;const S=t.videoTrack,T={peer:t._uintid,width:(S==null?void 0:S._videoWidth)||0,height:(S==null?void 0:S._videoHeight)||0,ssrc:t._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:u,peerPubStatusMs:p,joinChannelStart:e.joinStart||0,preloadStart:e.preloadStart||0,preloadEnd:e.preloadEnd||0,apStart:e.requestAPStart||0,apEnd:e.requestAPEnd||0,suaEnd:e.requestSUAEnd||0,beforeConnect:e.beforeConnect||0,peerReceiver:e.peerReceiver||0,ice:e.iceConnectionEnd||0,pc:e.peerConnectionEnd||0,signalConnected:e.signalConnected||0,joinReq:e.joinReq||0,joinRes:e.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:E||0,firstRender:_?Math.max(m,_):Math.max(m,c),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!t._videoSSRC||!this.isPreSubScribe(t._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:F1(this.store)};bt.firstXLAPeerFirstVideoFrame(this.store.sessionId,T)}}reportVideoFirstFrameDecoded(t,e,n,i){var o;const c=Array.from(Gi(o=this.remoteUserMap).call(o)).find(l=>l._videoSSRC===t);if(c){i||this.store.subscribe(c.uid,"video",void 0,void 0,void 0,void 0,Date.now());const l=this.store.keyMetrics,u=l.subscribe.find(p=>p.userId===c.uid&&p.type==="video");bt.firstRemoteVideoDecode(this.store.sessionId,yn.FIRST_VIDEO_DECODE,je.FIRST_VIDEO_DECODE,{peer:c._uintid,videowidth:e,videoheight:n,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:l.requestAPEnd||0,apStart:l.requestAPStart||0,joinGwEnd:l.joinGatewayEnd||0,joinGwStart:l.joinGatewayStart||0,pcEnd:l.peerConnectionEnd||0,pcStart:l.peerConnectionStart||0,subscriberEnd:(u==null?void 0:u.subscribeEnd)||0,subscriberStart:(u==null?void 0:u.subscribeStart)||0,videoAddNotify:(u==null?void 0:u.streamAdded)||0,state:i?1:0,firstFrame:(u==null?void 0:u.firstFrame)||0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const o=i.get(e);if(!o)return!1;const c=await this.connection.getRemoteSSRC(o);return c!==void 0&&c!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===st.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Nl.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Ct(Zt.prototype,"startP2PConnection",[fi],Object.getOwnPropertyDescriptor(Zt.prototype,"startP2PConnection"),Zt.prototype),Ct(Zt.prototype,"connect",[fi],Object.getOwnPropertyDescriptor(Zt.prototype,"connect"),Zt.prototype),Ct(Zt.prototype,"updateRemoteRTPCapabilities",[fi],Object.getOwnPropertyDescriptor(Zt.prototype,"updateRemoteRTPCapabilities"),Zt.prototype),Ct(Zt.prototype,"publishDataChannel",[fi],Object.getOwnPropertyDescriptor(Zt.prototype,"publishDataChannel"),Zt.prototype),Ct(Zt.prototype,"unpublish",[fi],Object.getOwnPropertyDescriptor(Zt.prototype,"unpublish"),Zt.prototype),Ct(Zt.prototype,"unpublishDataChannel",[fi],Object.getOwnPropertyDescriptor(Zt.prototype,"unpublishDataChannel"),Zt.prototype),Ct(Zt.prototype,"unpublishLowStream",[fi],Object.getOwnPropertyDescriptor(Zt.prototype,"unpublishLowStream"),Zt.prototype),Ct(Zt.prototype,"subscribeDataChannel",[fi],Object.getOwnPropertyDescriptor(Zt.prototype,"subscribeDataChannel"),Zt.prototype),Ct(Zt.prototype,"subscribe",[fi],Object.getOwnPropertyDescriptor(Zt.prototype,"subscribe"),Zt.prototype),Ct(Zt.prototype,"massSubscribe",[fi],Object.getOwnPropertyDescriptor(Zt.prototype,"massSubscribe"),Zt.prototype),Ct(Zt.prototype,"unsubscribe",[fi],Object.getOwnPropertyDescriptor(Zt.prototype,"unsubscribe"),Zt.prototype),Ct(Zt.prototype,"unsubscribeDataChannel",[fi],Object.getOwnPropertyDescriptor(Zt.prototype,"unsubscribeDataChannel"),Zt.prototype),Ct(Zt.prototype,"massUnsubscribe",[fi],Object.getOwnPropertyDescriptor(Zt.prototype,"massUnsubscribe"),Zt.prototype),Ct(Zt.prototype,"muteRemote",[fi],Object.getOwnPropertyDescriptor(Zt.prototype,"muteRemote"),Zt.prototype),Ct(Zt.prototype,"unmuteRemote",[fi],Object.getOwnPropertyDescriptor(Zt.prototype,"unmuteRemote"),Zt.prototype),Ct(Zt.prototype,"hasRemoteMediaWithLock",[fi],Object.getOwnPropertyDescriptor(Zt.prototype,"hasRemoteMediaWithLock"),Zt.prototype),Ct(Zt.prototype,"disconnectForReconnect",[fi],Object.getOwnPropertyDescriptor(Zt.prototype,"disconnectForReconnect"),Zt.prototype),Ct(Zt.prototype,"updateBitrateLimit",[fi],Object.getOwnPropertyDescriptor(Zt.prototype,"updateBitrateLimit"),Zt.prototype),Ct(Zt.prototype,"remoteMediaSsrcChanged",[fi],Object.getOwnPropertyDescriptor(Zt.prototype,"remoteMediaSsrcChanged"),Zt.prototype),Zt);function fi(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,c=await o.lock("From P2PChannel.".concat(e));try{for(var l=arguments.length,u=new Array(l),p=0;p<l;p++)u[p]=arguments[p];return await i.apply(this,u)}finally{c()}},n}function f2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function m2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?f2(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const zZ=Date.now(),KZ=20,aR=new Map,cg=new Map;async function _2(t){const e=aR.get(t),n=Array.isArray(e)&&e[e.length-1],i=cg.get(t);if(!n)return void(i.isSyncing=!1);const o={uid:n.uid,payload:n.payload};i.firstRecvTs===0&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const c=n.sendTs-i.firstSendTs,l=c-(Date.now()-i.firstRecvTs);l>0&&(i.firstRecvTs=Date.now()-c);let u=n.mediaDelay+l;u<=0?(e.pop(),g2(n.context,o),u=0):u=Math.min(u,KZ),setTimeout(()=>e.length&&_2(t),u)}function g2(t,e){t.safeEmit(te.STREAM_MESSAGE,e.uid,e.payload),t.onStreamMessage&&t.onStreamMessage(e)}function YZ(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return g2(n,{uid:t.uid,payload:t.payload});const i="".concat(n.id,"-").concat(t.uid),o=aR.get(i)||[],c=o.findIndex(m=>t.sendTs>=m.sendTs),l=m2(m2({},t),{},{context:n,mediaDelay:e,recvTs:Date.now()});c===-1?o.push(l):o.splice(c,0,l),aR.set(i,o);let u=!1;var p;cg.has(i)?u=!((p=cg.get(i))===null||p===void 0||!p.isSyncing):cg.set(i,{isSyncing:u,firstRecvTs:0,firstSendTs:0}),u||_2(i)}const qZ=ie().name;function E2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function S2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?E2(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const Ql="websdk_ng_cache_parameter",XZ=x("MAX_PRELOAD_ASYNC_LENGTH"),JZ=1e4,rd=new Map,sd=[];let cR=null,dR=0,lR=0;const dg=new Map,QZ=function(t,e){const n=[];let i=0;const o=async()=>{const c=n.shift();c&&await c(),n.length>0&&i<e?o():i--};return async function(){for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return new gt(async(p,m)=>{n.push(async()=>{try{const _=await t(...l);p(_)}catch(_){m(_)}}),i<e&&(i++,o())})}}(v2,XZ),uR=Oi.CancelToken.source();async function v2(t,e,n,i,o,c){try{if(!x("ENABLE_PRELOAD"))return;if(!ae().supportWebCrypto)return void La(()=>{R.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new $(L.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Mn(n,"token",1,2047),Mn(t,"appid",1,2047),U_(e),i&&V_(i);const l=Kc();R.debug("preload channel ".concat(e,", uid is ").concat(i));const u={appId:t,cname:e,token:n||t,uid:typeof i!="string"?i:null,sid:l,proxyServer:o};let p,m;typeof i=="string"?(u.stringUid=i,[m,p]=await gt.all([LZ(i,{sid:l,appId:t},uR.token),Kx(S2(S2({},u),{},{token:n||t,uid:0}),uR.token)]),u.uid=m.uid,p.gatewayInfo.uid=u.uid,p.gatewayInfo.res.uid=u.uid):(c&&(u.stringUid=c),p=await Kx(u,uR.token));const _={sid:l,appId:t,cname:e,token:n||t,uid:u.stringUid||i,intUid:u.uid||p.gatewayInfo.uid,stringUid:u.stringUid,ts:Date.now(),sua:m,ap:p};await async function(E){let S;try{E.uid&&y2({appId:E.appId,cname:E.cname,token:E.token,uid:E.uid,stringUid:E.stringUid});const T=I2(E),A=await async function(w,P){try{const D=await window.crypto.subtle.importKey("raw",h1(P),"AES-GCM",!1,["encrypt"]),U=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},D,zc(window.btoa(JSON.stringify(w))));return Ma(new Uint8Array(U))}catch{return}}(E,E.token||E.appId);if(!A)return;S=b2(Ql);const I=S?JSON.parse(S):[];I.push({[T]:A}),I.length>x("AP_CACHE_NUM")&&I.shift(),lg(Ql,JSON.stringify(I))}catch(T){R.warn("Error caching server parameters:",T.message),lg(Ql,"")}}(_),dR++}catch(l){throw lR++,function(u){cR||(cR=window.setTimeout(()=>{let m="";dg.forEach((_,E)=>{m+="".concat(E,": ").concat(_," ;")}),bt.reportApiInvoke(null,{name:tn.PRELOAD,options:{success:dR,failed:lR,err:m}}).onError(u),dR=0,lR=0,dg.clear(),cR=null},JZ));const p=dg.get(u.code)||0;dg.set(u.code,p+1)}(l),l}}async function T2(t){try{if(x("AP_REQUEST_DETAIL")||x("ENABLE_ROLE_SELECT_EDGE"))return;const e=y2(t);if(!e||t.cloudProxyServer!=="disabled")return;const n=await async function(i,o){try{const c=await window.crypto.subtle.importKey("raw",h1(o),"AES-GCM",!1,["decrypt"]),l=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},c,zc(i));return JSON.parse(window.atob(Ma(new Uint8Array(l))))}catch{return}}(e,t.token||t.appId);if(!n||!function(i,o){return i.cname===o.cname&&i.appId===o.appId&&i.token===o.token?o.stringUid?i.stringUid===o.stringUid:typeof o.uid=="number"?i.uid===o.uid:i.uid==o.uid:!1}(n,t))return;if(n&&Date.now()-n.ts<x("AP_CACHE_LIFETIME"))return n}catch(e){R.warn("Error get preloadInfo",e.message)}}function y2(t){let e;try{if(e=b2(Ql),!e)return;const n=JSON.parse(e),i=I2(t),o=function(l,u){for(let p=l.length-1;p>=0;p--)if(u(l[p]))return p;return-1}(n,l=>i in l);if(o===-1)return;const c=n.splice(o,1)[0];return lg(Ql,JSON.stringify(n)),c[i]}catch(n){R.warn("Error delete preload info: ".concat(e),n.message),lg(Ql,"")}}function hR(t){if(t){let e=rd.get(t);e&&(window.clearTimeout(e),e=null,rd.delete(t)),pt(sd).call(sd,t)||t.cloudProxyServer!=="disabled"||sd.push(t)}if(rd.size<x("AP_CACHE_NUM")&&sd.length>0){const e=sd.shift();rd.set(e,window.setTimeout(async()=>{const{appId:n,cname:i,token:o,stringUid:c,uid:l,proxyServer:u}=e;try{await QZ(n,i,o,l,u,c),rd.has(e)&&hR(e)}catch(p){R.warn("update preload failed",p.message),R2(e)}},x("AP_UPDATE_INTERVAL")))}}function R2(t){const e=sd.indexOf(t);e!==-1&&sd.splice(e,1);let n=rd.get(t);n&&(window.clearTimeout(n),n=null,rd.delete(t),hR())}function C2(t,e){const n=t.sua,i=t.ap;e&&n&&bt.reqUserAccount(t.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:e,uid:t.intUid,errorCode:null,extend:n.req}),bt.reportResourceTiming(t.ap.url,t.sid),bt.joinWebProxyAP(t.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(o=>o.ip).join(","),eventType:"disabled",unilbsServerIds:[an.CHOOSE_SERVER,an.CLOUD_PROXY_FALLBACK].toString()}),bt.joinChooseServer(t.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(o=>o.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[an.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function b2(t){return window.atob(window.localStorage.getItem(t)||"")}function lg(t,e){window.localStorage.setItem(t,window.btoa(e))}function I2(t){let e="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(e+="_s_".concat(t.uid)),typeof t.uid=="number"&&(e+="_".concat(t.uid)),t.token&&(e+="_".concat(t.token)),S1(e)}function ZZ(t){let e=function(){const n=e$.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let o=n.appId;o!==void 0&&(cn(i,10),qa(i,o));let c=n.cid;c!==void 0&&(cn(i,16),cn(i,c));let l=n.cname;l!==void 0&&(cn(i,26),qa(i,l));let u=n.deviceId;u!==void 0&&(cn(i,34),qa(i,u));let p=n.elapse;p!==void 0&&(cn(i,40),Xa(i,p));let m=n.fileSize;m!==void 0&&(cn(i,48),Xa(i,Zl(m)));let _=n.height;_!==void 0&&(cn(i,56),Xa(i,Zl(_)));let E=n.jpg;E!==void 0&&(cn(i,66),cn(i,E.length),A2(i,E));let S=n.networkType;S!==void 0&&(cn(i,72),Xa(i,Zl(S)));let T=n.osType;T!==void 0&&(cn(i,80),Xa(i,Zl(T)));let A=n.requestId;A!==void 0&&(cn(i,90),qa(i,A));let I=n.sdkVersion;I!==void 0&&(cn(i,98),qa(i,I));let w=n.sequence;w!==void 0&&(cn(i,104),Xa(i,Zl(w)));let P=n.sid;P!==void 0&&(cn(i,114),qa(i,P));let D=n.timestamp;D!==void 0&&(cn(i,120),Xa(i,D));let U=n.uid;U!==void 0&&(cn(i,128),cn(i,U));let G=n.vid;G!==void 0&&(cn(i,136),cn(i,G));let W=n.width;W!==void 0&&(cn(i,144),Xa(i,Zl(W)));let F=n.service;F!==void 0&&(cn(i,152),cn(i,F));let X=n.callbackData;X!==void 0&&(cn(i,162),cn(i,X.length),A2(i,X));let tt=n.ticket;tt!==void 0&&(cn(i,170),qa(i,tt));let nt=n.vendorConfigs;nt!==void 0&&(cn(i,178),qa(i,nt))}(t,e),function(n){let i=n.bytes,o=n.limit;return i.length===o?i:i.subarray(0,o)}(e)}function $Z(t){return function(n){let i={};t:for(;!n$(n);){let o=Qh(n);switch(o>>>3){case 0:break t;case 1:i.code=Qh(n);break;case 2:i.msg=O2(n,Qh(n));break;case 3:i.requestId=O2(n,Qh(n));break;case 4:i.timestamp=i$(n,!1);break;default:t$(n,7&o)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function t$(t,e){switch(e){case 0:for(;128&Ts(t););break;case 2:pR(t,Qh(t));break;case 5:pR(t,4);break;case 1:pR(t,8);break;default:throw new Error("Unimplemented type: "+e)}}function Zl(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let e$=[];function pR(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function n$(t){return t.offset>=t.limit}function ug(t,e){let n=t.bytes,i=t.offset,o=t.limit,c=i+e;if(c>n.length){let l=new Uint8Array(2*c);l.set(n),t.bytes=l}return t.offset=c,c>o&&(t.limit=c),i}function w2(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function A2(t,e){let n=ug(t,e.length);t.bytes.set(e,n)}function O2(t,e){let n=w2(t,e),i=String.fromCharCode,o=t.bytes,c="",l="";for(let u=0;u<e;u++){let p,m,_,E,S=o[u+n];128&S?(224&S)==192?u+1>=e?l+=c:(p=o[u+n+1],(192&p)!=128?l+=c:(E=(31&S)<<6|63&p,E<128?l+=c:(l+=i(E),u++))):(240&S)==224?u+2>=e?l+=c:(p=o[u+n+1],m=o[u+n+2],(49344&(p|m<<8))!=32896?l+=c:(E=(15&S)<<12|(63&p)<<6|63&m,E<2048||E>=55296&&E<=57343?l+=c:(l+=i(E),u+=2))):(248&S)==240?u+3>=e?l+=c:(p=o[u+n+1],m=o[u+n+2],_=o[u+n+3],(12632256&(p|m<<8|_<<16))!=8421504?l+=c:(E=(7&S)<<18|(63&p)<<12|(63&m)<<6|63&_,E<65536||E>1114111?l+=c:(E-=65536,l+=i(55296+(E>>10),56320+(1023&E)),u+=3))):l+=c:l+=i(S)}return l}function qa(t,e){let n=e.length,i=0;for(let l=0;l<n;l++){let u=e.charCodeAt(l);u>=55296&&u<=56319&&l+1<n&&(u=(u<<10)+e.charCodeAt(++l)-56613888),i+=u<128?1:u<2048?2:u<65536?3:4}cn(t,i);let o=ug(t,i),c=t.bytes;for(let l=0;l<n;l++){let u=e.charCodeAt(l);u>=55296&&u<=56319&&l+1<n&&(u=(u<<10)+e.charCodeAt(++l)-56613888),u<128?c[o++]=u:(u<2048?c[o++]=u>>6&31|192:(u<65536?c[o++]=u>>12&15|224:(c[o++]=u>>18&7|240,c[o++]=u>>12&63|128),c[o++]=u>>6&63|128),c[o++]=63&u|128)}}function Ts(t){return t.bytes[w2(t,1)]}function N2(t,e){let n=ug(t,1);t.bytes[n]=e}function Qh(t){let e,n=0,i=0;do e=Ts(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function cn(t,e){for(e>>>=0;e>=128;)N2(t,127&e|128),e>>>=7;N2(t,e)}function i$(t,e){let n,i=0,o=0,c=0;return n=Ts(t),i=127&n,128&n&&(n=Ts(t),i|=(127&n)<<7,128&n&&(n=Ts(t),i|=(127&n)<<14,128&n&&(n=Ts(t),i|=(127&n)<<21,128&n&&(n=Ts(t),o=127&n,128&n&&(n=Ts(t),o|=(127&n)<<7,128&n&&(n=Ts(t),o|=(127&n)<<14,128&n&&(n=Ts(t),o|=(127&n)<<21,128&n&&(n=Ts(t),c=127&n,128&n&&(n=Ts(t),c|=(127&n)<<7))))))))),{low:i|o<<28,high:o>>>4|c<<24,unsigned:e}}function Xa(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,o=e.high>>>24,c=o===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:o<128?9:10,l=ug(t,c),u=t.bytes;switch(c){case 10:u[l+9]=o>>>7&1;case 9:u[l+8]=c!==9?128|o:127&o;case 8:u[l+7]=c!==8?i>>>21|128:i>>>21&127;case 7:u[l+6]=c!==7?i>>>14|128:i>>>14&127;case 6:u[l+5]=c!==6?i>>>7|128:i>>>7&127;case 5:u[l+4]=c!==5?128|i:127&i;case 4:u[l+3]=c!==4?n>>>21|128:n>>>21&127;case 3:u[l+2]=c!==3?n>>>14|128:n>>>14&127;case 2:u[l+1]=c!==2?n>>>7|128:n>>>7&127;case 1:u[l]=c!==1?128|n:127&n}}const D2={},P2={},hg=4294967296,k2=hg*hg,L2=k2/2,fR=x2(0,!0),M2=x2(0),r$=$l(0,-2147483648,!1),s$=$l(-1,2147483647,!1),o$=$l(-1,-1,!0);function x2(t,e){let n,i,o;return e?(o=0<=(t>>>=0)&&t<256)&&(i=P2[t],i)?i:(n=$l(t,0,!0),o&&(P2[t]=n),n):(o=-128<=(t|=0)&&t<128)&&(i=D2[t],i)?i:(n=$l(t,t<0?-1:0,!1),o&&(D2[t]=n),n)}function $l(t,e,n){return{low:0|t,high:0|e,unsigned:!!n}}function U2(t,e){if(isNaN(t))return e?fR:M2;if(e){if(t<0)return fR;if(t>=k2)return o$}else{if(t<=-L2)return r$;if(t+1>=L2)return s$}return t<0?e?fR:M2:$l(t%hg|0,t/hg|0,e)}function V2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}class mR extends Ke{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(Xs.CONNECTION_STATE_CHANGE,e,n)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var n;super(),N(this,"name","AgoraRTCImageModeration"),N(this,"_connectionState",jr.CONNECTING),N(this,"_sequence",0),N(this,"_moderationStartTime",void 0),N(this,"_workerConnection",void 0),N(this,"_workerMessageLengthLimit",void 0),N(this,"_qualityRatio",void 0),N(this,"_connectInfo",void 0),N(this,"_cancelTokenSource",Oi.CancelToken.source()),N(this,"_retryConfig",void 0),N(this,"_moderationInterval",void 0),N(this,"_moderationTimer",null),N(this,"_moderationMode",1),N(this,"_quality",1),N(this,"_qualityTimer",null),N(this,"_ticket",void 0),N(this,"_moderationIntervalMinimum",void 0),N(this,"_uploadFailedNum",0),N(this,"_uploadNum",0),N(this,"_uploadTimer",null),N(this,"_extraInfo",void 0),N(this,"_vendor",""),N(this,"_encoder",new TextEncoder),N(this,"_moderationId",void 0),N(this,"inspectImage",()=>{if(this.connectionState!==jr.CONNECTED)throw new Q(L.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===jr.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Ae(5,"image-moderation-"),this._workerMessageLengthLimit=x("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=x("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=x("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new jh("worker-"+this._moderationId,pn),this.on(Xs.STATE_CHANGE,(i,o)=>{R.debug("[".concat(this._moderationId,"] Moderation operation :").concat(jl[i]," ").concat(o||""))}),this.handleWorkerEvents()}async init(e,n){this.emit(Xs.STATE_CHANGE,jl.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new gt((o,c)=>{this.on(Xs.CONNECTION_STATE_CHANGE,(l,u)=>{l===jr.CONNECTED&&o()}),this.requestAP(e,i,n).then(l=>{this.connectWorker(l)}).catch(l=>{c(l)})})}updateConfig(e){var n;this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),R.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===jr.CONNECTED&&this.inspectImage()}async requestAP(e,n,i){const o=x("WEBCS_DOMAIN").map(p=>"https://".concat(p,"/api/v1")),c=await function(p,m,_,E){let{appId:S,areaCode:T,cname:A,sid:I,token:w,uid:P}=m;Yl++;const D="moderation_plugin",U={service_name:D,json_body:JSON.stringify({appId:S,areaCode:T,cname:A,command:"allocateEdge",requestId:Yl,seq:Yl,sid:I,appToken:w,ts:Date.now(),uid:P+""})};let G,W,F=p[0];return zs(async()=>{G=Date.now();const X=await Js(F,{data:U,cancelToken:_,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(W=Date.now()-G,X.code!==0){const at=new Q(L.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+X.code,{retry:!0,responseTime:W});throw R.error(at.toString()),at}const tt=JSON.parse(X.json_body);if(tt.code!==200){const at=new Q(L.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(tt.code,", reason: ").concat(tt.reason),{code:tt.code,responseTime:W});throw R.error(at.toString()),at}if(!tt.servers||!Array.isArray(tt.servers)||tt.servers.length===0){const at=new Q(L.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:tt.code,responseTime:W});throw R.error(at.toString()),at}if(!tt.servers.some(at=>!!at.wss)){const at=new Q(L.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:tt.code,responseTime:W});throw R.error(at.toString()),at}const nt=x("IMAGE_MODERATION_WORKER_HOST");return{addressList:tt.servers.map(at=>{let{address:Kt,wss:Xt}=at;if(Kt&&Xt)return"wss://".concat(Kt.replace(/\./g,"-"),".").concat(nt,":").concat(Xt,"/moderation")}).filter(at=>!!at),workerToken:tt.workerToken,vid:tt.vid,ticket:tt.appTicket,responseTime:W}},(X,tt)=>(bt.apworkerEvent(I,{success:!0,sc:200,serviceName:D,responseDetail:JSON.stringify(X.addressList),firstSuccess:tt===0,responseTime:W,serverIp:p[tt%p.length]}),!1),(X,tt)=>(bt.apworkerEvent(I,{success:!1,sc:X.data&&X.data.code||200,serviceName:D,responseTime:W,serverIp:p[tt%p.length]}),!!(X.code!==L.OPERATION_ABORTED&&X.code!==L.UNEXPECTED_RESPONSE||X.data&&X.data.retry)&&(F=p[(tt+1)%p.length],!0)),E)}(o,e,n,i);this.emit(Xs.STATE_CHANGE,jl.AP_CONNECTED);const{addressList:l,ticket:u}=c;return this._ticket=u,l}async connectWorker(e){this.emit(Xs.STATE_CHANGE,jl.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(Gt.CONNECTED,async()=>{this.emit(Xs.STATE_CHANGE,jl.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=jr.CONNECTED}),this._workerConnection.on(Gt.CLOSED,()=>{this.connectionState=jr.CLOSED}),this._workerConnection.on(Gt.FAILED,()=>{this.connectionState=jr.CLOSED}),this._workerConnection.on(Gt.RECONNECTING,()=>{this.connectionState=this.connectionState===jr.CONNECTED?jr.RECONNECTING:jr.CONNECTING}),this._workerConnection.on(Gt.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=$Z(new Uint8Array(e.data));x("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,R.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{bt.reportApiInvoke(this._connectInfo.sid||null,{name:tn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:We.TRACER}).onError(new Q(L.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},x("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else R.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Gt.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this._workerConnection.on(Gt.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=_r(this,Xs.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(x("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(e,n);this._workerConnection.sendMessage(i,!0,!0)}else x("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being published can be inspected")}async generateRequestData(e,n){let{appId:i,cname:o,cid:c,vid:l,sid:u,uid:p}=n;const m=Date.now(),_=await e.getCurrentFrameImage("image/jpeg",this.quality),E=await cL(_,i,o),S=this._sequence+"-"+c+"-"+p+"-"+m+"-"+Ae(12,""),T={appId:i,cid:c,cname:o,deviceId:"",elapse:mR.intToLong(Number(m-this._moderationStartTime)),fileSize:_.buffer.byteLength,height:_.height,width:_.width,jpg:E,networkType:6,osType:7,requestId:S,sdkVersion:"4.24.0",sequence:this._sequence,sid:u,timestamp:U2(m),uid:p,vid:l,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete T.callbackData;const A=ZZ(T);if(A.byteLength<this._workerMessageLengthLimit){if(x("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const I=function(w){for(var P=1;P<arguments.length;P++){var D=arguments[P]!=null?arguments[P]:{};P%2?V2(Object(D),!0).forEach(function(U){N(w,U,D[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(D)):V2(Object(D)).forEach(function(U){Object.defineProperty(w,U,Object.getOwnPropertyDescriptor(D,U))})}return w}({},T);delete I.jpg,R.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(I))}return A}{const I=this.quality*this._qualityRatio;return this.quality=I,await this.generateRequestData(e,{appId:i,cname:o,cid:c,vid:l,sid:u,uid:p})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Oi.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=jr.CLOSED,this.emit(Xs.STATE_CHANGE,jl.CLOSED)}}function F2(t){if(be(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new Q(L.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new Q(L.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const a$={name:"ImageModeration",create:function(t){let{config:e}=t;return F2(e),new mR(e)}};var B2,j2,W2,G2,H2,z2,K2,Y2,q2,X2,J2,Q2,Z2,$2,tU,eU,nU,iU,rU,sU,oU,aU,cU,dU,lU,uU,hU,pU,fU,mU,_U,gU,EU,SU,vU,TU,yU,RU,CU,bU,IU,Et;function wU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function ys(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?wU(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}Qn.setLogger(R);let c$=(B2=Pt(),j2=Pt({argsMap:(t,e)=>{if(!Array.isArray(e)){if(!(e instanceof kl))return[e];e=[e]}return e.map(n=>n?Object(n).toString():"null")}}),W2=Pt({argsMap:(t,e)=>(e||(e=[]),Array.isArray(e)||e.trackMediaType!==Pl.DATA?(Array.isArray(e)||(e=[e]),e.map(n=>n.getTrackId())):[e.getChannelId()])}),G2=Pt({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),H2=Pt({argsMap:(t,e,n)=>[e,n]}),z2=Pt({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:o}=n;return[i==null?void 0:i.uid,o]})}),K2=Pt({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),Y2=Pt({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:o}=n;return{uid:i==null?void 0:i.uid,mediaType:o}})}),q2=Pt(),X2=Pt(),J2=Pt(),Q2=Pt(),Z2=Pt(),$2=Pt(),tU=Pt(),eU=Pt(),nU=Pt(),iU=Pt(),rU=Pt(),sU=Pt(),oU=Pt(),aU=Pt(),cU=Pt(),dU=Pt({argsMap:(t,e)=>[e]}),lU=Pt(),uU=Pt(),hU=Pt(),pU=Pt(),fU=Pt(),mU=Pt(),_U=Pt(),gU=Pt(),EU=Pt({argsMap:(t,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),SU=Pt(),vU=Pt(),TU=Pt(),yU=Pt(),RU=Pt(),CU=Pt(),bU=Pt({reportResult:!0}),IU=Pt(),Et=class extends Ke{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,e){let n;if(super(),N(this,"store",void 0),N(this,"_uid",void 0),N(this,"_channelName",void 0),N(this,"_uintUid",void 0),N(this,"_users",[]),N(this,"_config",void 0),N(this,"_clientId",void 0),N(this,"_appId",void 0),N(this,"_sessionId",null),N(this,"_key",void 0),N(this,"_rtmConfig",{}),N(this,"_joinInfo",void 0),N(this,"_gateway",void 0),N(this,"_statsCollector",void 0),N(this,"_configDistribute",void 0),N(this,"_leaveMutex",void 0),N(this,"_publishMutex",void 0),N(this,"_renewTokenMutex",void 0),N(this,"_subscribeMutex",void 0),N(this,"_encryptionMode","none"),N(this,"_encryptionSecret",null),N(this,"_encryptionSalt",null),N(this,"_encryptDataStream",!1),N(this,"_encryptDataStreamKey",null),N(this,"_encryptDataStreamIv",null),N(this,"_proxyServer",void 0),N(this,"_turnServer",{servers:[],mode:"auto"}),N(this,"_cloudProxyServerMode","disabled"),N(this,"_isDualStreamEnabled",!1),N(this,"_defaultStreamFallbackType",void 0),N(this,"_lowStreamParameter",void 0),N(this,"_streamFallbackTypeCacheMap",new Map),N(this,"_remoteStreamTypeCacheMap",new Map),N(this,"_axiosCancelSource",Oi.CancelToken.source()),N(this,"_audioVolumeIndicationInterval",void 0),N(this,"_networkQualityInterval",void 0),N(this,"_userOfflineTimeout",void 0),N(this,"_streamRemovedTimeout",void 0),N(this,"_liveTranscodeStreamingClient",void 0),N(this,"_liveRawStreamingClient",void 0),N(this,"_channelMediaRelayClient",void 0),N(this,"_networkQualitySensitivity","normal"),N(this,"_p2pChannel",void 0),N(this,"_useLocalAccessPoint",!1),N(this,"_setLocalAPVersion",void 0),N(this,"_joinAndNotLeaveYet",!1),N(this,"_numberOfJoinCount",0),N(this,"_joinResponse",null),N(this,"_remoteDefaultVideoStreamType",void 0),N(this,"_inspect",void 0),N(this,"_moderation",void 0),N(this,"_license",void 0),N(this,"_pendingPublishedUsers",[]),N(this,"ntpAlignErrorCount",0),N(this,"remoteInboundOffset",0),N(this,"_peerConnectionState",void 0),N(this,"_handleLocalTrackEnable",(o,c,l)=>{this.publish(o,!1).then(c).catch(l)}),N(this,"_handleLocalTrackDisable",(o,c,l)=>{this.unpublish(o).then(c).catch(l)}),N(this,"_handleUserOnline",o=>{if(x("BLOCK_LOCAL_CLIENT")&&td(o.uid,this.channelName))return void R.debug("[".concat(o.uid,"] will be ignored in local"));this.isStringUID&&typeof o.uid!="string"&&R.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const c=this._users.find(l=>l.uid===o.uid);if(c)c._trust_in_room_=!0,c._is_pre_created&&(c._is_pre_created=!1,this.safeEmit(te.USER_JOINED,c));else{const l=new Ka(o.uid,o.uint_id||o.uid);this._users.push(l),R.debug("[".concat(this._clientId,"] user online"),o.uid),this.store.firstVideoFrameDecoded(l.uid,{userJoinNotify:Date.now()}),this.safeEmit(te.USER_JOINED,l)}}),N(this,"_handleUserOffline",o=>{if(x("BLOCK_LOCAL_CLIENT")&&td(o.uid,this.channelName))return;const c=this._users.find(l=>l.uid===o.uid);c&&(this._handleRemoveStream(o),this._handleRemoveDataChannels(o),c._audio_pre_subscribed||c._video_pre_subscribed?c._is_pre_created=!0:h_(this._users,c),this._remoteStreamTypeCacheMap.delete(c.uid),this._streamFallbackTypeCacheMap.delete(c.uid),R.debug("[".concat(this._clientId,"] user offline"),o.uid,"reason:",o.reason),this.safeEmit(te.USER_LEAVED,c,o.reason))}),N(this,"_handleAddAudioOrVideoStream",(o,c,l,u,p,m,_,E)=>{if(x("BLOCK_LOCAL_CLIENT")&&td(c,this.channelName))return;const S=this._users.find(A=>A.uid===c);if(!S)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(c,", type ").concat(o)),this.store.subscribe(S.uid,o,void 0,void 0,void 0,Date.now()),o==="video"&&this.store.firstVideoFrameDecoded(S.uid,{videoAddNotify:Date.now()});const T=o==="audio"?S.hasAudio:S.hasVideo;if(S._uintid||(S._uintid=m||c),o==="audio"?S._trust_audio_stream_added_state_=!0:S._trust_video_stream_added_state_=!0,o==="audio"?(S._audio_added_=!0,l!==void 0&&(S._audioSSRC=l),u!==void 0&&(S._cname=u),_&&(S._audioOrtc=_)):(S._video_added_=!0,l!==void 0&&(S._videoSSRC=l),u!==void 0&&(S._cname=u),E!==void 0&&(S._rtxSsrcId=E),_&&(S._videoOrtc=_)),(o==="audio"?S.hasAudio:S.hasVideo)&&!T&&(R.info("[".concat(this._clientId,"] remote user ").concat(S.uid," published ").concat(o)),this.safeEmit(te.USER_PUBLISHED,S,o)),o==="video"?bt.onGatewayStream(this._sessionId,yn.ON_ADD_VIDEO_STREAM,je.ON_ADD_VIDEO_STREAM,{peer:m||c,ssrc:S._videoSSRC}):bt.onGatewayStream(this._sessionId,yn.ON_ADD_AUDIO_STREAM,je.ON_ADD_AUDIO_STREAM,{peer:m||c,ssrc:S._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(S,o,l).then(A=>{if(A&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(S.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Jh))return this._p2pChannel.unsubscribe(S,o,!0).then(()=>this._subscribe(S,o,!0).catch(I=>{R.error("[".concat(this._clientId,"] resubscribe error"),I.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(S,o)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(S.uid," after reconnect.")),this._subscribe(S,o,!0).catch(A=>{R.error("[".concat(this._clientId,"] resubscribe error"),A.toString())})),o==="video"&&!Hn()&&!ai()){const A=this._getEncodingName(p);(A==null?void 0:A.toLocaleLowerCase())==kh.av1&&kZ().then(I=>{I||this._gateway.downgradeCodec(A)})}}),N(this,"_handleRemoveStream",o=>{if(x("BLOCK_LOCAL_CLIENT")&&td(o.uid,this.channelName))return;const c=this._users.find(u=>u.uid===o.uid);if(!c)return void R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));R.debug("[".concat(this._clientId,"] stream removed with uid ").concat(o.uid));let l=()=>{};c.hasAudio&&c.hasVideo?l=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished audio track")),this.safeEmit(te.USER_UNPUBLISHED,c,"audio"),R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished video track")),this.safeEmit(te.USER_UNPUBLISHED,c,"video")}:c.hasVideo?l=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished video track")),this.safeEmit(te.USER_UNPUBLISHED,c,"video")}:c.hasAudio&&(l=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished audio track")),this.safeEmit(te.USER_UNPUBLISHED,c,"audio")}),c._video_pre_subscribed||c._audio_pre_subscribed||(c._trust_audio_stream_added_state_=!0,c._trust_video_stream_added_state_=!0,c._audio_added_=!1,c._video_added_=!1,this._p2pChannel instanceof Jh&&this._p2pChannel.unsubscribe(c).then(u=>{if(u)return this._gateway.unsubscribe(u,c.uid)}),c._audioSSRC=void 0,c._videoSSRC=void 0,c._audioOrtc=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),bt.onGatewayStream(this._sessionId,yn.ON_REMOVE_STREAM,je.ON_REMOVE_STREAM,{peer:o.uint_id||o.uid}),l()}),N(this,"_handleSetStreamLocalEnable",(o,c,l)=>{if(x("BLOCK_LOCAL_CLIENT")&&td(c,this.channelName))return;const u=this._users.find(_=>_.uid===c);if(!u)return void R.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));R.debug("[".concat(this._clientId,"] local ").concat(o," ").concat(l?"enabled":"disabled"," with uid ").concat(c));const p=o==="audio"?u.hasAudio:u.hasVideo;if(o==="audio"){u._trust_audio_enabled_state_=!0;const _=u._audio_enabled_;if(u._audio_enabled_=l,u._audio_enabled_===_)return;{const E=u._audio_enabled_?"enable-local-audio":"disable-local-audio";R.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(c,", msg: ").concat(E)),this.safeEmit(te.USER_INFO_UPDATED,c,E)}}else{u._trust_video_enabled_state_=!0;const _=u._video_enabled_;if(u._video_enabled_=l,u._video_enabled_===_)return;{const E=u._video_enabled_?"enable-local-video":"disable-local-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(E)),this.safeEmit(te.USER_INFO_UPDATED,c,E)}}const m=o==="audio"?u.hasAudio:u.hasVideo;return p!==m?!p&&m?(R.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(o)),void this.safeEmit(te.USER_PUBLISHED,u,o)):(o==="video"&&u._videoTrack&&u._videoTrack._destroy(),o==="audio"&&u._audioTrack,this._p2pChannel.muteRemote(u,o),R.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(o)),void this.safeEmit(te.USER_UNPUBLISHED,u,o)):void 0}),N(this,"_handleMuteStream",(o,c,l)=>{if(x("BLOCK_LOCAL_CLIENT")&&td(o,this.channelName))return;R.debug("[".concat(this._clientId,"] receive mute message"),o,c,l);const u=this._users.find(_=>_.uid===o);if(!u)return void R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(o));const p=c==="audio"?u.hasAudio:u.hasVideo;if(c==="audio"){u._trust_audio_mute_state_=!0;const _=u._audio_muted_;if(u._audio_muted_=l,u._audio_muted_===_)return;{const E=u._audio_muted_?"mute-audio":"unmute-audio";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(E)),this.safeEmit(te.USER_INFO_UPDATED,o,E)}}else{u._trust_video_mute_state_=!0;const _=u._video_muted_;if(u._video_muted_=l,u._video_muted_===_)return;{const E=u._video_muted_?"mute-video":"unmute-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(E)),this.safeEmit(te.USER_INFO_UPDATED,o,E)}}const m=c==="audio"?u.hasAudio:u.hasVideo;if(p!==m){if(!p&&m)return(c==="audio"?u._audioSSRC:u._videoSSRC)?(R.info("[".concat(this._clientId,"] remote user ").concat(o," published ").concat(c)),void this.safeEmit(te.USER_PUBLISHED,u,c)):void R.warning("[".concat(this._clientId,"] remote user ").concat(o," receive ").concat(c," unmute message  before add stream message, ").concat(c," SSRC doesn't exist yet."));c==="video"&&u._videoTrack&&!u._video_pre_subscribed&&u._videoTrack._destroy(),c==="audio"&&u._audioTrack,this._p2pChannel.muteRemote(u,c),R.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished ").concat(c)),this.safeEmit(te.USER_UNPUBLISHED,u,c)}}),N(this,"_handleP2PLost",async o=>{R.debug("[".concat(this._clientId,"] receive p2p lost"),o),parseInt(o.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():R.warning("[".concat(this._clientId,"] P2PLost stream not found"),o)}),N(this,"_handleTokenWillExpire",()=>{R.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(te.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),N(this,"_handleBeforeUnload",o=>{o.type==="beforeunload"&&o.returnValue!==void 0&&o.returnValue!==""||(this.leave(),R.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),N(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(te.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const o={downlinkNetworkQuality:0,uplinkNetworkQuality:0};o.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),o.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(te.NETWORK_QUALITY,o)}),N(this,"_handleP2PAddAudioOrVideoStream",(o,c,l,u)=>{const p=this._users.find(_=>_.uid===c);if(!p)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(c,", type ").concat(o)),this.store.subscribe(p.uid,o,void 0,void 0,void 0,Date.now());const m=o==="audio"?p.hasAudio:p.hasVideo;o==="audio"?p._trust_audio_stream_added_state_=!0:p._trust_video_stream_added_state_=!0,o==="audio"?(p._audio_added_=!0,l!==void 0&&(p._audioSSRC=l),u!==void 0&&(p._audioMid=u)):(p._video_added_=!0,l!==void 0&&(p._videoSSRC=l),u!==void 0&&(p._videoMid=u)),(o==="audio"?p.hasAudio:p.hasVideo)&&!m&&(R.info("[".concat(this._clientId,"] remote user ").concat(p.uid," published ").concat(o)),this.safeEmit(te.USER_PUBLISHED,p,o)),this._p2pChannel.hasPendingRemoteMedia(p,o)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(p.uid," after reconnect.")),this._subscribe(p,o,!0).catch(_=>{R.error("[".concat(this._clientId,"] resubscribe error"),_.toString())}))}),this._config=t,this._clientId=e||Ae(5,"client-"),this.store=new class{constructor(o,c,l,u){Ft(this,"state",void 0),this.state={codec:o,audioCodec:c,mode:l,clientId:u,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Yc.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(o){this.state=function(c,l){switch(l.type){case Bt.SET_SESSION_ID:return ct(ct({},c),{},{sessionId:l.sessionId});case Bt.SET_P2P_ID:return ct(ct({},c),{},{p2pId:l.p2pId});case Bt.SET_UID:return ct(ct({},c),{},{uid:l.uid});case Bt.SET_INT_UID:return ct(ct({},c),{},{intUid:l.intUid});case Bt.SET_PUB_ID:return ct(ct({},c),{},{pubId:l.pubId});case Bt.KEY_METRIC_CLIENT_CREATED:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{clientCreated:l.metric})});case Bt.KEY_METRIC_JOIN_START:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{joinStart:l.metric})});case Bt.KEY_METRIC_PRELOAD_START:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{preloadStart:l.metric})});case Bt.KEY_METRIC_PRELOAD_END:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{preloadEnd:l.metric})});case Bt.KEY_METRIC_JOIN_END:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{joinEnd:l.metric})});case Bt.KEY_METRIC_REQUEST_AP_START:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{requestAPStart:l.metric})});case Bt.KEY_METRIC_REQUEST_AP_END:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{requestAPEnd:l.metric})});case Bt.KEY_METRIC_REQUEST_SUA_END:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{requestSUAEnd:l.metric})});case Bt.KEY_METRIC_BEFORE_CONNECT:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{beforeConnect:l.metric})});case Bt.KEY_METRIC_PEER_RECEIVER:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{peerReceiver:l.metric})});case Bt.KEY_METRIC_SIGNAL_CONNECTED:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{signalConnected:l.metric})});case Bt.KEY_METRIC_JOIN_REQ:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{joinReq:l.metric})});case Bt.KEY_METRIC_JOIN_REP:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{joinRep:l.metric})});case Bt.KEY_METRIC_JOIN_GATEWAY_START:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{joinGatewayStart:l.metric})});case Bt.KEY_METRIC_JOIN_GATEWAY_END:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{joinGatewayEnd:l.metric})});case Bt.KEY_METRIC_PEER_CONNECTION_START:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{peerConnectionStart:l.metric})});case Bt.KEY_METRIC_PEER_CONNECTION_END:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{peerConnectionEnd:l.metric})});case Bt.KEY_METRIC_DESCRIPTION_START:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{descriptionStart:l.metric})});case Bt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{signalChannelOpen:l.metric})});case Bt.KEY_METRIC_ICE_CONNECTION_END:return ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{iceConnectionEnd:l.metric})});case Bt.KEY_METRIC_PUBLISH:{const u=c.keyMetrics.publish,p=u.findIndex(m=>m.trackId===l.metric.trackId);return p!==-1?(u[p]=ct(ct({},u[p]),l.metric),ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{publish:[...u]})})):ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{publish:[...c.keyMetrics.publish,l.metric]})})}case Bt.KEY_METRIC_SUBSCRIBE:{const u=c.keyMetrics.subscribe,p=u.findIndex(m=>m.userId===l.metric.userId&&m.type===l.metric.type);return p!==-1?(u[p]=ct(ct({},u[p]),l.metric),ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{subscribe:[...u]})})):ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{subscribe:[...c.keyMetrics.subscribe,l.metric]})})}case Bt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const u=c.keyMetrics.firstVideoFrameDecoded,p=u.findIndex(m=>m.userId===l.metric.userId);return p!==-1?(u[p]=ct(ct({},u[p]),l.metric),ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{firstVideoFrameDecoded:[...u]})})):ct(ct({},c),{},{keyMetrics:ct(ct({},c.keyMetrics),{},{firstVideoFrameDecoded:[...c.keyMetrics.firstVideoFrameDecoded,l.metric]})})}case Bt.RESET_FIRST_VIDEO_FRAME_DECODED:return c.keyMetrics.firstVideoFrameDecoded=[],c;case Bt.SET_CLOUD_PROXY_SERVER_MODE:return c.cloudProxyServerMode=l.mode,c;case Bt.RECORD_JOIN_CHANNEL_SERVICE:return typeof l.index!="number"?c.joinChannelServiceRecords=[...c.joinChannelServiceRecords,l.record]:(c.joinChannelServiceRecords[l.index]=ct(ct({},c.joinChannelServiceRecords[l.index]),l.record),c.joinChannelServiceRecords=[...c.joinChannelServiceRecords]),c;case Bt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return c.joinChannelServiceRecords=[],c;case Bt.RESET_KEY_METRICS:return c.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},c;case Bt.SET_USE_P2P:return ct(ct({},c),{},{useP2P:l.val});case Bt.SET_TRANSPORT_TYPE:return ct(ct({},c),{},{p2pTransport:l.val});default:return c}}(this.state,o)}set autoSubscribe(o){this.state.autoSubscribe=o}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(o){this.state.enableInstantMuteRestore=o}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(o){this.dispatch({type:Bt.SET_SESSION_ID,sessionId:o})}get sessionId(){return this.state.sessionId}set cid(o){this.state.cid=o}get cid(){return this.state.cid}set codec(o){this.state.codec=o}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(o){this.dispatch({type:Bt.SET_P2P_ID,p2pId:o})}get p2pId(){return this.state.p2pId}set dcId(o){this.dispatch({type:Bt.SET_DC_ID,dcId:o})}get dcId(){return this.state.dcId}set uid(o){this.dispatch({type:Bt.SET_UID,uid:o})}get uid(){return this.state.uid}set intUid(o){this.dispatch({type:Bt.SET_INT_UID,intUid:o})}get intUid(){return this.state.intUid}set pubId(o){this.dispatch({type:Bt.SET_PUB_ID,pubId:o})}get pubId(){return this.state.pubId}set cloudProxyServerMode(o){this.dispatch({type:Bt.SET_CLOUD_PROXY_SERVER_MODE,mode:o})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(o){this.dispatch({type:Bt.SET_USE_P2P,val:o})}get useP2P(){return this.state.useP2P}set p2pTransport(o){this.dispatch({type:Bt.SET_TRANSPORT_TYPE,val:o})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(o){this.state.hasStartJoinChannel=o}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(o){this.state.isABTestSuccess=o}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Bt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Bt.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:Bt.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:Bt.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:Bt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Bt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Bt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:Bt.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:Bt.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:Bt.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:Bt.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:Bt.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:Bt.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Bt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Bt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Bt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Bt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(o,c){this.dispatch({type:Bt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:ct({userId:o},c)})}descriptionStart(){this.dispatch({type:Bt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Bt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Bt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(o,c,l,u){this.dispatch({type:Bt.KEY_METRIC_PUBLISH,metric:ct(ct({trackId:o,type:c},l&&{publishStart:l}),u&&{publishEnd:u})})}subscribe(o,c,l,u,p,m,_){this.dispatch({type:Bt.KEY_METRIC_SUBSCRIBE,metric:ct(ct(ct(ct(ct({userId:o,type:c},l&&{subscribeStart:l}),u&&{subscribeEnd:u}),p&&{firstFrame:p}),m&&{streamAdded:m}),_&&{firstDecoded:_})})}massSubscribe(o,c,l,u){o.forEach(p=>{this.dispatch({type:Bt.KEY_METRIC_SUBSCRIBE,metric:ct(ct(ct({userId:p.userId,type:p.type},c&&{subscribeStart:c}),l&&{subscribeEnd:l}),u&&{firstFrame:u})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(o,c){o.service==="gateway"&&Array.isArray(o.urls)&&(o.urls=o.urls.map(l=>l.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof c!="number"?(this.dispatch({type:Bt.RECORD_JOIN_CHANNEL_SERVICE,record:ct(ct({},o),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(c<0||c>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Bt.RECORD_JOIN_CHANNEL_SERVICE,record:o,index:c}),c)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Bt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Bt.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:Bt.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new Qn("client-leave",this._clientId),this._publishMutex=new Qn("client-publish",this._clientId),this._renewTokenMutex=new Qn("client-renewtoken",this._clientId),this._subscribeMutex=new Qn("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),R.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Ur," build: ").concat($y,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{By(t.clientRoleOptions),n=Object.assign({},t.clientRoleOptions)}catch(o){R.warning("[".concat(this._clientId,"] ").concat(o.toString()))}var i;this._statsCollector=new qh(this.store),this._statsCollector.onStatsException=(o,c,l)=>{R.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(o,", msg: ").concat(c,", uid: ").concat(l)),o===Z0.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(u=>{u instanceof I_&&x("ENABLE_ENCODE_EXCEPTION")&&u.findClosestProfile()}),this.safeEmit(te.EXCEPTION,{code:o,msg:c,uid:l})},this._statsCollector.onUploadPublishDuration=(o,c,l,u)=>{const p=this._users.find(m=>m.uid===o);p&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(p._uintid,{peerPublishDuration:l,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(p)),bt.peerPublishStatus(this._sessionId,{subscribeElapse:u,audioPublishDuration:c,videoPublishDuration:l,peer:p._uintid}))},this._statsCollector.onVideoCodecChanged=o=>{if(x("VIDEO_STANDARD_BITRATE_VERSION")&&(o==="av1"||o==="h265"||o==="h264")){const c=this.localTracks.find(l=>l instanceof Me);c&&c._saveEncodeBitrateRatio!==1&&c.setSaveEncodeBitrateRatio(o==="h264"?x("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=t.mode==="p2p",this._gateway=new wZ(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||pn,httpRetryConfig:t.httpRetryConfig||pn,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:n}),this._configDistribute=new VZ(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},$o("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new Jh(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,n,i,o){let c=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],l=arguments.length>6&&arguments[6]!==void 0&&arguments[6];ye("JOIN_GATEWAY_USE_443PORT_ONLY",c),ye("JOIN_GATEWAY_USE_DUAL_DOMAIN",l);const u=this._gateway.signal.websocket;return u instanceof U0&&(u.use443PortOnly=c,u.tryDoubleDomain=l),async function(p,m,_){a_.get(p)||a_.set(p,[]),c_.get(p)||c_.set(p,m),So.get(p)||So.set(p,0);const E=a_.get(p),S=c_.get(p);if(!E||!S)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(So.get(p)===S){const P=Ch();E.push(P),await P.promise}So.set(p,So.get(p)+1);for(var T=arguments.length,A=new Array(T>3?T-3:0),I=3;I<T;I++)A[I-3]=arguments[I];const w=await _(...A);return So.set(p,So.get(p)-1),So.get(p)===S-1&&E.length>0&&(E[0].resolve(),E.shift()),So.get(p)===0&&(a_.set(p,[]),c_.set(p,0),So.set(p,0)),w}("client.join",x("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,n,i,o)}async join(t,e,n,i,o){const c=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const l=(m_||m_||(m_=(window.location.protocol.split(":")[0]||"").toUpperCase(),m_))==="HTTPS",u=y1()?window.isSecureContext:"Browser Not Support";if(!y1()&&!l||!window.isSecureContext){const w="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";R.warning(w)}let p;bt.setAppId(t);try{if(!n&&n!==null)throw new Q(L.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&Mn(n,"token",1,2047),Mn(t,"appid",1,2047),U_(e),i&&V_(i),o)if(typeof o=="string")Mn(o,"optionalInfo",1,256),p=o;else{if(typeof o!="object")throw new Q(L.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:w,enableInstantMuteRestore:P}=o;w&&(Hs(w,"autoSubscribe"),R.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(w)),this.store.autoSubscribe=w),P&&(Hs(P,"enableInstantMuteRestore"),R.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(P)),this.store.enableInstantMuteRestore=P)}}}catch(w){throw bt.reportApiInvoke(Kc(),{name:tn.JOIN,options:[t,e,n,i],states:{isHttps:l,isSecureContext:u},tag:We.TRACER}).onError(w),w}if(this._leaveMutex.isLocked&&(R.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),R.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const w=new Q(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw bt.reportApiInvoke(Kc(),{name:tn.JOIN,options:[t,e,n,i],states:{isHttps:l,isSecureContext:u},tag:We.TRACER}).onError(w),w}this._gateway.state="CONNECTING",this.store.preloadStart();const m=await T2({appId:t,cname:e,uid:i,stringUid:typeof i=="string"?i:void 0,token:n||t,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new Q(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const _=(m==null?void 0:m.sid)||Kc();R.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(c)),this._sessionId||(this._sessionId=_,this.store.sessionId=this._sessionId);const E=bt.reportApiInvoke(_,{id:this._clientId,name:tn.JOIN,options:[t,e,n,i],states:{isHttps:l,isSecureContext:u},tag:We.TRACER}),S=ys(ys(ys({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:p,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!m},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:x("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(S.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(S.stringUid=i,this._uintUid?(S.uid=this._uintUid,this._uintUid=void 0):S.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(S.aesmode=this._encryptionMode,S.aespassword=await(async w=>{const P=function(W){const F=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),X=new Uint8Array(new ArrayBuffer(F.length));for(let tt=0;tt<F.length;tt+=1)X[tt]=F.charCodeAt(tt);return X}(),D=await window.crypto.subtle.importKey("spki",P,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),U=Vy(w),G=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},D,U);return function(W){let F="";for(let X=0;X<W.length;X+=1)F+=String.fromCharCode(W[X]);return window.btoa(F)}(new Uint8Array(G))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Q(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(S.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const w=new TextEncoder,P=x("USE_PURE_ENCRYPTION_MASTER_KEY")?w.encode(S.appId+this._encryptionSecret+this._encryptionSecret):w.encode(S.appId+S.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(D,U,G){const W=await window.crypto.subtle.importKey("raw",U,"PBKDF2",!1,["deriveBits","deriveKey"]),F=D==="aes-128-gcm2"?128:256,X=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:P1,hash:"SHA-256",salt:G},W,F+iQ);return new Uint8Array(X).subarray(F/8)}(this._encryptionMode,P,zc(this._encryptionSalt)),this._encryptDataStreamKey=await async function(D,U,G){const W=await window.crypto.subtle.importKey("raw",U,"PBKDF2",!1,["deriveBits","deriveKey"]),F=D==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:P1,hash:"SHA-256",salt:G},W,{name:"AES-GCM",length:F},!0,["encrypt","decrypt"])}(this._encryptionMode,P,zc(this._encryptionSalt))}else u?R.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):R.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,R.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:e,appId:t,stringUid:S.stringUid});const T=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&T===this._sessionId&&bt.joinChannelTimeout(this._sessionId,5)},5e3);try{var A;let w;const P=S.cloudProxyServer;if(pt(A=["proxy3","proxy4","proxy5"]).call(A,P)){const F=x("PROXY_SERVER_TYPE3");Array.isArray(F)?S.proxyServer=F[0]:S.proxyServer=F}if(bt.setProxyServer(S.proxyServer),R.setProxyServer(S.proxyServer),this.store.requestAPStart(),m){if(R.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(S.stringUid?", ".concat(S.stringUid," => ").concat(m.intUid):""," ")),S.stringUid&&!S.uid&&(S.uid=m.intUid),w={gatewayInfo:m.ap.gatewayInfo},x("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&S.turnServer.mode==="auto")if(m.ap.proxyInfo.addresses.length===0)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const F=(await gx(m.ap.proxyInfo,m.ap.gatewayInfo.uid)).map(X=>({turnServerURL:X.address,tcpport:X.tcpport||Yn.tcpport,udpport:X.udpport||Yn.udpport,username:X.username||Yn.username,password:X.password||Yn.password,forceturn:!1,security:!0}));S.turnServer={mode:"manual",servers:F}}C2(m,S.stringUid)}else{if(S.stringUid&&!S.uid){let F;[F,w]=await gt.all([zx(S.stringUid,S,this._axiosCancelSource.token,this._config.httpRetryConfig||pn,this.store).finally(()=>{this.store.requestSUAEnd()}),Hx(S,this._axiosCancelSource.token,this._config.httpRetryConfig||pn,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),R.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(S.stringUid," => ").concat(F)),S.uid=F,w.gatewayInfo.uid=F,w.gatewayInfo.res.uid=F}else w=await Hx(S,this._axiosCancelSource.token,this._config.httpRetryConfig||pn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Q(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(S,this._axiosCancelSource.token),this._configDistribute.on(Fh.UPDATE_BITRATE_LIMIT,F=>{this._p2pChannel.updateBitrateLimit(F)}),this._configDistribute.on(Fh.UPDATE_CLIENT_ROLE_OPTIONS,F=>{this._setClientRoleOptions(F)})},0),this._key=n||t;const D=w.gatewayInfo,U=S.uid?S.uid:D.uid;this._joinInfo=ys(ys({},S),{},{cid:D.cid,uid:U,vid:D.vid,apResponse:D.res,apGatewayAddress:D.apGatewayAddress,uni_lbs_ip:D.uni_lbs_ip,gatewayAddrs:D.gatewayAddrs}),this.store.intUid=U,this.store.cid=D.cid;const G=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Q(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));E.onSuccess(G),this._appId=t,this._channelName=S.cname,this._uid=G,this.store.uid=G,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Hn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const W=S.stringUid?"string uid: ".concat(S.stringUid,",uid: ").concat(S.uid):"uid: ".concat(this._uid);return R.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(W)),setTimeout(()=>{R.startUpload()},5e3),this.store.joinEnd(),I=this,pt($c).call($c,I)||$c.push(I),this._cloudProxyServerMode==="disabled"&&ae().supportWebCrypto&&x("ENABLE_PRELOAD")&&hR(this._joinInfo),G}catch(w){const P=Array.isArray(w)?w[0]:w;throw P&&P.code===L.OPERATION_ABORTED?R.warning("[".concat(this._clientId,"] join number: ").concat(c,", Joining channel failed, rollback"),P):R.error("[".concat(this._clientId,"] join number: ").concat(c,", Joining channel failed, rollback"),P),P.code!==L.OPERATION_ABORTED&&this._numberOfJoinCount===c&&(this._gateway.state="DISCONNECTED",this._reset()),E.onError(P),P}var I}_joinGateway(){if(!this._joinInfo||!this._key)throw new Q(L.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!x("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){R.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Hn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const n=$c.indexOf(e);n!==-1&&$c.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return R.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",_e.LEAVE),R.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof kl))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new Q(L.INVALID_PARAMS,"param list is empty");const n=t;if(this._gateway.role==="audience")throw new Q(L.INVALID_OPERATION,"audience can not publish stream");for(const o of n){if(!(o instanceof kl))throw new Q(L.INVALID_PARAMS,"parameter is not local track");if(!o._enabled&&e)throw new Q(L.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(o.getTrackId()))}R.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(o=>"".concat(o.getTrackId()," "))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&n.forEach(o=>{const c=this._configDistribute.getBitrateLimit();o instanceof Me&&c&&o.setBitrateLimit(c.uplink)});try{await this._publishHighStream(n),R.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(o=>"".concat(o.getTrackId()," "))))}catch(o){throw R.error("[".concat(this._clientId,"] publish error"),o.toString()),o}finally{i()}}async _publishDataChannel(t){if(t==null)throw new Q(L.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(t)));be(t.id,"id",0,65535,!0),Hs(t.ordered,"ordered"),Mn(t.metadata,"metadata",0,512),R.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(o=>o.id===t.id)!==-1)throw new Q(L.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Q(L.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&x("FORCE_TURN")&&!x("TURN_ENABLE_TCP")&&!x("TURN_ENABLE_UDP"))throw new Q(L.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(o){return Mx(o,!1)}(t),i=await this._p2pChannel.publishDataChannel([n]);if(i.length>0){if(typeof n._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Q(L.CREATE_DATACHANNEL_ERROR);try{await gt.all(i.map(o=>this._uid&&this._gateway.publishDataChannel(this._uid,o,!0))),await n._waitTillOpen()}catch(o){if(o.code!==L.DISCONNECT_P2P)throw o}}return R.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw R.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{e()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new Q(L.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof kl))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);R.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(i=>"".concat(i.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.sendExtensionMessage(rn.UNPUBLISH,{unpubMsg:i},!0)}else{const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.unpublish(i,this._uid),R.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(o=>"".concat(o.getTrackId()))))}}catch(i){throw R.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{n&&n()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),R.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(n=>"".concat(n.id," "))," "));const e=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(t);n&&await this._gateway.unpublishDataChannel(n),R.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(i=>"".concat(i.id))))}catch(n){throw R.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{e&&e()}}async subscribe(t,e,n){if(!(t instanceof Ka)){const i=this.remoteUsers.find(o=>o.uid===t);if(!i)throw new Q(L.INVALID_REMOTE_USER,"user is not in the channel");t=i}return e==="datachannel"?this._subscribeDataChannel(t,n):this._subscribe(t,e)}async presubscribe(t,e){if(Tn(e,"mediaType",["audio","video"]),this.store.useP2P)throw new Q(L.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Q(L.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=e===St.AUDIO,i=e===St.VIDEO,o=await this._subscribeMutex.lock();try{const{ssrcId:c,ortc:l,rtxSsrcId:u,cname:p,uint_id:m}=await this._gateway.presubscribe(t,e,!0);if(c==null)throw new Q(L.UNEXPECTED_RESPONSE,"no ssrc id");let _=this._users.find(S=>S.uid===t);_||(_=new Ka(t,m||t),_._is_pre_created=!0,this._users.push(_)),p&&(_._cname=p),_._uintid||(_._uintid=m||t),n&&(_._audioSSRC=c,_._audio_pre_subscribed=!0,l&&(_._audioOrtc=l)),i&&(_._videoSSRC=c,_._video_pre_subscribed=!0,l&&(_._videoOrtc=l),u!=null&&(_._rtxSsrcId=u)),R.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(c)),await this._p2pChannel.subscribe(_,e,c,u,l);const E=n?_._audioTrack:_._videoTrack;if(!E)throw new Q(L.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(_._trust_audio_stream_added_state_=!0,_._audio_added_=!0),i&&(_._trust_video_stream_added_state_=!0,_._video_added_=!0),E}catch(c){throw R.error("[".concat(this._clientId,"] presub user ").concat(t," error"),c),c}finally{o()}}async _subscribeDataChannel(t,e){var n;if(be(e,"channelId",0,65535,!0),!this._joinInfo)throw new Q(L.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===t))throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new Q(L.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new Q(L.INVALID_REMOTE_USER,"user is not published");const o=(n=t._dataChannels)===null||n===void 0?void 0:n.find(u=>u.id===e);if(!o)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new Q(L.REMOTE_USER_IS_NOT_PUBLISHED);const c=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const u=await this._p2pChannel.subscribeDataChannel(t,[o]);if(u&&pt(u).call(u,o.id))try{var l;if(typeof o._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Q(L.CREATE_DATACHANNEL_ERROR);const p={id:o.id,datachannelId:o._originDataChannelId,ordered:o.ordered,maxRetransmits:o.maxRetransmits,metadata:(l=o.metadata)!==null&&l!==void 0?l:""};await this._gateway.subscribeDataChannel(t.uid,p,!0),await o._waitTillOpen()}catch(p){if((p==null?void 0:p.code)!==L.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[o]),p;await this._p2pChannel.unsubscribeDataChannel(t,[o]),this._p2pChannel.setPendingRemoteDataChannel(t,o.id)}return R.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),o}finally{c()}}async _p2pSubscribe(t,e,n){if(Tn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new Q(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===t)){const c=new Q(L.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),c}if(!t.hasAudio&&!t.hasVideo){const c=new Q(L.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),c}if(!n&&(e==="audio"&&!t.hasAudio||e==="video"&&!t.hasVideo)){const c=new Q(L.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),c}const o=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const l=e==="audio"?t._audioSSRC:t._videoSSRC,u=e==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,e,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,e,l,u)}catch(l){throw l}R.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(l=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),l)});const c=e==="audio"?t._audioTrack:t._videoTrack;if(!c)throw new Q(L.UNEXPECTED_ERROR,"can not find remote track in user object");return c}catch(c){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),c),c}finally{o()}}async _subscribe(t,e,n){if(this.store.useP2P)return this._p2pSubscribe(t,e);if(Tn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new Q(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===t)){const m=new Q(L.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),m}if(!t.hasAudio&&!t.hasVideo){const m=new Q(L.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),m}if(!(n||(e!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(e!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const m=new Q(L.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),m}let o=e==="audio"?t._audioSSRC:t._videoSSRC,c=e==="audio"?t._audioOrtc:t._videoOrtc,l=e==="video"?t._rtxSsrcId:void 0,u={stream_type:e==="audio"?St.AUDIO:St.VIDEO,ssrcId:o};e==="video"&&this.store.firstVideoFrameDecoded(t.uid,{subscribeStart:Date.now()});const p=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const _=e==="audio"?t._audioSSRC:t._videoSSRC;_!==void 0&&_!==o&&(o=_,c=e==="audio"?t._audioOrtc:t._videoOrtc,l=e==="video"?t._rtxSsrcId:void 0,u={stream_type:e==="audio"?St.AUDIO:St.VIDEO,ssrcId:o}),ei.markSubscribeStart(this.store.clientId,o),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,o,l,c);try{this._p2pChannel.isPreSubScribe(o)||await this._gateway.subscribe(t.uid,u,!0)}catch(E){if((E==null?void 0:E.code)!==L.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),E;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(_){throw this._p2pChannel.reportSubscribeEvent(!1,_==null?void 0:_.code,t,e),_}R.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(_=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),_)});const m=e==="audio"?t._audioTrack:t._videoTrack;if(!m)throw new Q(L.UNEXPECTED_ERROR,"can not find remote track in user object");return e==="video"&&(this.store.firstVideoFrameDecoded(t.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(t)),m}catch(m){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),m),m}finally{p()}}async massSubscribe(t){if(Jo(t,"subscribeList"),!this._joinInfo)throw new Q(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),n=new Map,i=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(u=>{let{user:p,mediaType:m}=u;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(m)}).join("; ")));const o=(t=[...t]).map(u=>{let{user:p,mediaType:m}=u;return{user:p,mediaType:m}}),c=await this._p2pChannel.globalLock();try{var l;for(let p=t.length-1;p>=0;p--){const m=t[p],{user:_,mediaType:E}=m;if(Tn(E,"mediaType",["audio","video"]),!_){const I=new Q(L.INVALID_PARAMS,"user property does not exist in subscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),I}if(!this._users.find(I=>I===_)){const I=new Q(L.INVALID_REMOTE_USER,"user is not in the channel");R.error("[".concat(this._clientId,"] can not massSubscribe ").concat(_.uid,", this user is not in the channel")),o[p].error=I,t.splice(p,1);continue}if(E==="audio"&&(!_.hasAudio||_._audioSSRC===void 0)||E==="video"&&(!_.hasVideo||_._videoSSRC===void 0)){const I=new Q(L.REMOTE_USER_IS_NOT_PUBLISHED);R.error("[".concat(this._clientId,"] can not subscribe ").concat(_.uid," with mediaType ").concat(E,", remote user is not published")),o[p].error=I,t.splice(p,1);continue}const T=In.Video|In.LwoVideo,A=n.get(_);if(A){if(E==="video"?A&T:A&In.Audio){t.splice(p,1),R.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(_.uid,", mediaType:").concat(E," twice"));continue}n.set(_,A|(E==="video"?T:In.Audio))}else n.set(_,E==="video"?T:In.Audio)}for(let p=t.length-1;p>=0;p--){const m=t[p],{user:_,mediaType:E}=m,S=In.Video|In.LwoVideo;if(this._p2pChannel.hasRemoteMedia(_,E)){await this._p2pChannel.unmuteRemoteNoLock(_,E);const T=n.get(_);n.set(_,E==="video"?T^S:T^In.Audio),t.splice(p,1)}}this.store.massSubscribe(t.map(p=>({userId:p.user.uid,type:p.mediaType})),e);let u=os(l=Array.from(n.entries())).call(l,(p,m)=>{let[_,E]=m;if(E===0)return p;const S={stream_id:_.uid,stream_type:E};return E&In.Audio&&(S.audio_ssrc=_._audioSSRC),E&In.Video&&(S.video_ssrc=_._videoSSRC),p.push(S),p},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(m=>{let{user:_,mediaType:E}=m;return{user:_,mediaType:E,ssrcId:E===St.VIDEO?_._videoSSRC:_._audioSSRC,rtxSsrcId:E===St.VIDEO?_._rtxSsrcId:void 0}}));const p=new Map;if(u=u.filter(m=>m.video_ssrc&&!this._p2pChannel.isPreSubScribe(m.video_ssrc)||m.audio_ssrc&&!this._p2pChannel.isPreSubScribe(m.audio_ssrc)||!m.video_ssrc&&!m.audio_ssrc),u.length>0){const m=await this._gateway.subscribeAll(u,!0);((m==null?void 0:m.users)||[]).forEach(_=>{let{stream_id:E,video_error_code:S,audio_error_code:T,error_code:A}=_;(S||T||A)&&p.set(E,{video_error_code:S,audio_error_code:T,error_code:A})})}if(Array.from(p.entries()).length>0){const m=[];Array.from(p.entries()).forEach(_=>{let[E,S]=_;const T=this.remoteUsers.find(A=>A.uid===E);if(T){let A;S.error_code||S.video_error_code&&S.audio_error_code?A=void 0:S.video_error_code?A=St.VIDEO:S.audio_error_code&&(A=St.AUDIO),m.push({user:T,mediaType:A})}}),m.length>0&&await this._p2pChannel.massUnsubscribeNoLock(m)}for(const m of o){const _=p.get(m.user.uid);if(_){const E=_.error_code||m.mediaType==="audio"&&_.audio_error_code||m.mediaType==="video"&&_.video_error_code;if(E){const S=Bh(E);R.error("user:".concat(m.user.uid," mediaType:").concat(m.mediaType," has massSubscribe error ").concat(S.desc)),m.error=new Q(L.SUBSCRIBE_FAILED,"code ".concat(E,": ").concat(S.desc))}}m.error||(m.mediaType==="video"?m.track=m.user.videoTrack:m.track=m.user.audioTrack)}return this.store.massSubscribe(o.filter(m=>!m.error).map(m=>({userId:m.user.uid,type:m.mediaType})),void 0,Date.now()),o.forEach(m=>{var _;bt.subscribe(this.store.sessionId,{succ:!!m.error,ec:((_=m.error)===null||_===void 0?void 0:_.code)||null,video:m.mediaType===St.VIDEO,audio:m.mediaType===St.AUDIO,peerid:m.user.uid,subscribeRequestid:m.mediaType===St.VIDEO?m.user._videoSSRC:m.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e),preSsrc:this._p2pChannel.isPreSubScribe(m.user._videoSSRC)},!0)}),R.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(m=>{let{user:_,mediaType:E}=m;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(E)}).join("; "))),o}catch(p){throw await this._p2pChannel.massUnsubscribeNoLock(t),p}}finally{c(),i()}}async unsubscribe(t,e,n){if(!(t instanceof Ka)){const c=this.remoteUsers.find(l=>l.uid===t);if(!c)throw new Q(L.INVALID_REMOTE_USER,"user is not in the channel");t=c}if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(t,n)}else await this._unsubscribeDataChannel(t,n);if(e&&Tn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new Q(L.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(c=>c===t)){const c=new Q(L.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),c}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const o=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,e);else{const c=await this._p2pChannel.unsubscribe(t,e);c&&await this._gateway.unsubscribe(c,t.uid),e&&e!=="audio"||(t._audio_pre_subscribed=!1),e&&e!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&h_(this._users,t),R.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(c){if(c.code===L.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),c.toString()),c}finally{o()}}async _unsubscribeDataChannel(t,e){if(e&&be(e,"id",0,65535,!0),!this._joinInfo)throw new Q(L.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(o=>o===t)){const o=new Q(L.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),o}let i;if(typeof e=="number"){const o=t._dataChannels.find(c=>c.id===e);o&&(i=[o])}else i=t._dataChannels;if(i===void 0){const o=new Q(L.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),o}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(i.map(o=>o.id)));try{const o=await this._p2pChannel.unsubscribeDataChannel(t,i);o&&await this._gateway.unsubscribeDataChannel(o,t.uid),R.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(o))}catch(o){if(o.code===L.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),o.toString()),o}}async massUnsubscribe(t){if(Jo(t,"unsubscribeList"),!this._joinInfo)throw new Q(L.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");R.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(n=>{let{user:i,mediaType:o}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(o,";")}).join())),t=[...t];const e=new Map;for(let n=t.length-1;n>=0;n--){const{user:i,mediaType:o}=t[n];if(!i){const u=new Q(L.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),u}if(Tn(o,"mediaType",["video","audio",void 0]),!this._users.find(u=>u===i)){R.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),t.splice(n,1);continue}const l=In.Video|In.LwoVideo;if(e.has(i)){const u=e.get(i);let p;switch(o){case"video":p=u&l;break;case"audio":p=u&In.Audio;break;default:p=u&(In.Audio|l)}if(p){R.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(o," twice.")),t.splice(n,1);continue}o?o==="audio"?e.set(i,u|In.Audio):o==="video"&&e.set(i,u|l):e.set(i,u|In.Audio|l)}else o?o==="audio"?e.set(i,In.Audio):o==="video"&&e.set(i,l):e.set(i,In.Audio|l)}try{const n=await this._p2pChannel.massUnsubscribe(t);n&&await this._gateway.massUnsubscribe(n),R.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(i=>{let{user:o,mediaType:c}=i;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join()))}catch(n){if(n.code===L.DISCONNECT_P2P)return void R.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw R.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(t){(function(n){if(!n)throw new $(L.INVALID_PARAMS);Xe(n.width)||xy(n.width,"streamParameter.width"),Xe(n.height)||xy(n.height,"streamParameter.height"),Xe(n.framerate)||xy(n.framerate,"streamParameter.framerate"),Xe(n.bitrate)||be(n.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&R.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),R.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,st.LocalVideoLowTrack)}async enableDualStream(){if(!ae().supportDualStream)throw bt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Q(L.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Q(L.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw bt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,bt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),R.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Q(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(st.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw bt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,bt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),R.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(i){Tn(i,"role",["audience","host"])}(t),e&&By(e),this.mode==="rtc"||this.mode==="p2p")throw R.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Q(L.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(e&&e.level&&t==="host")throw new Q(L.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new Q(L.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==n&&x("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,e),this._config.role=t,this._gateway.reconnect("recover",zn.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,e),this._config.role=t),R.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let e=!1;try{t&&By(t),await this._gateway.setClientRole(this._config.role,t),e=!0}catch{}finally{R.info("[".concat(this._clientId,"] set client role options ").concat(e?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const e=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const n=e.timestamp-Date.now();return Math.abs(n)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(Mn(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new Q(L.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Q(L.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,bt.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer),R.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new Q(L.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Q(L.INVALID_OPERATION,"You have already set the proxy")}if(Ah(t))return this._turnServer={servers:t,mode:"original-manual"},void R.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map(n=>n.urls).join(","),"."));t.forEach(n=>l1(n)),this._turnServer={servers:t,mode:"manual"},R.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new Q(L.INVALID_OPERATION,"you should set license before join channel");if(Mn(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new Q(L.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,R.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new Q(L.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Q(L.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let n;switch(t===void 0&&(t=3),t){case 1:case 2:throw new Q(L.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new Q(L.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Q(L.INVALID_OPERATION,"Stop proxy server after leave channel");bt.setProxyServer(),R.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new Q(L.INVALID_PARAMS,"accessPoints is required.");Jo(t.accessPoints.serverList,"accessPoints.serverList"),Mn(t.accessPoints.domain,"accessPoints.domain");const e=(S,T)=>{be(S,T,0,65535,!0)};let n=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),n=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Q(L.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");x("CLOSE_AFB_FOR_LOCAL_AP")&&(ye("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),ye("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,o=t.accessPoints.domain,c=t.accessPoints.serverList.map(S=>i.test(S)?"".concat(S.replace(/\./g,"-"),".").concat(o):S),l=c.map(S=>"".concat(S,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,ye("WEBCS_DOMAIN",l),ye("WEBCS_DOMAIN_BACKUP_LIST",l),ye("GATEWAY_DOMAINS",[o]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(Jo(t.report.hostname,"report.hostname"),ye("EVENT_REPORT_DOMAIN",t.report.hostname[0]),ye("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(ye("EVENT_REPORT_DOMAIN",c[0]),ye("EVENT_REPORT_BACKUP_DOMAIN",c[1]||c[0]));let u=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),u=t.report.port),ye("STATS_COLLECTOR_PORT",u),t.report?ye("ENABLE_EVENT_REPORT",!0):ye("ENABLE_EVENT_REPORT",!1);let p="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(Jo(t.log.hostname,"log.hostname"),p=t.log.hostname[0]):p=c[0];let m=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),m=t.log.port),ye("LOG_UPLOAD_SERVER","".concat(p,":").concat(m));let _=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(Jo(t.cds.hostname,"cds.hostname"),_=t.cds.hostname):_=c;let E=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),E=t.cds.port),ye("CDS_AP",_.map(S=>"".concat(S,":").concat(E))),t.cds?ye("ENABLE_CONFIG_DISTRIBUTE",!0):ye("ENABLE_CONFIG_DISTRIBUTE",!1),R.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(Jo(t,"serverList"),Mn(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Q(L.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(e):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,ye("WEBCS_DOMAIN",t),ye("WEBCS_DOMAIN_BACKUP_LIST",t),ye("GATEWAY_DOMAINS",[e]),ye("EVENT_REPORT_DOMAIN",t[0]),ye("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),ye("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),R.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Tn(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw R.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else R.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){Tn(e,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout(()=>{const n=this._users.find(i=>i.uid===t);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw R.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}R.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){Tn(e,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(n){throw R.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}R.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,n,i){(function(c){Tn(c,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),Mn(e,"secret");const o=["aes-128-gcm2","aes-256-gcm2"];if(pt(o).call(o,t)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new Q(L.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new Q(L.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(Hs(i,"encryptDataStream"),!pt(o).call(o,t))throw new Q(L.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||R.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=e,n&&(this._encryptionSalt=Ma(n))}async renewToken(t){if(Mn(t,"token",1,2047),!this._key||!this._joinInfo)throw new Q(L.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const n=await this._renewTokenMutex.lock();try{if(x("USE_NEW_TOKEN")){R.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await UZ(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||pn);R.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:i})}else R.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});R.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=e,this._joinInfo.token=e,R.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?R.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(te.VOLUME_INDICATOR,t)},x("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if(this.codec!=="h264")throw new Q(L.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Q(L.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new Q(L.LIVE_STREAMING_TASK_CONFLICT);const n=e?bo.TRANSCODE:bo.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(t,n)}setLiveTranscoding(t){return this._createLiveStreamingClient(bo.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(t));if(!e.length)throw new Q(L.INVALID_PARAMS,"can not find live streaming url to stop");await gt.all(e.map(n=>n&&n.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){Qx(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){Qx(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof Jh&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var e;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Q(L.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const o=new TextEncoder;t.payload=o.encode(t.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&pt(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)&&(i=!0,t.payload=await async function(o,c,l){var u;const p=os(u=Array.from(l)).call(u,(I,w)=>I+w,0),m={serverTs:0,seq:rQ++,length:l.length,checkSum:p},_=new Uint8Array(E1(p,2)),E=new ArrayBuffer(wl),S=new DataView(E);S.setUint32(0,m.serverTs),S.setUint16(4,m.seq),S.setUint16(6,m.length),S.setUint16(8,m.checkSum);const T=16-l.length%16;l=p1(l,new Uint8Array(T));const A=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:o,tagLength:D1,additionalData:_},c,l);return p1(new Uint8Array(E),new Uint8Array(A))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new Q(L.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Mt.DATA_STREAM,{payload:Ma(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-zZ},!n)}sendMetadata(t){if(!this._joinInfo)throw new Q(L.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new Q(L.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Mt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Ma(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(pQ),!this._joinInfo)throw new Q(L.INVALID_OPERATION,"can not send custom report, not joined");await bt.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const t=this._statsCollector.getRemoteNetworkQualityStats();if(x("DELETE_NEQ_AFTER_USER_LEAVE")){const e=this._users.map(n=>n.uid+"");Object.keys(t).forEach(n=>{pt(e).call(e,n)||delete t[n]})}return t}async pickSVCLayer(t,e){Tn(e.spatialLayer,"spatialLayer",[0,1,2,3]),Tn(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(n){throw R.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(t){const{apRTM:e=!1,rtmFlag:n}=t;if(Hs(e,"apRTM"),be(n,"rtmFlag",0),this._rtmConfig.apRTM=e,this._rtmConfig.rtmFlag=n,R.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=e,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(R.debug("[".concat(this._clientId,"] reset client")),function(t){const e=Fl.indexOf(t);e!==-1&&Fl.splice(e,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Oi.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&R2(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&bt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(e=>e._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Qn("client-publish",this._clientId),this._subscribeMutex=new Qn("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,e){var n;const i=t||Kc();t?R.debug("[".concat(this._clientId,"] new Session ").concat(i)):R.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const o=t?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,bt.addSid(i);const c={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(e==null?void 0:e.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:o,clientRole:this.role==="audience"?2:1};bt.sessionInit(this._sessionId,ys({cname:e.channel,appid:e.appId},c)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new Q(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&x("FORCE_TURN")&&!x("TURN_ENABLE_TCP")&&!x("TURN_ENABLE_UDP"))throw new Q(L.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");R.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const i=(await n.next()).value;if(i){try{await this._gateway.sendExtensionMessage(rn.PUBLISH,i,!0)}catch(o){throw n.throw(o),o}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var e;let o;try{o=await this._gateway.publish(this._uid,i,!0)}catch(c){if(c.code!==L.DISCONNECT_P2P)throw n.throw(c),c}await n.next(((e=o)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const o of t)o instanceof Me&&o._encoderConfig&&this._gateway.setVideoProfile(o._encoderConfig).catch(c=>{R.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!o.muted&&o.enabled||await this._p2pChannel.muteLocalTrack(o)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,t),(n==null?void 0:n.code)===L.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Q(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));R.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var e;let o;try{o=await this._gateway.publish(this._uid,i,!0)}catch(c){if(c.code!==L.DISCONNECT_P2P)throw n.throw(c),c}n.next(((e=o)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===L.WS_ABORT)return;throw n}}_createLiveStreamingClient(t){const e=()=>{if(!this._joinInfo||!this._appId)return new Q(L.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},$o("LiveStreaming").create(i));var i;return n.onLiveStreamError=(o,c)=>{bt.reportApiInvoke(this._sessionId,{name:tn.ON_LIVE_STREAM_ERROR,options:[o,c],tag:We.TRACER}).onSuccess(),this.safeEmit(te.LIVE_STREAMING_ERROR,o,c)},n.onLiveStreamWarning=(o,c)=>{bt.reportApiInvoke(this._sessionId,{name:tn.ON_LIVE_STREAM_WARNING,options:[o,c],tag:We.TRACER}).onSuccess(),this.safeEmit(te.LIVE_STREAMING_WARNING,o,c)},n.on(L0.REQUEST_WORKER_MANAGER_LIST,(o,c,l)=>{if(!this._joinInfo)return l(new Q(L.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(u,p,m,_){const E=x("UAP_AP").slice(0,x("AJAX_REQUEST_CONCURRENT")).map(S=>p.proxyServer?"https://".concat(p.proxyServer,"/ap/?url=").concat(S+"/api/v1?action=uap"):"https://".concat(S,"/api/v1?action=uap"));return await NZ(E,u,p,m,_)})(o,this._joinInfo,this._axiosCancelSource.token,pn).then(c).catch(l)}),n};return t===bo.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||e(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||e(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Q(L.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:e,height:n}},$o("ChannelMediaRelay").create(t));i.on("state",o=>{o===Hi.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(te.CHANNEL_MEDIA_RELAY_STATE,o)}),i.on("event",o=>{this.safeEmit(te.CHANNEL_MEDIA_RELAY_EVENT,o)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(o,c)=>{var l;o==="resolution"&&((l=this._channelMediaRelayClient)===null||l===void 0||l.setVideoProfile(c))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:n,deleted:i}=t,o=[];if(e){const c=[];this._users.forEach(l=>{l._dataChannels.forEach(u=>{n.every(p=>p.uid!==l._uintid||p.stream_id!==u.id)&&c.push({uid:l._uintid,stream_id:u.id,ordered:u.ordered,max_retrans_times:u.maxRetransmits,metadata:u.metadata})})}),c.length>0&&this._handleUpdateDataChannel({added:[],deleted:c})}Array.isArray(n)&&n.length>0&&n.forEach(c=>{const{uid:l,stream_id:u,ordered:p,max_retrans_times:m,metadata:_}=c,E=this._users.find(S=>S._uintid===l);if(!E)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(R.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(l)),pt(o).call(o,E)||o.push(E),E._uintid||(E._uintid=l),E._dataChannels.findIndex(S=>S.id===c.stream_id)===-1){const S={id:u,ordered:!!p,maxRetransmits:m,metadata:_},T=function(A){return Mx(A,!0)}(S);E._dataChannels.push(T),R.info("[".concat(this._clientId,"] remote user ").concat(E.uid," published datachannel")),e||this.safeEmit(te.USER_PUBLISHED,E,"datachannel",S)}this._p2pChannel.hasPendingRemoteDataChannel(E,c.stream_id)&&(R.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(E.uid," after reconnect.")),this._subscribeDataChannel(E,c.stream_id).catch(S=>{R.error("[".concat(this._clientId,"] resubscribe datachannel error"),S.toString())}))}),e&&(this.safeEmit(te.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(c=>{const{uid:l,stream_id:u}=c,p=this._users.find(_=>_._uintid===l);if(!p)return void R.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const m=p._dataChannels.find(_=>_.id===c.stream_id);m&&(R.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(l)),this._p2pChannel.unsubscribeDataChannel(p,[m]).then(_=>{if(p._dataChannels=p._dataChannels.filter(E=>E!==m),_)return this._gateway.unsubscribeDataChannel(_,p.uid)}),R.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished datachannel ,id:").concat(m.id)),this.safeEmit(te.USER_UNPUBLISHED,p,"datachannel",m._config))})}_getEncodingName(t){var e;if(!this._joinResponse)return;const n=(e=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||e===void 0?void 0:e.videoCodecs;if(n)for(const o of n){var i;if(o.payloadType===t)return o==null||(i=o.rtpMap)===null||i===void 0?void 0:i.encodingName}}_handleRemoveDataChannels(t){const e=this._users.find(n=>n.uid===t.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){R.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const n=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(i=>{this.safeEmit(te.USER_UNPUBLISHED,e,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,e.uid)}),n()}}else R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Nn.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void R.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();Object.keys(e).forEach(i=>{const{value:o,type:c,expires:l}=e[i];l&&l<=n||c||w0()||!Object.prototype.hasOwnProperty.call(E_,i)||(Ks[i]=o,Be[i]=o,R.debug("Update gateway parameters from config distribute",i,o))})}catch(e){R.error("Error update config from local cache",e.message)}})()}),this._gateway.on(Nn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Nn.CONNECTION_STATE_CHANGE,(t,e,n)=>{var i;if(n===_e.FALLBACK)return;const o=()=>{this.safeEmit(te.CONNECTION_STATE_CHANGE,t,e,n)};if(bt.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:tn.CONNECTION_STATE_CHANGE,options:[t,e,n],tag:We.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:n})),R.info("[".concat(this._clientId,"] signal connection state change: ").concat(e," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void o();if(t==="RECONNECTING")this._users.forEach(l=>{l._trust_in_room_=!1,l._trust_audio_enabled_state_=!1,l._trust_video_enabled_state_=!1,l._trust_audio_mute_state_=!1,l._trust_video_mute_state_=!1,l._trust_audio_stream_added_state_=!1,l._trust_video_stream_added_state_=!1,l._is_pre_created||(l._audio_pre_subscribed||(l._audioSSRC=void 0,l._audioOrtc=void 0),l._video_pre_subscribed||(l._videoSSRC=void 0,l._videoOrtc=void 0,l._rtxSsrcId=void 0),l._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var c;this._streamFallbackTypeCacheMap.forEach((l,u)=>{this._gateway.setStreamFallbackOption(u,l).catch(p=>{R.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),p)})}),this._remoteStreamTypeCacheMap.forEach((l,u)=>{this._gateway.setRemoteVideoStreamType(u,l).catch(p=>{R.warning("[".concat(this._clientId,"] auto set remote stream type failed"),p)})}),this._remoteDefaultVideoStreamType!==void 0&&((c=this._joinInfo)===null||c===void 0?void 0:c.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{R.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(l=>{R.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(l))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(l=>!l._trust_in_room_).forEach(l=>{R.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(l.uid)),this._handleUserOffline({uid:l.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(l=>{l._trust_audio_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(l.uid)),this._handleMuteStream(l.uid,St.AUDIO,!1)),l._trust_video_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(l.uid)),this._handleMuteStream(l.uid,St.VIDEO,!1)),l._trust_audio_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(l.uid)),this._handleSetStreamLocalEnable("audio",l.uid,!0)),l._trust_video_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(l.uid)),this._handleSetStreamLocalEnable("video",l.uid,!0)),l._trust_video_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(l.uid)),this._handleResetAddStream(l,"video")),l._trust_audio_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(l.uid)),this._handleResetAddStream(l,"audio")),l._video_added_||l._audio_added_||(R.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(l.uid)),this._handleRemoveStream({uid:l.uid,uint_id:l._uintid}))}))},1e3))}o()}),this._gateway.on(Nn.REQUEST_NEW_GATEWAY_LIST,async(t,e)=>{if(!this._joinInfo)return e(new Q(L.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const i=await T2(ys(ys({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(n=i.ap,C2(i),this._joinInfo.preload=!0):(n=await J0(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||pn,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const o=[];n.gatewayInfo.gatewayAddrs.forEach(c=>{let{address:l}=c;const[u,p]=l.split(":");this._joinInfo&&this._joinInfo.proxyServer?o.push({proxy:this._joinInfo.proxyServer,host:u,port:p}):o.push({host:u,port:p})}),t(o)}catch(n){e(n)}}),this._gateway.on(Nn.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(te.NETWORK_QUALITY,t)}),this._gateway.on(Nn.STREAM_TYPE_CHANGE,(t,e)=>{this.safeEmit(te.STREAM_TYPE_CHANGED,t,e),bt.reportApiInvoke(this._sessionId,{name:tn.STREAM_TYPE_CHANGE,options:[t,e],tag:We.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(Nn.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(Nn.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,n)=>{try{let i=await this._p2pChannel.getEstablishParams();i&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(i=await this._p2pChannel.startP2PConnection(t)),e(i)}catch(i){n(i)}}),this._gateway.on(Nn.JOIN_RESPONSE,(t,e)=>{if(this.store.useP2P)return;let n;this._joinResponse=t,t.attributes?n=t.attributes.userAttributes.preSubSsrcs:R.debug("no attributes in joinResponse");const i=Rx(t.ortc,e,n);this._p2pChannel.connect(i)}),this._gateway.on(Nn.PRE_CONNECT_PC,async t=>{const{candidates:e,fingerprint:n,turnServer:i}=t;if(this._joinInfo&&e.length>0&&!this._p2pChannel.isPlanB){const{cert:c,cid:l}=this._joinInfo.apResponse,u="".concat(l,"_").concat(c);if(u.length<4||u.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:i,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var o;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(l,"_").concat(c),icePwd:"".concat(l,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=x("FINGERPRINT"))!==null&&o!==void 0?o:n}]},candidates:e,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(p){p.code&&p.code===L.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:i,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(ee.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(ee.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(ee.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc)),this._gateway.signal.on(ee.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(ee.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(ee.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(ee.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(ee.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(ee.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,St.AUDIO,!0)),this._gateway.signal.on(ee.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,St.AUDIO,!1)),this._gateway.signal.on(ee.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,St.VIDEO,!0)),this._gateway.signal.on(ee.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,St.VIDEO,!1)),this._gateway.signal.on(ee.RECEIVE_METADATA,t=>{const e=zc(t.metadata);this.safeEmit(te.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(ee.ON_DATA_STREAM,async t=>{var e;if(!t)return;let n=zc(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&pt(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)){if(t.payload.length<wl)throw new Q(L.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(wl));n=await async function(c,l,u){const p=u.subarray(0,wl),m=p.slice(8,wl),_=(m[0]<<8)+m[1],E=(p[6]<<8)+p[7],S=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:c,tagLength:D1,additionalData:new Uint8Array(E1(_,2))},l,u.subarray(wl));return new Uint8Array(S).subarray(0,E)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let i=0;if(t.ordered||t.syncWithAudio){const o=this._p2pChannel.getStats(),c=this.remoteUsers.find(u=>u.uid===t.uid),l=o==null?void 0:o.audioRecv.find(u=>u.ssrc===(c==null?void 0:c._audioSSRC));i=l==null?void 0:l.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),YZ(ys(ys({},t),{},{payload:n}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(ee.ON_CRYPT_ERROR,()=>{La(()=>{R.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(te.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(ee.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(ee.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{R.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,_e.TOKEN_EXPIRE),this.safeEmit(te.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(ee.ON_STREAM_FALLBACK_UPDATE,t=>{R.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(te.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(ee.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),R.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(ee.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(ee.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(Vt.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case Mt.PUBLISH:{if(!e)return;const o=e.ortc;if(o){var n,i;const c=o.some(p=>{let{stream_type:m}=p;return m===Ee.Audio}),l=o.some(p=>{let{stream_type:m}=p;return m!==Ee.Audio}),u=o.some(p=>{let{stream_type:m}=p;return m===Ee.Screen||m===Ee.ScreenLow});e.state==="offer"&&bt.publish(this._joinInfo.sid,{eventElapse:ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:L.TIMEOUT,audio:c,video:l,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:u,audioName:c?(n=o.find(p=>{let{stream_type:m}=p;return m===Ee.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:l?(i=o.find(p=>{let{stream_type:m}=p;return m!==Ee.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case Mt.SUBSCRIBE:e&&bt.subscribe(this._joinInfo.sid,{succ:!1,ec:L.TIMEOUT,audio:e.stream_type===St.AUDIO,video:e.stream_type===St.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:ei.measureFromSubscribeStart(this.store.clientId,e.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(e.ssrcId)})}}),this._gateway.signal.on(ee.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(ee.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;x("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(i=>!td(i.string_id||i.stream_id,this.channelName)));const e=[],n=[];for(const i of t.users){let o=this._users.find(_=>_._uintid===i.stream_id);o?o._trust_in_room_=!0:(o=new Ka(i.string_id||i.stream_id,i.stream_id),this._users.push(o),this.store.firstVideoFrameDecoded(o.uid,{userJoinNotify:Date.now()}),this.getListeners(te.PUBLISHED_USER_LIST).length===0&&(R.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(te.USER_JOINED,o)));const c=In.Audio&i.stream_type,l=(In.Video|In.LwoVideo)&i.stream_type,u=(65280&i.stream_type)!=0,p=c&&o.hasAudio,m=l&&o.hasVideo;l&&(o._trust_video_stream_added_state_=!0,o._video_added_=!0,o._videoSSRC=i.video_ssrc,o._rtxSsrcId=i.video_rtx),c&&(o._trust_audio_stream_added_state_=!0,o._audio_added_=!0,o._audioSSRC=i.audio_ssrc),c&&!p&&this.getListeners(te.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published audio")),this.safeEmit(te.USER_PUBLISHED,o,"audio")),l&&!m&&this.getListeners(te.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published video")),this.safeEmit(te.USER_PUBLISHED,o,"video")),(c&&!p||l&&!m||u)&&e.push(o),l&&this._p2pChannel.hasPendingRemoteMedia(o,"video")&&n.push({user:o,mediaType:"video"}),c&&this._p2pChannel.hasPendingRemoteMedia(o,"audio")&&n.push({user:o,mediaType:"audio"})}n.length>0&&(R.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{R.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(te.PUBLISHED_USER_LIST).length>0?x("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(R.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(i=>i.uid).join(", "))),this.safeEmit(te.PUBLISHED_USER_LIST,e)):R.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(ee.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:e}=t;this._p2pChannel instanceof Jh&&this._p2pChannel.updateRemoteRTPCapabilities(e.map(n=>n.toLowerCase()).filter(n=>{var i;return pt(i=Object.keys(kh)).call(i,n)}))})}_handleP2PEvents(){this._gateway.signal.on(ee.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(rn.PUBLISH,(t,e,n)=>{const{uid:i}=t;t.forEach(o=>{const{kind:c,ssrcs:l,mid:u,isMuted:p}=o;this._handleP2PAddAudioOrVideoStream(c,i,l[0].ssrcId,u);const m=this._users.find(_=>_.uid===i);return m&&this.store.useP2P?this._p2pChannel.mockSubscribe(m,c,l[0].ssrcId,u).then(()=>{e()}).catch(n):e(),this._handleMuteStream(i,c,!!p)})}),this._gateway.signal.on(rn.CALL,async(t,e,n)=>{if(this.store.useP2P)try{var i;e(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},t))}catch(o){n(o)}}),this._gateway.signal.on(Vt.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(rn.UNPUBLISH,async(t,e,n)=>{if(this.store.useP2P){const{unpubMsg:i,uid:o}=t,c=this._users.find(l=>l.uid===o);if(!c)return R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(o)),void e();try{i.forEach(async l=>{let{stream_type:u}=l;const p=u===Ee.Audio?St.AUDIO:St.VIDEO;await this._p2pChannel.unsubscribe(c,p),this._handleMuteStream(o,p,!0)}),e()}catch(l){n(l)}}}),this._gateway.signal.on(rn.CONTROL,async(t,e)=>{const{action:n}=t;switch(n){case Fa.MUTE_LOCAL_VIDEO:this._handleMuteStream(e,St.VIDEO,!0);break;case Fa.MUTE_LOCAL_AUDIO:this._handleMuteStream(e,St.AUDIO,!0);break;case Fa.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",e),this._handleMuteStream(e,St.VIDEO,!1);break;case Fa.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",e),this._handleMuteStream(e,St.AUDIO,!1)}}),this._gateway.signal.on(rn.RESTART_ICE,async(t,e,n)=>{if(this.store.useP2P)try{const{direction:i,iceParameter:o}=t;i!==yi.SEND_ONLY||o?e(await this._p2pChannel.restartICE(i,o)):(this._p2pChannel.handleDisconnect(i),e())}catch(i){n(i)}}),this._gateway.signal.on(rn.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:e,direction:n}=t;this._p2pChannel.addRemoteCandidate(e,n)}}),this._p2pChannel.on(It.RequestP2PRestartICE,async(t,e,n)=>{try{const{direction:i}=t;e(await this._gateway.sendExtensionMessage(rn.RESTART_ICE,t,i===yi.SEND_ONLY))}catch(i){n(i)}}),this._p2pChannel.on(It.LocalCandidate,t=>{this._gateway.sendExtensionMessage(rn.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(It.RequestP2PMuteLocal,async(t,e,n)=>{try{await this._gateway.sendExtensionMessage(rn.CONTROL,t,!0),e()}catch(i){n(i)}}),this._p2pChannel.on(It.RequestP2PUnmuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===L.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(It.RequestP2PMuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===L.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(It.StateChange,(t,e)=>{e===ge.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(It.PeerConnectionStateChange,t=>{const e=this._peerConnectionState;t!==e&&(this.safeEmit(te.PEERCONNECTION_STATE_CHANGE,t,e),this._peerConnectionState=t)}),this._p2pChannel.on(It.RequestMuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===L.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(It.RequestUnmuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===L.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(It.RequestRePublish,(t,e,n)=>{this.publish(t,!1).then(e).catch(n)}),this._p2pChannel.on(It.RequestRePublishDataChannel,(t,e,n)=>{gt.all(t.map(async i=>{const o=await this._p2pChannel.publishDataChannel([i]);try{o.forEach(c=>{this._uid&&this._gateway.publishDataChannel(this._uid,c,!0)})}catch(c){if(c.code!==L.DISCONNECT_P2P)throw c}})).then(e).catch(n)}),this._p2pChannel.on(It.RequestReSubscribe,async(t,e,n)=>{try{for(const{user:i,kind:o}of t)o===St.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");e()}catch(i){n(i)}}),this._p2pChannel.on(It.RequestUpload,(t,e)=>{this._gateway.upload(t,e)}),this._p2pChannel.on(It.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(It.MediaReconnectStart,t=>{this.safeEmit(te.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(It.MediaReconnectEnd,t=>{this.safeEmit(te.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(It.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(It.RequestRestartICE,async t=>{if(this.store.useP2P)return;const e=await this._p2pChannel.restartICE(t),n=await e.next();if(n.done)return;const i=n.value;let o;try{o=await this._gateway.restartICE({iceParameters:i})}catch(l){return void e.throw(l)}const{iceParameters:c}=function(l){const u=l.iceParameters;return{iceParameters:{iceUfrag:u.iceUfrag,icePwd:u.icePwd}}}(o);await e.next({remoteIceParameters:c})}),this._p2pChannel.on(It.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(It.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:o,gatewayAddress:c}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:n,rtpCapabilities:i}),l=Rx(o,c);await this._p2pChannel.connect(l),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(It.RequestUnpublishForReconnectPC,async(t,e,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):n()}),this._p2pChannel.on(It.P2PLost,()=>{this.safeEmit(te.P2P_LOST,this.store.uid)}),this._p2pChannel.on(It.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(It.ConnectionTypeChange,t=>{this.safeEmit(te.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(It.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(It.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(It.AudioMetadata,t=>{this.safeEmit(te.AUDIO_METADATA,t)}),this._p2pChannel.on(It.AudioPts,t=>{this.safeEmit(te.AUDIO_PTS,Number(t))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Q(L.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Q(L.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(e={config:t},$o("ContentInspect").create(e));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:o,sid:c,token:l,uid:u,cid:p,vid:m}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:o,sid:c,token:l,uid:u,cid:p,vid:m?Number(m):0},pn)}catch(n){throw Array.isArray(n)?n[0]:n}var e}handleVideoInspectEvents(t){t.on(Dn.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(te.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,n),n===Es.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(te.CONTENT_INSPECT_ERROR,new Q(L.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(Dn.INSPECT_RESULT,(e,n)=>{var i;if((n==null?void 0:n.code)===L.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return R.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(te.CONTENT_INSPECT_RESULT,e,n)}),t.on(Dn.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Q(L.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(Hs(t,"enabled"),t){if(!e)throw new Q(L.INVALID_PARAMS,"config is required");if(F2(e),!this._joinInfo)throw new Q(L.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(e);else{const i=(n={config:e},$o("ImageModeration").create(n));this._moderation=i,this.handleImageModerationEvents(i);const{appId:o,cname:c,sid:l,token:u,uid:p,cid:m,vid:_}=this._joinInfo;await i.init({appId:o,areaCode:"",cname:c,sid:l,token:u,uid:p,cid:m,vid:_?Number(_):0},pn)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var n;if(!this._moderation)throw new Q(L.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(t){t.on(Xs.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(te.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,n),e===jr.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Q(L.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Xs.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(e){Tn(e,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new Q(L.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,R.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return R.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){Hs(t,"enabled"),ye("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Ct(Et.prototype,"leave",[B2],Object.getOwnPropertyDescriptor(Et.prototype,"leave"),Et.prototype),Ct(Et.prototype,"publish",[j2],Object.getOwnPropertyDescriptor(Et.prototype,"publish"),Et.prototype),Ct(Et.prototype,"unpublish",[W2],Object.getOwnPropertyDescriptor(Et.prototype,"unpublish"),Et.prototype),Ct(Et.prototype,"subscribe",[G2],Object.getOwnPropertyDescriptor(Et.prototype,"subscribe"),Et.prototype),Ct(Et.prototype,"presubscribe",[H2],Object.getOwnPropertyDescriptor(Et.prototype,"presubscribe"),Et.prototype),Ct(Et.prototype,"massSubscribe",[z2],Object.getOwnPropertyDescriptor(Et.prototype,"massSubscribe"),Et.prototype),Ct(Et.prototype,"unsubscribe",[K2],Object.getOwnPropertyDescriptor(Et.prototype,"unsubscribe"),Et.prototype),Ct(Et.prototype,"massUnsubscribe",[Y2],Object.getOwnPropertyDescriptor(Et.prototype,"massUnsubscribe"),Et.prototype),Ct(Et.prototype,"setLowStreamParameter",[q2],Object.getOwnPropertyDescriptor(Et.prototype,"setLowStreamParameter"),Et.prototype),Ct(Et.prototype,"enableDualStream",[X2],Object.getOwnPropertyDescriptor(Et.prototype,"enableDualStream"),Et.prototype),Ct(Et.prototype,"disableDualStream",[J2],Object.getOwnPropertyDescriptor(Et.prototype,"disableDualStream"),Et.prototype),Ct(Et.prototype,"setClientRole",[Q2],Object.getOwnPropertyDescriptor(Et.prototype,"setClientRole"),Et.prototype),Ct(Et.prototype,"_setClientRoleOptions",[Z2],Object.getOwnPropertyDescriptor(Et.prototype,"_setClientRoleOptions"),Et.prototype),Ct(Et.prototype,"setProxyServer",[$2],Object.getOwnPropertyDescriptor(Et.prototype,"setProxyServer"),Et.prototype),Ct(Et.prototype,"setTurnServer",[tU],Object.getOwnPropertyDescriptor(Et.prototype,"setTurnServer"),Et.prototype),Ct(Et.prototype,"setLicense",[eU],Object.getOwnPropertyDescriptor(Et.prototype,"setLicense"),Et.prototype),Ct(Et.prototype,"startProxyServer",[nU],Object.getOwnPropertyDescriptor(Et.prototype,"startProxyServer"),Et.prototype),Ct(Et.prototype,"stopProxyServer",[iU],Object.getOwnPropertyDescriptor(Et.prototype,"stopProxyServer"),Et.prototype),Ct(Et.prototype,"setLocalAccessPointsV2",[rU],Object.getOwnPropertyDescriptor(Et.prototype,"setLocalAccessPointsV2"),Et.prototype),Ct(Et.prototype,"setLocalAccessPoints",[sU],Object.getOwnPropertyDescriptor(Et.prototype,"setLocalAccessPoints"),Et.prototype),Ct(Et.prototype,"setRemoteDefaultVideoStreamType",[oU],Object.getOwnPropertyDescriptor(Et.prototype,"setRemoteDefaultVideoStreamType"),Et.prototype),Ct(Et.prototype,"setRemoteVideoStreamType",[aU],Object.getOwnPropertyDescriptor(Et.prototype,"setRemoteVideoStreamType"),Et.prototype),Ct(Et.prototype,"setStreamFallbackOption",[cU],Object.getOwnPropertyDescriptor(Et.prototype,"setStreamFallbackOption"),Et.prototype),Ct(Et.prototype,"setEncryptionConfig",[dU],Object.getOwnPropertyDescriptor(Et.prototype,"setEncryptionConfig"),Et.prototype),Ct(Et.prototype,"renewToken",[lU],Object.getOwnPropertyDescriptor(Et.prototype,"renewToken"),Et.prototype),Ct(Et.prototype,"enableAudioVolumeIndicator",[uU],Object.getOwnPropertyDescriptor(Et.prototype,"enableAudioVolumeIndicator"),Et.prototype),Ct(Et.prototype,"startLiveStreaming",[hU],Object.getOwnPropertyDescriptor(Et.prototype,"startLiveStreaming"),Et.prototype),Ct(Et.prototype,"setLiveTranscoding",[pU],Object.getOwnPropertyDescriptor(Et.prototype,"setLiveTranscoding"),Et.prototype),Ct(Et.prototype,"stopLiveStreaming",[fU],Object.getOwnPropertyDescriptor(Et.prototype,"stopLiveStreaming"),Et.prototype),Ct(Et.prototype,"startChannelMediaRelay",[mU],Object.getOwnPropertyDescriptor(Et.prototype,"startChannelMediaRelay"),Et.prototype),Ct(Et.prototype,"updateChannelMediaRelay",[_U],Object.getOwnPropertyDescriptor(Et.prototype,"updateChannelMediaRelay"),Et.prototype),Ct(Et.prototype,"stopChannelMediaRelay",[gU],Object.getOwnPropertyDescriptor(Et.prototype,"stopChannelMediaRelay"),Et.prototype),Ct(Et.prototype,"sendCustomReportMessage",[EU],Object.getOwnPropertyDescriptor(Et.prototype,"sendCustomReportMessage"),Et.prototype),Ct(Et.prototype,"pickSVCLayer",[SU],Object.getOwnPropertyDescriptor(Et.prototype,"pickSVCLayer"),Et.prototype),Ct(Et.prototype,"setRTMConfig",[vU],Object.getOwnPropertyDescriptor(Et.prototype,"setRTMConfig"),Et.prototype),Ct(Et.prototype,"enableContentInspect",[TU],Object.getOwnPropertyDescriptor(Et.prototype,"enableContentInspect"),Et.prototype),Ct(Et.prototype,"disableContentInspect",[yU],Object.getOwnPropertyDescriptor(Et.prototype,"disableContentInspect"),Et.prototype),Ct(Et.prototype,"setImageModeration",[RU],Object.getOwnPropertyDescriptor(Et.prototype,"setImageModeration"),Et.prototype),Ct(Et.prototype,"setP2PTransport",[CU],Object.getOwnPropertyDescriptor(Et.prototype,"setP2PTransport"),Et.prototype),Ct(Et.prototype,"getJoinChannelServiceRecords",[bU],Object.getOwnPropertyDescriptor(Et.prototype,"getJoinChannelServiceRecords"),Et.prototype),Ct(Et.prototype,"setPublishAudioFilterEnabled",[IU],Object.getOwnPropertyDescriptor(Et.prototype,"setPublishAudioFilterEnabled"),Et.prototype),Et);class Zh{constructor(e,n){N(this,"id",0),N(this,"element",void 0),N(this,"peerPair",void 0),N(this,"context",void 0),N(this,"audioPlayerElement",void 0),N(this,"audioTrack",void 0),Zh.count+=1,this.id=Zh.count,this.element=e,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const n=document.createElement("audio");n.srcObject=new MediaStream([e.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const e=async(i,o)=>{const c=o==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(c),i.iceGatheringState==="complete"?i.localDescription:new gt(l=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&l(i.localDescription)}})},n=async(i,o)=>await i.setRemoteDescription(o);try{const i=await e(this.peerPair[0],"offer");await n(this.peerPair[1],i);const o=await e(this.peerPair[1],"answer");await n(this.peerPair[0],o)}catch(i){throw new Q(L.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let n;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(n)}catch(o){throw new Q(L.LOCAL_AEC_ERROR,o.toString()).print()}if(!n)throw new Q(L.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,n=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){R.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var AU,pg;N(Zh,"count",0);const d$=window.AudioContext||window.webkitAudioContext,l$=new(AU=Pt({report:bt}),Ct((pg=class{constructor(){N(this,"units",[]),N(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return R.debug("the system does not need to process local aec"),-1;this.context||(this.context=new d$);let e=this.units.find(n=>n&&n.getElement()===t);return e||(e=new Zh(t,this.context),this.units.push(e)),e.startEchoCancellation(),R.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return ie().name!==ue.SAFARI}}).prototype,"processExternalMediaAEC",[AU],Object.getOwnPropertyDescriptor(pg.prototype,"processExternalMediaAEC"),pg.prototype),pg);function OU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function NU(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?OU(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):OU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const _R=window||document;function DU(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!_R)return;const n=fn._cspEventHandlerPointer;if(n&&e)return void console.error(n,e);const i=o=>{if(!(o&&o.blockedURI&&(fn.onSecurityPolicyViolation||fn.getListeners(Io.SECURITY_POLICY_VIOLATION).length>0)))return;const c=o.blockedURI;x("CSP_DETECTED_HOSTNAME_LIST").some(l=>pt(c).call(c,l))&&(fn.onSecurityPolicyViolation&&typeof fn.onSecurityPolicyViolation=="function"&&fn.onSecurityPolicyViolation(o),fn.getListeners(Io.SECURITY_POLICY_VIOLATION).length>0&&fn.safeEmit(Io.SECURITY_POLICY_VIOLATION,o))};n&&_R.removeEventListener("securitypolicyviolation",n),(e||t&&typeof t=="function"||fn.getListeners(Io.SECURITY_POLICY_VIOLATION).length>0)&&_R.addEventListener("securitypolicyviolation",i),fn._cspEventHandlerPointer=i}var u$=M,h$=hk,PU=RegExp.prototype,p$=function(t){return t===PU||u$(PU,t)?h$(t):t.flags},mi=h(p$);function tu(t){let e=t.length;for(;--e>=0;)t[e]=0}const gR=256,kU=286,$h=30,tp=15,ER=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),fg=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),f$=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),LU=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ea=new Array(576);tu(ea);const ep=new Array(60);tu(ep);const np=new Array(512);tu(np);const ip=new Array(256);tu(ip);const SR=new Array(29);tu(SR);const mg=new Array($h);function vR(t,e,n,i,o){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=i,this.max_length=o,this.has_stree=t&&t.length}let MU,xU,UU;function TR(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}tu(mg);const VU=t=>t<256?np[t]:np[256+(t>>>7)],rp=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},Ir=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,rp(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},Oo=(t,e,n)=>{Ir(t,n[2*e],n[2*e+1])},FU=(t,e)=>{let n=0;do n|=1&t,t>>>=1,n<<=1;while(--e>0);return n>>>1},BU=(t,e,n)=>{const i=new Array(16);let o,c,l=0;for(o=1;o<=tp;o++)l=l+n[o-1]<<1,i[o]=l;for(c=0;c<=e;c++){let u=t[2*c+1];u!==0&&(t[2*c]=FU(i[u]++,u))}},jU=t=>{let e;for(e=0;e<kU;e++)t.dyn_ltree[2*e]=0;for(e=0;e<$h;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},WU=t=>{t.bi_valid>8?rp(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},GU=(t,e,n,i)=>{const o=2*e,c=2*n;return t[o]<t[c]||t[o]===t[c]&&i[e]<=i[n]},yR=(t,e,n)=>{const i=t.heap[n];let o=n<<1;for(;o<=t.heap_len&&(o<t.heap_len&&GU(e,t.heap[o+1],t.heap[o],t.depth)&&o++,!GU(e,i,t.heap[o],t.depth));)t.heap[n]=t.heap[o],n=o,o<<=1;t.heap[n]=i},HU=(t,e,n)=>{let i,o,c,l,u=0;if(t.sym_next!==0)do i=255&t.pending_buf[t.sym_buf+u++],i+=(255&t.pending_buf[t.sym_buf+u++])<<8,o=t.pending_buf[t.sym_buf+u++],i===0?Oo(t,o,e):(c=ip[o],Oo(t,c+gR+1,e),l=ER[c],l!==0&&(o-=SR[c],Ir(t,o,l)),i--,c=VU(i),Oo(t,c,n),l=fg[c],l!==0&&(i-=mg[c],Ir(t,i,l)));while(u<t.sym_next);Oo(t,256,e)},RR=(t,e)=>{const n=e.dyn_tree,i=e.stat_desc.static_tree,o=e.stat_desc.has_stree,c=e.stat_desc.elems;let l,u,p,m=-1;for(t.heap_len=0,t.heap_max=573,l=0;l<c;l++)n[2*l]!==0?(t.heap[++t.heap_len]=m=l,t.depth[l]=0):n[2*l+1]=0;for(;t.heap_len<2;)p=t.heap[++t.heap_len]=m<2?++m:0,n[2*p]=1,t.depth[p]=0,t.opt_len--,o&&(t.static_len-=i[2*p+1]);for(e.max_code=m,l=t.heap_len>>1;l>=1;l--)yR(t,n,l);p=c;do l=t.heap[1],t.heap[1]=t.heap[t.heap_len--],yR(t,n,1),u=t.heap[1],t.heap[--t.heap_max]=l,t.heap[--t.heap_max]=u,n[2*p]=n[2*l]+n[2*u],t.depth[p]=(t.depth[l]>=t.depth[u]?t.depth[l]:t.depth[u])+1,n[2*l+1]=n[2*u+1]=p,t.heap[1]=p++,yR(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((_,E)=>{const S=E.dyn_tree,T=E.max_code,A=E.stat_desc.static_tree,I=E.stat_desc.has_stree,w=E.stat_desc.extra_bits,P=E.stat_desc.extra_base,D=E.stat_desc.max_length;let U,G,W,F,X,tt,nt=0;for(F=0;F<=tp;F++)_.bl_count[F]=0;for(S[2*_.heap[_.heap_max]+1]=0,U=_.heap_max+1;U<573;U++)G=_.heap[U],F=S[2*S[2*G+1]+1]+1,F>D&&(F=D,nt++),S[2*G+1]=F,G>T||(_.bl_count[F]++,X=0,G>=P&&(X=w[G-P]),tt=S[2*G],_.opt_len+=tt*(F+X),I&&(_.static_len+=tt*(A[2*G+1]+X)));if(nt!==0){do{for(F=D-1;_.bl_count[F]===0;)F--;_.bl_count[F]--,_.bl_count[F+1]+=2,_.bl_count[D]--,nt-=2}while(nt>0);for(F=D;F!==0;F--)for(G=_.bl_count[F];G!==0;)W=_.heap[--U],W>T||(S[2*W+1]!==F&&(_.opt_len+=(F-S[2*W+1])*S[2*W],S[2*W+1]=F),G--)}})(t,e),BU(n,m,t.bl_count)},zU=(t,e,n)=>{let i,o,c=-1,l=e[1],u=0,p=7,m=4;for(l===0&&(p=138,m=3),e[2*(n+1)+1]=65535,i=0;i<=n;i++)o=l,l=e[2*(i+1)+1],++u<p&&o===l||(u<m?t.bl_tree[2*o]+=u:o!==0?(o!==c&&t.bl_tree[2*o]++,t.bl_tree[32]++):u<=10?t.bl_tree[34]++:t.bl_tree[36]++,u=0,c=o,l===0?(p=138,m=3):o===l?(p=6,m=3):(p=7,m=4))},KU=(t,e,n)=>{let i,o,c=-1,l=e[1],u=0,p=7,m=4;for(l===0&&(p=138,m=3),i=0;i<=n;i++)if(o=l,l=e[2*(i+1)+1],!(++u<p&&o===l)){if(u<m)do Oo(t,o,t.bl_tree);while(--u!=0);else o!==0?(o!==c&&(Oo(t,o,t.bl_tree),u--),Oo(t,16,t.bl_tree),Ir(t,u-3,2)):u<=10?(Oo(t,17,t.bl_tree),Ir(t,u-3,3)):(Oo(t,18,t.bl_tree),Ir(t,u-11,7));u=0,c=o,l===0?(p=138,m=3):o===l?(p=6,m=3):(p=7,m=4)}};let YU=!1;const qU=(t,e,n,i)=>{Ir(t,0+(i?1:0),3),WU(t),rp(t,n),rp(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var m$=t=>{YU||((()=>{let e,n,i,o,c;const l=new Array(16);for(i=0,o=0;o<28;o++)for(SR[o]=i,e=0;e<1<<ER[o];e++)ip[i++]=o;for(ip[i-1]=o,c=0,o=0;o<16;o++)for(mg[o]=c,e=0;e<1<<fg[o];e++)np[c++]=o;for(c>>=7;o<$h;o++)for(mg[o]=c<<7,e=0;e<1<<fg[o]-7;e++)np[256+c++]=o;for(n=0;n<=tp;n++)l[n]=0;for(e=0;e<=143;)ea[2*e+1]=8,e++,l[8]++;for(;e<=255;)ea[2*e+1]=9,e++,l[9]++;for(;e<=279;)ea[2*e+1]=7,e++,l[7]++;for(;e<=287;)ea[2*e+1]=8,e++,l[8]++;for(BU(ea,287,l),e=0;e<$h;e++)ep[2*e+1]=5,ep[2*e]=FU(e,5);MU=new vR(ea,ER,257,kU,tp),xU=new vR(ep,fg,0,$h,tp),UU=new vR(new Array(0),f$,0,19,7)})(),YU=!0),t.l_desc=new TR(t.dyn_ltree,MU),t.d_desc=new TR(t.dyn_dtree,xU),t.bl_desc=new TR(t.bl_tree,UU),t.bi_buf=0,t.bi_valid=0,jU(t)},_$=(t,e,n,i)=>{let o,c,l=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(u=>{let p,m=4093624447;for(p=0;p<=31;p++,m>>>=1)if(1&m&&u.dyn_ltree[2*p]!==0)return 0;if(u.dyn_ltree[18]!==0||u.dyn_ltree[20]!==0||u.dyn_ltree[26]!==0)return 1;for(p=32;p<gR;p++)if(u.dyn_ltree[2*p]!==0)return 1;return 0})(t)),RR(t,t.l_desc),RR(t,t.d_desc),l=(u=>{let p;for(zU(u,u.dyn_ltree,u.l_desc.max_code),zU(u,u.dyn_dtree,u.d_desc.max_code),RR(u,u.bl_desc),p=18;p>=3&&u.bl_tree[2*LU[p]+1]===0;p--);return u.opt_len+=3*(p+1)+5+5+4,p})(t),o=t.opt_len+3+7>>>3,c=t.static_len+3+7>>>3,c<=o&&(o=c)):o=c=n+5,n+4<=o&&e!==-1?qU(t,e,n,i):t.strategy===4||c===o?(Ir(t,2+(i?1:0),3),HU(t,ea,ep)):(Ir(t,4+(i?1:0),3),((u,p,m,_)=>{let E;for(Ir(u,p-257,5),Ir(u,m-1,5),Ir(u,_-4,4),E=0;E<_;E++)Ir(u,u.bl_tree[2*LU[E]+1],3);KU(u,u.dyn_ltree,p-1),KU(u,u.dyn_dtree,m-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,l+1),HU(t,t.dyn_ltree,t.dyn_dtree)),jU(t),i&&WU(t)},g$=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(ip[n]+gR+1)]++,t.dyn_dtree[2*VU(e)]++),t.sym_next===t.sym_end),E$=t=>{Ir(t,2,3),Oo(t,256,ea),(e=>{e.bi_valid===16?(rp(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(t)},S$={_tr_init:m$,_tr_stored_block:qU,_tr_flush_block:_$,_tr_tally:g$,_tr_align:E$},sp=(t,e,n,i)=>{let o=65535&t|0,c=t>>>16&65535|0,l=0;for(;n!==0;){l=n>2e3?2e3:n,n-=l;do o=o+e[i++]|0,c=c+o|0;while(--l);o%=65521,c%=65521}return o|c<<16|0};const v$=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var Ci=(t,e,n,i)=>{const o=v$,c=i+n;t^=-1;for(let l=i;l<c;l++)t=t>>>8^o[255&(t^e[l])];return-1^t},od={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},eu={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:T$,_tr_stored_block:CR,_tr_flush_block:y$,_tr_tally:Ja,_tr_align:R$}=S$,{Z_NO_FLUSH:Qa,Z_PARTIAL_FLUSH:C$,Z_FULL_FLUSH:b$,Z_FINISH:Rs,Z_BLOCK:XU,Z_OK:ki,Z_STREAM_END:JU,Z_STREAM_ERROR:No,Z_DATA_ERROR:I$,Z_BUF_ERROR:bR,Z_DEFAULT_COMPRESSION:w$,Z_FILTERED:A$,Z_HUFFMAN_ONLY:_g,Z_RLE:O$,Z_FIXED:N$,Z_DEFAULT_STRATEGY:D$,Z_UNKNOWN:P$,Z_DEFLATED:gg}=eu,IR=286,k$=30,L$=19,M$=2*IR+1,x$=15,ad=258,Do=262,nu=42,cd=113,op=666,dd=(t,e)=>(t.msg=od[e],e),QU=t=>2*t-(t>4?9:0),Za=t=>{let e=t.length;for(;--e>=0;)t[e]=0},U$=t=>{let e,n,i,o=t.w_size;e=t.hash_size,i=e;do n=t.head[--i],t.head[i]=n>=o?n-o:0;while(--e);e=o,i=e;do n=t.prev[--i],t.prev[i]=n>=o?n-o:0;while(--e)};let $a=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const Gr=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},Hr=(t,e)=>{y$(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Gr(t.strm)},en=(t,e)=>{t.pending_buf[t.pending++]=e},ap=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},wR=(t,e,n,i)=>{let o=t.avail_in;return o>i&&(o=i),o===0?0:(t.avail_in-=o,e.set(t.input.subarray(t.next_in,t.next_in+o),n),t.state.wrap===1?t.adler=sp(t.adler,e,o,n):t.state.wrap===2&&(t.adler=Ci(t.adler,e,o,n)),t.next_in+=o,t.total_in+=o,o)},ZU=(t,e)=>{let n,i,o=t.max_chain_length,c=t.strstart,l=t.prev_length,u=t.nice_match;const p=t.strstart>t.w_size-Do?t.strstart-(t.w_size-Do):0,m=t.window,_=t.w_mask,E=t.prev,S=t.strstart+ad;let T=m[c+l-1],A=m[c+l];t.prev_length>=t.good_match&&(o>>=2),u>t.lookahead&&(u=t.lookahead);do if(n=e,m[n+l]===A&&m[n+l-1]===T&&m[n]===m[c]&&m[++n]===m[c+1]){c+=2,n++;do;while(m[++c]===m[++n]&&m[++c]===m[++n]&&m[++c]===m[++n]&&m[++c]===m[++n]&&m[++c]===m[++n]&&m[++c]===m[++n]&&m[++c]===m[++n]&&m[++c]===m[++n]&&c<S);if(i=ad-(S-c),c=S-ad,i>l){if(t.match_start=e,l=i,i>=u)break;T=m[c+l-1],A=m[c+l]}}while((e=E[e&_])>p&&--o!=0);return l<=t.lookahead?l:t.lookahead},iu=t=>{const e=t.w_size;let n,i,o;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Do)&&(t.window.set(t.window.subarray(e,e+e-i),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),U$(t),i+=e),t.strm.avail_in===0)break;if(n=wR(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=n,t.lookahead+t.insert>=3)for(o=t.strstart-t.insert,t.ins_h=t.window[o],t.ins_h=$a(t,t.ins_h,t.window[o+1]);t.insert&&(t.ins_h=$a(t,t.ins_h,t.window[o+3-1]),t.prev[o&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=o,o++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Do&&t.strm.avail_in!==0)},$U=(t,e)=>{let n,i,o,c=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,l=0,u=t.strm.avail_in;do{if(n=65535,o=t.bi_valid+42>>3,t.strm.avail_out<o||(o=t.strm.avail_out-o,i=t.strstart-t.block_start,n>i+t.strm.avail_in&&(n=i+t.strm.avail_in),n>o&&(n=o),n<c&&(n===0&&e!==Rs||e===Qa||n!==i+t.strm.avail_in)))break;l=e===Rs&&n===i+t.strm.avail_in?1:0,CR(t,0,0,l),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,Gr(t.strm),i&&(i>n&&(i=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,n-=i),n&&(wR(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(l===0);return u-=t.strm.avail_in,u&&(u>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=u&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-u,t.strm.next_in),t.strstart),t.strstart+=u,t.insert+=u>t.w_size-t.insert?t.w_size-t.insert:u),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),l?4:e!==Qa&&e!==Rs&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(o=t.window_size-t.strstart,t.strm.avail_in>o&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,o+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),o>t.strm.avail_in&&(o=t.strm.avail_in),o&&(wR(t.strm,t.window,t.strstart,o),t.strstart+=o,t.insert+=o>t.w_size-t.insert?t.w_size-t.insert:o),t.high_water<t.strstart&&(t.high_water=t.strstart),o=t.bi_valid+42>>3,o=t.pending_buf_size-o>65535?65535:t.pending_buf_size-o,c=o>t.w_size?t.w_size:o,i=t.strstart-t.block_start,(i>=c||(i||e===Rs)&&e!==Qa&&t.strm.avail_in===0&&i<=o)&&(n=i>o?o:i,l=e===Rs&&t.strm.avail_in===0&&n===i?1:0,CR(t,t.block_start,n,l),t.block_start+=n,Gr(t.strm)),l?3:1)},AR=(t,e)=>{let n,i;for(;;){if(t.lookahead<Do){if(iu(t),t.lookahead<Do&&e===Qa)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=$a(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-Do&&(t.match_length=ZU(t,n)),t.match_length>=3)if(i=Ja(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=$a(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=$a(t,t.ins_h,t.window[t.strstart+1]);else i=Ja(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(Hr(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,e===Rs?(Hr(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Hr(t,!1),t.strm.avail_out===0)?1:2},ru=(t,e)=>{let n,i,o;for(;;){if(t.lookahead<Do){if(iu(t),t.lookahead<Do&&e===Qa)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=$a(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-Do&&(t.match_length=ZU(t,n),t.match_length<=5&&(t.strategy===A$||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){o=t.strstart+t.lookahead-3,i=Ja(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=o&&(t.ins_h=$a(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(Hr(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(i=Ja(t,0,t.window[t.strstart-1]),i&&Hr(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=Ja(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===Rs?(Hr(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Hr(t,!1),t.strm.avail_out===0)?1:2};function Po(t,e,n,i,o){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=i,this.func=o}const cp=[new Po(0,0,0,0,$U),new Po(4,4,8,4,AR),new Po(4,5,16,8,AR),new Po(4,6,32,32,AR),new Po(4,4,16,16,ru),new Po(8,16,32,32,ru),new Po(8,16,128,128,ru),new Po(8,32,128,256,ru),new Po(32,128,258,1024,ru),new Po(32,258,258,4096,ru)];function V$(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=gg,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*M$),this.dyn_dtree=new Uint16Array(2*(2*k$+1)),this.bl_tree=new Uint16Array(2*(2*L$+1)),Za(this.dyn_ltree),Za(this.dyn_dtree),Za(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(x$+1),this.heap=new Uint16Array(2*IR+1),Za(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*IR+1),Za(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const dp=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==nu&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==cd&&e.status!==op?1:0},tV=t=>{if(dp(t))return dd(t,No);t.total_in=t.total_out=0,t.data_type=P$;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?nu:cd,t.adler=e.wrap===2?0:1,e.last_flush=-2,T$(e),ki},eV=t=>{const e=tV(t);return e===ki&&(n=>{n.window_size=2*n.w_size,Za(n.head),n.max_lazy_match=cp[n.level].max_lazy,n.good_match=cp[n.level].good_length,n.nice_match=cp[n.level].nice_length,n.max_chain_length=cp[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(t.state),e},nV=(t,e,n,i,o,c)=>{if(!t)return No;let l=1;if(e===w$&&(e=6),i<0?(l=0,i=-i):i>15&&(l=2,i-=16),o<1||o>9||n!==gg||i<8||i>15||e<0||e>9||c<0||c>N$||i===8&&l!==1)return dd(t,No);i===8&&(i=9);const u=new V$;return t.state=u,u.strm=t,u.status=nu,u.wrap=l,u.gzhead=null,u.w_bits=i,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=o+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new Uint8Array(2*u.w_size),u.head=new Uint16Array(u.hash_size),u.prev=new Uint16Array(u.w_size),u.lit_bufsize=1<<o+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new Uint8Array(u.pending_buf_size),u.sym_buf=u.lit_bufsize,u.sym_end=3*(u.lit_bufsize-1),u.level=e,u.strategy=c,u.method=n,eV(t)};var F$=(t,e)=>{if(dp(t)||e>XU||e<0)return t?dd(t,No):No;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===op&&e!==Rs)return dd(t,t.avail_out===0?bR:No);const i=n.last_flush;if(n.last_flush=e,n.pending!==0){if(Gr(t),t.avail_out===0)return n.last_flush=-1,ki}else if(t.avail_in===0&&QU(e)<=QU(i)&&e!==Rs)return dd(t,bR);if(n.status===op&&t.avail_in!==0)return dd(t,bR);if(n.status===nu&&n.wrap===0&&(n.status=cd),n.status===nu){let o=gg+(n.w_bits-8<<4)<<8,c=-1;if(c=n.strategy>=_g||n.level<2?0:n.level<6?1:n.level===6?2:3,o|=c<<6,n.strstart!==0&&(o|=32),o+=31-o%31,ap(n,o),n.strstart!==0&&(ap(n,t.adler>>>16),ap(n,65535&t.adler)),t.adler=1,n.status=cd,Gr(t),n.pending!==0)return n.last_flush=-1,ki}if(n.status===57){if(t.adler=0,en(n,31),en(n,139),en(n,8),n.gzhead)en(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),en(n,255&n.gzhead.time),en(n,n.gzhead.time>>8&255),en(n,n.gzhead.time>>16&255),en(n,n.gzhead.time>>24&255),en(n,n.level===9?2:n.strategy>=_g||n.level<2?4:0),en(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(en(n,255&n.gzhead.extra.length),en(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=Ci(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(en(n,0),en(n,0),en(n,0),en(n,0),en(n,0),en(n,n.level===9?2:n.strategy>=_g||n.level<2?4:0),en(n,3),n.status=cd,Gr(t),n.pending!==0)return n.last_flush=-1,ki}if(n.status===69){if(n.gzhead.extra){let o=n.pending,c=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+c>n.pending_buf_size;){let u=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+u),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>o&&(t.adler=Ci(t.adler,n.pending_buf,n.pending-o,o)),n.gzindex+=u,Gr(t),n.pending!==0)return n.last_flush=-1,ki;o=0,c-=u}let l=new Uint8Array(n.gzhead.extra);n.pending_buf.set(l.subarray(n.gzindex,n.gzindex+c),n.pending),n.pending+=c,n.gzhead.hcrc&&n.pending>o&&(t.adler=Ci(t.adler,n.pending_buf,n.pending-o,o)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let o,c=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>c&&(t.adler=Ci(t.adler,n.pending_buf,n.pending-c,c)),Gr(t),n.pending!==0)return n.last_flush=-1,ki;c=0}o=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,en(n,o)}while(o!==0);n.gzhead.hcrc&&n.pending>c&&(t.adler=Ci(t.adler,n.pending_buf,n.pending-c,c)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let o,c=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>c&&(t.adler=Ci(t.adler,n.pending_buf,n.pending-c,c)),Gr(t),n.pending!==0)return n.last_flush=-1,ki;c=0}o=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,en(n,o)}while(o!==0);n.gzhead.hcrc&&n.pending>c&&(t.adler=Ci(t.adler,n.pending_buf,n.pending-c,c))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Gr(t),n.pending!==0))return n.last_flush=-1,ki;en(n,255&t.adler),en(n,t.adler>>8&255),t.adler=0}if(n.status=cd,Gr(t),n.pending!==0)return n.last_flush=-1,ki}if(t.avail_in!==0||n.lookahead!==0||e!==Qa&&n.status!==op){let o=n.level===0?$U(n,e):n.strategy===_g?((c,l)=>{let u;for(;;){if(c.lookahead===0&&(iu(c),c.lookahead===0)){if(l===Qa)return 1;break}if(c.match_length=0,u=Ja(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++,u&&(Hr(c,!1),c.strm.avail_out===0))return 1}return c.insert=0,l===Rs?(Hr(c,!0),c.strm.avail_out===0?3:4):c.sym_next&&(Hr(c,!1),c.strm.avail_out===0)?1:2})(n,e):n.strategy===O$?((c,l)=>{let u,p,m,_;const E=c.window;for(;;){if(c.lookahead<=ad){if(iu(c),c.lookahead<=ad&&l===Qa)return 1;if(c.lookahead===0)break}if(c.match_length=0,c.lookahead>=3&&c.strstart>0&&(m=c.strstart-1,p=E[m],p===E[++m]&&p===E[++m]&&p===E[++m])){_=c.strstart+ad;do;while(p===E[++m]&&p===E[++m]&&p===E[++m]&&p===E[++m]&&p===E[++m]&&p===E[++m]&&p===E[++m]&&p===E[++m]&&m<_);c.match_length=ad-(_-m),c.match_length>c.lookahead&&(c.match_length=c.lookahead)}if(c.match_length>=3?(u=Ja(c,1,c.match_length-3),c.lookahead-=c.match_length,c.strstart+=c.match_length,c.match_length=0):(u=Ja(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++),u&&(Hr(c,!1),c.strm.avail_out===0))return 1}return c.insert=0,l===Rs?(Hr(c,!0),c.strm.avail_out===0?3:4):c.sym_next&&(Hr(c,!1),c.strm.avail_out===0)?1:2})(n,e):cp[n.level].func(n,e);if(o!==3&&o!==4||(n.status=op),o===1||o===3)return t.avail_out===0&&(n.last_flush=-1),ki;if(o===2&&(e===C$?R$(n):e!==XU&&(CR(n,0,0,!1),e===b$&&(Za(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),Gr(t),t.avail_out===0))return n.last_flush=-1,ki}return e!==Rs?ki:n.wrap<=0?JU:(n.wrap===2?(en(n,255&t.adler),en(n,t.adler>>8&255),en(n,t.adler>>16&255),en(n,t.adler>>24&255),en(n,255&t.total_in),en(n,t.total_in>>8&255),en(n,t.total_in>>16&255),en(n,t.total_in>>24&255)):(ap(n,t.adler>>>16),ap(n,65535&t.adler)),Gr(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?ki:JU)},B$=(t,e)=>{let n=e.length;if(dp(t))return No;const i=t.state,o=i.wrap;if(o===2||o===1&&i.status!==nu||i.lookahead)return No;if(o===1&&(t.adler=sp(t.adler,e,n,0)),i.wrap=0,n>=i.w_size){o===0&&(Za(i.head),i.strstart=0,i.block_start=0,i.insert=0);let p=new Uint8Array(i.w_size);p.set(e.subarray(n-i.w_size,n),0),e=p,n=i.w_size}const c=t.avail_in,l=t.next_in,u=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,iu(i);i.lookahead>=3;){let p=i.strstart,m=i.lookahead-2;do i.ins_h=$a(i,i.ins_h,i.window[p+3-1]),i.prev[p&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=p,p++;while(--m);i.strstart=p,i.lookahead=2,iu(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=l,t.input=u,t.avail_in=c,i.wrap=o,ki},lp={deflateInit:(t,e)=>nV(t,e,gg,15,8,D$),deflateInit2:nV,deflateReset:eV,deflateResetKeep:tV,deflateSetHeader:(t,e)=>dp(t)||t.state.wrap!==2?No:(t.state.gzhead=e,ki),deflate:F$,deflateEnd:t=>{if(dp(t))return No;const e=t.state.status;return t.state=null,e===cd?dd(t,I$):ki},deflateSetDictionary:B$,deflateInfo:"pako deflate (from Nodeca project)"};const j$=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Eg={assign:function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)j$(n,i)&&(t[i]=n[i])}}return t},flattenChunks:t=>{let e=0;for(let i=0,o=t.length;i<o;i++)e+=t[i].length;const n=new Uint8Array(e);for(let i=0,o=0,c=t.length;i<c;i++){let l=t[i];n.set(l,o),o+=l.length}return n}};let iV=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{iV=!1}const up=new Uint8Array(256);for(let t=0;t<256;t++)up[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;up[254]=up[254]=1;var hp={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,i,o,c,l=t.length,u=0;for(o=0;o<l;o++)n=t.charCodeAt(o),(64512&n)==55296&&o+1<l&&(i=t.charCodeAt(o+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),o++)),u+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(u),c=0,o=0;c<u;o++)n=t.charCodeAt(o),(64512&n)==55296&&o+1<l&&(i=t.charCodeAt(o+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),o++)),n<128?e[c++]=n:n<2048?(e[c++]=192|n>>>6,e[c++]=128|63&n):n<65536?(e[c++]=224|n>>>12,e[c++]=128|n>>>6&63,e[c++]=128|63&n):(e[c++]=240|n>>>18,e[c++]=128|n>>>12&63,e[c++]=128|n>>>6&63,e[c++]=128|63&n);return e},buf2string:(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let i,o;const c=new Array(2*n);for(o=0,i=0;i<n;){let l=t[i++];if(l<128){c[o++]=l;continue}let u=up[l];if(u>4)c[o++]=65533,i+=u-1;else{for(l&=u===2?31:u===3?15:7;u>1&&i<n;)l=l<<6|63&t[i++],u--;u>1?c[o++]=65533:l<65536?c[o++]=l:(l-=65536,c[o++]=55296|l>>10&1023,c[o++]=56320|1023&l)}}return((l,u)=>{if(u<65534&&l.subarray&&iV)return String.fromCharCode.apply(null,l.length===u?l:l.subarray(0,u));let p="";for(let m=0;m<u;m++)p+=String.fromCharCode(l[m]);return p})(c,o)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(192&t[n])==128;)n--;return n<0||n===0?e:n+up[t[n]]>e?n:e}},rV=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const sV=Object.prototype.toString,{Z_NO_FLUSH:W$,Z_SYNC_FLUSH:G$,Z_FULL_FLUSH:H$,Z_FINISH:z$,Z_OK:Sg,Z_STREAM_END:K$,Z_DEFAULT_COMPRESSION:Y$,Z_DEFAULT_STRATEGY:q$,Z_DEFLATED:X$}=eu;function pp(t){this.options=Eg.assign({level:Y$,method:X$,chunkSize:16384,windowBits:15,memLevel:8,strategy:q$},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new rV,this.strm.avail_out=0;let n=lp.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==Sg)throw new Error(od[n]);if(e.header&&lp.deflateSetHeader(this.strm,e.header),e.dictionary){let i;if(i=typeof e.dictionary=="string"?hp.string2buf(e.dictionary):sV.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,n=lp.deflateSetDictionary(this.strm,i),n!==Sg)throw new Error(od[n]);this._dict_set=!0}}function OR(t,e){const n=new pp(e);if(n.push(t,!0),n.err)throw n.msg||od[n.err];return n.result}pp.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize;let o,c;if(this.ended)return!1;for(c=e===~~e?e:e===!0?z$:W$,typeof t=="string"?n.input=hp.string2buf(t):sV.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(c===G$||c===H$)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(o=lp.deflate(n,c),o===K$)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),o=lp.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===Sg;if(n.avail_out!==0){if(c>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},pp.prototype.onData=function(t){this.chunks.push(t)},pp.prototype.onEnd=function(t){t===Sg&&(this.result=Eg.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var J$={Deflate:pp,deflate:OR,deflateRaw:function(t,e){return(e=e||{}).raw=!0,OR(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,OR(t,e)},constants:eu};const vg=16209;var Q$=function(t,e){let n,i,o,c,l,u,p,m,_,E,S,T,A,I,w,P,D,U,G,W,F,X,tt,nt;const at=t.state;n=t.next_in,tt=t.input,i=n+(t.avail_in-5),o=t.next_out,nt=t.output,c=o-(e-t.avail_out),l=o+(t.avail_out-257),u=at.dmax,p=at.wsize,m=at.whave,_=at.wnext,E=at.window,S=at.hold,T=at.bits,A=at.lencode,I=at.distcode,w=(1<<at.lenbits)-1,P=(1<<at.distbits)-1;t:do{T<15&&(S+=tt[n++]<<T,T+=8,S+=tt[n++]<<T,T+=8),D=A[S&w];e:for(;;){if(U=D>>>24,S>>>=U,T-=U,U=D>>>16&255,U===0)nt[o++]=65535&D;else{if(!(16&U)){if(!(64&U)){D=A[(65535&D)+(S&(1<<U)-1)];continue e}if(32&U){at.mode=16191;break t}t.msg="invalid literal/length code",at.mode=vg;break t}G=65535&D,U&=15,U&&(T<U&&(S+=tt[n++]<<T,T+=8),G+=S&(1<<U)-1,S>>>=U,T-=U),T<15&&(S+=tt[n++]<<T,T+=8,S+=tt[n++]<<T,T+=8),D=I[S&P];n:for(;;){if(U=D>>>24,S>>>=U,T-=U,U=D>>>16&255,!(16&U)){if(!(64&U)){D=I[(65535&D)+(S&(1<<U)-1)];continue n}t.msg="invalid distance code",at.mode=vg;break t}if(W=65535&D,U&=15,T<U&&(S+=tt[n++]<<T,T+=8,T<U&&(S+=tt[n++]<<T,T+=8)),W+=S&(1<<U)-1,W>u){t.msg="invalid distance too far back",at.mode=vg;break t}if(S>>>=U,T-=U,U=o-c,W>U){if(U=W-U,U>m&&at.sane){t.msg="invalid distance too far back",at.mode=vg;break t}if(F=0,X=E,_===0){if(F+=p-U,U<G){G-=U;do nt[o++]=E[F++];while(--U);F=o-W,X=nt}}else if(_<U){if(F+=p+_-U,U-=_,U<G){G-=U;do nt[o++]=E[F++];while(--U);if(F=0,_<G){U=_,G-=U;do nt[o++]=E[F++];while(--U);F=o-W,X=nt}}}else if(F+=_-U,U<G){G-=U;do nt[o++]=E[F++];while(--U);F=o-W,X=nt}for(;G>2;)nt[o++]=X[F++],nt[o++]=X[F++],nt[o++]=X[F++],G-=3;G&&(nt[o++]=X[F++],G>1&&(nt[o++]=X[F++]))}else{F=o-W;do nt[o++]=nt[F++],nt[o++]=nt[F++],nt[o++]=nt[F++],G-=3;while(G>2);G&&(nt[o++]=nt[F++],G>1&&(nt[o++]=nt[F++]))}break}}break}}while(n<i&&o<l);G=T>>3,n-=G,T-=G<<3,S&=(1<<T)-1,t.next_in=n,t.next_out=o,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=o<l?l-o+257:257-(o-l),at.hold=S,at.bits=T};const Tg=15,Z$=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),$$=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ttt=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ett=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var fp=(t,e,n,i,o,c,l,u)=>{const p=u.bits;let m,_,E,S,T,A,I=0,w=0,P=0,D=0,U=0,G=0,W=0,F=0,X=0,tt=0,nt=null;const at=new Uint16Array(16),Kt=new Uint16Array(16);let Xt,Ut,me,he=null;for(I=0;I<=Tg;I++)at[I]=0;for(w=0;w<i;w++)at[e[n+w]]++;for(U=p,D=Tg;D>=1&&at[D]===0;D--);if(U>D&&(U=D),D===0)return o[c++]=20971520,o[c++]=20971520,u.bits=1,0;for(P=1;P<D&&at[P]===0;P++);for(U<P&&(U=P),F=1,I=1;I<=Tg;I++)if(F<<=1,F-=at[I],F<0)return-1;if(F>0&&(t===0||D!==1))return-1;for(Kt[1]=0,I=1;I<Tg;I++)Kt[I+1]=Kt[I]+at[I];for(w=0;w<i;w++)e[n+w]!==0&&(l[Kt[e[n+w]]++]=w);if(t===0?(nt=he=l,A=20):t===1?(nt=Z$,he=$$,A=257):(nt=ttt,he=ett,A=0),tt=0,w=0,I=P,T=c,G=U,W=0,E=-1,X=1<<U,S=X-1,t===1&&X>852||t===2&&X>592)return 1;for(;;){Xt=I-W,l[w]+1<A?(Ut=0,me=l[w]):l[w]>=A?(Ut=he[l[w]-A],me=nt[l[w]-A]):(Ut=96,me=0),m=1<<I-W,_=1<<G,P=_;do _-=m,o[T+(tt>>W)+_]=Xt<<24|Ut<<16|me|0;while(_!==0);for(m=1<<I-1;tt&m;)m>>=1;if(m!==0?(tt&=m-1,tt+=m):tt=0,w++,--at[I]==0){if(I===D)break;I=e[n+l[w]]}if(I>U&&(tt&S)!==E){for(W===0&&(W=U),T+=P,G=I-W,F=1<<G;G+W<D&&(F-=at[G+W],!(F<=0));)G++,F<<=1;if(X+=1<<G,t===1&&X>852||t===2&&X>592)return 1;E=tt&S,o[E]=U<<24|G<<16|T-c|0}}return tt!==0&&(o[T+tt]=I-W<<24|64<<16|0),u.bits=U,0};const{Z_FINISH:oV,Z_BLOCK:ntt,Z_TREES:yg,Z_OK:ld,Z_STREAM_END:itt,Z_NEED_DICT:rtt,Z_STREAM_ERROR:Cs,Z_DATA_ERROR:aV,Z_MEM_ERROR:cV,Z_BUF_ERROR:stt,Z_DEFLATED:dV}=eu,Rg=16180,Cg=16190,na=16191,NR=16192,DR=16194,bg=16199,Ig=16200,PR=16206,Pn=16209,lV=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function ott(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ud=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<Rg||e.mode>16211?1:0},uV=t=>{if(ud(t))return Cs;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=Rg,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,ld},hV=t=>{if(ud(t))return Cs;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,uV(t)},pV=(t,e)=>{let n;if(ud(t))return Cs;const i=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?Cs:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,hV(t))},fV=(t,e)=>{if(!t)return Cs;const n=new ott;t.state=n,n.strm=t,n.window=null,n.mode=Rg;const i=pV(t,e);return i!==ld&&(t.state=null),i};let kR,LR,mV=!0;const att=t=>{if(mV){kR=new Int32Array(512),LR=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(fp(1,t.lens,0,288,kR,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;fp(2,t.lens,0,32,LR,0,t.work,{bits:5}),mV=!1}t.lencode=kR,t.lenbits=9,t.distcode=LR,t.distbits=5},_V=(t,e,n,i)=>{let o;const c=t.state;return c.window===null&&(c.wsize=1<<c.wbits,c.wnext=0,c.whave=0,c.window=new Uint8Array(c.wsize)),i>=c.wsize?(c.window.set(e.subarray(n-c.wsize,n),0),c.wnext=0,c.whave=c.wsize):(o=c.wsize-c.wnext,o>i&&(o=i),c.window.set(e.subarray(n-i,n-i+o),c.wnext),(i-=o)?(c.window.set(e.subarray(n-i,n),0),c.wnext=i,c.whave=c.wsize):(c.wnext+=o,c.wnext===c.wsize&&(c.wnext=0),c.whave<c.wsize&&(c.whave+=o))),0};var ctt=(t,e)=>{let n,i,o,c,l,u,p,m,_,E,S,T,A,I,w,P,D,U,G,W,F,X,tt=0;const nt=new Uint8Array(4);let at,Kt;const Xt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ud(t)||!t.output||!t.input&&t.avail_in!==0)return Cs;n=t.state,n.mode===na&&(n.mode=NR),l=t.next_out,o=t.output,p=t.avail_out,c=t.next_in,i=t.input,u=t.avail_in,m=n.hold,_=n.bits,E=u,S=p,X=ld;t:for(;;)switch(n.mode){case Rg:if(n.wrap===0){n.mode=NR;break}for(;_<16;){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}if(2&n.wrap&&m===35615){n.wbits===0&&(n.wbits=15),n.check=0,nt[0]=255&m,nt[1]=m>>>8&255,n.check=Ci(n.check,nt,2,0),m=0,_=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&m)<<8)+(m>>8))%31){t.msg="incorrect header check",n.mode=Pn;break}if((15&m)!==dV){t.msg="unknown compression method",n.mode=Pn;break}if(m>>>=4,_-=4,F=8+(15&m),n.wbits===0&&(n.wbits=F),F>15||F>n.wbits){t.msg="invalid window size",n.mode=Pn;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&m?16189:na,m=0,_=0;break;case 16181:for(;_<16;){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}if(n.flags=m,(255&mi(n))!==dV){t.msg="unknown compression method",n.mode=Pn;break}if(57344&mi(n)){t.msg="unknown header flags set",n.mode=Pn;break}n.head&&(n.head.text=m>>8&1),512&mi(n)&&4&n.wrap&&(nt[0]=255&m,nt[1]=m>>>8&255,n.check=Ci(n.check,nt,2,0)),m=0,_=0,n.mode=16182;case 16182:for(;_<32;){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}n.head&&(n.head.time=m),512&mi(n)&&4&n.wrap&&(nt[0]=255&m,nt[1]=m>>>8&255,nt[2]=m>>>16&255,nt[3]=m>>>24&255,n.check=Ci(n.check,nt,4,0)),m=0,_=0,n.mode=16183;case 16183:for(;_<16;){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}n.head&&(n.head.xflags=255&m,n.head.os=m>>8),512&mi(n)&&4&n.wrap&&(nt[0]=255&m,nt[1]=m>>>8&255,n.check=Ci(n.check,nt,2,0)),m=0,_=0,n.mode=16184;case 16184:if(1024&mi(n)){for(;_<16;){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}n.length=m,n.head&&(n.head.extra_len=m),512&mi(n)&&4&n.wrap&&(nt[0]=255&m,nt[1]=m>>>8&255,n.check=Ci(n.check,nt,2,0)),m=0,_=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&mi(n)&&(T=n.length,T>u&&(T=u),T&&(n.head&&(F=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(c,c+T),F)),512&mi(n)&&4&n.wrap&&(n.check=Ci(n.check,i,T,c)),u-=T,c+=T,n.length-=T),n.length))break t;n.length=0,n.mode=16186;case 16186:if(2048&mi(n)){if(u===0)break t;T=0;do F=i[c+T++],n.head&&F&&n.length<65536&&(n.head.name+=String.fromCharCode(F));while(F&&T<u);if(512&mi(n)&&4&n.wrap&&(n.check=Ci(n.check,i,T,c)),u-=T,c+=T,F)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&mi(n)){if(u===0)break t;T=0;do F=i[c+T++],n.head&&F&&n.length<65536&&(n.head.comment+=String.fromCharCode(F));while(F&&T<u);if(512&mi(n)&&4&n.wrap&&(n.check=Ci(n.check,i,T,c)),u-=T,c+=T,F)break t}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&mi(n)){for(;_<16;){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}if(4&n.wrap&&m!==(65535&n.check)){t.msg="header crc mismatch",n.mode=Pn;break}m=0,_=0}n.head&&(n.head.hcrc=mi(n)>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=na;break;case 16189:for(;_<32;){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}t.adler=n.check=lV(m),m=0,_=0,n.mode=Cg;case Cg:if(n.havedict===0)return t.next_out=l,t.avail_out=p,t.next_in=c,t.avail_in=u,n.hold=m,n.bits=_,rtt;t.adler=n.check=1,n.mode=na;case na:if(e===ntt||e===yg)break t;case NR:if(n.last){m>>>=7&_,_-=7&_,n.mode=PR;break}for(;_<3;){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}switch(n.last=1&m,m>>>=1,_-=1,3&m){case 0:n.mode=16193;break;case 1:if(att(n),n.mode=bg,e===yg){m>>>=2,_-=2;break t}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=Pn}m>>>=2,_-=2;break;case 16193:for(m>>>=7&_,_-=7&_;_<32;){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}if((65535&m)!=(m>>>16^65535)){t.msg="invalid stored block lengths",n.mode=Pn;break}if(n.length=65535&m,m=0,_=0,n.mode=DR,e===yg)break t;case DR:n.mode=16195;case 16195:if(T=n.length,T){if(T>u&&(T=u),T>p&&(T=p),T===0)break t;o.set(i.subarray(c,c+T),l),u-=T,c+=T,p-=T,l+=T,n.length-=T;break}n.mode=na;break;case 16196:for(;_<14;){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}if(n.nlen=257+(31&m),m>>>=5,_-=5,n.ndist=1+(31&m),m>>>=5,_-=5,n.ncode=4+(15&m),m>>>=4,_-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=Pn;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;_<3;){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}n.lens[Xt[n.have++]]=7&m,m>>>=3,_-=3}for(;n.have<19;)n.lens[Xt[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,at={bits:n.lenbits},X=fp(0,n.lens,0,19,n.lencode,0,n.work,at),n.lenbits=at.bits,X){t.msg="invalid code lengths set",n.mode=Pn;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;tt=n.lencode[m&(1<<n.lenbits)-1],w=tt>>>24,P=tt>>>16&255,D=65535&tt,!(w<=_);){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}if(D<16)m>>>=w,_-=w,n.lens[n.have++]=D;else{if(D===16){for(Kt=w+2;_<Kt;){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}if(m>>>=w,_-=w,n.have===0){t.msg="invalid bit length repeat",n.mode=Pn;break}F=n.lens[n.have-1],T=3+(3&m),m>>>=2,_-=2}else if(D===17){for(Kt=w+3;_<Kt;){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}m>>>=w,_-=w,F=0,T=3+(7&m),m>>>=3,_-=3}else{for(Kt=w+7;_<Kt;){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}m>>>=w,_-=w,F=0,T=11+(127&m),m>>>=7,_-=7}if(n.have+T>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=Pn;break}for(;T--;)n.lens[n.have++]=F}}if(n.mode===Pn)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=Pn;break}if(n.lenbits=9,at={bits:n.lenbits},X=fp(1,n.lens,0,n.nlen,n.lencode,0,n.work,at),n.lenbits=at.bits,X){t.msg="invalid literal/lengths set",n.mode=Pn;break}if(n.distbits=6,n.distcode=n.distdyn,at={bits:n.distbits},X=fp(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,at),n.distbits=at.bits,X){t.msg="invalid distances set",n.mode=Pn;break}if(n.mode=bg,e===yg)break t;case bg:n.mode=Ig;case Ig:if(u>=6&&p>=258){t.next_out=l,t.avail_out=p,t.next_in=c,t.avail_in=u,n.hold=m,n.bits=_,Q$(t,S),l=t.next_out,o=t.output,p=t.avail_out,c=t.next_in,i=t.input,u=t.avail_in,m=n.hold,_=n.bits,n.mode===na&&(n.back=-1);break}for(n.back=0;tt=n.lencode[m&(1<<n.lenbits)-1],w=tt>>>24,P=tt>>>16&255,D=65535&tt,!(w<=_);){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}if(P&&!(240&P)){for(U=w,G=P,W=D;tt=n.lencode[W+((m&(1<<U+G)-1)>>U)],w=tt>>>24,P=tt>>>16&255,D=65535&tt,!(U+w<=_);){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}m>>>=U,_-=U,n.back+=U}if(m>>>=w,_-=w,n.back+=w,n.length=D,P===0){n.mode=16205;break}if(32&P){n.back=-1,n.mode=na;break}if(64&P){t.msg="invalid literal/length code",n.mode=Pn;break}n.extra=15&P,n.mode=16201;case 16201:if(n.extra){for(Kt=n.extra;_<Kt;){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}n.length+=m&(1<<n.extra)-1,m>>>=n.extra,_-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;tt=n.distcode[m&(1<<n.distbits)-1],w=tt>>>24,P=tt>>>16&255,D=65535&tt,!(w<=_);){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}if(!(240&P)){for(U=w,G=P,W=D;tt=n.distcode[W+((m&(1<<U+G)-1)>>U)],w=tt>>>24,P=tt>>>16&255,D=65535&tt,!(U+w<=_);){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}m>>>=U,_-=U,n.back+=U}if(m>>>=w,_-=w,n.back+=w,64&P){t.msg="invalid distance code",n.mode=Pn;break}n.offset=D,n.extra=15&P,n.mode=16203;case 16203:if(n.extra){for(Kt=n.extra;_<Kt;){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}n.offset+=m&(1<<n.extra)-1,m>>>=n.extra,_-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=Pn;break}n.mode=16204;case 16204:if(p===0)break t;if(T=S-p,n.offset>T){if(T=n.offset-T,T>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=Pn;break}T>n.wnext?(T-=n.wnext,A=n.wsize-T):A=n.wnext-T,T>n.length&&(T=n.length),I=n.window}else I=o,A=l-n.offset,T=n.length;T>p&&(T=p),p-=T,n.length-=T;do o[l++]=I[A++];while(--T);n.length===0&&(n.mode=Ig);break;case 16205:if(p===0)break t;o[l++]=n.length,p--,n.mode=Ig;break;case PR:if(n.wrap){for(;_<32;){if(u===0)break t;u--,m|=i[c++]<<_,_+=8}if(S-=p,t.total_out+=S,n.total+=S,4&n.wrap&&S&&(t.adler=n.check=mi(n)?Ci(n.check,o,S,l-S):sp(n.check,o,S,l-S)),S=p,4&n.wrap&&(mi(n)?m:lV(m))!==n.check){t.msg="incorrect data check",n.mode=Pn;break}m=0,_=0}n.mode=16207;case 16207:if(n.wrap&&mi(n)){for(;_<32;){if(u===0)break t;u--,m+=i[c++]<<_,_+=8}if(4&n.wrap&&m!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=Pn;break}m=0,_=0}n.mode=16208;case 16208:X=itt;break t;case Pn:X=aV;break t;case 16210:return cV;default:return Cs}return t.next_out=l,t.avail_out=p,t.next_in=c,t.avail_in=u,n.hold=m,n.bits=_,(n.wsize||S!==t.avail_out&&n.mode<Pn&&(n.mode<PR||e!==oV))&&_V(t,t.output,t.next_out,S-t.avail_out),E-=t.avail_in,S-=t.avail_out,t.total_in+=E,t.total_out+=S,n.total+=S,4&n.wrap&&S&&(t.adler=n.check=mi(n)?Ci(n.check,o,S,t.next_out-S):sp(n.check,o,S,t.next_out-S)),t.data_type=n.bits+(n.last?64:0)+(n.mode===na?128:0)+(n.mode===bg||n.mode===DR?256:0),(E===0&&S===0||e===oV)&&X===ld&&(X=stt),X},ia={inflateReset:hV,inflateReset2:pV,inflateResetKeep:uV,inflateInit:t=>fV(t,15),inflateInit2:fV,inflate:ctt,inflateEnd:t=>{if(ud(t))return Cs;let e=t.state;return e.window&&(e.window=null),t.state=null,ld},inflateGetHeader:(t,e)=>{if(ud(t))return Cs;const n=t.state;return 2&n.wrap?(n.head=e,e.done=!1,ld):Cs},inflateSetDictionary:(t,e)=>{const n=e.length;let i,o,c;return ud(t)?Cs:(i=t.state,i.wrap!==0&&i.mode!==Cg?Cs:i.mode===Cg&&(o=1,o=sp(o,e,n,0),o!==i.check)?aV:(c=_V(t,e,n,n),c?(i.mode=16210,cV):(i.havedict=1,ld)))},inflateInfo:"pako inflate (from Nodeca project)"},dtt=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const gV=Object.prototype.toString,{Z_NO_FLUSH:ltt,Z_FINISH:utt,Z_OK:mp,Z_STREAM_END:MR,Z_NEED_DICT:xR,Z_STREAM_ERROR:htt,Z_DATA_ERROR:EV,Z_MEM_ERROR:ptt}=eu;function _p(t){this.options=Eg.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&!(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new rV,this.strm.avail_out=0;let n=ia.inflateInit2(this.strm,e.windowBits);if(n!==mp)throw new Error(od[n]);if(this.header=new dtt,ia.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=hp.string2buf(e.dictionary):gV.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=ia.inflateSetDictionary(this.strm,e.dictionary),n!==mp)))throw new Error(od[n])}function UR(t,e){const n=new _p(e);if(n.push(t),n.err)throw n.msg||od[n.err];return n.result}_p.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize,o=this.options.dictionary;let c,l,u;if(this.ended)return!1;for(l=e===~~e?e:e===!0?utt:ltt,gV.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),c=ia.inflate(n,l),c===xR&&o&&(c=ia.inflateSetDictionary(n,o),c===mp?c=ia.inflate(n,l):c===EV&&(c=xR));n.avail_in>0&&c===MR&&n.state.wrap>0&&t[n.next_in]!==0;)ia.inflateReset(n),c=ia.inflate(n,l);switch(c){case htt:case EV:case xR:case ptt:return this.onEnd(c),this.ended=!0,!1}if(u=n.avail_out,n.next_out&&(n.avail_out===0||c===MR))if(this.options.to==="string"){let p=hp.utf8border(n.output,n.next_out),m=n.next_out-p,_=hp.buf2string(n.output,p);n.next_out=m,n.avail_out=i-m,m&&n.output.set(n.output.subarray(p,p+m),0),this.onData(_)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(c!==mp||u!==0){if(c===MR)return c=ia.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},_p.prototype.onData=function(t){this.chunks.push(t)},_p.prototype.onEnd=function(t){t===mp&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Eg.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var ftt={Inflate:_p,inflate:UR,inflateRaw:function(t,e){return(e=e||{}).raw=!0,UR(t,e)},ungzip:UR,constants:eu};const{Deflate:hct,deflate:mtt,deflateRaw:pct,gzip:fct}=J$,{Inflate:mct,inflate:_tt,inflateRaw:_ct,ungzip:gct}=ftt;var gtt=mtt,Ett=_tt,SV=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(SV||{});class Stt{constructor(){N(this,"_sequence",0),N(this,"_startTime",Date.now()),N(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const u=new Uint8Array(4);u.set([1,0,0,0]);const p={id:0,length:4,data:u.buffer},m={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[p]};n.commonPacketHeader.extension=1,n.extension=m,n.payload=this.compress(e),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;x("SHOW_DATASTREAM2_LOG")&&R.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),o=new Uint8Array(i),c=new DataView(i);let l=0;if(c.setUint16(l,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),l+=2,c.setUint32(l,n.commonPacketHeader.sequence,!0),l+=4,c.setUint16(l,n.commonStreamHeader,!0),l+=2,n.extension){const u=this.serializeExtension(n.extension);o.set(new Uint8Array(u),l),l+=u.byteLength}if(o.set(new Uint8Array(n.payload),l),l+=n.payload.byteLength,l!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const n=new DataView(e);let i=0;const o=n.getUint16(i,!0);i+=2;const c={length:16383&o,reserved:(16384&o)>>14,extension:(32768&o)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let l,u;if(i+=4,x("SHOW_DATASTREAM2_LOG")&&R.debug("receive data header: ".concat(JSON.stringify(c))),n.getUint16(i,!0),i+=2,c.extension){u=this.deserializeExtension(e.slice(i)),i+=2+u.length,l=e.slice(i);let p=!1;if(u.datas.length>0){const m=u.datas.find(_=>_.id===0);m&&(p=(1&new DataView(m.data).getUint32(0,!0))==1)}l=p?this.decompress(l):l}else l=e.slice(8);return l}serializeExtension(e){const{profile:n,length:i,datas:o}=e,c=new ArrayBuffer(i+2),l=new Uint8Array(c),u=new DataView(c);let p=0;if(u.setUint8(p++,n),u.setUint8(p++,i),o.forEach(m=>{n?(u.setUint8(p++,m.id),u.setUint8(p++,m.length),l.set(new Uint8Array(m.data),p),p+=m.data.byteLength):(u.setUint8(p++,m.id|m.length<<4),l.set(new Uint8Array(m.data),p),p+=m.data.byteLength)}),p!==i+2)throw Error("serialize extension error, is ".concat(p,"!==").concat(i+2));return c}deserializeExtension(e){const n=new DataView(e);let i=0;const o=n.getUint8(i);i++;const c=n.getUint8(i);i++;const l=o===SV.TWO_BYTE,u=[],p=new DataView(e,2);let m=0;for(;m<c;){let _=0,E=0,S=new ArrayBuffer(0);l?(_=p.getUint8(m),m++,E=p.getUint8(m),m++):(_=15&p.getUint8(m),E=p.getUint8(m)>>4,m++),E>0&&(S=p.buffer.slice(m+2,m+2+E),m+=S.byteLength),u.push({id:_,length:E,data:S})}if(m!==c)throw Error("parse error");return{profile:o,length:c,datas:u}}decompress(e){return Ett(new Uint8Array(e))}compress(e){return gtt(new Uint8Array(e))}}const vtt={name:"DataStream",create:(t,e)=>{const n=e?new NQ(t):new DQ(t);return n.useDataStream(new Stt),n}};class Ttt extends Ke{constructor(e,n,i){super(),N(this,"ws",void 0),N(this,"requestId",1),N(this,"heartBeatTimer",void 0),N(this,"joinInfo",void 0),N(this,"clientId",void 0),N(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),N(this,"onClose",o=>{this.emit("close"),this.dispose()}),N(this,"onMessage",o=>{const c=JSON.parse(o.data);if(!c||c.command!=="serverResponse"||!c.requestId)return c&&c.command==="serverStatus"&&c.serverStatus&&c.serverStatus.command?(this.emit("status",c.serverStatus),void this.emit(c.serverStatus.command,c.serverStatus)):void 0;this.emit("req_".concat(c.requestId),c)}),this.joinInfo=e,this.clientId=n,this.ws=new jh("cross-channel-".concat(this.clientId),i),this.ws.on(Gt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Gt.CONNECTED,this.onOpen),this.ws.on(Gt.ON_MESSAGE,this.onMessage),this.ws.on(Gt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){const n=this.requestId++;return e.requestId=n,e.seq=n,this.ws.sendMessage(e),n}waitStatus(e){return new gt((n,i)=>{const o=window.setTimeout(()=>{i(new Q(L.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,c=>{window.clearTimeout(o),c.state&&c.state!==0?i(new Q(L.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(o),i(new Q(L.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new Q(L.WS_DISCONNECT);const n=()=>new gt((l,u)=>{this.ws.once(Gt.CLOSED,()=>u(new Q(L.WS_ABORT))),this.ws.once(Gt.CONNECTED,l)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(e),o=new gt((l,u)=>{const p=()=>{u(new Q(L.WS_ABORT))};this.ws.once(Gt.RECONNECTING,p),this.ws.once(Gt.CLOSED,p),this.once("req_".concat(i),l),xn(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(Gt.RECONNECTING,p),this.ws.off(Gt.CLOSED,p),u(new Q(L.TIMEOUT,"cross channel ws request timeout"))})}),c=await o;if(!c||c.code!==200)throw new Q(L.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(c)));return c}async connect(e){this.ws.removeAllListeners(Gt.REQUEST_NEW_URLS),this.ws.on(Gt.REQUEST_NEW_URLS,n=>{n(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const n=this.requestId++;return e.requestId=n,this.ws.sendMessage(e),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class ytt extends Ke{set state(e){e!==this._state&&(e!==Hi.RELAY_STATE_FAILURE&&(this.errorCode=Bl.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,n,i,o,c){super(),N(this,"joinInfo",void 0),N(this,"sid",void 0),N(this,"clientId",void 0),N(this,"cancelToken",Oi.CancelToken.source()),N(this,"workerToken",void 0),N(this,"requestId",0),N(this,"signal",void 0),N(this,"prevChannelMediaConfig",void 0),N(this,"httpRetryConfig",void 0),N(this,"_resolution",void 0),N(this,"_state",Hi.RELAY_STATE_IDLE),N(this,"errorCode",Bl.RELAY_OK),N(this,"onStatus",l=>{R.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(l))),l&&l.command&&(l.command==="onAudioPacketReceived"&&this.emit("event",Qo.PACKET_RECEIVED_AUDIO_FROM_SRC),l.command==="onVideoPacketReceived"&&this.emit("event",Qo.PACKET_RECEIVED_VIDEO_FROM_SRC),l.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Bl.SRC_TOKEN_EXPIRED,this.state=Hi.RELAY_STATE_FAILURE),l.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Bl.DEST_TOKEN_EXPIRED,this.state=Hi.RELAY_STATE_FAILURE))}),N(this,"onReconnect",async()=>{R.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Qo.NETWORK_DISCONNECTED),this.state=Hi.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(l=>{this.state!==Hi.RELAY_STATE_IDLE&&(R.error("auto restart channel media relay failed",l.toString()),this.errorCode=Bl.SERVER_CONNECTION_LOST,this.state=Hi.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=n,this.sid=Kc(),this.signal=new Ttt(this.joinInfo,this.clientId,i),this.httpRetryConfig=o,this._resolution=c}async startChannelMediaRelay(e){if(this.state!==Hi.RELAY_STATE_IDLE)throw new Q(L.INVALID_OPERATION);this.state=Hi.RELAY_STATE_CONNECTING,await this.connect(),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new Q(L.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new Q(L.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new Q(L.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==Hi.RELAY_STATE_RUNNING)throw new Q(L.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==Hi.RELAY_STATE_RUNNING)throw new Q(L.INVALID_OPERATION);const n=this.genMessage(Ri.SetVideoProfile);await this.signal.request(n),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),R.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Hi.RELAY_STATE_IDLE,this.dispose()}dispose(){R.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Oi.CancelToken.source(),this.state=Hi.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await xZ(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",Qo.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const n=this.genMessage(Ri.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(Ri.SetSdkProfile,e);await this.signal.request(i),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const o=this.genMessage(Ri.SetSourceChannel,e);await this.signal.request(o),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Qo.PACKET_JOINED_SRC_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const c=this.genMessage(Ri.SetSourceUserId,e);await this.signal.request(c),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const l=this.genMessage(Ri.SetDestChannel,e);await this.signal.request(l),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Qo.PACKET_JOINED_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const u=this.genMessage(Ri.StartPacketTransfer,e);await this.signal.request(u),this.emit("event",Qo.PACKET_SENT_TO_DEST_CHANNEL),this.state=Hi.RELAY_STATE_RUNNING,R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const n=this.genMessage(Ri.UpdateDestChannel,e);await this.signal.request(n),this.emit("event",Qo.PACKET_UPDATE_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(Ri.StopPacketTransfer);await this.signal.request(e),R.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,n){const i=[],o=[],c=[];this.requestId+=1;const l={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Ur,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};l.sdkVersion==="4.24.0"&&(l.sdkVersion="0.0.1");let u=null,p=null;switch(e){case Ri.SetSdkProfile:return l.clientRequest={command:"SetSdkProfile",type:"multi_channel"},l;case Ri.SetSourceChannel:if(p=n&&n.getSrcChannelMediaInfo(),!p)throw new Q(L.UNEXPECTED_ERROR,"can not find source config");return l.clientRequest={command:"SetSourceChannel",uid:"0",channelName:p.channelName,token:p.token||this.joinInfo.appId},l;case Ri.SetSourceUserId:if(p=n&&n.getSrcChannelMediaInfo(),!p)throw new Q(L.UNEXPECTED_ERROR,"can not find source config");return l.clientRequest={command:"SetSourceUserId",uid:p.uid+""},l;case Ri.SetDestChannel:if(u=n&&n.getDestChannelMediaInfo(),!u)throw new Q(L.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(m=>{i.push(m.channelName),o.push(m.uid+""),c.push(m.token||this.joinInfo.appId)}),l.clientRequest={command:"SetDestChannel",channelName:i,uid:o,token:c},l;case Ri.StartPacketTransfer:return l.clientRequest={command:"StartPacketTransfer"},l;case Ri.Reconnect:return l.clientRequest={command:"Reconnect"},l;case Ri.StopPacketTransfer:return l.clientRequest={command:"StopPacketTransfer"},l;case Ri.UpdateDestChannel:if(u=n&&n.getDestChannelMediaInfo(),!u)throw new Q(L.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(m=>{i.push(m.channelName),o.push(m.uid+""),c.push(m.token||this.joinInfo.appId)}),l.clientRequest={command:"UpdateDestChannel",channelName:i,uid:o,token:c},l;case Ri.SetVideoProfile:l.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return l}}const Rtt={name:"ChannelMediaRelay",create:function(t){return new ytt(t.joinInfo,t.clientId,t.websocketRetryConfig||pn,t.httpRetryConfig||pn,t.resolution)}};function vV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function gp(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?vV(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class Ctt extends Ke{constructor(e,n,i,o){super(),N(this,"spec",void 0),N(this,"token",void 0),N(this,"websocket",void 0),N(this,"pingpongTimer",void 0),N(this,"reconnectMode","retry"),N(this,"serviceMode",void 0),N(this,"reqId",0),N(this,"commandReqId",0),N(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),N(this,"handleWebSocketMessage",c=>{if(!c.data)return;const l=JSON.parse(c.data);l.requestId?this.emit("@".concat(l.requestId,"-").concat(l.sid),l):(bt.workerEvent(this.spec.sid,{actionType:"status",serverCode:l.code,workerType:this.serviceMode===bo.TRANSCODE?1:2}),this.emit(Va.PUBLISH_STREAM_STATUS,l))}),this.spec=n,this.token=e,this.serviceMode=o,this.websocket=new jh("live-streaming",i),this.websocket.on(Gt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Gt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Gt.REQUEST_NEW_URLS,(c,l)=>{Kn(this,Va.REQUEST_NEW_ADDRESS).then(c).catch(l)}),this.websocket.on(Gt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,n,i,o){this.reqId+=1,e==="request"&&(this.commandReqId+=1);const c=this.commandReqId,l=this.reqId;if(!l||!this.websocket)throw new Q(L.UNEXPECTED_ERROR);const u=gp({command:e,sdkVersion:Ur==="4.24.0"?"0.0.1":Ur,seq:l,requestId:l,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new Q(L.WS_DISCONNECT);const p=()=>new gt((S,T)=>{this.websocket.once(Gt.CLOSED,()=>T(new Q(L.WS_ABORT))),this.websocket.once(Gt.CONNECTED,S)});this.websocket.state!=="connected"&&await p(),u.clientRequest&&(u.clientRequest.workerToken=this.token);const m=new gt((S,T)=>{const A=()=>{T(new Q(L.WS_ABORT))};this.websocket.once(Gt.RECONNECTING,A),this.websocket.once(Gt.CLOSED,A),this.once("@".concat(l,"-").concat(this.spec.sid),I=>{S(I)})});o&&bt.workerEvent(this.spec.sid,gp(gp({},o),{},{requestId:c,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const _=Date.now();this.websocket.sendMessage(u);let E=null;try{E=await m}catch(S){if(this.websocket.state==="closed")throw S;return await p(),await this.request(e,n,i)}return o&&bt.workerEvent(this.spec.sid,gp(gp({},o),{},{requestId:c,actionType:"response",payload:JSON.stringify(E.serverResponse),serverCode:E.code,success:E.code===200,responseTime:Date.now()-_})),E.code!==200&&this.handleResponseError(E),E}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e=Ur==="4.24.0"?"0.0.1":Ur;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case En.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void R.warning("live stream response already exists stream");case En.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case En.LIVE_STREAM_RESPONSE_BAD_STREAM:case En.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Q(L.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case En.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new Q(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case En.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Q(L.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case En.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new Q(L.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Va.WARNING,n,e.serverResponse.url)}case En.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new Q(L.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Va.WARNING,n,e.serverResponse.url)}case En.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Q(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case En.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Q(L.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case En.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new Q(L.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Va.WARNING,n,e.serverResponse.url)}case En.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Q(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case En.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Q(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case En.LIVE_STREAM_RESPONSE_WORKER_LOST:case En.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new Q(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case En.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new Q(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new Q(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case En.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Q(L.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(f_)},6e3)}}function TV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function zi(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?TV(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):TV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class btt extends Ke{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:pn,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:pn;super(),N(this,"onLiveStreamWarning",void 0),N(this,"onLiveStreamError",void 0),N(this,"spec",void 0),N(this,"retryTimeout",1e4),N(this,"connection",void 0),N(this,"httpRetryConfig",void 0),N(this,"wsRetryConfig",void 0),N(this,"streamingTasks",new Map),N(this,"isStartingStreamingTask",!1),N(this,"taskMutex",new Qn("live-streaming")),N(this,"cancelToken",Oi.CancelToken.source()),N(this,"transcodingConfig",void 0),N(this,"uapResponse",void 0),N(this,"lastTaskId",1),N(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(e){const n=zi(zi({},fZ),e);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(R.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(l=>zi(zi(zi({},pZ),l),{},{zOrder:l.zOrder?l.zOrder+1:1}))),function(l){Xe(l.width)||be(l.width,"config.width",0,1e4),Xe(l.height)||be(l.height,"config.height",0,1e4),Xe(l.videoBitrate)||be(l.videoBitrate,"config.videoBitrate",1,1e6),Xe(l.videoFrameRate)||be(l.videoFrameRate,"config.videoFrameRate"),Xe(l.lowLatency)||Hs(l.lowLatency,"config.lowLatency"),Xe(l.audioSampleRate)||Tn(l.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Xe(l.audioBitrate)||be(l.audioBitrate,"config.audioBitrate",1,128),Xe(l.audioChannels)||Tn(l.audioChannels,"config.audioChannels",[1,2,3,4,5]),Xe(l.videoGop)||be(l.videoGop,"config.videoGop"),Xe(l.videoCodecProfile)||Tn(l.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Xe(l.userCount)||be(l.userCount,"config.userCount",0,17),Xe(l.backgroundColor)||be(l.backgroundColor,"config.backgroundColor",0,16777215),Xe(l.userConfigExtraInfo)||Mn(l.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),l.transcodingUsers&&!Xe(l.transcodingUsers)&&(Jo(l.transcodingUsers,"config.transcodingUsers"),l.transcodingUsers.forEach((u,p)=>{V_(u.uid),Xe(u.x)||be(u.x,"transcodingUser[".concat(p,"].x"),0,1e4),Xe(u.y)||be(u.y,"transcodingUser[".concat(p,"].y"),0,1e4),Xe(u.width)||be(u.width,"transcodingUser[".concat(p,"].width"),0,1e4),Xe(u.height)||be(u.height,"transcodingUser[".concat(p,"].height"),0,1e4),Xe(u.zOrder)||be(u.zOrder-1,"transcodingUser[".concat(p,"].zOrder"),0,100),Xe(u.alpha)||be(u.alpha,"transcodingUser[".concat(p,"].alpha"),0,1,!1)})),Xe(l.watermark)||k0(l.watermark,"watermark"),Xe(l.backgroundImage)||k0(l.backgroundImage,"backgroundImage"),l.images&&!Xe(l.images)&&(Jo(l.images,"config.images"),l.images.forEach((u,p)=>{k0(u,"images[".concat(p,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(l=>zi(zi(zi({},P0),l),{},{zOrder:255}))),n.backgroundImage&&(i.push(zi(zi(zi({},P0),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(zi(zi(zi({},P0),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(l=>zi({},l)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const o=(n.userConfigs||[]).map(l=>typeof l.uid=="number"?gt.resolve(l.uid):zx(l.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await gt.all(o)).forEach((l,u)=>{n.userConfigs&&n.userConfigs[u]&&(n.userConfigs[u].uid=l)}),this.transcodingConfig=n,this.connection)try{var c;const l=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(nr(c=this.streamingTasks).call(c)).map(u=>u.taskId).join("#")});R.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(l.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(l){if(!l.data||!l.data.retry)throw l;l.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(u=>{R.warning("[".concat(this.spec.clientId,"] live streaming receive error"),l.toString(),"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,l).then(()=>{R.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(u.url," success"))}).catch(p=>{R.error("[".concat(this.spec.clientId,"] live streaming republish failed"),u.url,p.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,p)})})}}async startLiveStreamingTask(e,n,i){if(!this.transcodingConfig&&n===bo.TRANSCODE)throw new Q(L.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const o={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};R.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(n));const c=await this.taskMutex.lock();if(!this.connection&&i)return void c();if(this.streamingTasks.get(e)&&!i)return c(),new Q(L.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(u){throw c(),u}switch(n){case bo.TRANSCODE:o.transcodingConfig=zi({},this.transcodingConfig);case bo.RAW:}this.uapResponse&&this.uapResponse.vid&&(o.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const l=this.lastTaskId++;try{const u=new gt((m,_)=>{xn(this.retryTimeout).then(()=>{if(i)return _(i);const E=this.statusError.get(e);return E?(this.statusError.delete(e),_(E)):void 0})}),p=await gt.race([this.connection.request("request",{clientRequest:o},!0,{url:e,command:"PublishStream",workerType:n===bo.TRANSCODE?1:2,requestByUser:!i,tid:l.toString()}),u]);this.isStartingStreamingTask=!1,R.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(p.code)),this.streamingTasks.set(e,{clientRequest:o,mode:n,url:e,taskId:l}),c()}catch(u){if(c(),this.isStartingStreamingTask=!1,!u.data||!u.data.retry||i)throw u;return u.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,n,u)):await this.startLiveStreamingTask(e,n,u)}}stopLiveStreamingTask(e){return new gt((n,i)=>{const o=this.streamingTasks.get(e);if(!o||!this.connection)return new Q(L.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const c=o.mode;o.abortTask=()=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:o.url}},!1,{url:e,command:"UnPublishStream",workerType:c===bo.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(l=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(l.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(i)})}resetAllTask(){var e;const n=Array.from(nr(e=this.streamingTasks).call(e));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(o=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,o)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Oi.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new Q(L.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await Kn(this,L0.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=n,this.connection=new Ctt(n.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(Va.WARNING,(i,o)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(o,i)),this.connection.on(Va.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(Va.REQUEST_NEW_ADDRESS,(i,o)=>{if(!this.connection)return o(new Q(L.UNEXPECTED_ERROR,"can not get new live streaming address list"));Kn(this,L0.REQUEST_WORKER_MANAGER_LIST,e).then(c=>{this.uapResponse=c,i(c.addressList)}).catch(o)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(e){const n=e.serverStatus&&e.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),o=e.reason;switch(e.code){case En.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const l=new Q(L.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(i)return R.error(l.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,l);if(!this.isStartingStreamingTask)return;this.statusError.set(n,l)}case En.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const l=new Q(L.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,o);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,l)}case En.LIVE_STREAM_RESPONSE_WORKER_LOST:case En.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var c;if(!this.connection)return;this.connection.tryNextAddress();const l=Array.from(nr(c=this.streamingTasks).call(c));for(const u of l)u.abortTask?u.abortTask():(R.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,new Q(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{R.debug("[".concat(this.spec.clientId,"] republish live stream success"),u.url)}).catch(p=>{R.error(p.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,p)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const Itt={name:"LiveStreaming",create:function(t){return new btt(t.joinInfo,t.websocketRetryConfig||pn,t.httpRetryConfig||pn)}};function wtt(t){let e=CV();return function(n,i){let o=n.appId;o!==void 0&&(Te(i,10),ko(i,o));let c=n.cid;c!==void 0&&(Te(i,16),Te(i,c));let l=n.cname;l!==void 0&&(Te(i,26),ko(i,l));let u=n.deviceId;u!==void 0&&(Te(i,34),ko(i,u));let p=n.elapse;p!==void 0&&(Te(i,40),tc(i,p));let m=n.fileSize;m!==void 0&&(Te(i,48),tc(i,su(m)));let _=n.height;_!==void 0&&(Te(i,56),tc(i,su(_)));let E=n.jpg;E!==void 0&&(Te(i,66),Te(i,E.length),function(ni,et){let ut=ou(ni,et.length);ni.bytes.set(et,ut)}(i,E));let S=n.networkType;S!==void 0&&(Te(i,72),tc(i,su(S)));let T=n.osType;T!==void 0&&(Te(i,80),tc(i,su(T)));let A=n.requestId;A!==void 0&&(Te(i,90),ko(i,A));let I=n.sdkVersion;I!==void 0&&(Te(i,98),ko(i,I));let w=n.sequence;w!==void 0&&(Te(i,104),tc(i,su(w)));let P=n.sid;P!==void 0&&(Te(i,114),ko(i,P));let D=n.timestamp;D!==void 0&&(Te(i,120),tc(i,D));let U=n.uid;U!==void 0&&(Te(i,128),Te(i,U));let G=n.vid;G!==void 0&&(Te(i,136),Te(i,G));let W=n.width;W!==void 0&&(Te(i,144),tc(i,su(W)));let F=n.service;F!==void 0&&(Te(i,152),Te(i,F));let X=n.callbackData;X!==void 0&&(Te(i,162),ko(i,X));let tt=n.jpgEncryption;tt!==void 0&&(Te(i,168),Te(i,tt));let nt=n.requestType;nt!==void 0&&(Te(i,176),Te(i,nt));let at=n.scorePorn;at!==void 0&&(Te(i,185),WR(i,at));let Kt=n.scoreSexy;Kt!==void 0&&(Te(i,193),WR(i,Kt));let Xt=n.scoreNeutral;Xt!==void 0&&(Te(i,201),WR(i,Xt));let Ut=n.scene;Ut!==void 0&&(Te(i,208),Te(i,Ut));let me=n.ossFilePrefix;me!==void 0&&(Te(i,218),ko(i,me));let he=n.serviceVendor;if(he!==void 0)for(let ni of he){Te(i,226);let et=CV();Ntt(ni,et),Te(i,et.limit),Ltt(i,et),ktt(et)}}(t,e),function(n){let i=n.bytes,o=n.limit;return i.length===o?i:i.subarray(0,o)}(e)}function Att(t){return function(n){let i={};t:for(;!bV(n);){let o=Lo(n);switch(o>>>3){case 0:break t;case 1:i.code=Lo(n);break;case 2:i.msg=IV(n,Lo(n));break;case 3:{let c=Dtt(n);i.data=Ott(n),n.limit=c;break}default:yV(n,7&o)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function Ott(t){let e={};t:for(;!bV(t);){let n=Lo(t);switch(n>>>3){case 0:break t;case 1:e.requestId=IV(t,Lo(t));break;case 2:e.requestType=Lo(t)>>>0;break;case 3:e.scorePorn=jR(t);break;case 4:e.scoreSexy=jR(t);break;case 5:e.scoreNeutral=jR(t);break;case 6:e.requestScene=Lo(t)>>>0;break;case 7:e.scene=Lo(t)>>>0;break;default:yV(t,7&n)}}return e}function Ntt(t,e){let n=t.service;n!==void 0&&(Te(e,8),Te(e,n));let i=t.vendor;i!==void 0&&(Te(e,16),Te(e,i));let o=t.token;o!==void 0&&(Te(e,26),ko(e,o));let c=t.callbackUrl;c!==void 0&&(Te(e,34),ko(e,c))}function Dtt(t){let e=Lo(t),n=t.limit;return t.limit=t.offset+e,n}function yV(t,e){switch(e){case 0:for(;128&wV(t););break;case 2:FR(t,Lo(t));break;case 5:FR(t,4);break;case 1:FR(t,8);break;default:throw new Error("Unimplemented type: "+e)}}let Ptt=new Float32Array(1);new Uint8Array(Ptt.buffer);let VR=new Float64Array(1),Ki=new Uint8Array(VR.buffer);function su(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let RV=[];function CV(){const t=RV.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function ktt(t){RV.push(t)}function FR(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function bV(t){return t.offset>=t.limit}function ou(t,e){let n=t.bytes,i=t.offset,o=t.limit,c=i+e;if(c>n.length){let l=new Uint8Array(2*c);l.set(n),t.bytes=l}return t.offset=c,c>o&&(t.limit=c),i}function BR(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function IV(t,e){let n=BR(t,e),i=String.fromCharCode,o=t.bytes,c="",l="";for(let u=0;u<e;u++){let p,m,_,E,S=o[u+n];128&S?(224&S)==192?u+1>=e?l+=c:(p=o[u+n+1],(192&p)!=128?l+=c:(E=(31&S)<<6|63&p,E<128?l+=c:(l+=i(E),u++))):(240&S)==224?u+2>=e?l+=c:(p=o[u+n+1],m=o[u+n+2],(49344&(p|m<<8))!=32896?l+=c:(E=(15&S)<<12|(63&p)<<6|63&m,E<2048||E>=55296&&E<=57343?l+=c:(l+=i(E),u+=2))):(248&S)==240?u+3>=e?l+=c:(p=o[u+n+1],m=o[u+n+2],_=o[u+n+3],(12632256&(p|m<<8|_<<16))!=8421504?l+=c:(E=(7&S)<<18|(63&p)<<12|(63&m)<<6|63&_,E<65536||E>1114111?l+=c:(E-=65536,l+=i(55296+(E>>10),56320+(1023&E)),u+=3))):l+=c:l+=i(S)}return l}function ko(t,e){let n=e.length,i=0;for(let l=0;l<n;l++){let u=e.charCodeAt(l);u>=55296&&u<=56319&&l+1<n&&(u=(u<<10)+e.charCodeAt(++l)-56613888),i+=u<128?1:u<2048?2:u<65536?3:4}Te(t,i);let o=ou(t,i),c=t.bytes;for(let l=0;l<n;l++){let u=e.charCodeAt(l);u>=55296&&u<=56319&&l+1<n&&(u=(u<<10)+e.charCodeAt(++l)-56613888),u<128?c[o++]=u:(u<2048?c[o++]=u>>6&31|192:(u<65536?c[o++]=u>>12&15|224:(c[o++]=u>>18&7|240,c[o++]=u>>12&63|128),c[o++]=u>>6&63|128),c[o++]=63&u|128)}}function Ltt(t,e){let n=ou(t,e.limit),i=t.bytes,o=e.bytes;for(let c=0,l=e.limit;c<l;c++)i[c+n]=o[c]}function wV(t){return t.bytes[BR(t,1)]}function AV(t,e){let n=ou(t,1);t.bytes[n]=e}function jR(t){let e=BR(t,8),n=t.bytes;return Ki[0]=n[e++],Ki[1]=n[e++],Ki[2]=n[e++],Ki[3]=n[e++],Ki[4]=n[e++],Ki[5]=n[e++],Ki[6]=n[e++],Ki[7]=n[e++],VR[0]}function WR(t,e){let n=ou(t,8),i=t.bytes;VR[0]=e,i[n++]=Ki[0],i[n++]=Ki[1],i[n++]=Ki[2],i[n++]=Ki[3],i[n++]=Ki[4],i[n++]=Ki[5],i[n++]=Ki[6],i[n++]=Ki[7]}function Lo(t){let e,n=0,i=0;do e=wV(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function Te(t,e){for(e>>>=0;e>=128;)AV(t,127&e|128),e>>>=7;AV(t,e)}function tc(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,o=e.high>>>24,c=o===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:o<128?9:10,l=ou(t,c),u=t.bytes;switch(c){case 10:u[l+9]=o>>>7&1;case 9:u[l+8]=c!==9?128|o:127&o;case 8:u[l+7]=c!==8?i>>>21|128:i>>>21&127;case 7:u[l+6]=c!==7?i>>>14|128:i>>>14&127;case 6:u[l+5]=c!==6?i>>>7|128:i>>>7&127;case 5:u[l+4]=c!==5?128|i:127&i;case 4:u[l+3]=c!==4?n>>>21|128:n>>>21&127;case 3:u[l+2]=c!==3?n>>>14|128:n>>>14&127;case 2:u[l+1]=c!==2?n>>>7|128:n>>>7&127;case 1:u[l]=c!==1?128|n:127&n}}function OV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}const Mtt=new Map([["moderation",1],["supervise",2]]);class xtt extends Ke{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(Dn.CONNECTION_STATE_CHANGE,n,e)}get inspectType(){return this._inspectType}set inspectType(e){var n;this._inspectMode=os(n=e.map(i=>Mtt.get(i)||0)).call(n,(i,o)=>i+o),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),N(this,"name","AgoraRTCVideoContentInspect"),N(this,"_connectionState",Es.CONNECTING),N(this,"_innerConnectionState",void 0),N(this,"sequence",0),N(this,"inspectStartTime",void 0),N(this,"workerManagerConnection",void 0),N(this,"workerConnection",void 0),N(this,"workerMessageLengthLimit",void 0),N(this,"inspectIntervalMinimum",void 0),N(this,"qualityRatio",void 0),N(this,"_connectInfo",void 0),N(this,"_cancelTokenSource",Oi.CancelToken.source()),N(this,"_retryConfig",void 0),N(this,"wmSequence",0),N(this,"inspectInterval",void 0),N(this,"inspectTimer",null),N(this,"ossFilePrefix",void 0),N(this,"extraInfo",void 0),N(this,"_inspectType",void 0),N(this,"_inspectMode",void 0),N(this,"_quality",1),N(this,"qualityTimer",null),N(this,"_inspectId",void 0),N(this,"_needWorkUrlOnly",!1),N(this,"inspectImage",()=>{if(this.connectionState!==Es.CONNECTED)throw new Q(L.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Es.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Ae(5,"inspect-"),this.workerMessageLengthLimit=x("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=x("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=x("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new jh("worker-manager-"+this._inspectId,pn),this.on(Dn.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,R.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Ss[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new jh("worker-"+this._inspectId,pn),this.handleWorkerEvents()}async init(e,n){this.emit(Dn.STATE_CHANGE,Ss.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new gt((o,c)=>{this.on(Dn.CONNECTION_STATE_CHANGE,(l,u)=>{u===Es.CONNECTED&&o()}),this.requestAP(e,i,n).then(l=>{this.connectWorkerManager(l)}).catch(l=>{c(l)})})}async requestAP(e,n,i){const o=x("WEBCS_DOMAIN").map(u=>"https://".concat(u,"/api/v1")),c=await function(u,p,m,_){let{appId:E,areaCode:S,cname:T,sid:A,token:I,uid:w}=p;Yl++;const P="image_moderation_api",D={service_name:P,json_body:JSON.stringify({appId:E,areaCode:S,cname:T,command:"allocateEdge",requestId:Yl,seq:Yl,sid:A,token:I,ts:Date.now(),uid:w+""})};let U,G,W=u[0];return zs(async()=>{U=Date.now();const F=await Js(W,{data:D,cancelToken:m,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(G=Date.now()-U,F.code!==0){const at=new Q(L.UNEXPECTED_RESPONSE,"image inspect ap error, code"+F.code,{retry:!0,responseTime:G});throw R.error(at.toString()),at}const X=JSON.parse(F.json_body);if(X.code!==200){const at=new Q(L.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(X.code,", reason: ").concat(X.reason),{code:X.code,responseTime:G});throw R.error(at.toString()),at}if(!X.servers||!Array.isArray(X.servers)||X.servers.length===0){const at=new Q(L.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:X.code,responseTime:G});throw R.error(at.toString()),at}const tt=x("VIDEO_INSPECT_WORKER_MANAGER_HOST"),nt=x("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:X.servers.map(at=>{let{address:Kt,wss:Xt}=at;if(Kt&&Xt)return"wss://".concat(Kt.replace(/\./g,"-"),".").concat(tt,":").concat(nt||Xt)}).filter(at=>!!at),workerToken:X.workerToken,vid:X.vid,responseTime:G}},(F,X)=>(bt.apworkerEvent(A,{success:!0,sc:200,serviceName:P,responseDetail:JSON.stringify(F.addressList),firstSuccess:X===0,responseTime:G,serverIp:u[X%u.length]}),!1),(F,X)=>(bt.apworkerEvent(A,{success:!1,sc:F.data&&F.data.code||200,serviceName:P,responseTime:G,serverIp:u[X%u.length]}),!!(F.code!==L.OPERATION_ABORTED&&F.code!==L.UNEXPECTED_RESPONSE||F.data&&F.data.retry)&&(W=u[(X+1)%u.length],!0)),_)}(o,e,n,i);this.emit(Dn.STATE_CHANGE,Ss.AP_CONNECTED);const{addressList:l}=c;return this.wmSequence++,l}async connectWorkerManager(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Dn.STATE_CHANGE,Ss.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Gt.CONNECTED,async()=>{this.emit(Dn.STATE_CHANGE,Ss.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Gt.CLOSED,()=>{this._innerConnectionState<Ss.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Gt.FAILED,()=>{this._innerConnectionState<Ss.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Gt.RECONNECTING,()=>{this._innerConnectionState<Ss.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Gt.ON_MESSAGE,async e=>{this.emit(Dn.STATE_CHANGE,Ss.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(e.data);if(i.code!==200)throw R.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new Q(L.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw R.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new Q(L.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const o=x("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,c=n.replace(/:\d+\/?$/,":".concat(o));this.emit(Dn.STATE_CHANGE,Ss.CONNECT_WORKER,c),this._needWorkUrlOnly?this.emit(Dn.REQUEST_NEW_WORKER_URL,c):await this.connectWorker(c)}}),this.workerManagerConnection.on(Gt.WILL_RECONNECT,(e,n,i)=>{i(e)}),this.workerManagerConnection.on(Gt.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}handleWorkerEvents(){this.workerConnection.on(Gt.CONNECTED,async()=>{this.emit(Dn.STATE_CHANGE,Ss.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Es.CONNECTED}),this.workerConnection.on(Gt.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const i=Att(new Uint8Array(e.data));if(x("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&R.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Dn.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const o={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},c=os(n=Object.keys(o)).call(n,(u,p)=>o[u]>o[p]?u:p,"porn"),l=Object.keys(o).find(u=>u===c);this.emit(Dn.INSPECT_RESULT,l)}else this.emit(Dn.INSPECT_RESULT,void 0,new Q(L.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(Dn.INSPECT_RESULT,void 0,new Q(L.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else R.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Dn.INSPECT_RESULT,void 0,new Q(L.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Gt.CLOSED,()=>{this.connectionState=Es.CLOSED}),this.workerConnection.on(Gt.FAILED,()=>{this.connectionState=Es.CLOSED}),this.workerConnection.on(Gt.RECONNECTING,()=>{this.connectionState=this.connectionState===Es.CONNECTED?Es.RECONNECTING:Es.CONNECTING}),this.workerConnection.on(Gt.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this.workerConnection.on(Gt.REQUEST_NEW_URLS,(e,n)=>{this.workerManagerConnection.close(),this.once(Dn.REQUEST_NEW_WORKER_URL,i=>{e([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}async requestToInspectImage(){this.sequence++;const e=_r(this,Dn.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(Dn.INSPECT_RESULT,void 0,new Q(L.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(e,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(Dn.INSPECT_RESULT,void 0,new Q(L.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,n){let{appId:i,cname:o,cid:c,vid:l,sid:u,uid:p}=n;const m=Date.now(),_=await e.getCurrentFrameImage("image/jpeg",this.quality),E=await cL(_,i,o),S=this.sequence+"-"+c+"-"+p+"-"+m+"-"+Ae(12,""),T={appId:i,cid:c,cname:o,deviceId:"",elapse:(A=Number(m-this.inspectStartTime),{low:A|=0,high:A>>31,unsigned:A>=0}),fileSize:E.byteLength,jpgEncryption:2,height:_.height,width:_.width,jpg:E,networkType:6,osType:7,requestId:S,sdkVersion:"4.24.0",sequence:this.sequence,sid:u,timestamp:U2(m),uid:p,vid:l,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var A;this.extraInfo===void 0&&delete T.callbackData,this.ossFilePrefix===void 0&&delete T.ossFilePrefix;const I=wtt(T);if(I.byteLength<this.workerMessageLengthLimit){if(x("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const w=function(P){for(var D=1;D<arguments.length;D++){var U=arguments[D]!=null?arguments[D]:{};D%2?OV(Object(U),!0).forEach(function(G){N(P,G,U[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(P,Object.getOwnPropertyDescriptors(U)):OV(Object(U)).forEach(function(G){Object.defineProperty(P,G,Object.getOwnPropertyDescriptor(U,G))})}return P}({},T);delete w.jpg,R.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(w))}return I}{const w=this.quality*this.qualityRatio;return this.quality=w,await this.generateRequestData(e,{appId:i,cname:o,cid:c,vid:l,sid:u,uid:p})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Oi.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Es.CLOSED,this.emit(Dn.STATE_CHANGE,Ss.CLOSED)}}const Utt={name:"ContentInspect",create:function(t){let{config:e}=t;return function(n){if(!n)throw new Q(L.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new Q(L.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach(o=>{var c;if(!pt(c=["supervise","moderation"]).call(c,o))throw new Q(L.INVALID_PARAMS,"".concat(o," is not a valid inspect type."))}),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new Q(L.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(e),new xtt(e)}};var NV=h(Bi.Object.getOwnPropertySymbols),Vtt=ve,Ftt=KS.indexOf,Btt=Vf,GR=At([].indexOf),DV=!!GR&&1/GR([1],1,-0)<0;Vtt({target:"Array",proto:!0,forced:DV||!Btt("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return DV?GR(this,t,e)||0:Ftt(this,t,e)}});var jtt=ss("Array","indexOf"),Wtt=M,Gtt=jtt,HR=Array.prototype,Htt=function(t){var e=t.indexOf;return t===HR||Wtt(HR,t)&&e===HR.indexOf?Gtt:e},PV=h(Htt);function ztt(t,e){if(t==null)return{};var n,i,o=function(l,u){if(l==null)return{};var p={};for(var m in l)if({}.hasOwnProperty.call(l,m)){if(PV(u).call(u,m)!==-1)continue;p[m]=l[m]}return p}(t,e);if(NV){var c=NV(t);for(i=0;i<c.length;i++)n=c[i],PV(e).call(e,n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}let kV=class{get localCapabilities(){return Ge(this._localCapabilities)}get rtpCapabilities(){return Ge(this._rtpCapabilities)}get candidates(){return Ge(this._candidates)}get iceParameters(){return Ge(this._iceParameters)}get dtlsParameters(){return Ge(this._dtlsParameters)}constructor(t){N(this,"sessionDesc",void 0),N(this,"_localCapabilities",void 0),N(this,"_rtpCapabilities",void 0),N(this,"_candidates",void 0),N(this,"_iceParameters",void 0),N(this,"_dtlsParameters",void 0),N(this,"setup",void 0),N(this,"currentMidIndex",void 0),N(this,"cname","o/i14u9pJrxRKAsu"),N(this,"firefoxSsrcMidMap",new Map),t=Ge(t);const{remoteIceParameters:e,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:o,localCapabilities:c,direction:l,setup:u,videoCodec:p,audioCodec:m}=t;let _;this.setup=u,_=l===yi.RECEIVE_ONLY?Wi(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Wi(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=o,this._candidates=i,this._iceParameters=e,this._dtlsParameters=n,this._localCapabilities=c;const E=l===yi.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,S=l===yi.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,T=l===yi.RECEIVE_ONLY?o.send.videoCodecs:zh(St.VIDEO,E,S,p),A=l===yi.RECEIVE_ONLY?o.send.audioCodecs:zh(St.AUDIO,E,S,m);for(const I of _.mediaDescriptions)I.attributes.iceUfrag=e.iceUfrag,I.attributes.icePwd=e.icePwd,I.attributes.fingerprints=n.fingerprints,I.attributes.candidates=i,I.attributes.setup=this.setup,I.media.mediaType==="application"&&(I.attributes.sctpPort="5000"),I.media.mediaType==="video"&&(I.media.fmts=T.map(w=>w.payloadType.toString(10)),I.attributes.payloads=T,I.attributes.extmaps=E.videoExtensions),I.media.mediaType==="audio"&&(I.media.fmts=A.map(w=>w.payloadType.toString(10)),I.attributes.payloads=A,I.attributes.extmaps=E.audioExtensions,Kl(I));this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return xa(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===t)}send(t,e,n,i,o){n=n.replace(/ /g,"-");const{ssrcs:c,ssrcGroups:l}=Hh(e,this.cname,x("SYNC_GROUP")?n:void 0),u=this.findPreloadMediaDesc(c);if(u){if(qe()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,u.attributes.mid),o&&(o.twcc||o.remb)){const p=this.sessionDesc.mediaDescriptions.indexOf(u);return this.sessionDesc.mediaDescriptions[p]=this.mungSendMediaDesc(u,o),{mid:u.attributes.mid,needExchangeSDP:!0}}return{mid:u.attributes.mid,needExchangeSDP:!1}}{const p=this.findAvailableMediaIndex(t,c,i);let m;return p===-1?(m=this.createOrRecycleSendMedia(t,c,l,"sendonly",i,o),this.updateBundleMids()):(m=Ge(this.sessionDesc.mediaDescriptions[p]),m.attributes.direction="sendonly",m.attributes.ssrcs=c,m.attributes.ssrcGroups=l,this.sessionDesc.mediaDescriptions[p]=this.mungSendMediaDesc(m,o)),qe()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,m.attributes.mid),{needExchangeSDP:!0,mid:m.attributes.mid}}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,e,n){const i=[];return t.forEach(o=>{const c=o._mediaStreamTrack.kind,l=this.findAvailableRecvMediaIndex(c);let u,p=!1;l===-1?(p=!0,u=this.createOrRecycleRecvMedia(o,[],"recvonly",e,n),this.updateBundleMids()):(u=Ge(this.sessionDesc.mediaDescriptions[l]),u.attributes.direction="recvonly"),i.push({mid:u.attributes.mid,needCreateTransceiver:p})}),i}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:e,protocol:n,address:i,port:o,type:c,relatedAddress:l,relatedPort:u,priority:p}=new RTCIceCandidate(t),m={foundation:e??"",componentId:"1",transport:n??"",priority:p?p+"":"",connectionAddress:i??"",port:o?o+"":"",type:c?c+"":"",relAddr:l??"",relPort:u?u+"":"",extension:{}};this.candidates.some(_=>_.priority===m.priority&&_.connectionAddress===m.connectionAddress&&_.port===m.port)||(this._candidates.push(m),this.sessionDesc.mediaDescriptions.forEach(_=>{_.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,e,n,i,o){const c=t._mediaStreamTrack.kind,l=this.rtpCapabilities.recv,u=zh(c,l,this.localCapabilities.send,c===St.AUDIO?o:i),p=c===St.VIDEO?l.videoExtensions:l.audioExtensions,m="".concat(++this.currentMidIndex);let _={media:{mediaType:c,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};_=this.mungRecvMediaDsec(_,t);const E=this.findFirstClosedMedia(c);if(E){const S=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[S]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>pt(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>pt(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(t,e,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const o=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(qe()){if(o){const c=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(c||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!c||c!==i.attributes.mid)}return!1}return o&&i.attributes.mid===n})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(e=>{const n=e.media.mediaType===t&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&n})}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}restartICE(t){t=Ge(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,e,n,i,o,c){const l=this.rtpCapabilities.send,u=t===St.VIDEO?l.videoCodecs:l.audioCodecs,p=t===St.VIDEO?l.videoExtensions:l.audioExtensions;qe()&&(o="".concat(++this.currentMidIndex));let m={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:o}};m=this.mungSendMediaDesc(m,c);const _=this.findFirstClosedMedia(t);if(_){const E=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[E]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}mungRecvMediaDsec(t,e,n){const i=Ge(t);return B0(i),zl(i,e),j0(i,e),bx(i),K_(i,n,this.localCapabilities.send),i}mungSendMediaDesc(t,e){const n=Ge(t);return K_(n,e,this.localCapabilities.recv),Kl(n),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var n;return((n=e.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>qe()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}};const Ktt=["sdp"];var xe;function LV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function ec(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?LV(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):LV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let MV=(xe=class lu extends ax{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,n,i){super(e,n),N(this,"direction",void 0),N(this,"name",void 0),N(this,"store",void 0),N(this,"spec",void 0),N(this,"peerConnection",void 0),N(this,"initialOffer",void 0),N(this,"transport",void 0),N(this,"statsFilter",void 0),N(this,"localCandidateCount",0),N(this,"_isInRestartIce",!1),N(this,"mutex",void 0),N(this,"onLocalCandidate",void 0),N(this,"remoteSDP",void 0),N(this,"pendingCandidates",[]),N(this,"localCapabilities",void 0),N(this,"isReady",!1),N(this,"restartCnt",0),N(this,"curTurnServerIndex",0),this.store=n,this.spec=e,this.mutex=new Qn("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(lu.resolvePCConfiguration(e,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??yi.SEND_ONLY,this.name=this.direction===yi.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Xy(this.peerConnection,x("STATS_UPDATE_INTERVAL"),void 0,qe()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const n=await wx();if(this.localCapabilities=Y_(n),e){const{sdp:i}=e,o=ztt(e,Ktt),c=function(){const _={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},E=Gh(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(vs(E,_,"videoExtensions",S,T,A),vs(E,_,"videoCodecs",S,T,A),vs(E,_,"audioExtensions",S,T,A),vs(E,_,"audioCodecs",S,T,A),x("RAISE_H264_BASELINE_PRIORITY")){const I=A.videoCodecs.findIndex(w=>w.rtpMap&&w.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&w.fmtp&&w.fmtp.parameters["profile-level-id"]==="42001f");if(I!==-1){const w=A.videoCodecs.findIndex(P=>P.rtpMap&&P.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(w<I){R.debug("raising H264 baseline profile priority");const P=A.videoCodecs[I];A.videoCodecs.splice(I,1),A.videoCodecs.splice(w,0,P)}w!==-1&&x("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(P=>!(P.rtpMap&&P.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&P.fmtp&&P.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:S,recv:T,sendrecv:A}}({},{},i);this.remoteSDP=new kV({remoteIceParameters:o.iceParameters,remoteDtlsParameters:o.dtlsParameters,candidates:[],remoteRTPCapabilities:c,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const l=await this.peerConnection.createAnswer();if(!l.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const u=Wa(l.sdp);await this.peerConnection.setLocalDescription(l);const p=await Ax({},{},l.sdp);this.localCapabilities=Y_(p);const m=this.peerConnection.getTransceivers()[0];return m!=null&&m.receiver&&m.receiver.transport&&this.tryBindTransportEvents(m.receiver.transport),ec(ec({},u),{},{sdp:l.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const o=Wa(i.sdp);return this.initialOffer=i,ec(ec({},o),{},{sdp:i.sdp})}}catch(n){throw new $(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:i,dtlsParameters:o}=e,c=await Ax({},{},n);this.remoteSDP=new kV({remoteIceParameters:i,remoteDtlsParameters:o,candidates:[],remoteRTPCapabilities:c,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const l=this.peerConnection.getTransceivers()[0];l!=null&&l.sender&&l.sender.transport&&this.tryBindTransportEvents(l.sender.transport)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new $(L.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(e,n,i){var o=this;return xr(function*(){const c=yield oe(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=[],u=o.remoteSDP.receive(e,n,i);e.forEach((w,P)=>{if(u[P].needCreateTransceiver){const D=o.peerConnection.addTransceiver(w._mediaStreamTrack,{direction:"sendonly"});l.push(D),w._updateRtpTransceiver(D)}else{const D=o.peerConnection.getTransceivers().find(U=>U.mid===u[P].mid);if(!D)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(u[P].mid));l.push(D),w._updateRtpTransceiver(D)}}),qe()&&x("SIMULCAST")===!0&&(yield oe(o.applySimulcastForFirefox(l,e)));const p=u.map(w=>w.mid),m=yield oe(o.peerConnection.createOffer()),_=o.mungSendOfferSDP(m.sdp,e,p),E=Wi(_),S=p.map(w=>{const P=E.mediaDescriptions.find(D=>D.attributes.mid===w);if(!P)throw new Error("Cannot extract ssrc from mediaDescription.");return yx(P,x("USE_PUB_RTX"))}),T=l.map((w,P)=>{const D=p[P];return{localSSRC:S[P],id:D}});yield oe(o.peerConnection.setLocalDescription({type:"offer",sdp:_}));try{yield T}catch(w){const P=o.remoteSDP.toString();throw yield oe(o.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield oe(o.peerConnection.setRemoteDescription({type:"answer",sdp:P})),yield oe(o.stopSending(p,!0)),w}yield oe(o.applySimulcastEncodings(l,e)),yield oe(o.applySendEncodings(l,e));const A=o.remoteSDP.toString(),I=o.logSDPExchange(_,"offer","local","send");return I==null||I(A),yield oe(o.setRemoteDescription({type:"answer",sdp:A})),l.map((w,P)=>{const D=p[P];return{localSSRC:S[P],id:D}})}catch(l){throw l instanceof $?l:new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{c()}})()}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(p=>e.indexOf(p.mid)!==-1);if(o.length!==e.length)throw new Error("Transceivers' length (".concat(o.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));o.map(p=>{var m;p.direction="inactive",(m=p.stop)===null||m===void 0||m.call(p)});const c=await this.peerConnection.createOffer(),l=this.logSDPExchange(c.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(e);const u=this.remoteSDP.toString();l==null||l(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{i&&i()}}async receive(e,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:c,needExchangeSDP:l}=this.remoteSDP.send(e,n,i,o);if(l){const p=this.remoteSDP.toString(),m=this.logSDPExchange(p,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:p});const _=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(_.sdp,c,e);m==null||m(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const u=this.peerConnection.getTransceivers().find(p=>p.mid===c);if(!u||u.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,mid:u.mid,transceiver:u}}catch(c){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async mockReceive(e,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:c,needExchangeSDP:l}=this.remoteSDP.send(e,n,i,o);if(l){const u=this.remoteSDP.toString(),p=this.logSDPExchange(u,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:u});const m=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(m.sdp,c,e);p==null||p(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(c){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===Yc.Auto&&(this.store.p2pTransport=Yc.SdRtn,ae().supportPCSetConfiguration&&this.peerConnection.setConfiguration(lu.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,ae().supportPCSetConfiguration&&this.peerConnection.setConfiguration(lu.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=Wa(n.sdp);return this.store.descriptionStart(),this.direction===yi.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===yi.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=Wa(n.sdp);return await this.peerConnection.setLocalDescription(n),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const c=this.remoteSDP.toString(),l=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),l==null||l(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new $(L.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(o=>o.mid===e);i.length===1&&(this.isVP8Simulcast(n)?qe()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(o=>o.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:o}=n.getSelectedCandidatePair();return{local:ec(ec({},To),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:ec(ec({},To),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,n;pt(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var n;e.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const o={iceServers:[]};var c;return e.iceServers?o.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Ah(e.turnServer.servers)?o.iceServers=e.turnServer.servers:(o.iceServers&&o.iceServers.push(...lu.turnServerConfigToIceServers(e.turnServer.servers,n,i)),x("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&e.turnServer.serversFromGateway&&o.iceServers.push(...lu.turnServerConfigToIceServers(e.turnServer.serversFromGateway,n,i)),pt(c=[Yc.Relay,Yc.SdRtn]).call(c,n)&&(o.iceTransportPolicy="relay"),x("FORCE_TURN_TCP")?o.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(l=>{l.forceturn&&(o.iceTransportPolicy="relay")}))),x("ENABLE_ENCODED_TRANSFORM")&&ae().supportWebRTCEncodedTransform&&(o.encodedInsertableStreams=!0),R.debug("P2PConnection p2pTransport is ".concat(n)),o}static turnServerConfigToIceServers(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const o=[],c=e.filter(u=>u.tcpport);R.debug("P2PConnection turnServers is ".concat(c,", current index is ").concat(i));const l=c.length>i?c[i]:c[0];switch(n){case Yc.SdRtn:const u=e.filter(m=>{var _;return pt(_=m.username).call(_,"glb:")&&m.turnServerURL==m.turnServerURL}),p=u.length>i?u[i]:u[0];p&&(o.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(Ba(p.turnServerURL),":").concat(p.tcpport,"?transport=udp")}),o.push({username:p.username,credential:p.password,credentialType:"password",urls:"turns:".concat(Ba(p.turnServerURL),":").concat(p.tcpport,"?transport=tcp")}));break;case Yc.Relay:l&&(o.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.tcpport,"?transport=udp")}),o.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(Ba(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}));break;default:l&&(o.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.tcpport,"?transport=udp")}),o.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(Ba(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}),o.push({username:l.username,credential:l.password,credentialType:"password",urls:"stun:".concat(l.turnServerURL,":").concat(l.tcpport)}))}return o}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var i;e!=null&&e.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,e.state))},e.onerror=i=>{var o;(o=this.onDTLSTransportError)===null||o===void 0||o.call(this,"error"in i?i.error:i)};const n=e.iceTransport;n&&(n.onstatechange=()=>{const i=e==null?void 0:e.iceTransport.state;var o;i&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:o}=n.getSelectedCandidatePair()||{};if(i&&o){const c=i.address+":"+i.port,l=o.address+":"+o.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(ed(c)),", remote ").concat(JSON.stringify(ed(l))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(_=>_.track===e._mediaStreamTrack)),!n)return R.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ae().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const o={},c={};switch(e._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(e._encoderConfig){var l;const{bitrateMax:_,frameRate:E,scaleResolutionDownBy:S}=e._encoderConfig;_&&(c.maxBitrate=1e3*_),pt(l=e._hints).call(l,Ie.LOW_STREAM)&&(E&&(c.maxFramerate=or(E)),S&&S>=1&&(c.scaleResolutionDownBy=S))}if(x("DSCP_TYPE")&&Xo()){var u;const _=x("DSCP_TYPE");pt(u=["very-low","low","medium","high"]).call(u,_)&&(c.networkPriority=_)}const p=n.getParameters(),m=(i=p.encodings)===null||i===void 0?void 0:i[0];qe()&&!m&&(o.encodings=[c]),m&&Object.assign(m,c),Object.assign(p,o),R.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p.encodings))),await n.setParameters(p)}async applySendEncodings(e,n){try{if(!ae().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const o=e[i],c=n[i];c instanceof Me&&!this.isVP8Simulcast(c)&&await this.updateRtpSenderEncodings(c,o.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const o=Wi(e);return n.forEach((c,l)=>{const u=i[l],p=o.mediaDescriptions.find(m=>m.attributes.mid===u);p&&(zl(p,c),Ix(p,c,this.store.codec))}),xa(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let p=0;p<e.length;p++){var i,o,c,l,u;const m=e[p],_=n[p];if(_ instanceof Me&&!pt(i=_._hints).call(i,Ie.LOW_STREAM)&&(o=_._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=_._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(l=_._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=_._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},S={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const T=m.sender.getParameters();await m.sender.setParameters(Object.assign(T,E))}}}async applySimulcastEncodings(e,n){if(!qe()&&e.length===n.length)for(let i=0;i<e.length;i++){const o=n[i];if(o instanceof Me&&this.isVP8Simulcast(o)){const c=e[i],l={},u={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};l.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const p=c.sender.getParameters();await c.sender.setParameters(Object.assign(p,l))}}}isVP8Simulcast(e){var n,i,o,c,l;return!!(e instanceof Me&&x("SIMULCAST")&&this.store.codec==="vp8"&&!pt(n=e._hints).call(n,Ie.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=e._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(c=e._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=e._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1)}logSDPExchange(e,n,i,o){if(x("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(o,`
`),e),n==="offer"?c=>{this.logSDPExchange(c,"answer",i==="local"?"remote":"local",o)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(l=>l.mid&&e.indexOf(l.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(l=>{l.direction="inactive"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const c=this.remoteSDP.toString();o==null||o(c),await this.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(l=>l.mid&&e.indexOf(l.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async l=>{l.direction="sendonly"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e);const c=this.remoteSDP.toString();o==null||o(c),await this.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(e,n){var i;if(n=n??((i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp)){var o;const c=(o=Wi(n).mediaDescriptions.find(l=>l.attributes.mid===e))===null||o===void 0?void 0:o.attributes.ssrcs;return c==null?void 0:c[0].ssrcId}}async setRemoteDescription(e){var n;await this.peerConnection.setRemoteDescription(e),pt(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,n,i){const o=Wi(e),c=o.mediaDescriptions.find(l=>l.attributes.mid===n);return c&&i===St.AUDIO&&c.media.mediaType==="audio"&&Kl(c),xa(o)}},Ct(xe.prototype,"establish",[bs],Object.getOwnPropertyDescriptor(xe.prototype,"establish"),xe.prototype),Ct(xe.prototype,"connect",[bs],Object.getOwnPropertyDescriptor(xe.prototype,"connect"),xe.prototype),Ct(xe.prototype,"receive",[bs],Object.getOwnPropertyDescriptor(xe.prototype,"receive"),xe.prototype),Ct(xe.prototype,"mockReceive",[bs],Object.getOwnPropertyDescriptor(xe.prototype,"mockReceive"),xe.prototype),Ct(xe.prototype,"stopReceiving",[bs],Object.getOwnPropertyDescriptor(xe.prototype,"stopReceiving"),xe.prototype),Ct(xe.prototype,"restartICE",[bs],Object.getOwnPropertyDescriptor(xe.prototype,"restartICE"),xe.prototype),Ct(xe.prototype,"close",[bs],Object.getOwnPropertyDescriptor(xe.prototype,"close"),xe.prototype),Ct(xe.prototype,"updateEncoderConfig",[bs],Object.getOwnPropertyDescriptor(xe.prototype,"updateEncoderConfig"),xe.prototype),Ct(xe.prototype,"updateSendParameters",[bs],Object.getOwnPropertyDescriptor(xe.prototype,"updateSendParameters"),xe.prototype),Ct(xe.prototype,"replaceTrack",[bs],Object.getOwnPropertyDescriptor(xe.prototype,"replaceTrack"),xe.prototype),Ct(xe.prototype,"muteLocal",[bs],Object.getOwnPropertyDescriptor(xe.prototype,"muteLocal"),xe.prototype),Ct(xe.prototype,"unmuteLocal",[bs],Object.getOwnPropertyDescriptor(xe.prototype,"unmuteLocal"),xe.prototype),xe);function bs(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,c=await o.lock("From P2PConnection.".concat(e));try{for(var l=arguments.length,u=new Array(l),p=0;p<l;p++)u[p]=arguments[p];return await i.apply(this,u)}finally{c()}},n}let $s=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var xV,UV,VV,FV,BV,jV,WV,GV,HV,zV,KV,He;function YV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function wg(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?YV(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):YV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let Ytt=(xV=to($s.SEND_ONLY),UV=to($s.SEND_ONLY),VV=to(),FV=to($s.RECEIVE_ONLY),BV=to($s.RECEIVE_ONLY),jV=to($s.RECEIVE_ONLY),WV=to($s.RECEIVE_ONLY),GV=to($s.RECEIVE_ONLY),HV=to($s.RECEIVE_ONLY),zV=to(),KV=to($s.RECEIVE_ONLY),He=class extends Ke{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(It.StateChange,e,this._state)}constructor(t,e){super(),N(this,"isPlanB",!1),N(this,"store",void 0),N(this,"statsUploader",void 0),N(this,"sendConnection",void 0),N(this,"recvConnection",void 0),N(this,"localTrackMap",new Map),N(this,"remoteUserMap",new Map),N(this,"localDataChannels",[]),N(this,"pendingLocalTracks",[]),N(this,"pendingRemoteTracks",[]),N(this,"statsCollector",void 0),N(this,"dtlsFailedCount",0),N(this,"sendMutex",void 0),N(this,"recvMutex",void 0),N(this,"_state",ge.Disconnected),N(this,"_restartStates",["disconnected","failed"]),N(this,"reconnectInterval",void 0),N(this,"uploadUnplinkStarted",!1),N(this,"uploadDownlinkStarted",!1),N(this,"uplinkStateUploadInterval",void 0),N(this,"downlinkStatsUploadInterval",void 0),N(this,"handleMuteLocalTrack",async(n,i,o)=>{const c=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==ge.Connected)return void o(new $(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const p=this.filterTobeMutedTracks(n);if(p.length===0)return void i();const m=p.find(T=>T[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(p.map(T=>{let[,{id:A}]=T;return A}));let _=!1;var l,u;n.trackMediaType==="video"?_=!((l=this.localTrackMap.get(st.LocalAudioTrack))===null||l===void 0||!l.track._muted):_=((u=this.localTrackMap.get(st.LocalVideoTrack))===null||u===void 0?void 0:u.id)===void 0;const E=this.createMuteMessage(p);await we(this,It.RequestMuteLocal,E);const S=n.trackMediaType==="video"?Fa.MUTE_LOCAL_VIDEO:Fa.MUTE_LOCAL_AUDIO;await we(this,It.RequestP2PMuteLocal,{action:S,message:E,isMuteAll:_}),i()}catch(p){o(p)}finally{c()}}),N(this,"handleUnmuteLocalTrack",async(n,i,o)=>{const c=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==ge.Connected)return void o(new $(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const l=this.filterTobeUnmutedTracks(n);if(l.length===0)return void i();await this.sendConnection.unmuteLocal(l.map(m=>{let[,{id:_}]=m;return _}));const u=this.createUnmuteMessage(l),p=n.trackMediaType==="video"?Fa.UNMUTE_LOCAL_VIDEO:Fa.UNMUTE_LOCAL_AUDIO;await we(this,It.RequestP2PMuteLocal,{action:p,message:u}),i()}catch(l){o(l)}finally{c()}}),N(this,"handleUpdateVideoEncoder",async(n,i,o,c)=>{let l;typeof c=="boolean"&&c||(l=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const p=this.localTrackMap.get(st.LocalVideoTrack);if(!this.sendConnection||!p||p.track!==n||this.state!==ge.Connected)return void i();const{id:m,track:_}=p;m&&(await this.sendConnection.updateSendParameters(m,_),await this.sendConnection.updateEncoderConfig(m,_),this.emit(It.UpdateVideoEncoder,_)),i()}catch(p){o(p)}finally{var u;(u=l)===null||u===void 0||u()}}),N(this,"handleUpdateVideoSendParameters",async(n,i,o)=>{const c=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const l=this.localTrackMap.get(st.LocalVideoTrack);if(!this.sendConnection||!l||l.track!==n||this.state!==ge.Connected)return void i();const{id:u,track:p}=l;u&&await this.sendConnection.updateSendParameters(u,p),i()}catch(l){o(l)}finally{c()}}),N(this,"handleReplaceTrack",async(n,i,o,c)=>{let l;R.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof c=="boolean"&&c||(l=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var u;const m=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:E}]=_;return n===E});if(!this.sendConnection||!m||m[1].id===void 0||this.state!==ge.Connected)return void i();if(await((u=this.sendConnection)===null||u===void 0?void 0:u.replaceTrack(n,m[1].id)),m[0]===st.LocalVideoTrack&&ae().supportDualStreamEncoding){const _=this.localTrackMap.get(st.LocalVideoLowTrack);if(_){const E=n._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=E,_.track._originMediaStreamTrack=E,await new gt((S,T)=>{this.handleReplaceTrack(_.track,S,T,!0)})}}i()}catch(m){o(m)}finally{var p;(p=l)===null||p===void 0||p()}}),N(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),N(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),N(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),N(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new d2(t),this.bindStatsUploaderEvents(),this.sendMutex=new Qn("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new Qn("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},x("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,e){throw new $(L.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new $(L.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){let n;try{if(e){this.recvConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new MV(t,this.store,yi.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(e);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=ge.New,this.sendConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new MV(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{n&&n()}}async p2pConnect(t){if(!this.sendConnection)throw new $(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ge.Connected}async addRemoteCandidate(t,e){if(e===yi.RECEIVE_ONLY){if(!this.sendConnection)throw new $(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new $(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,e,n){var i=this;return xr(function*(){const o=yield oe(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==ge.Connected){i.throwIfTrackTypeNotMatch(t);const m=t.filter(_=>i.pendingLocalTracks.indexOf(_)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(m))}i.store.pubId=i.store.pubId+1,ei.markPublishStart(i.store.clientId,i.store.pubId);const c=i.filterTobePublishedTracks(t,e,n);if(c.length===0)return void(yield oe(i.tryToUnmuteAudio(t)));c.forEach(m=>{let{track:_,type:E}=m;const S=Date.now();i.store.publish(_.getTrackId(),E===st.LocalAudioTrack?"audio":"video",S)}),i.bindLocalTrackEvents(c);const l=yield oe(i.sendConnection.send(c.map(m=>{let{track:_}=m;return _}),i.store.codec,i.store.audioCodec)),u=(yield oe(l.next())).value,p=i.createGatewayPublishMessage(c,u);try{yield p}catch(m){throw l.throw(m),(m==null?void 0:m.code)===L.WS_ABORT&&c.forEach(_=>{let{track:E}=_;i.pendingLocalTracks.indexOf(E)===-1&&i.pendingLocalTracks.push(E)}),i.unbindLocalTrackEvents(c),m}yield oe(l.next()),c.forEach(m=>{let{type:_}=m;i.statsCollector.addLocalStats(_)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(c,u),c.forEach(m=>{let{track:_,type:E}=m;const S=Date.now();i.store.publish(_.getTrackId(),E===st.LocalAudioTrack?"audio":"video",void 0,S)}),i.startUploadUplinkState()}finally{o()}})()}async unpublish(t){if(!this.sendConnection||this.state!==ge.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(o=>!pt(t).call(t,o)));const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(o=>o[0]==="videoLowTrack");n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(e);if(await this.sendConnection.stopSending(e.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(o=>{let[c,{track:l}]=o;return{type:c,track:l}})),e.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===ge.Connected)return n&&n[1].track.close(),i;t.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const e=[],n=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[o,{track:c,ssrcs:l}]=i;const u={stream_type:jZ(c,o),ssrcs:l};c._muted||!c._enabled?e.push(u):n.push(u)}),e.length>0&&e.forEach(i=>{we(this,It.RequestMuteLocal,[i])}),n.length>0&&n.forEach(i=>{we(this,It.RequestUnmuteLocal,[i])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return xr(function*(){throw new $(L.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Kn(this,It.RequestRePublish,this.pendingLocalTracks),this.emit(It.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new $(L.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,e,n,i){var o;if(!this.recvConnection)throw new $(L.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((o=this.remoteUserMap.get(t))!==null&&o!==void 0&&o.has(e))return;const{track:c,mid:l,transceiver:u}=await this.recvConnection.receive(e,[{ssrcId:n}],String(t.uid),i);e===St.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(c):(t._audioTrack=new Ul(c,t.uid,t._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),u&&t._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=n,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(c):(t._videoTrack=new xl(c,t.uid,t._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),u&&t._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(t,t._videoTrack));const p=this.remoteUserMap.get(t);p?p.set(e,l):this.remoteUserMap.set(t,new Map([[e,l]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const m=this.pendingRemoteTracks.findIndex(_=>{let{user:E,kind:S}=_;return E.uid===t.uid&&e===S});m!==-1&&(this.pendingRemoteTracks.splice(m,1),this.emit(It.MediaReconnectEnd,t.uid))}async mockSubscribe(t,e,n,i){if(!this.recvConnection)throw new $(L.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(e,[{ssrcId:n}],String(t.uid),i)}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:u}=c;return e!==void 0?l.uid===t.uid&&e===u:l.uid===t.uid});if(i.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.recvConnection||n||i.forEach(c=>{let{kind:l}=c;var u;if(l===St.AUDIO)(u=t._audioTrack)===null||u===void 0||u._destroy(),t._audioTrack=void 0;else if(l===St.VIDEO){var p;(p=t._videoTrack)===null||p===void 0||p._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const o=this.filterTobeUnSubscribedTracks(t,e);o.length!==0&&(await this.recvConnection.stopReceiving(o.map(c=>{let[,{id:l}]=c;return l})),this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),o.forEach(c=>{let[l,{kind:u}]=c;var p,m;if(u===St.VIDEO&&l._videoSSRC&&((p=this.recvConnection)===null||p===void 0||p.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),u===St.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),n||((m=l._videoTrack)===null||m===void 0||m._destroy(),l._videoTrack=void 0);else if(u===St.AUDIO){var _;this.unbindRemoteTrackEvents(l._audioTrack),!n&&((_=l._audioTrack)===null||_===void 0||_._destroy(),l._audioTrack=void 0)}}),o.forEach(c=>{let[,{kind:l}]=c;we(this,It.RequestP2PMuteRemote,l)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,n]=e;[St.VIDEO,St.AUDIO].forEach(i=>{n.has(i)?we(this,It.RequestP2PUnmuteRemote,i):we(this,It.RequestP2PMuteRemote,i)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new $(L.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new $(L.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new $(L.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new $(L.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===St.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(st.LocalAudioTrack);if((e==null?void 0:e.track)instanceof gn){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return o!==st.LocalAudioTrack}).filter(i=>{let[o]=i;return!(t&&o===st.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===st.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(t,e,n,i,o){if(t){const l=this.localTrackMap.get(st.LocalAudioTrack),u=i?this.localTrackMap.get(st.LocalVideoLowTrack):this.localTrackMap.get(st.LocalVideoTrack);bt.publish(this.store.sessionId,{eventElapse:ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:l==null?void 0:l.track.getTrackLabel(),videoName:u==null?void 0:u.track.getTrackLabel(),screenshare:(u==null?void 0:u.track._hints.indexOf(Ie.SCREEN_TRACK))!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var c;n||(n=[]);const l=n.find(p=>p instanceof $e),u=i?(c=this.localTrackMap.get(st.LocalVideoTrack))===null||c===void 0?void 0:c.track:n.find(p=>p instanceof Me);bt.publish(this.store.sessionId,{eventElapse:ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:l==null?void 0:l.getTrackLabel(),videoName:u==null?void 0:u.getTrackLabel(),screenshare:(u==null?void 0:u._hints.indexOf(Ie.SCREEN_TRACK))!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(t,e,n,i){const o=i===St.VIDEO?n._videoSSRC:n._audioSSRC;o&&bt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===St.VIDEO,audio:i===St.AUDIO,peerid:n.uid,subscribeRequestid:i===St.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:ei.measureFromSubscribeStart(this.store.clientId,o)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Qn("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Qn("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(st.LocalAudioTrack);if((t==null?void 0:t.track)instanceof gn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=ge.Disconnected}getStats(t){var e,n;return t?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(st.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(st.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof Me||e&&e.track instanceof $e?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(Gi(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(st.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Mc(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=ge.Reconnecting,x("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case st.LocalVideoTrack:pt(e=i._hints).call(e,Ie.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case st.LocalAudioTrack:i instanceof gn?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case st.LocalVideoLowTrack:}}),this.emit(It.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(Gi(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(It.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:o}=n;if((t instanceof Ka?t.uid:t)===i.uid&&e===o)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t,e){let n,i;if(t===yi.SEND_ONLY){if(!this.sendConnection)throw new $(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new $(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(e){const o=await i.restartICE(e);return i.isInRestartIce=!1,o}{const o=await i.restartICE();if(o){const c=await Kn(this,It.RequestP2PRestartICE,{direction:yi.RECEIVE_ONLY,iceParameter:o});await i.restartICE(c),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(st.LocalVideoTrack),n=this.localTrackMap.get(st.LocalAudioTrack),i=t.videoSend.find(T=>{var A;return T.ssrc===(e==null||(A=e.ssrcs)===null||A===void 0?void 0:A[0].ssrcId)}),o=t.audioSend.find(T=>{var A;return T.ssrc===(n==null||(A=n.ssrcs)===null||A===void 0?void 0:A[0].ssrcId)});if(!i||!o)return 1;const c=_r(this,It.NeedSignalRTT),l=i?i.rttMs:void 0,u=o?o.rttMs:void 0,p=l&&u?(l+u)/2:l||u,m=(p&&c?(p+c)/2:p||c)||0,_=100*t.sendPacketLossRate*.7/50+.3*m/1500,E=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,S=e==null?void 0:e.track;if(S&&S._encoderConfig&&S._hints.indexOf(Ie.SCREEN_TRACK)===-1){const T=S._encoderConfig.bitrateMax,A=t.bitrate.actualEncoded;if(T&&A){const I=(1e3*T-A)/(1e3*T);return $M[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const o=i._audioSSRC,c=i._videoSSRC,l=t.audioRecv.find(A=>A.ssrc===o),u=t.videoRecv.find(A=>A.ssrc===c);if(!l&&!u)return void(e+=1);const p=_r(this,It.NeedSignalRTT),m=t.rtt,_=(m&&p?(m+p)/2:m||p)||0,E=l?l.jitterMs:void 0,S=t.recvPacketLossRate;let T=.7*S*100/50+.3*_/1500;E&&(T=.6*S*100/50+.2*_/1500+.2*E/400),e+=T<.1?1:T<.17?2:T<.36?3:T<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new gt((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}filterTobePublishedTracks(t,e,n){const i=[],o=ae(),c=this.getAllTracks();t=Rl(t=t.filter(p=>c.indexOf(p)===-1));let l=!1,u=!1;for(const p of t){if(p instanceof Me&&(this.localTrackMap.has(st.LocalVideoTrack)||l?new $(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:p,type:st.LocalVideoTrack}),l=!0),e)){const m=this.getLowVideoTrack(p,n);i.push({track:m,type:st.LocalVideoLowTrack})}if(p instanceof $e){const m=this.localTrackMap.get(st.LocalAudioTrack);if(m){if(!(m.track instanceof gn))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(p._bypassWebAudio)throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");m.track.addAudioTrack(p),this.bindLocalAudioTrackEvents(p,!0)}else if(u){const _=i.find(E=>{let{type:S}=E;return S===st.LocalAudioTrack});if(!(_.track instanceof gn))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(p._bypassWebAudio)throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(p)}else{if(!o.webAudioMediaStreamDest||p instanceof gn||p._bypassWebAudio)i.push({track:p,type:st.LocalAudioTrack});else{const _=new gn;_.addAudioTrack(p),i.push({track:_,type:st.LocalAudioTrack})}u=!0}}}return i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=Rl(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof $e){const o=this.localTrackMap.get(st.LocalAudioTrack);if(!o)continue;o.track instanceof gn?(o.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),o.track.trackList.length===0&&(e.push([st.LocalAudioTrack,o]),o.track.close())):e.push([st.LocalAudioTrack,o])}if(i instanceof Me){const o=this.localTrackMap.get(st.LocalVideoTrack);if(!o)continue;e.push([st.LocalVideoTrack,o]);const c=this.localTrackMap.get(st.LocalVideoLowTrack);c&&e.push([st.LocalVideoLowTrack,c])}}return e}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case st.LocalVideoTrack:n.addListener(yt.GET_STATS,this.handleGetLocalVideoStats),n.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case st.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case st.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof gn?t.trackList.forEach(n=>{n.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case st.LocalVideoTrack:n.off(yt.GET_STATS,this.handleGetLocalVideoStats),n.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case st.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case st.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof gn?t.trackList.forEach(e=>{e.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(yt.GET_STATS,this.handleGetLocalAudioStats),e.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(yt.GET_STATS,this.handleGetLocalAudioStats),t.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof xl&&e.addListener(yt.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof Ul&&e.addListener(yt.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(yt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(St.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(St.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var o;let c,{track:l,type:u}=n;switch(u){case st.LocalAudioTrack:c=Ee.Audio;break;case st.LocalVideoTrack:c=pt(o=l._hints).call(o,Ie.SCREEN_TRACK)?Ee.Screen:Ee.High;break;case st.LocalVideoLowTrack:c=Ee.Low}return{kind:u===st.LocalAudioTrack?St.AUDIO:St.VIDEO,stream_type:c,mid:e[i].id,ssrcs:e[i].localSSRC,isMuted:l.muted||!l.enabled}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[o,{track:c,ssrcs:l,id:u}]=e;switch(o){case st.LocalVideoTrack:i=pt(n=c._hints).call(n,Ie.SCREEN_TRACK)?Ee.Screen:Ee.High;break;case st.LocalAudioTrack:i=Ee.Audio;break;case st.LocalVideoLowTrack:i=Ee.Low}return{stream_type:i,ssrcs:l,mid:u}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:o,type:c}=n;this.localTrackMap.set(c,{track:o,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var n;R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(e,")")),this.emit(It.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(t.isInRestartIce=!1),pt(n=this._restartStates).call(n,e)&&!t.isInRestartIce&&(e==="disconnected"&&await xn(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),bt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:We.TRACER}).onSuccess(),this.emit(It.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(Gi(n=this.remoteUserMap).call(n)).find(c=>c._audioSSRC===e);var o;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(o=i.audioTrack)===null||o===void 0||o.emit(Fr.FIRST_FRAME_DECODED),bt.firstRemoteFrame(this.store.sessionId,yn.FIRST_AUDIO_DECODE,je.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(Gi(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===e);i&&bt.firstRemoteFrame(this.store.sessionId,yn.FIRST_AUDIO_RECEIVED,je.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoReceived=e=>{var n;const i=Array.from(Gi(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===e);i&&bt.firstRemoteFrame(this.store.sessionId,yn.FIRST_VIDEO_RECEIVED,je.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",o=n.candidateType==="relay";n.candidateType!=="unknown"&&i===o||this.emit(It.ConnectionTypeChange,i),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ja(n))," -> ").concat(JSON.stringify(ja(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ja(n))," -> ").concat(JSON.stringify(ja(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.onLocalCandidate=e=>{this.emit(It.LocalCandidate,{candidate:e,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const e=t===yi.SEND_ONLY?this.sendConnection:this.recvConnection;e&&!e.isInRestartIce&&(e.isInRestartIce=!0,R.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(e.name,"] start use restartICE")),t===yi.SEND_ONLY?this.restartICE(t):Kn(this,It.RequestP2PRestartICE,{direction:yi.SEND_ONLY}))}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(st.LocalAudioTrack);if(t instanceof $e&&(n==null?void 0:n.track)instanceof gn)return n.track.isActive||e.push([st.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:c}]=o;return t===c});if(i&&(e.push(i),i[0]===st.LocalVideoTrack)){const o=this.localTrackMap.get(st.LocalVideoLowTrack);o&&e.push([st.LocalVideoLowTrack,o])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(st.LocalAudioTrack);if(t instanceof $e&&(n==null?void 0:n.track)instanceof gn)return n.track.isActive&&e.push([st.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:c}]=o;return t===c});if(i)if(i[0]===st.LocalVideoTrack){e.push(i);const o=this.localTrackMap.get(st.LocalVideoLowTrack);o&&e.push([st.LocalVideoLowTrack,o])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[o,{track:c,ssrcs:l,id:u}]=e;switch(o){case st.LocalAudioTrack:i=Ee.Audio;break;case st.LocalVideoTrack:i=pt(n=c._hints).call(n,Ie.SCREEN_TRACK)?Ee.Screen:Ee.High;break;case st.LocalVideoLowTrack:i=Ee.Low}return{stream_type:i,ssrcs:l,mid:u}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[o,{track:c,ssrcs:l,id:u}]=e;switch(o){case st.LocalAudioTrack:i=Ee.Audio;break;case st.LocalVideoTrack:i=pt(n=c._hints).call(n,Ie.SCREEN_TRACK)?Ee.Screen:Ee.High;break;case st.LocalVideoLowTrack:i=Ee.Low}return{stream_type:i,ssrcs:l,mid:u}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const o=i.get(e);if(!o)return n;n.push([t,{kind:e,id:o}])}else Array.from(i.entries()).forEach(o=>{let[c,l]=o;n.push([t,{kind:c,id:l}])});return n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:o,id:c}]=n;switch(o){case St.VIDEO:return void(i._videoSSRC&&e.push({stream_type:St.VIDEO,ssrcId:i._videoSSRC}));case St.AUDIO:return void(i._audioSSRC&&e.push({stream_type:St.AUDIO,ssrcId:i._audioSSRC}))}}),e}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const o=this.remoteUserMap.get(n);o&&(o.delete(i),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(st.LocalVideoTrack),n=this.localTrackMap.get(st.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new gt((i,o)=>{this.handleUpdateVideoEncoder(e.track,i,o,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new gt((i,o)=>{this.handleUpdateVideoEncoder(n.track,i,o,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return t!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof $e){const n=this.filterTobeUnmutedTracks(t[e]);if(n.length===0)continue;const i=this.createUnmuteMessage(n);return void await we(this,It.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:e}]=t;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(It.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(It.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await xn(Gy(this.dtlsFailedCount,pn)),this.emit(It.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(st.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Me)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof Me).length>1)throw new $(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof $e).length>1&&(t.some(e=>e instanceof $e&&e._bypassWebAudio)||!ae().webAudioMediaStreamDest))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof Me&&this.pendingLocalTracks.some(n=>n instanceof Me))throw new $(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof $e&&this.pendingLocalTracks.some(n=>n instanceof $e)&&(!ae().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof $e&&n._bypassWebAudio)))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&ae().supportDualStreamEncoding,i=wg(wg({},{width:160,height:120,framerate:15,bitrate:50}),e);let o;o=n?t._mediaStreamTrack.clone():sR(t,i);const c=Ae(8,"track-low-"),l=new Me(o,wg(wg({},n&&{scaleResolutionDownBy:F0(i,t)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,c);return l.on(qc.TRANSCEIVER_UPDATED,u=>{t._updateRtpTransceiver(u,Nl.LOW_STREAM)}),l._hints.push(Ie.LOW_STREAM),t.addListener(yt.NEED_CLOSE,()=>{l.close()}),l}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,n,i){var o;const c=Array.from(Gi(o=this.remoteUserMap).call(o)).find(l=>l._videoSSRC===t);if(c){i||this.store.subscribe(c.uid,"video",void 0,void 0,void 0,void 0,Date.now());const l=this.store.keyMetrics,u=l.subscribe.find(p=>p.userId===c.uid&&p.type==="video");bt.firstRemoteVideoDecode(this.store.sessionId,yn.FIRST_VIDEO_DECODE,je.FIRST_VIDEO_DECODE,{peer:c._uintid,videowidth:e,videoheight:n,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:l.requestAPEnd||0,apStart:l.requestAPStart||0,joinGwEnd:l.joinGatewayEnd||0,joinGwStart:l.joinGatewayStart||0,pcEnd:l.peerConnectionEnd||0,pcStart:l.peerConnectionStart||0,subscriberEnd:(u==null?void 0:u.subscribeEnd)||0,subscriberStart:(u==null?void 0:u.subscribeStart)||0,videoAddNotify:(u==null?void 0:u.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const o=i.get(e);if(!o)return!1;const c=await this.recvConnection.getRemoteSSRC(o);return c!==void 0&&c!==n}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new $(L.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new $(L.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new $(L.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new $(L.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new $(L.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new $(L.NOT_SUPPORTED)}async preConnect(t){throw new $(L.NOT_SUPPORTED)}getEstablishParams(){throw new $(L.NOT_SUPPORTED)}async reSubscribe(t){throw new $(L.NOT_SUPPORTED)}reportVideoFirstFrameRender(t){}async updateVideoStreamParameter(t,e){throw new $(L.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===st.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Nl.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Ct(He.prototype,"p2pConnect",[xV],Object.getOwnPropertyDescriptor(He.prototype,"p2pConnect"),He.prototype),Ct(He.prototype,"unpublish",[UV],Object.getOwnPropertyDescriptor(He.prototype,"unpublish"),He.prototype),Ct(He.prototype,"unpublishLowStream",[VV],Object.getOwnPropertyDescriptor(He.prototype,"unpublishLowStream"),He.prototype),Ct(He.prototype,"subscribe",[FV],Object.getOwnPropertyDescriptor(He.prototype,"subscribe"),He.prototype),Ct(He.prototype,"mockSubscribe",[BV],Object.getOwnPropertyDescriptor(He.prototype,"mockSubscribe"),He.prototype),Ct(He.prototype,"unsubscribe",[jV],Object.getOwnPropertyDescriptor(He.prototype,"unsubscribe"),He.prototype),Ct(He.prototype,"muteRemote",[WV],Object.getOwnPropertyDescriptor(He.prototype,"muteRemote"),He.prototype),Ct(He.prototype,"unmuteRemote",[GV],Object.getOwnPropertyDescriptor(He.prototype,"unmuteRemote"),He.prototype),Ct(He.prototype,"hasRemoteMediaWithLock",[HV],Object.getOwnPropertyDescriptor(He.prototype,"hasRemoteMediaWithLock"),He.prototype),Ct(He.prototype,"disconnectForReconnect",[zV],Object.getOwnPropertyDescriptor(He.prototype,"disconnectForReconnect"),He.prototype),Ct(He.prototype,"remoteMediaSsrcChanged",[KV],Object.getOwnPropertyDescriptor(He.prototype,"remoteMediaSsrcChanged"),He.prototype),He);function to(t){return function(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];switch(t){case $s.SEND_ONLY:{const p=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await o.apply(this,l)}finally{p()}}case $s.RECEIVE_ONLY:{const p=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await o.apply(this,l)}finally{p()}}default:{const p=await this.sendMutex.lock("From P2PChannel2.".concat(n)),m=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await o.apply(this,l)}finally{p(),m()}}}},i}}class hd extends Ke{constructor(e,n){super(),N(this,"signal",void 0),N(this,"token",void 0),N(this,"tokenTimeout",void 0),N(this,"tokenInterval",void 0),N(this,"_sequence",0),N(this,"userMap",new Map),N(this,"encoder",new TextEncoder),this.signal=e,this.token=n;const i=()=>{this.signal.connectionState===Le.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*x("P2P_TOKEN_INTERVAL"))};i()}async send(e,n,i,o,c){var l;if(this.userMap.size===0)return;const u=Array.from(nr(l=this.userMap).call(l))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),o=o??Ae(6,""),c=c??this._sequence++;const p={_id:o,_type:e,_seq:c,_message:n,token:"".concat(this.token,"_").concat(u)};x("SHOW_P2P_LOG")&&R.debug("send message",p,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(p)).forEach(_=>{this.signal.request(Mt.DATA_STREAM,{payload:Ma(this.encoder.encode(_))})});const m=new gt((_,E)=>{const S=window.setTimeout(()=>{this.off("res-@".concat(o,"_ack"),T),this.off("res-@".concat(o),I),this.off(Wl.ABORT,A),R.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(o)),this.userMap.size===0?E(new $(L.INVALID_REMOTE_USER)):E(new $(L.TIMEOUT))},x("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),T=()=>{S&&window.clearTimeout(S),this.off(Wl.ABORT,A),i&&_()},A=()=>{S&&window.clearTimeout(S),this.off("res-@".concat(o,"_ack"),T),this.off("res-@".concat(o),I),E(new $(L.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(o)))};this.once(Wl.ABORT,A),this.once("res-@".concat(o,"_ack"),T);const I=(P,D)=>{w=!0,S&&window.clearTimeout(S),this.off("res-@".concat(o,"_ack"),T),this.off(Wl.ABORT,A),P==="success"?_(D):E(new $(L.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(o)))};let w=!1;i||(this.once("res-@".concat(o),I),xn(x("SIGNAL_REQUEST_TIMEOUT")).then(()=>{w||R.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(o,", ").concat(p))}))});try{return await m}catch(_){if(_.code===L.TIMEOUT)return await this.send(e,n,i,o,c);throw _}}onMessage(e){var n;const{_uid:i}=e;let o,c=this.userMap.get(i);if(c)o=c.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==rn.CHECK)return;const{token:m}=e;o=new Map,c={uid:i,isStart:!0,token:m,splitMessageMap:o,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,c),this.signal.emit(ee.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in e&&"total"in e){var l;const{id:m,total:_}=e,E=(l=o.get(m))!==null&&l!==void 0?l:[];if(E.push(e),o.has(m)||o.set(m,E),E.length!==_)return;{const S=Mc(E).call(E,(T,A)=>T.index-A.index).map(T=>T.payload).join("");o.delete(m),(e=JSON.parse(S))._uid=i}}const{_type:u,token:p}=e;if(pt(n=[rn.ACK,rn.CHECK]).call(n,u))return u===rn.CHECK&&this.handleCheckToken(c,p),void this.receiveMessage(e);p==="".concat(c.token,"_").concat(this.token)?this.handleReceivedMessage(e):R.debug('Receive unexpected message", '.concat(p,", cur_token: ").concat(c.token,"_").concat(this.token),e)}check(){const e={_id:Ae(6,""),token:this.token,_type:rn.CHECK};x("SHOW_P2P_LOG")&&R.debug("send message",e),this.signal.request(Mt.DATA_STREAM,{payload:Ma(this.encoder.encode(JSON.stringify(e)))})}ack(e){const n={_id:e,_type:rn.ACK,token:this.token};x("SHOW_P2P_LOG")&&R.debug("send message",n),this.signal.request(Mt.DATA_STREAM,{payload:Ma(this.encoder.encode(JSON.stringify(n)))})}response(e,n,i){this.send(rn.RESPONSE,JSON.stringify({success:!i,message:n}),!0,e)}handleReceivedMessage(e){const n=()=>{this.userMap.forEach(m=>{const{receivedMessagesMap:_,nextExpectedSequenceNumber:E}=m;for(;_.has(E);){const S=_.get(E);_.delete(E),this.receiveMessage(S),m.nextExpectedSequenceNumber++}})};if(!e)return void n();const{_uid:i,_seq:o}=e,c=this.userMap.get(i),{receivedMessagesMap:l,isStart:u,nextExpectedSequenceNumber:p}=c;if(o<p)return this.ack(e._id),void R.debug("[external-signal] receive old message, seq: ".concat(o,", ").concat(e._message));l.set(o,e),u&&o===p&&(this.receiveMessage(e),l.delete(p),c.nextExpectedSequenceNumber++,n())}receiveMessage(e){const{_id:n,_type:i,_message:o,_uid:c}=e;if(x("SHOW_P2P_LOG")&&R.debug("receive message",e),n){let l;switch(e._type!==rn.ACK&&(o&&(l=JSON.parse(o)),this.ack(e._id)),e._type){case rn.CANDIDATE:case rn.CONTROL:this.signal.emit(i,l,c);break;case rn.PUBLISH:case rn.UNPUBLISH:case rn.RESTART_ICE:case rn.CALL:l.uid=c,Kn(this.signal,i,l).then(u=>{this.response(e._id,u)}).catch(()=>{this.response(e._id,void 0,!0)});break;case rn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case rn.RESPONSE:{const{success:u,message:p}=l;this.emit("res-@".concat(n),u?"success":"failed",p);break}}}}splitMessage(e){if(e.length<hd.MAX_MESSAGE_SIZE)return[e];const n=[],{remoteToken:i}=JSON.parse(e),o=Ae(6,"");let c=0,l=800;const u=Math.ceil(e.length/l);for(;e.length>0;){c++;const p={id:o,index:c,total:u,payload:e.slice(0,l),token:"".concat(this.token,"_").concat(i)};JSON.stringify(p).length>hd.MAX_MESSAGE_SIZE?l-=50:(n.push(p),e=e.slice(l))}return n.map(p=>JSON.stringify(p))}handleCheckToken(e,n){return e.token!==n?(R.debug("token changed, from ".concat(e.token," to ").concat(n)),this.reset(e.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{R.debug("token timeout, ".concat(n)),this.reset(e.uid)},x("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await Kn(this.signal,rn.CALL,void 0),n=await this.send(rn.CALL,e);this.signal.emit(Vt.P2P_CONNECTION,n,!0)}async reset(e,n){const i=this.userMap.get(e);i&&(this.emit(Wl.ABORT),this.signal.emit(ee.ON_USER_OFFLINE,{uid:i.uid,reason:mZ.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(R.debug("change local token from ".concat(n," to ").concat(n)),this.token=Ae(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Wl.ABORT)}}N(hd,"MAX_SIZE",1),N(hd,"MAX_MESSAGE_SIZE",1024);class qtt extends Ke{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Le.CONNECTED?this.emit(Vt.WS_CONNECTED):e===Le.RECONNECTING?this.emit(Vt.WS_RECONNECTING,this._websocketReconnectReason):e===Le.CLOSED&&this.emit(Vt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),N(this,"_disconnectedReason",void 0),N(this,"_websocketReconnectReason",void 0),N(this,"_connectionState",Le.CLOSED),N(this,"reconnectToken",void 0),N(this,"p2pToken",void 0),N(this,"websocket",void 0),N(this,"openConnectionTime",void 0),N(this,"clientId",void 0),N(this,"lastMsgTime",Date.now()),N(this,"uploadCache",[]),N(this,"uploadCacheInterval",void 0),N(this,"rttRolling",new T1(5)),N(this,"pingpongTimer",void 0),N(this,"pingpongTimeoutCount",0),N(this,"joinResponse",void 0),N(this,"multiIpOption",void 0),N(this,"initError",void 0),N(this,"spec",void 0),N(this,"store",void 0),N(this,"_external_signal",void 0),N(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Vt.ON_BINARY_DATA,i.data);const o=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const c="res-@".concat(o._id);this.emit(c,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){switch(o._type){case ee.ON_DATA_STREAM:return void this.handleDataStream(o._message);case ee.MUTE_AUDIO:case ee.MUTE_VIDEO:case ee.ON_P2P_LOST:case ee.ON_USER_ONLINE:return;case ee.ON_USER_OFFLINE:const{uid:c}=o._message;return R.debug("[".concat(this.clientId,"] user-offline uid: ").concat(c)),void this._external_signal.reset(c)}if(this.emit(o._type,o._message),o._type===ee.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===ee.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(_e.UID_BANNED);break;case 15:this.close(_e.IP_BANNED);break;case 16:this.close(_e.CHANNEL_BANNED)}if(o._type===ee.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case Nt.ERR_LICENSE_MISSING:this.close(_e.LICENSE_MISSING);break;case Nt.ERR_LICENSE_EXPIRED:this.close(_e.LICENSE_EXPIRED);break;case Nt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(_e.LICENSE_MINUTES_EXCEEDED);break;case Nt.ERR_LICENSE_PERIOD_INVALID:this.close(_e.LICENSE_PERIOD_INVALID);break;case Nt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(_e.LICENSE_MULTIPLE_SDK_SERVICE);break;case Nt.ERR_LICENSE_ILLEGAL:this.close(_e.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new U0("gateway-".concat(this.clientId),this.spec.retryConfig,!0,x("JOIN_GATEWAY_USE_DUAL_DOMAIN"),x("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Le.CONNECTED&&this.reconnect("retry",zn.OFFLINE)}),this.p2pToken=Ae(6,""),this._external_signal=new hd(this,this.p2pToken)}async request(e,n,i,o){const c=Ae(6,""),l={_id:c,_type:e,_message:n},u=this.websocket.connectionID,p=()=>new gt((A,I)=>{if(this.connectionState===Le.CONNECTED)return A();const w=()=>{this.off(Vt.WS_CLOSED,P),A()},P=()=>{this.off(Vt.WS_CONNECTED,w),I(new $(L.WS_ABORT))};this.once(Vt.WS_CONNECTED,w),this.once(Vt.WS_CLOSED,P)});if(this.connectionState!==Le.CONNECTING&&this.connectionState!==Le.RECONNECTING||e===Mt.JOIN||e===Mt.REJOIN||await p(),this.websocket.sendMessage(l,!0),o)return;const m=new gt((A,I)=>{let w=!1;const P=(U,G)=>{w=!0,A({isSuccess:U==="success",message:G||{}}),this.off(Vt.WS_CLOSED,D),this.off(Vt.WS_RECONNECTING,D),this.emit(Vt.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(c),P);const D=()=>{I(new $(L.WS_ABORT,"type: ".concat(e))),this.off(Vt.WS_CLOSED,D),this.off(Vt.WS_RECONNECTING,D),this.off("res-@".concat(c),P)};this.once(Vt.WS_CLOSED,D),this.once(Vt.WS_RECONNECTING,D),xn(x("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||w||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(Vt.REQUEST_TIMEOUT,e,n))})});let _=null;try{_=await m}catch(A){if(this.connectionState===Le.CLOSED||e===Mt.LEAVE)throw new $(L.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?A.throw():e===Mt.JOIN||e===Mt.REJOIN?null:(await p(),await this.request(e,n))}if(_.isSuccess)return _.message;const E=Number(_.message.error_code||_.message.code),S=Bh(E),T=new $(L.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(_.message.error_str),{code:E,data:_.message,desc:S.desc});return S.action==="success"?_.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(E,", message: ").concat(S.desc,", action: ").concat(S.action)),E===Nt.ERR_TOO_MANY_BROADCASTERS?((e===Mt.JOIN||e===Mt.REJOIN)&&(this.initError=T,this.close()),T.throw()):S.action==="failed"?T.throw():S.action==="quit"?(this.initError=T,this.close(),T.throw()):(E===Nt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",zn.MULTI_IP)):this.reconnect(S.action,zn.SERVER_ERROR),e===Mt.JOIN||e===Mt.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new gt(i=>{const o=c=>{(!n||n(c))&&(this.off(e,o),i(c))};this.on(e,o)})}uploadWRTCStats(e){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Vh.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const c=x("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Le.CONNECTED)return;const l=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(l._type,l._message)},x("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}async sendExtensionMessage(e,n,i){return await this._external_signal.send(e,n,i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new gt((n,i)=>{this.once(Vt.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Vt.WS_CLOSED,()=>i(this.initError||new $(L.WS_ABORT))),this.connectionState=Le.CONNECTING,this.websocket.init(e).catch(i)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||_e.LEAVE,this.connectionState=Le.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Ae(6,""),this._external_signal.clear(),this._external_signal=new hd(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Vt.ABORT_P2P_EXECUTION);const e=await Kn(this,Vt.REQUEST_JOIN_INFO),n=await this.request(Mt.JOIN,e);if(!n)return this.emit(Vt.REPORT_JOIN_GATEWAY,L.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Vt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Le.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}async downgradeCodec(e){return!1}handleDataStream(e){try{var n;const i=zc(e.payload),o=new TextDecoder().decode(i),c=JSON.parse(o);"total"in c&&"id"in c||pt(n=Object.values(rn)).call(n,c._type)?(c._uid=e.uid,this._external_signal.onMessage(c)):this.emit(ee.ON_DATA_STREAM,e)}catch{this.emit(ee.ON_DATA_STREAM,e)}}handleNotification(e){R.debug("[".concat(this.clientId,"] receive notification: "),e);const n=Bh(e.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(_e.UID_BANNED),void this.close()):void this.reconnect(n.action,zn.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=x("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(R.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>x("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",zn.TIMEOUT):this.request(Mt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),x("REPORT_STATS")&&this.send(Mt.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(Gt.RECONNECT_CREATE_CONNECTION,e=>{this.emit(Vt.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Gt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Gt.CLOSED,()=>{this.connectionState=Le.CLOSED}),this.websocket.on(Gt.FAILED,()=>{this._disconnectedReason=_e.NETWORK_ERROR,this.connectionState=Le.CLOSED}),this.websocket.on(Gt.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Le.CONNECTED?this.connectionState=Le.RECONNECTING:this.connectionState=Le.CONNECTING}),this.websocket.on(Gt.WILL_RECONNECT,(e,n,i)=>{e!=="retry"?(R.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):R.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(e)}),this.websocket.on(Gt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(Vt.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof $&&e.code===L.UNEXPECTED_RESPONSE&&e.data.code===Nt.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",zn.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",zn.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(Gt.REQUEST_NEW_URLS,(e,n)=>{Kn(this,Vt.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(Gt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ee.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const Xtt={name:"P2PChannel",create:function(t){let{store:e,statsCollector:n}=t;return new Ytt(e,n)},createSubmodule:function(t){let{store:e,spec:n}=t;return new qtt(n,e)}};function qV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function XV(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?qV(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):qV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class Jtt{constructor(e){N(this,"sessionDesc",void 0),N(this,"localCapabilities",void 0),N(this,"rtpCapabilities",void 0),N(this,"candidates",void 0),N(this,"_originCandidates",void 0),N(this,"iceParameters",void 0),N(this,"dtlsParameters",void 0),N(this,"setup",void 0),N(this,"currentMidIndex",void 0),N(this,"cname",void 0),e=Ge(e);const{iceParameters:n,dtlsParameters:i,candidates:o,rtpCapabilities:c,setup:l,localCapabilities:u,sdkCodec:p,cname:m}=e,_=Wi(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=c,this.candidates=o,this._originCandidates=Ge(o),this.iceParameters=n,this.dtlsParameters=i,this.setup=l,this.localCapabilities=u,this.cname=m;for(let E=0;E<_.mediaDescriptions.length;E++){const S=_.mediaDescriptions[E];if(S.attributes.iceUfrag=n.iceUfrag,S.attributes.icePwd=n.icePwd,S.attributes.fingerprints=i.fingerprints,S.attributes.candidates=o,S.attributes.setup=l,S.media.mediaType==="video"){S.media.fmts=c.videoCodecs.map(I=>I.payloadType.toString(10));const T=c.videoCodecs.filter(I=>{var w,P;return(w=I.rtpMap)===null||w===void 0?void 0:pt(P=w.encodingName.toLowerCase()).call(P,p)}),A=c.videoCodecs.filter(I=>!pt(T).call(T,I));S.attributes.payloads=[...T,...A],S.attributes.extmaps=c.videoExtensions}S.media.mediaType==="audio"&&(S.media.fmts=c.audioCodecs.map(T=>T.payloadType.toString(10)),S.attributes.payloads=c.audioCodecs,S.attributes.extmaps=c.audioExtensions),_.mediaDescriptions[E]=this.mungMediaDesc(S)}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return xa(this.sessionDesc)}send(e,n,i){const{ssrcs:o,ssrcGroups:c}=Hh(n,this.cname),l=this.sessionDesc.mediaDescriptions.find(m=>e===St.VIDEO?m.media.mediaType==="video":m.media.mediaType==="audio"),u=o[0].attributes.label,p=o[0].attributes.mslabel;return l.attributes.ssrcs=l.attributes.ssrcs.concat(o),l.attributes.ssrcGroups=l.attributes.ssrcGroups.concat(c),{id:u,mslabel:p}}batchSend(e){return e.map(n=>{let{kind:i,ssrcMsg:o}=n;return this.send(i,o,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],o=[],c=[];n.attributes.ssrcs.forEach(l=>{pt(e).call(e,l.attributes.label||"")?c.push(l):i.push(l)}),n.attributes.ssrcGroups.forEach(l=>{var u;pt(u=c.map(p=>p.ssrcId)).call(u,l.ssrcIds[0])||o.push(l)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=o})}mute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(e,n,i){e.forEach((o,c)=>{const l=o._mediaStreamTrack,u=this.sessionDesc.mediaDescriptions.findIndex(m=>m.attributes.mid===l.kind),p=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[u],o);this.sessionDesc.mediaDescriptions[u]=p})}stopReceiving(e){}updateCandidates(e){const n=this._originCandidates.filter(o=>o.transport==="udp"),i=[];if(n.forEach(o=>{i.push(XV(XV({},o),{},{foundation:"tcpcandidate",priority:Number(o.priority)-1+"",transport:"tcp",port:Number(o.port)+90+""}))}),n.length!==0){switch(e){case ti.TCP_RELAY:this.candidates=i;break;case ti.UDP_TCP_RELAY:case ti.RELAY:this.candidates=[...n,...i];break;default:this.candidates=n}for(const o of this.sessionDesc.mediaDescriptions)o.attributes.candidates=this.candidates}}restartICE(e){e=Ge(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const n=[];for(let i=0;i<e;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(e,n){const i=Ge(e);return zl(i,n),j0(i,n),i}updateRecvMedia(e,n){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=o}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,n,i){const o=this.sessionDesc.mediaDescriptions.find(l=>e===St.VIDEO?l.attributes.mid==="video":l.attributes.mid==="audio");if(o){const l=o.attributes.ssrcs.find(u=>u.attributes.label===n);var c;l&&(l.attributes.label=i,(c=l.attributes.msid)===null||c===void 0||c.replace(n,i))}}mungMediaDesc(e){const n=Ge(e);return B0(n),function(i){const o=i.attributes.extmaps.find(c=>z_(c.extensionName));o&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(o),1),i.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(u=>u.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}(n),n}getSSRC(e){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===e)return[i]}}var Oe;function JV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function Ag(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?JV(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):JV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let Qtt=(Oe=class jp extends cx{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return pt(n=Object.keys(kh)).call(n,e)}))]}constructor(e,n){super(e,n),N(this,"store",void 0),N(this,"peerConnection",void 0),N(this,"remoteSDP",void 0),N(this,"initialOffer",void 0),N(this,"statsFilter",void 0),N(this,"useRTX",!1),N(this,"localCapabilities",void 0),N(this,"localCandidateCount",0),N(this,"allCandidatesReceived",!1),N(this,"establishPromise",void 0),N(this,"mutex",void 0),this.store=n,this.mutex=new Qn("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(jp.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=Xy(this.peerConnection,x("STATS_UPDATE_INTERVAL"),void 0,qe()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Wa(e.sdp),i=Gh(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:x("FILTER_VIDEO_FEC"),filterAudioFec:x("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=e,Ag(Ag({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:e.sdp})}catch(e){throw new $(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Jtt(Ag(Ag({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(e,n){throw new $(L.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,n){var i=this;return xr(function*(){const o=yield oe(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=e.map(S=>i.peerConnection.addTrack(S._mediaStreamTrack)),l=yield oe(i.peerConnection.createOffer()),u=Wi(l.sdp),p=e.map(S=>{const T=S._mediaStreamTrack,A=u.mediaDescriptions.find(I=>I.attributes.mid===T.kind);if(!A)throw new Error("Cannot extract ssrc from mediaDescription.");return function(I,w,P){const D=I.attributes.ssrcs.filter(G=>G.attributes.label===w),U=I.attributes.ssrcGroups;if(D.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(U&&D.length>1){const G=U.find(W=>W.ssrcIds.indexOf(D[0].ssrcId)!==-1);return G?[{ssrcId:G.ssrcIds[0],rtx:P?G.ssrcIds[1]:void 0}]:[{ssrcId:D[0].ssrcId}]}return[{ssrcId:D[0].ssrcId}]}(A,T.id,i.useRTX)});let m;try{m=yield p}catch(S){throw c.forEach(T=>{Hn()&&T.replaceTrack(null),i.peerConnection.removeTrack(T)}),S}const _=i.mungSendOfferSDP(l.sdp,e);i.remoteSDP.receive(e,n,m);const E=i.remoteSDP.toString();return yield oe(i.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield oe(i.applySendEncodings(c,e)),yield oe(i.peerConnection.setRemoteDescription({type:"answer",sdp:E})),e.map((S,T)=>{const A=S._mediaStreamTrack.id;return{localSSRC:p[T],id:A}})}catch(c){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{o()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(c=>{var l;return e.indexOf(((l=c.track)===null||l===void 0?void 0:l.id)||"")!==-1});if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(c=>{Hn()&&c.replaceTrack(null),this.peerConnection.removeTrack(c)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(e);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(e,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:c,mslabel:l}=this.remoteSDP.send(e,n,o),u=new gt((_,E)=>{const S=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(c)))},1e4),T=A=>{const I=ie();if((I.name==="Safari"&&Number(I.version)===11||ai())&&A.track.id!==c&&A.streams[0].id===l){var w;const P=A.streams[0].getTracks()[0];return(w=this.remoteSDP)===null||w===void 0||w.updateTrackLabel(e,c,A.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(S),void _(P)}if(A.track.id===c)return this.peerConnection.removeEventListener("track",T),clearTimeout(S),void _(A.track)};this.peerConnection.addEventListener("track",T)}),p=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:p});const m=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(m),{track:await u,id:c}}catch(c){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var o;return e.indexOf(((o=i.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==e.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if(Hn()&&i.track)i.track.enabled=!1;else{const o=i.getParameters();o.encodings.forEach(c=>c.active=!1),i.setParameters(o)}})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(c=>{var l;return e.indexOf(((l=c.track)===null||l===void 0?void 0:l.id)||"")!==-1});if(n.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async c=>{if(Hn()&&c.track)c.track.enabled=!0;else{const l=c.getParameters();l.encodings.forEach(u=>u.active=!0),await c.setParameters(l)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return xr(function*(){const i=yield oe(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const o=ae().supportPCSetConfiguration;if(e===ti.RELAY&&!o)return;if(o){const m=n.peerConnection.getConfiguration(),_=e===ti.RELAY?"relay":"all";m.iceTransportPolicy!==_&&(R.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(_,"]")),m.iceTransportPolicy=_,n.peerConnection.setConfiguration(m))}e!==ti.RELAY&&n.remoteSDP.updateCandidates(e);const c=yield oe(n.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const l=Wa(c.sdp),{remoteIceParameters:u}=yield l.iceParameters;n.remoteSDP.restartICE(u);const p=n.remoteSDP.toString();yield oe(n.peerConnection.setLocalDescription(c)),yield oe(n.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(o){R.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{i()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const c=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new $(L.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getSenders().filter(o=>{var c;return((c=o.track)===null||c===void 0?void 0:c.id)===e});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getSenders().find(o=>{var c;return((c=o.track)===null||c===void 0?void 0:c.id)===n});i&&await i.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,n){throw new $(L.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new $(L.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},x("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Ah(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...jp.turnServerConfigToIceServers(e.turnServer.servers)),x("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...jp.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(m=>{var _;return((_=m.track)===null||_===void 0?void 0:_.id)===e._mediaStreamTrack.id})),!n)return R.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!ae().supportSetRtpSenderParameters)return R.warn("Browser not support set rtp-sender parameters");const o={},c={};if(e instanceof Me)switch(e._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(x("DSCP_TYPE")&&Xo()){var l;const m=x("DSCP_TYPE");pt(l=["very-low","low","medium","high"]).call(l,m)&&(c.networkPriority=m)}const u=n.getParameters(),p=(i=u.encodings)===null||i===void 0?void 0:i[0];p&&Object.assign(p,c),Object.assign(u,o),R.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(u.encodings))),await n.setParameters(u)}async applySendEncodings(e,n){try{if(!ae().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const o=e[i],c=n[i];o&&c&&await this.updateRtpSenderEncodings(c,o)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n){const i=Wi(e);return n.forEach((o,c)=>{const l=o._mediaStreamTrack,u=i.mediaDescriptions.find(p=>p.attributes.mid===l.kind);u&&zl(u,o)}),xa(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(e).map((c,l)=>{let{id:u,mslabel:p}=c;const{kind:m}=e[l];return new gt((_,E)=>{const S=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(u)))},1e4),T=A=>{const I=ie();if(I.name==="Safari"&&Number(I.version)===11&&A.track.id!==u&&A.streams[0].id===p){var w;const P=A.streams[0].getTracks()[0];return(w=this.remoteSDP)===null||w===void 0||w.updateTrackLabel(m,u,A.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(S),void _({track:P,id:u})}if(A.track.id===u)return this.peerConnection.removeEventListener("track",T),clearTimeout(S),void _({track:A.track,id:u})};this.peerConnection.addEventListener("track",T)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(o),await gt.all(n)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n==null?void 0:n[0].ssrcId}setConfiguration(e){if(ae().supportPCSetConfiguration){const n=jp.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Ct(Oe.prototype,"connect",[zr],Object.getOwnPropertyDescriptor(Oe.prototype,"connect"),Oe.prototype),Ct(Oe.prototype,"stopSending",[zr],Object.getOwnPropertyDescriptor(Oe.prototype,"stopSending"),Oe.prototype),Ct(Oe.prototype,"receive",[zr],Object.getOwnPropertyDescriptor(Oe.prototype,"receive"),Oe.prototype),Ct(Oe.prototype,"stopReceiving",[zr],Object.getOwnPropertyDescriptor(Oe.prototype,"stopReceiving"),Oe.prototype),Ct(Oe.prototype,"muteRemote",[zr],Object.getOwnPropertyDescriptor(Oe.prototype,"muteRemote"),Oe.prototype),Ct(Oe.prototype,"unmuteRemote",[zr],Object.getOwnPropertyDescriptor(Oe.prototype,"unmuteRemote"),Oe.prototype),Ct(Oe.prototype,"muteLocal",[zr],Object.getOwnPropertyDescriptor(Oe.prototype,"muteLocal"),Oe.prototype),Ct(Oe.prototype,"unmuteLocal",[zr],Object.getOwnPropertyDescriptor(Oe.prototype,"unmuteLocal"),Oe.prototype),Ct(Oe.prototype,"close",[zr],Object.getOwnPropertyDescriptor(Oe.prototype,"close"),Oe.prototype),Ct(Oe.prototype,"updateEncoderConfig",[zr],Object.getOwnPropertyDescriptor(Oe.prototype,"updateEncoderConfig"),Oe.prototype),Ct(Oe.prototype,"updateSendParameters",[zr],Object.getOwnPropertyDescriptor(Oe.prototype,"updateSendParameters"),Oe.prototype),Ct(Oe.prototype,"replaceTrack",[zr],Object.getOwnPropertyDescriptor(Oe.prototype,"replaceTrack"),Oe.prototype),Ct(Oe.prototype,"getRemoteSSRC",[zr],Object.getOwnPropertyDescriptor(Oe.prototype,"getRemoteSSRC"),Oe.prototype),Oe);function zr(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,c=await o.lock("Locking from P2PConnection.".concat(e));try{for(var l=arguments.length,u=new Array(l),p=0;p<l;p++)u[p]=arguments[p];return await i.apply(this,u)}finally{c()}},n}const Ztt={name:"PlanBConnection",create:function(t){let{store:e,spec:n}=t;return new Qtt(n,e)}},$tt={interceptLocalAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ae().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(A_.has(t)||!t.track)return;const n={track:t.track};if(qo()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let o=null;try{o=t.createEncodedStreams()}catch(l){return void R.error("create audio-encoded-streams error",l&&l.message)}const c=new TransformStream({transform(l,u){n.controller||(n.controller=u),t.track&&t.track.id!==n.track.id&&(R.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const p=e.metadata&&e.metadata();p?function(m,_){const{chunk:E,controller:S}=_,T=Ua.METADATA;E.data=function(A,I,w){const P=w.byteLength,D=P+v0+zM,U=E0+S0+D,G=new ArrayBuffer(A.byteLength+U),W=new DataView(G);W.setUint8(0,HM),W.setUint16(1,D),W.setUint8(3,I),W.setUint16(4,P);for(let X=0;X<P;X++)W.setUint8(6+X,w[X]);const F=new Uint8Array(W.buffer);return F.set(new Uint8Array(A),U),F.buffer}(E.data,T,m),S.enqueue(E)}(p,{sender:t,chunk:l,controller:u}):u.enqueue(l)}});o.readable.pipeThrough(c).pipeTo(o.writable)}else if(Hn()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const o=w_(),c=new MessageChannel;await new gt(u=>o.onmessage=p=>{p.data==="registered"&&u(void 0)});const l=new RTCRtpScriptTransform(o,{name:"audio-metadata-tx",port:c.port2},[c.port2]);t.transform=l,await new gt(u=>o.onmessage=p=>{p.data==="started"&&u(void 0)}),c.port1.onmessage=u=>{var p;if(u.data.transformed&&t.track&&((p=t.track)===null||p===void 0?void 0:p.id)!==n.track.id)R.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i);else if(u.data.getMetadata){const m=e.metadata&&e.metadata();m&&c.port1.postMessage({metadata:m})}},n.worker=o}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const o=A_.get(t);if(o){A_.delete(t);try{var c,l;(c=o.controller)===null||c===void 0||c.terminate(),(l=o.worker)===null||l===void 0||l.terminate()}catch(u){R.warning(u&&u.message)}}}A_.set(t,n),t.track.addEventListener("ended",i)},interceptRemoteAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ae().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(L_.has(t))return;const n={track:t.track,onMetadata:e.onMetadata,onPts:e.onPts};if(qo()&&!ai()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");Oy(ue.CHROME,87,116)||(e.enableTopn=!1);let o=null;try{o=t.createEncodedStreams()}catch(l){return void R.error("create audio-encoded-streams error",l&&l.message)}const c=new TransformStream({transform(l,u){n.controller||(n.controller=u),t.track&&t.track.id!==n.track.id&&(R.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)),e.enableTopn?function(p,m,_){var E;const S=T0(new DataView(m.data));if(!S)return _.enqueue(m);const T=p.track.id;xQ.set(T,p.track);const A=(E=S.tlv.find(G=>G.tag===Ua.AUDIO_LEVEL))===null||E===void 0?void 0:E.value;let I=0;typeof A=="number"&&(I=127-A);const w=Math.round(Math.pow(10,I/60)-1),{selected:P,speaker:D}=function(G,W){let F=Vl.get(G);if(F||(F=function(X){const tt=new YM;return Vl.set(X,tt),Ys||(Ys=new LQ(x("TOPN_SILENCE_THRESHOLD")||500),Ys.on("ActiveSpeakerChanged",nt=>{nt!=null&&(D_=nt)})),Ys.addSpeakers([tt]),tt}(G)),Vl.size<=qM)return{selected:!0,speaker:F};if(!Ys)throw new Error("no active speaker detector");return Ys.levelChanged(F.id,W),Zc=Ys.loudest.map(X=>X.id),D_&&!pt(Zc).call(Zc,D_)&&Zc.length>=qM&&Zc.pop(),{selected:pt(Zc).call(Zc,F.id)||F.id===D_,speaker:F}}(p,w),U=function(G,W,F){const X=qs.get(G)||new MQ(G,W);return X.score=F,qs.set(G,X),function(tt){if(P_.set(tt,!0),!k_)return void(k_=Date.now());const nt=Date.now();nt-k_>1e3&&(P_.get(tt)?P_.set(tt,!1):(XM(tt),P_.delete(tt)),k_=nt)}(G),X}(T,p.track,D.energyScore);U.addSample(P),U.active&&(m.data=S.frame.buffer,_.enqueue(m))}(t,l,u):e.enableMetadata||e.enablePts?function(p,m,_,E){const S=new DataView(p.data),T=S.getUint8(0);let A;if(128&T&&T!==71){const P=function(D){if(D.byteLength<=0)return[];const U=[];let G=0;for(;G<D.byteLength;){const F=(128&D.getUint8(G))>>7,X=127&D.getUint8(G);if(!(F&&G+4<=D.byteLength)){G++;break}{const tt=D.getUint32(G,!1),nt=(16776192&tt)>>10,at=1023&tt;U.push({pt:X,ts_offset:nt,length:at,data:new Uint8Array}),G+=4}}let W=D.byteLength-G;for(const F of U){if(F.length>W)return console.warn("Broken red payload"),[];F.length>0&&(F.data=new Uint8Array(D.buffer,D.byteOffset+G,F.length),G+=F.length,W-=F.length)}if(W>0){const F={pt:U.length>0?U[U.length-1].pt:0,ts_offset:0,length:W,data:new Uint8Array(D.buffer,D.byteOffset+G,W)};U.push(F)}return U}(S);if(P.length>0){const D=function(U){let G=0;for(let X=0;X<U.length;X++)G+=X<U.length-1?4:1,G+=U[X].length;const W=new Uint8Array(G);let F=0;for(let X=0;X<U.length;X++)if(X<U.length-1){const tt=(2147483648|(127&U[X].pt)<<24|(262143&U[X].ts_offset)<<10|1023&U[X].length)>>>0;W[F++]=tt>>24&255,W[F++]=tt>>16&255,W[F++]=tt>>8&255,W[F++]=255&tt}else W[F++]=127&U[X].pt;for(const X of U)W.set(X.data,F),F+=X.length;return W}(P.map(U=>{const G=new Uint8Array(U.length);G.set(U.data);const W=T0(new DataView(G.buffer));return W!=null&&W.frame&&(U.data=W==null?void 0:W.frame),A=W,U}));p.data=D.buffer}}else A=T0(S),A&&(p.data=A.frame.buffer);if(m.enqueue(p),!A)return;const I=A.tlv.find(P=>P.tag===Ua.METADATA);I&&_&&I.value instanceof Uint8Array&&_(I.value);const w=A.tlv.find(P=>P.tag===Ua.AUDIO_64_BIT_PTS);w&&E&&w.value instanceof Uint8Array&&w.value.length==8&&E(new DataView(w.value.buffer).getBigUint64(0,!0))}(l,u,e.onMetadata,e.onPts):u.enqueue(l)}});o.readable.pipeThrough(c).pipeTo(o.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const o=w_(),c=new MessageChannel;await new gt(u=>o.onmessage=p=>{p.data==="registered"&&u(void 0)});const l=new RTCRtpScriptTransform(o,{name:"audio-metadata-rx",port:c.port2},[c.port2]);t.transform=l,await new gt(u=>o.onmessage=p=>{p.data==="started"&&u(void 0)}),c.port1.onmessage=u=>{var p;u.data.transformed&&t.track&&((p=t.track)===null||p===void 0?void 0:p.id)!==n.track.id?(R.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)):u.data.metadata&&n.onMetadata?n.onMetadata(u.data.metadata):u.data.pts&&n.onPts&&n.onPts(u.data.pts)},n.worker=o}function i(){t.track.removeEventListener("ended",i),function(o){const c=L_.get(o);if(c){(function(p){const m=Vl.get(p);m&&(Vl.delete(p),Ys&&(Ys.removeSpeakers([m]),Vl.size===0&&(Ys.destroy(),Ys=null)))})(o),XM(o.track.id),L_.delete(o);try{var l,u;(l=c.controller)===null||l===void 0||l.terminate(),(u=c.worker)===null||u===void 0||u.terminate()}catch(p){R.warning(p&&p.message)}}}(t)}L_.set(t,n),t.track.addEventListener("ended",i)},interceptLocalVideoFrame:async function(t,e){if(!ae().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(M_.has(t)||!t.track)return;const n={track:t.track};if(qo()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let o=null;try{o=t.createEncodedStreams()}catch(u){return void R.error("create video-encoded-streams error",u&&u.message)}const c=[];e.on("sei-to-send",u=>{c.push(u)});const l=new TransformStream({transform(u,p){n.controller||(n.controller=p),t.track&&t.track.id!==n.track.id&&(R.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const m=ZM(new Uint8Array(u.data)),_=c.shift();if(_){const E=function(S,T,A){switch(A){case b0:return function(I,w){const P=QM(w),D=P.length,U=Math.floor(D/255),G=D%255,W=new Uint8Array(6+U+1+D+I.byteLength);W[0]=0,W[1]=0,W[2]=0,W[3]=1,W[4]=6,W[5]=101;let F=0;for(;F<U;)W[6+F]=255,F++;return W[6+F]=G,F++,W.set(P,6+F),W.set(new Uint8Array(I),6+F+D),W.buffer}(S,T);case I0:return function(I,w){const P=QM(w),D=P.length,U=Math.floor(D/255),G=D%255,W=new Uint8Array(7+U+1+D+1+I.byteLength);W[0]=0,W[1]=0,W[2]=0,W[3]=1,W[4]=78,W[5]=1,W[6]=101;let F=0;for(;F<U;)W[7+F]=255,F++;return W[7+F]=G,F++,W.set(P,7+F),F+=D,W[7+F]=128,F++,W.set(new Uint8Array(I),7+F),W.buffer}(S,T);default:return null}}(u.data,_,m);E&&(u.data=E)}p.enqueue(u)}});o.readable.pipeThrough(l).pipeTo(o.writable)}else{if(!Hn())return;{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const o=w_(),c=new MessageChannel;await new gt(u=>o.onmessage=p=>{p.data==="registered"&&u(void 0)});const l=new RTCRtpScriptTransform(o,{name:"sei-tx",port:c.port2},[c.port2]);t.transform=l,await new gt(u=>o.onmessage=p=>{p.data==="started"&&u(void 0)}),e.on("sei-to-send",u=>{c.port1.postMessage({sei:u})}),c.port1.onmessage=u=>{var p;u.data.transformed&&t.track&&((p=t.track)===null||p===void 0?void 0:p.id)!==n.track.id&&(R.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i))},n.worker=o}}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const o=M_.get(t);if(o){M_.delete(t);try{var c,l;(c=o.controller)===null||c===void 0||c.terminate(),(l=o.worker)===null||l===void 0||l.terminate()}catch(u){R.warning(u&&u.message)}}}M_.set(t,n),t.track.addEventListener("ended",i)},interceptRemoteVideoFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ae().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(!t.track)return;if(Uh.has(t)){const o=Uh.get(t);return void(o&&(o.onSei=e.onSei))}const n={track:t.track,onSei:e.onSei};if(qo()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let o=null;try{o=t.createEncodedStreams()}catch(l){return void R.error("create video-encoded-streams error",l&&l.message)}const c=new TransformStream({transform(l,u){n.controller||(n.controller=u),t.track&&t.track.id!==n.track.id&&(R.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const p=function(m,_){switch(_){case b0:return function(E){const S=new DataView(E.data);let T=0;for(;T+4<E.data.byteLength;){if(S.getUint8(T+0)===0&&S.getUint8(T+1)===0&&S.getUint8(T+2)===0&&S.getUint8(T+3)===1&&S.getUint8(T+4)===6){let A=T+6,I=0,w=0;for(;(w=S.getUint8(A++))===255;)I+=255;I+=w;const P=JM(E.data,A,I);return new Uint8Array(P)}T++}return null}(m);case I0:return function(E){const S=new DataView(E.data);let T=0;for(;T+5<E.data.byteLength;){if(S.getUint8(T+0)===0&&S.getUint8(T+1)===0&&S.getUint8(T+2)===0&&S.getUint8(T+3)===1&&S.getUint8(T+4)===78&&S.getUint8(T+5)===1&&S.getUint8(T+6)===101){let A=T+7,I=0,w=0;for(;(w=S.getUint8(A++))===255;)I+=255;I+=w;const P=JM(E.data,A,I);return new Uint8Array(P)}T++}return null}(m);default:return null}}(l,ZM(new Uint8Array(l.data)));p&&n.onSei&&n.onSei(p),u.enqueue(l)}});o.readable.pipeThrough(c).pipeTo(o.writable)}else if(Hn()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const o=w_(),c=new MessageChannel;await new gt(u=>o.onmessage=p=>{p.data==="registered"&&u(void 0)});const l=new RTCRtpScriptTransform(o,{name:"sei-rx",port:c.port2},[c.port2]);t.transform=l,await new gt(u=>o.onmessage=p=>{p.data==="started"&&u(void 0)}),c.port1.onmessage=u=>{var p;u.data.transformed&&t.track&&((p=t.track)===null||p===void 0?void 0:p.id)!==n.track.id?(R.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)):u.data.sei&&n.onSei&&n.onSei(u.data.sei)},n.worker=o}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}(function(o){const c=Uh.get(o);if(c){Uh.delete(o);try{var l,u;(l=c.controller)===null||l===void 0||l.terminate(),(u=c.worker)===null||u===void 0||u.terminate()}catch(p){R.warning(p&&p.message)}}})(t)}Uh.set(t,n),t.track.addEventListener("ended",i)}},tet={name:"InterceptFrame",create:()=>$tt};Jy(),ye("PROCESS_ID","process-".concat(Ae(8,""),"-").concat(Ae(4,""),"-").concat(Ae(4,""),"-").concat(Ae(4,""),"-").concat(Ae(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void R.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();R.debug("Loading global parameters from cache",e),Object.keys(e).forEach(i=>{if(Object.prototype.hasOwnProperty.call(Be,i)){const{value:o,expires:c}=e[i];if(c&&c<=n)return;Ks[i]=o,Be[i]=o}})}catch(e){R.error("Error loading mutableParamsCache: ".concat(t),e.message)}}(),Array.isArray(Ks.AREAS)&&Ks.AREAS.length>0&&z0(Ks.AREAS,!0);const QV=(t,e,n)=>{R.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(e))),ye(t,e,n)};za(Rtt,!1),za(Itt,!1),za(a$,!1),za(Utt,!1),za(vtt,!1),za(Xtt,!1),za(Ztt,!1),za(tet,!1);const fn=function(t){const e=new Ke,n=t,i={getListeners:e.getListeners.bind(e),on:(o,c)=>(function(l,u){l===Io.SECURITY_POLICY_VIOLATION&&DU(u,!0)}(o,c),e.on.bind(e)(o,c)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return NU(NU({},n),i)}({__TRACK_LIST__:Ol,VERSION:Ur,BUILD:$y,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:QV,getParameter:x,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let e=new RTCPeerConnection;const n=await async function(i){let o;return ae().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),o=(await i.createOffer()).sdp):o=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,o}(e);if(!n)return t;e.close(),e=null,t=function(i){const o={video:[],audio:[]};return i.match(/ VP8/i)&&o.video.push("VP8"),i.match(/ VP9/i)&&o.video.push("VP9"),i.match(/ AV1/i)&&o.video.push("AV1"),i.match(/ H264/i)&&o.video.push("H264"),i.match(/ H265/i)&&o.video.push("H265"),i.match(/ opus/i)&&o.audio.push("OPUS"),i.match(/ PCMU/i)&&o.audio.push("PCMU"),i.match(/ PCMA/i)&&o.audio.push("PCMA"),i.match(/ G722/i)&&o.audio.push("G722"),o}(n)}catch(e){throw new Q(L.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return t},checkSystemRequirements:function(){const t=bt.reportApiInvoke(null,{name:tn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:We.TRACER});let e=!1;try{const c=window.RTCPeerConnection,l=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,u=window.WebSocket;e=!!(c&&l&&u),e&&My()&&Jk(75)&&new c().close()}catch(c){return R.error("check system requirement failed: ",c),!1}let n=!1;const i=ie();i.name===ue.CHROME&&Number(i.version)>=58&&(Gs.engine.name!=="WebKit"||function(){const c=ie();if(l_()){if(c.os===bn.MAC_OS)return!0;if(c.os===bn.IOS){const l=Gs.os.version&&Gs.os.version.split(".");if(l&&Number(l[0])===14&&l[1]&&Number(l[1])>=3||l&&Number(l[0])>14)return!0}}return!1}())&&(n=!0),(i.name===ue.FIREFOX&&Number(i.version)>=56||i.name===ue.OPERA&&Number(i.version)>=45||i.name===ue.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&(ai()||ps())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||n1()||ie().name===ue.QQ)&&(n=!0),R.debug("checkSystemRequirements, api:",e,"browser",n);const o=e&&n;return t.onSuccess(o),o},getDevices:function(t){return yr.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return yr.getRecordingDevices(t)},getCameras:function(t){return yr.getCamerasDevices(t)},getElectronScreenSources:J1,getPlaybackDevices:function(t){return yr.getSpeakers(t)},createClient:function(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Ae(5,"client-"),i=bt.reportApiInvoke(null,{id:n,name:tn.CREATE_CLIENT,options:[e],tag:We.TRACER});try{(function(o){Tn(o.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Tn(o.mode,"config.mode",["rtc","live","p2p"]),o.audioCodec!==void 0&&Tn(o.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),o.proxyServer!==void 0&&Mn(o.proxyServer,"config.proxyServer",1,1e4),o.turnServer!==void 0&&l1(o.turnServer),o.httpRetryConfig!==void 0&&d1(o.httpRetryConfig),o.websocketRetryConfig!==void 0&&d1(o.websocketRetryConfig)})(e)}catch(o){throw i.onError(o),o}return($k(16,0,!0)||Py(16,0,!0))&&(e.codec==="vp9"&&(e.codec="vp8",R.debug("browser not support vp9, force use vp8")),ye("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),i.onSuccess(),new c$(ys(ys({forceWaitGatewayResponse:!0},e),{},{role:pt(t=["rtc","p2p"]).call(t,e.mode)?"host":e.role||"audience"}),n)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=x("CAMERA_CAPTURE_CONFIG"),n=Ae(8,"track-cam-"),i=bt.reportApiInvoke(null,{id:n,tag:We.TRACER,name:tn.CREATE_CAM_VIDEO_TRACK,options:[ke({},t),e]});e&&(t.encoderConfig=e);const o=b_(t);let c=null;R.info("start create camera video track with config",JSON.stringify(t),"trackId",n);try{c=(await Tr({video:o},n)).getVideoTracks()[0]||null}catch(u){throw i.onError(u),u}if(!c){const u=new $(L.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(u),u.throw(R)}if(t.optimizationMode&&g0(n,c,t,_s(t.encoderConfig)),x("USE_STANDARD_BITRATE_DEFAULT")){const u=_s(t.encoderConfig);t.encoderConfig=u,delete u.bitrateMax,delete u.bitrateMin}const l=new I_(c,t,o,t.scalabiltyMode?T_(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,n);return i.onSuccess(l.getTrackId()),R.info("create camera video success, trackId:",n),l},createCustomVideoTrack:function(t){const e=Ae(8,"track-cus-"),n=bt.reportApiInvoke(null,{id:e,tag:We.TRACER,name:tn.CREATE_CUSTOM_VIDEO_TRACK,options:[t]});x("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin);const i=new Me(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?T_(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,e,[Ie.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),R.info("create custom video track success with config",t,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof e=="object"?function(S){return oL(S)}(e):void 0;n&&(e="auto");const i=Ae(8,"track-scr-v-"),o=bt.reportApiInvoke(null,{id:i,tag:We.TRACER,name:tn.CREATE_SCREEN_VIDEO_TRACK,options:[ke({},t),e]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const c=function(S){const T={};S.screenSourceType&&(T.mediaSource=S.screenSourceType),S.extensionId&&qo()&&(T.extensionId=S.extensionId);const{displaySurface:A,selfBrowserSurface:I,surfaceSwitching:w,systemAudio:P,preferCurrentTab:D}=S;(vl(107)||Ny(107)||ky(93))&&(A&&(Tn(A,"displaySurface",["browser","window","monitor"]),T.displaySurface=A),I?(Tn(I,"selfBrowserSurface",["exclude","include"]),T.selfBrowserSurface=I):T.selfBrowserSurface="include",w&&(Tn(w,"surfaceSwitching",["exclude","include"]),T.surfaceSwitching=w)),(vl(105)||Ny(105)||ky(91))&&P&&(Tn(P,"systemAudio",["exclude","include"]),T.systemAudio=P),(vl(94)||Ny(94)||ky(80))&&D&&(T.preferCurrentTab=!0),S.electronScreenSourceId&&(T.sourceId=S.electronScreenSourceId);const U=S.encoderConfig?s0(S.encoderConfig):null;return T.mandatory={chromeMediaSource:"desktop",maxWidth:U?U.width:void 0,maxHeight:U?U.height:void 0},U&&(U.frameRate&&(typeof U.frameRate=="number"?(T.mandatory.maxFrameRate=U.frameRate,T.mandatory.minFrameRate=U.frameRate):(T.mandatory.maxFrameRate=U.frameRate.max||U.frameRate.ideal||U.frameRate.exact||void 0,T.mandatory.minFrameRate=U.frameRate.min||U.frameRate.ideal||U.frameRate.exact||void 0),T.frameRate=U.frameRate),U.width&&(T.width=U.width),U.height&&(T.height=U.height)),T}(t);let l=null,u=null;const p=ae();if(!p.supportShareAudio&&e==="enable"){const S=new $(L.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return o.onError(S),S.throw(R)}R.info("start create screen video track with config",t,"withAudio",e,"trackId",i);const m=p.supportShareAudio&&e!=="disable";try{const S=await Tr({screen:c,screenAudio:m?n||!0:void 0},i);l=S.getVideoTracks()[0]||null,u=S.getAudioTracks()[0]||null}catch(S){throw o.onError(S),S}if(!l){const S=new $(L.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(S),S.throw(R)}if(!u&&e==="enable"){l&&l.stop();const S=new $(L.SHARE_AUDIO_NOT_ALLOWED);return o.onError(S),S.throw(R)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(g0(i,l,t,t.encoderConfig&&s0(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const _=new Me(l,t.encoderConfig?s0(t.encoderConfig):{},t.scalabiltyMode?T_(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i,[Ie.SCREEN_TRACK]);if(!u)return o.onSuccess(_.getTrackId()),R.info("create screen video track success","video:",_.getTrackId()),_;const E=new $e(u,void 0,Ae(8,"track-scr-a-"),!1);return o.onSuccess([_.getTrackId(),E.getTrackId()]),R.info("create screen video track success","video:",_.getTrackId(),"audio:",E.getTrackId()),[_,E]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=x("CAMERA_CAPTURE_CONFIG"),i=Ae(8,"track-mic-"),o=Ae(8,"track-cam-"),c=bt.reportApiInvoke(null,{id:"".concat(i,"-").concat(o),tag:We.TRACER,name:tn.CREATE_MIC_AND_CAM_TRACKS,options:[t,e,n]});n&&(e.encoderConfig=n);const l=b_(e),u=aL(t);let p=null,m=null;R.info("start create camera video track(".concat(o,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(e)));try{const S=await Tr({audio:u,video:l},"".concat(i,"-").concat(o));p=S.getAudioTracks()[0],m=S.getVideoTracks()[0]}catch(S){throw c.onError(S),S}if(!p||!m){const S=new $(L.UNEXPECTED_ERROR,"can not find tracks in media stream");return c.onError(S),S.throw(R)}if(e.optimizationMode&&g0(o,m,e,_s(e.encoderConfig)),x("USE_STANDARD_BITRATE_DEFAULT")){const S=_s(e.encoderConfig);e.encoderConfig=S,delete S.bitrateMax,delete S.bitrateMin}const _=new xh(p,t,u,i),E=new I_(m,e,l,e.scalabiltyMode?T_(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o);return c.onSuccess([_.getTrackId(),E.getTrackId()]),R.info("create camera video track(".concat(o,") and microphone audio track(").concat(i,") success")),[_,E]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Ae(8,"track-mic-"),n=bt.reportApiInvoke(null,{id:e,tag:We.TRACER,name:tn.CREATE_MIC_AUDIO_TRACK,options:[t]}),i=aL(t);let o=null;R.info("start create microphone audio track with config",JSON.stringify(t),"trackId",e);try{o=(await Tr({audio:i},e)).getAudioTracks()[0]||null}catch(l){throw n.onError(l),l}if(!o){const l=new $(L.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(l),l.throw(R)}const c=new xh(o,t,i,e);return n.onSuccess(c.getTrackId()),R.info("create microphone audio track success, trackId:",e),c},createCustomAudioTrack:function(t){const e=Ae(8,"track-cus-"),n=bt.reportApiInvoke(null,{id:e,tag:We.TRACER,name:tn.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),i=new $e(t.mediaStreamTrack,t.encoderConfig?y_(t.encoderConfig):{},e,!1);return R.info("create custom audio track success with config",t,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(t){var e;const{cacheOnlineFile:n,encoderConfig:i}=t;let{source:o}=t;const c={source:o instanceof AudioBuffer?"AudioBuffer":o instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":o,cacheOnlineFile:n,encoderConfig:i},l=Ae(8,"track-buf-"),u=bt.reportApiInvoke(null,{id:l,tag:We.TRACER,name:tn.CREATE_BUFFER_AUDIO_TRACK,options:[c]});if(x("DISABLE_WEBAUDIO"))throw new $(L.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");R.info("start create buffer source audio track with config",JSON.stringify(c),"trackId",l);const p=o;if(!(o instanceof AudioBuffer))try{o=await async function(E,S){let T=null;if(typeof E=="string"){const I=YL.get(E);if(I)return R.debug("use cached audio resource: ",E),I;try{T=(await zs(()=>Oi.get(E,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(w){throw new $(L.FETCH_AUDIO_FILE_FAILED,w.toString())}}else T=await new gt((w,P)=>{const D=new FileReader;D.onload=U=>{U.target?w(U.target.result):P(new $(L.READ_LOCAL_AUDIO_FILE_ERROR))},D.onerror=()=>{P(new $(L.READ_LOCAL_AUDIO_FILE_ERROR))},D.readAsArrayBuffer(E)});const A=await function(I){const w=Ll();return new gt((P,D)=>{w.decodeAudioData(I,U=>{P(U)},U=>{D(new $(L.DECODE_AUDIO_FILE_FAILED,U.toString()))})})}(T);return typeof E=="string"&&S&&YL.set(E,A),A}(o,n)}catch(E){return u.onError(E),E.throw(R)}const m=new OQ(o),_=new AQ(p,m,i?y_(i):{},l);return R.info("create buffer source audio track success, trackId:",l),u.onSuccess(_.getTrackId()),_},setAppType:function(t){if(R.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw R.debug("Invalid appType"),new Q(L.INVALID_PARAMS,"invalid app type",t);ye("APP_TYPE",Math.floor(t))},setLogLevel:function(t){R.setLogLevel(t)},enableLogUpload:function(){x("USE_NEW_LOG")?ye("UPLOAD_LOG",!0):R.enableLogUpload()},disableLogUpload:function(){x("USE_NEW_LOG")?ye("UPLOAD_LOG",!1):R.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new Jx},checkAudioTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=bt.reportApiInvoke(null,{tag:We.TRACER,name:tn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof $e||t instanceof Ul)){const p=new Q(L.INVALID_TRACK,"the parameter is not a audio track");return n.onError(p),p.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof $e?t.getTrackLabel():"remote_track",o=t.getVolumeLevel();let c=o,l=o;const u=Date.now();return new gt(p=>{const m=setInterval(()=>{const _=t.getVolumeLevel();c=_>c?_:c,l=_<l?_:l;const E=c-l>1e-4,S=Date.now()-u;if(E||S>e){clearInterval(m);const T=E,A={duration:S,deviceLabel:i,maxVolumeLevel:c,result:T};R.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(A))),n.onSuccess(A),p(T)}},200)})},checkVideoTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=bt.reportApiInvoke(null,{tag:We.TRACER,name:tn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof Me||t instanceof xl)){const E=new Q(L.INVALID_TRACK,"the parameter is not a video track");return n.onError(E),E.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof Me?t.getTrackLabel():"remote_track",o=t.getMediaStreamTrack(!0),c=document.createElement("video");c.style.width="1px",c.style.height="1px",c.setAttribute("muted",""),c.muted=!0,c.setAttribute("playsinline",""),c.controls=!1,(Hn()||l_())&&(c.style.opacity="0.01",c.style.position="fixed",c.style.left="0",c.style.top="0",document.body.appendChild(c)),c.srcObject=new MediaStream([o]),c.play();const l=document.createElement("canvas");l.width=160,l.height=120;let u=0,p=0;try{const E=Date.now();u=await function(S,T,A,I){let w,P=0,D=null;return new gt((U,G)=>{function W(){P>I&&w&&(w(),U(P));const F=A.getContext("2d");if(!F){const nt=new Q(L.UNEXPECTED_ERROR,"can not get canvas 2d context.");return R.error(nt.toString()),void G(nt)}F.drawImage(S,0,0,160,120);const X=F.getImageData(0,0,A.width,A.height),tt=Math.floor(X.data.length/3);if(D){for(let nt=0;nt<tt;nt+=3)if(X.data[nt]!==D[nt])return P+=1,void(D=X.data);D=X.data}else D=X.data}setTimeout(()=>{w&&(w(),U(P))},T),w=l0(()=>{W()},30)})}(c,e,l,4),p=Date.now()-E}catch(E){throw n.onError(E),E}qZ===ue.SAFARI&&(c.pause(),c.remove()),c.srcObject=null;const m=u>4,_={duration:p,changedPicNum:u,deviceLabel:i,result:m};return R.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(_))),n.onSuccess(_),m},setArea:z0,audioElementPlayCenter:Ni,resumeAudioContext:function(){Ni.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){l$.processExternalMediaAEC(t)},registerExtensions:function(t){const e=x("PLUGIN_INFO")||[];t.forEach(n=>{"name"in n&&!pt(e).call(e,n.name)&&e.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=R.extLog,i.reporter.hookApiInvoke=bt.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(o=>{i.parameters[o]=x(o)})}),QV("PLUGIN_INFO",e)},ChannelMediaRelayError:Bl,ChannelMediaRelayEvent:Qo,ChannelMediaRelayState:Hi,RemoteStreamFallbackType:TQ,RemoteStreamType:vQ,ConnectionDisconnectedReason:_e,AudienceLatencyLevelType:QJ,AREAS:pe,preload:async function(t,e,n,i){return v2(t,e,n,i)}});return Object.defineProperties(fn,{onAudioAutoplayFailed:{get:()=>Rr.onAudioAutoplayFailed,set:t=>{Rr.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>Rr.onAutoplayFailed,set:t=>{Rr.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>fn._onSecurityPolicyViolation,set(t){fn._onSecurityPolicyViolation=t,DU(t)}},__CLIENT_LIST__:{get:()=>x("SHOW_GLOBAL_CLIENT_LIST")?$c:[]}}),yr.on(Xc.CAMERA_DEVICE_CHANGED,t=>{R.info("camera device changed",JSON.stringify(t)),fn.onCameraChanged&&fn.onCameraChanged(t),fn.safeEmit(Io.CAMERA_CHANGED,t)}),yr.on(Xc.RECORDING_DEVICE_CHANGED,t=>{R.info("microphone device changed",JSON.stringify(t)),fn.onMicrophoneChanged&&fn.onMicrophoneChanged(t),fn.safeEmit(Io.MICROPHONE_CHANGED,t)}),yr.on(Xc.PLAYOUT_DEVICE_CHANGED,t=>{R.debug("playout device changed",JSON.stringify(t)),fn.onPlaybackDeviceChanged&&fn.onPlaybackDeviceChanged(t),fn.safeEmit(Io.PLAYBACK_DEVICE_CHANGED,t)}),Ni.onAutoplayFailed=()=>{R.info("detect audio element autoplay failed"),Rr.onAudioAutoplayFailed&&Rr.onAudioAutoplayFailed()},Re.on("autoplay-failed",()=>{R.info("detect webaudio autoplay failed"),Rr.onAudioAutoplayFailed&&Rr.onAudioAutoplayFailed(),fn.safeEmit(Io.AUTOPLAY_FAILED)}),Re.on(Vn.STATE_CHANGE,(t,e)=>{R.info("audio context state changed: ".concat(e," => ").concat(t)),fn.onAudioContextStateChanged&&fn.onAudioContextStateChanged(t,e),fn.safeEmit(Io.AUDIO_CONTEXT_STATE_CHANGED,t,e)}),on.on(yl.NETWORK_STATE_CHANGE,(t,e)=>{R.info("[network-indicator] network state changed, ".concat(e," => ").concat(t))}),window&&(window.__ARTC__=fn),fn})})(v4);var Qat=v4.exports;const WI=Tj(Qat),R4=Rt.createContext(void 0),Zat=({children:s})=>{const r=Rt.useMemo(()=>WI.createClient({mode:"rtc",codec:"vp8"}),[]),[a,d]=Rt.useState(!1),h=Rt.useCallback(f=>{d(f)},[]);return ht.jsx(R4.Provider,{value:{client:r,isAvatarSpeaking:a,setIsAvatarSpeaking:h},children:s})},Lf=()=>{const s=Rt.useContext(R4);if(s===void 0)throw new Error("useAgora must be used within an AgoraProvider");return s};function Qi(...s){const r=new Date().toISOString();console.log(`[${r}]`,...s)}function GI(s){return s.connectionState==="CONNECTED"&&s.uid!==void 0}async function $at(s,r,a){if(!GI(s)){console.warn("Cannot send stream message: client not ready",{connectionState:s.connectionState,uid:s.uid});return}const d=Object.fromEntries(Object.entries(r).filter(([g,v])=>!!v)),h={v:2,type:"command",mid:`msg-${Date.now()}`,pld:{cmd:"set-params",data:d}},f=JSON.stringify(h);return Qi(`setAvatarParams, size=${f.length}, data=${f}`),a==null||a("set-params",d),s.sendStreamMessage(f,!1)}async function tct(s,r){if(!GI(s)){console.warn("Cannot send stream message: client not ready",{connectionState:s.connectionState,uid:s.uid});return}const a={v:2,type:"command",mid:`msg-${Date.now()}`,pld:{cmd:"interrupt"}},d=JSON.stringify(a);return Qi(`interuptResponse, size=${d.length}, data=${d}`),r==null||r("interrupt"),s.sendStreamMessage(d,!1)}async function ect(s,r,a){if(!GI(s))throw console.warn("Cannot send stream message: client not ready",{connectionState:s.connectionState,uid:s.uid}),new Error("Client not connected to channel");const d=950,h=6e3,f=(k,M,j)=>{const z={v:2,type:"chat",mid:r,idx:M,fin:j,pld:{text:k}};return new TextEncoder().encode(JSON.stringify(z))};if(!a)throw new Error("Content cannot be empty");const g=f("",0,!1),v=Math.floor((d-g.length)/4),y=[];let C=a,O=0;for(;C.length>0;){let k=C.slice(0,v),M=f(k,O,!1);for(;M.length>d&&k.length>1;)k=k.slice(0,Math.ceil(k.length/2)),M=f(k,O,!1);if(M.length>d)throw new Error("Message encoding failed: content too large for chunking");y.push(k),C=C.slice(k.length),O++}Qi(`Splitting message into ${y.length} chunks`);for(let k=0;k<y.length;k++){const M=k===y.length-1,j=f(y[k],k,M),z=j.length,Y=Math.ceil(1e3*z/h),Z=Date.now();Qi(`Sending chunk ${k+1}/${y.length}, size=${z} bytes`);try{await s.sendStreamMessage(j,!1)}catch(H){throw new Error(`Failed to send chunk ${k+1}: ${H instanceof Error?H.message:"Unknown error"}`)}if(!M){const H=Date.now()-Z,K=Math.max(0,Y-H);K>0&&await new Promise(q=>setTimeout(q,K))}}}const nct=({isJoined:s,avatarVideoUrl:r,localVideoTrack:a,cameraEnabled:d})=>{const h=Rt.useRef(null),f=Rt.useRef(null),g=Rt.useRef(null),{isAvatarSpeaking:v}=Lf(),[y,C]=Rt.useState(!1),[O,k]=Rt.useState(!1),[M,j]=Rt.useState(!1),[z,Y]=Rt.useState({x:0,y:0}),[Z,H]=Rt.useState({x:0,y:0,width:0,height:0}),[K,q]=Rt.useState(!1),[it,ot]=Rt.useState(!1),_t=vt=>/\.(jpg|jpeg|png|gif|webp)$/i.test(vt),ft=Rt.useCallback(vt=>{if(!f.current||!g.current)return;const Ot=f.current.getBoundingClientRect();C(!0),Y({x:vt.clientX-Ot.left,y:vt.clientY-Ot.top}),vt.preventDefault(),vt.stopPropagation()},[]),lt=Rt.useCallback(vt=>{if(!f.current||!g.current)return;const xt=f.current;k(!0),H({x:vt.clientX,y:vt.clientY,width:xt.offsetWidth,height:xt.offsetHeight}),vt.preventDefault(),vt.stopPropagation()},[]),kt=Rt.useCallback(vt=>{if(!f.current||!g.current)return;const xt=g.current,Ot=f.current,zt=xt.getBoundingClientRect();if(y){const Se=vt.clientX-zt.left-z.x,le=vt.clientY-zt.top-z.y,Lt=xt.offsetWidth-Ot.offsetWidth,Jt=xt.offsetHeight-Ot.offsetHeight,$t=Math.max(0,Math.min(Se,Lt)),Ve=Math.max(0,Math.min(le,Jt));Ot.style.left=`${$t}px`,Ot.style.top=`${Ve}px`,Ot.style.right="auto",Ot.style.bottom="auto"}else if(O){const Se=vt.clientX-Z.x,le=vt.clientY-Z.y,Lt=Math.max(160,Math.min(Z.width+Se,xt.offsetWidth*.5)),Jt=Math.max(120,Math.min(Z.height+le,xt.offsetHeight*.5));Ot.style.width=`${Lt}px`,Ot.style.height=`${Jt}px`}},[y,O,z,Z]),At=Rt.useCallback(()=>{const vt=y||O;C(!1),k(!1),vt&&(q(!0),setTimeout(()=>q(!1),100))},[y,O]),qt=Rt.useCallback(vt=>{if(K||y||O){vt.preventDefault();return}j(!M)},[M,K,y,O]);return Rt.useEffect(()=>{if(y||O)return document.addEventListener("mousemove",kt),document.addEventListener("mouseup",At),()=>{document.removeEventListener("mousemove",kt),document.removeEventListener("mouseup",At)}},[y,O,kt,At]),Rt.useEffect(()=>{if(a&&d)try{a.stop(),setTimeout(()=>{try{if(!M)h.current&&a.play(h.current);else{const vt=document.getElementById("main-local-video");vt&&a.play(vt)}}catch(vt){console.error("Failed to play local video track after delay:",vt)}},50)}catch(vt){console.error("Failed to stop local video track:",vt)}return()=>{if(a)try{a.stop()}catch(vt){console.error("Failed to stop local video track in cleanup:",vt)}}},[a,d,M]),Rt.useEffect(()=>{if(!d&&a)try{a.stop()}catch(vt){console.error("Failed to stop video track when camera disabled:",vt)}},[d,a]),Rt.useEffect(()=>{const vt=document.getElementById("remote-video");if(!vt)return;const xt=()=>{const zt=!vt.paused&&vt.readyState>=2;ot(zt),zt&&Qi("remote video is ready")},Ot=()=>ot(!1);return vt.addEventListener("canplay",xt),vt.addEventListener("playing",xt),vt.addEventListener("pause",Ot),vt.addEventListener("ended",Ot),vt.addEventListener("loadstart",Ot),()=>{vt.removeEventListener("canplay",xt),vt.removeEventListener("playing",xt),vt.removeEventListener("pause",Ot),vt.removeEventListener("ended",Ot),vt.removeEventListener("loadstart",Ot)}},[s]),Rt.useEffect(()=>{s||(ot(!1),Qi("Stream disconnected, switching back to local video"))},[s]),ht.jsxs("div",{ref:g,className:"video-container",children:[M?ht.jsxs(ht.Fragment,{children:[ht.jsx("div",{id:"main-local-video",style:{width:"100%",height:"100%",background:"#000"}}),ht.jsx("video",{id:"remote-video",style:{display:"none"}})]}):ht.jsxs(ht.Fragment,{children:[_t(r)?ht.jsx("img",{id:"placeholder-image",hidden:it,src:r,alt:"Avatar placeholder",style:{width:"100%",height:"100%",objectFit:"contain"}}):ht.jsx("video",{id:"placeholder-video",hidden:it,src:r,loop:!0,muted:!0,playsInline:!0,autoPlay:!0}),ht.jsx("video",{id:"remote-video",style:{display:it?"block":"none"}}),v&&ht.jsxs("div",{className:"speaking-indicator",children:[ht.jsxs("div",{className:"speaking-dots",children:[ht.jsx("span",{}),ht.jsx("span",{}),ht.jsx("span",{})]}),ht.jsx("span",{className:"speaking-text",children:"Speaking..."})]})]}),d&&a&&ht.jsxs("div",{ref:f,className:`local-video-overlay ${y?"dragging":""} ${O?"resizing":""} ${M?"switching":""}`,onClick:qt,children:[ht.jsx("div",{className:"drag-handle",onMouseDown:ft,onClick:vt=>vt.stopPropagation(),title:"Drag to move"}),ht.jsx("div",{className:"resize-handle",onMouseDown:lt,onClick:vt=>vt.stopPropagation(),title:"Drag to resize"}),ht.jsx("div",{ref:h,className:"local-video-container",children:M&&ht.jsxs(ht.Fragment,{children:[_t(r)?ht.jsx("img",{src:r,alt:"Avatar",style:{width:"100%",height:"100%",objectFit:"contain"}}):ht.jsx("video",{src:r,loop:!0,muted:!0,playsInline:!0,autoPlay:!0,style:{width:"100%",height:"100%",objectFit:"contain"}}),ht.jsx("div",{id:"remote-video-overlay",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:it?"block":"none"}})]})})]})]})};var qr=(s=>(s.AVATAR_AUDIO_START="avatar_audio_start",s.AVATAR_AUDIO_END="avatar_audio_end",s.MIC_START="mic_start",s.MIC_END="mic_end",s.CAMERA_START="camera_start",s.CAMERA_END="camera_end",s.SET_PARAMS="set_params",s.SET_PARAMS_ACK="set_params_ack",s.INTERRUPT="interrupt",s.INTERRUPT_ACK="interrupt_ack",s))(qr||{}),Wp=(s=>(s.USER="user",s.AVATAR="avatar",s.SYSTEM="system",s))(Wp||{}),Gp=(s=>(s.CHAT="chat",s.SYSTEM="system",s.EVENT="event",s.COMMAND="command",s))(Gp||{});const ict=s=>new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}),rct=(s,r)=>{if(!r)return!1;if(s.timestamp-r.timestamp>3e4)return!0;const d=Math.floor(s.timestamp/3e5),h=Math.floor(r.timestamp/3e5);return d>h},sct=({client:s,connected:r,onStreamMessage:a})=>{const[d,h]=Rt.useState([]),[f,g]=Rt.useState(""),[v,y]=Rt.useState(!1);Rt.useEffect(()=>{if(r&&a){const Y=a;return s.on("stream-message",Y),()=>{s.off("stream-message",Y)}}},[s,r,a]);const C=Rt.useCallback(async()=>{if(!f.trim()||!r||v)return;y(!0);const Y=Date.now().toString(),Z={id:Y,text:f,sender:"user",messageType:"chat",timestamp:Date.now()};h(H=>[...H,Z]),g("");try{await ect(s,Y,f)}catch(H){console.error("Failed to send message:",H),h(K=>K.filter(q=>q.id!==Y))}finally{y(!1)}},[s,r,f,v]),O=Rt.useCallback((Y,Z,H,K,q,it)=>{h(ot=>{const _t=Date.now();if(K==="system")return[...ot,{id:`${Y}_${_t}`,text:Z,sender:H,messageType:K,systemType:q,timestamp:_t,metadata:it}];const ft=ot.findIndex(lt=>lt.id===Y);if(ft!==-1){const lt=[...ot];return lt[ft]={...lt[ft],text:lt[ft].text+Z,metadata:it},lt}return[...ot,{id:Y,text:Z,sender:H,messageType:K,timestamp:_t,metadata:it}]})},[]),k=Rt.useCallback((Y,Z,H)=>{O(Y,Z,H,"chat")},[O]),M=Rt.useCallback((Y,Z,H,K)=>{O(Y,Z,"system","system",H,K)},[O]),j=Rt.useCallback(()=>{h([]),g("")},[]),z=Rt.useCallback(()=>{h(Y=>{const Z=Y.filter(q=>q.messageType==="system"),H=Y.filter(q=>q.messageType==="chat"),K=Z.slice(-10);return[...H,...K].sort((q,it)=>{const ot=Y.findIndex(ft=>ft.id===q.id),_t=Y.findIndex(ft=>ft.id===it.id);return ot-_t})})},[]);return Rt.useEffect(()=>{d.filter(Y=>Y.messageType==="system").length>15&&z()},[d,z]),{messages:d,inputMessage:f,setInputMessage:g,sendMessage:C,clearMessages:j,addMessage:O,addChatMessage:k,addSystemMessage:M,cleanupOldSystemMessages:z,formatTime:ict,shouldShowTimeSeparator:rct}};const oct=({client:s,connected:r,micEnabled:a,setMicEnabled:d,toggleMic:h,onSystemMessageCallback:f})=>{const g=Rt.useRef(null),{setIsAvatarSpeaking:v}=Lf(),[y,C]=Rt.useState(!1),[O,k]=Rt.useState(400),[M,j]=Rt.useState(!1),[z,Y]=Rt.useState(0),[Z,H]=Rt.useState(0),[K,q]=Rt.useState(""),[it,ot]=Rt.useState({x:0,y:0}),[_t,ft]=Rt.useState(!1),lt=({content:de,position:Ne,visible:On})=>!On||!de?null:ht.jsx("div",{className:"tooltip",style:{position:"fixed",left:Ne.x+10,top:Ne.y-10,zIndex:9999},children:ht.jsx("div",{className:"tooltip-content",children:ht.jsx("pre",{children:de})})}),{messages:kt,inputMessage:At,setInputMessage:qt,sendMessage:vt,addMessage:xt,addChatMessage:Ot,addSystemMessage:zt,clearMessages:Se,formatTime:le,shouldShowTimeSeparator:Lt}=sct({client:s,connected:r}),Jt=Rt.useCallback(de=>{console.log("Resize handle clicked!",de.clientY),de.preventDefault(),j(!0),Y(de.clientY),H(O)},[O]);Rt.useEffect(()=>{const de=On=>{if(!M)return;const is=z-On.clientY,ur=window.innerHeight-40,Ui=Math.max(200,Math.min(ur,Z+is));console.log("Resizing:",{deltaY:is,newHeight:Ui,maxHeight:ur,startY:On.clientY}),k(Ui)},Ne=()=>{j(!1)};return M&&(document.addEventListener("mousemove",de),document.addEventListener("mouseup",Ne)),()=>{document.removeEventListener("mousemove",de),document.removeEventListener("mouseup",Ne)}},[M,z,Z]),Rt.useEffect(()=>{const de=()=>{const Ne=window.innerHeight-40;O>Ne&&k(Ne)};return window.addEventListener("resize",de),()=>window.removeEventListener("resize",de)},[O]);const $t=Rt.useCallback((de,Ne)=>{var On;if(Ne.systemType===qr.SET_PARAMS&&((On=Ne.metadata)!=null&&On.fullParams)){console.log("Showing tooltip for set-params message:",Ne.metadata.fullParams);const is=JSON.stringify(Ne.metadata.fullParams,null,2);q(is),ot({x:de.clientX,y:de.clientY}),ft(!0)}},[]),Ve=Rt.useCallback(()=>{ft(!1)},[]),Pe=Rt.useCallback((de,Ne)=>{try{const On=new TextDecoder().decode(Ne),{v:is,type:ur,mid:Ui,pld:jd}=JSON.parse(On);if(is!==2)return;if(ur==="chat"){const{text:Vi,from:Fi}=jd,ho=Fi==="user"?Wp.USER:Wp.AVATAR;Ot(`${ur}_${Ui}`,Vi,ho)}else if(ur==="event"){const{event:Vi}=jd;if(Vi==="audio_start")v(!0),C(!0),console.log('Avatar started speaking - will now show "finished speaking" messages'),zt(`event_${Ui}`," Avatar started speaking",qr.AVATAR_AUDIO_START);else if(Vi==="audio_end"){v(!1);const Fi=kt.some(ho=>ho.messageType===Gp.CHAT);y&&Fi?zt(`event_${Ui}`," Avatar finished speaking",qr.AVATAR_AUDIO_END):console.log('Suppressing "Avatar finished speaking" message:',{hasAvatarStartedSpeaking:y,hasChatMessages:Fi,messageCount:kt.length,chatMessageCount:kt.filter(ho=>ho.messageType===Gp.CHAT).length})}else xt(`event_${Ui}`,` Event: ${Vi}`,Wp.SYSTEM,Gp.EVENT)}else if(ur==="command"){const{cmd:Vi,code:Fi,msg:ho}=jd;if(Fi!==void 0){const po=Fi===1e3?"":"",Lr=Fi===1e3?"Success":"Failed",Hu=Vi==="interrupt"?qr.INTERRUPT_ACK:qr.SET_PARAMS_ACK;zt(`cmd_ack_${Ui}`,`${po} ${Vi}: ${Lr}${ho?` (${ho})`:""}`,Hu)}else{const{data:po}=jd,Lr=po?` with data: ${JSON.stringify(po)}`:"",Hu=Vi==="interrupt"?qr.INTERRUPT:qr.SET_PARAMS,ri=Vi==="set-params"&&po?` ${Vi}${Lr} `:` ${Vi}${Lr}`,Bi=Vi==="set-params"&&po?{fullParams:po}:void 0;console.log("Creating set-params message:",{cmd:Vi,data:po,metadata:Bi,messageText:ri}),zt(`cmd_send_${Ui}`,ri,Hu,Bi)}}}catch(On){console.error("Error handling stream message:",On),console.error("Message body:",Ne)}},[v,Ot,zt,xt,y,kt]);Rt.useEffect(()=>{if(r){const de=Pe;return s.on("stream-message",de),()=>{s.off("stream-message",de)}}},[s,r,Pe]),Rt.useEffect(()=>{r&&C(!1)},[r]),Rt.useEffect(()=>{f&&f((de,Ne,On,is)=>{zt(de,Ne,On,is)})},[f,zt]),Rt.useEffect(()=>{ui()},[kt]),Rt.useEffect(()=>{r||(Se(),C(!1))},[r,Se]);const ui=()=>{var de;(de=g.current)==null||de.scrollIntoView({behavior:"smooth"})},hn=async()=>{if(h){await h(),a?zt(`mic_${Date.now()}`," User microphone disabled",qr.MIC_END):zt(`mic_${Date.now()}`," User microphone enabled",qr.MIC_START);return}a?(d(!1),zt(`mic_${Date.now()}`," User microphone disabled",qr.MIC_END)):(d(!0),zt(`mic_${Date.now()}`," User microphone enabled",qr.MIC_START))};return ht.jsxs("div",{className:`chat-window ${M?"resizing":""}`,style:{height:`${O}px`},children:[ht.jsxs("div",{className:"resize-handle",onMouseDown:Jt,title:`Drag to resize chat window (current height: ${O}px)`,children:[ht.jsx("div",{className:"resize-indicator"}),ht.jsxs("div",{className:"resize-dots",children:[ht.jsx("span",{children:""}),ht.jsx("span",{children:""}),ht.jsx("span",{children:""})]}),ht.jsx("div",{className:"resize-text",children:" Drag to resize"})]}),ht.jsxs("div",{className:"chat-messages",children:[kt.map((de,Ne)=>{const On=Ne>0?kt[Ne-1]:void 0,is=Lt(de,On),ur=Ne===0;return ht.jsxs("div",{children:[(ur||is)&&ht.jsx("div",{className:"time-separator",children:le(de.timestamp)}),ht.jsx("div",{className:`chat-message ${de.sender===Wp.USER?"sent":"received"} ${de.messageType===Gp.SYSTEM?`system ${de.systemType||""}`:""}`,onMouseEnter:Ui=>$t(Ui,de),onMouseLeave:Ve,children:de.text})]},de.id)}),ht.jsx("div",{ref:g})]}),ht.jsx(lt,{content:K,position:it,visible:_t}),ht.jsxs("div",{className:"chat-input",children:[ht.jsx("button",{onClick:hn,disabled:!r,className:`icon-button ${r?"":"disabled"}`,title:a?"Disable microphone":"Enable microphone",children:ht.jsx("span",{className:"material-icons",children:a?"mic":"mic_off"})}),!a&&ht.jsxs(ht.Fragment,{children:[ht.jsx("input",{type:"text",placeholder:"Type a message...",disabled:!r,className:r?"":"disabled",value:At,onChange:de=>qt(de.target.value),onKeyUp:de=>de.key==="Enter"&&vt()}),ht.jsx("button",{onClick:vt,disabled:!r,className:`icon-button ${r?"":"disabled"}`,title:"Send message",children:ht.jsx("span",{className:"material-icons",children:"send"})}),ht.jsx("button",{onClick:()=>{zt(`interrupt_${Date.now()}`," User interrupted response",qr.INTERRUPT),tct(s,de=>{console.log(`Interrupt command sent: ${de}`)})},disabled:!r,className:`icon-button ${r?"":"disabled"}`,title:"Interrupt response",children:ht.jsx("span",{className:"material-icons",children:"stop"})})]})]})]})},act=()=>{const{client:s}=Lf(),[r,a]=Rt.useState(!1),d=Rt.useRef(null),h=Rt.useCallback(async()=>{if(r)try{d.current&&(d.current.stop(),d.current.close(),await s.unpublish(d.current),d.current=null),a(!1)}catch(g){console.error("Failed to disable microphone:",g)}else try{const g=await WI.createMicrophoneAudioTrack({encoderConfig:"speech_low_quality",AEC:!0,ANS:!0,AGC:!0});await s.publish(g),d.current=g,a(!0)}catch(g){console.error("Failed to enable microphone:",g),a(!1)}},[r,s]),f=Rt.useCallback(async()=>{try{d.current&&(d.current.stop(),d.current.close(),await s.unpublish(d.current),d.current=null),a(!1)}catch(g){console.error("Failed to cleanup audio track:",g)}},[s]);return Rt.useEffect(()=>()=>{f()},[f]),{micEnabled:r,setMicEnabled:a,toggleMic:h,cleanup:f}},cct=s=>{const r={vid:s.voiceId,vurl:s.voiceUrl,lang:s.language,mode:s.modeType,bgurl:s.backgroundUrl,vparams:s.voiceParams};return Object.fromEntries(Object.entries(r).filter(([a,d])=>!!d))},dct=(s,r,a,d,h,f,g,v,y,C,O,k)=>{const{client:M}=Lf(),[j,z]=Rt.useState({isJoined:!1,connected:!1,remoteStats:null,session:null,paramsSet:!1}),Y=xt=>{z(Ot=>({...Ot,...xt}))},Z=Rt.useCallback(xt=>{Qi(xt)},[]),H=Rt.useCallback(()=>{alert("Session will expire in 30s")},[]),K=Rt.useCallback(()=>{alert("Session expired"),vt()},[]),q=Rt.useCallback(async(xt,Ot)=>{Qi("onUserPublish",xt,Ot),Ot==="video"?(await M.subscribe(xt,Ot)).play("remote-video",{fit:"contain"}):Ot==="audio"&&(await M.subscribe(xt,Ot)).play()},[M]),it=Rt.useCallback(async(xt,Ot)=>{Qi("onUserUnpublish",xt,Ot),await M.unsubscribe(xt,Ot)},[M]),ot=Rt.useCallback((xt,Ot)=>{const zt=new TextDecoder().decode(Ot);Qi(`stream-message, uid=${xt}, size=${Ot.length}, msg=${zt}`);const{v:Se,type:le,pld:Lt}=JSON.parse(zt);if(Se!==2){Qi(`unsupported message version, v=${Se}`);return}if(le==="command"){const{cmd:Jt,code:$t,msg:Ve}=Lt;Qi(`cmd-response, cmd=${Jt}, code=${$t}, msg=${Ve}`),$t!==1e3&&alert(`cmd-response, cmd=${Jt}, code=${$t}, msg=${Ve}`)}},[]),_t=Rt.useCallback(async xt=>{const{agora_app_id:Ot,agora_channel:zt,agora_token:Se,agora_uid:le}=xt;j.isJoined&&await ft(),M.on("exception",Z),M.on("user-published",q),M.on("user-unpublished",it),M.on("token-privilege-will-expire",H),M.on("token-privilege-did-expire",K),await M.join(Ot,zt,Se,le),M.on("network-quality",Lt=>{const Jt=M.getRemoteVideoStats(),$t=M.getRemoteAudioStats(),Ve=M.getRemoteNetworkQuality(),Pe=Object.values(Jt)[0]||{},ui=Object.values($t)[0]||{},hn=Object.values(Ve)[0]||{};Y({remoteStats:{localNetwork:Lt,remoteNetwork:hn,video:Pe,audio:ui}})}),Y({isJoined:!0})},[M,Z,q,it,H,K,j.isJoined]),ft=Rt.useCallback(async()=>{Y({isJoined:!1,paramsSet:!1}),M.removeAllListeners("exception"),M.removeAllListeners("user-published"),M.removeAllListeners("user-unpublished"),M.removeAllListeners("token-privilege-will-expire"),M.removeAllListeners("token-privilege-did-expire");try{const xt=M.localTracks;for(const Ot of xt)try{Ot.stop(),Ot.close()}catch(zt){console.error("Failed to stop/close local track:",zt)}await M.unpublish()}catch(xt){console.error("Failed to unpublish tracks:",xt)}await M.leave()},[M]),lt=Rt.useCallback(async()=>{if(!M||!j.isJoined||!j.connected||j.paramsSet)return;const xt=cct({voiceId:d,voiceUrl:h,language:g,modeType:v,backgroundUrl:f,voiceParams:y});await $at(M,xt,(Ot,zt)=>{if(k&&Ot==="set-params"&&zt){const Se=`cmd_send_${Date.now()}`,le=` ${Ot}`;k(Se,le,"set_params",{fullParams:zt})}}),Y({paramsSet:!0})},[M,j.isJoined,j.connected,j.paramsSet,k,d,h,g,v,f,y]),kt=Rt.useCallback(async()=>{const xt=ot;M.on("stream-message",xt),Y({connected:!0})},[M,ot]),At=Rt.useCallback(async()=>{Y({connected:!1,paramsSet:!1})},[]);Rt.useEffect(()=>{j.isJoined&&j.connected&&lt()},[j.isJoined,j.connected,lt]),Rt.useEffect(()=>{(async()=>{if(j.isJoined)try{if(O)await M.publish(O),Qi("Local video track published");else{const zt=M.localTracks.find(Se=>Se.trackMediaType==="video");zt&&(await M.unpublish(zt),Qi("Local video track unpublished"))}}catch(Ot){console.error("Failed to handle video track:",Ot)}})()},[M,O,j.isJoined]);const qt=Rt.useCallback(async()=>{if(!C){alert("Please set host and token first");return}const xt=await C.createSession({avatar_id:s,duration:a*60,...r?{knowledge_id:r}:{},...d?{voice_id:d}:{},...h?{voice_url:h}:{},...g?{language:g}:{},...v?{mode_type:v}:{},...f?{background_url:f}:{},...y&&Object.keys(y).length>0?{voice_params:y}:{}});Qi(xt),Y({session:xt});const{stream_urls:Ot,credentials:zt}=xt;await _t(zt||Ot),await kt()},[C,s,r,a,_t,kt,d,h,g,v,f,y]),vt=Rt.useCallback(async()=>{if(await At(),await ft(),!j.session){Qi("session not found");return}await(C==null?void 0:C.closeSession(j.session._id))},[C,At,ft,j.session]);return Rt.useEffect(()=>()=>{M.removeAllListeners("exception"),M.removeAllListeners("user-published"),M.removeAllListeners("user-unpublished"),M.removeAllListeners("token-privilege-will-expire"),M.removeAllListeners("token-privilege-did-expire"),M.removeAllListeners("network-quality"),M.removeAllListeners("stream-message");try{const xt=M.localTracks;for(const Ot of xt)try{Ot.stop(),Ot.close()}catch(zt){console.error("Failed to stop/close local track during cleanup:",zt)}}catch(xt){console.error("Failed to cleanup local tracks on unmount:",xt)}},[M]),{...j,startStreaming:qt,closeStreaming:vt}},lct=()=>{const[s,r]=Rt.useState(!1),[a,d]=Rt.useState(null),[h,f]=Rt.useState(null),g=Rt.useRef(null),v=Rt.useCallback(async()=>{try{if(f(null),g.current){await g.current.setEnabled(!0),d(g.current),r(!0);return}const k=await WI.createCameraVideoTrack({encoderConfig:{width:320,height:240,frameRate:15,bitrateMin:200,bitrateMax:500}});g.current=k,d(k),r(!0)}catch(k){console.error("Failed to enable camera:",k);let M="Failed to access camera";k instanceof Error&&(k.message.includes("Permission denied")?M="Camera permission denied":k.message.includes("NotFoundError")?M="No camera device found":k.message.includes("NotReadableError")&&(M="Camera is being used by another application")),f(M),r(!1),d(null)}},[]),y=Rt.useCallback(async()=>{try{g.current&&(g.current.stop(),await g.current.setEnabled(!1)),r(!1),d(null),f(null)}catch(k){console.error("Failed to disable camera:",k)}},[]),C=Rt.useCallback(async()=>{s?await y():await v()},[s,v,y]),O=Rt.useCallback(async()=>{try{g.current&&(g.current.stop(),g.current.close(),g.current=null),d(null),r(!1),f(null)}catch(k){console.error("Failed to cleanup camera track:",k)}},[]);return Rt.useEffect(()=>()=>{O()},[O]),{cameraEnabled:s,localVideoTrack:a,cameraError:h,enableCamera:v,disableCamera:y,toggleCamera:C,cleanup:O}};function uct(){const{client:s}=Lf(),{micEnabled:r,setMicEnabled:a,toggleMic:d,cleanup:h}=act(),[f,g]=Rt.useState(!1),v=+"2"||2,y="en",C="Xb7hH8MSUJpSbSDYk0k2",O="",k="",M={},j="https://openapi.akool.com",[z,Y]=Rt.useState("dvp_Alinna_realisticbg_20241224"),Z="",[H,K]=Rt.useState("https://drz0f01yeq1cx.cloudfront.net/1752045213655-dvp_Alinna_realisticbg_20241224.mp4"),q="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4YWVhNWIzNzQzNGQ1NTgxNjk4MDc0MSIsInVpZCI6MTU3MzczMTgsImVtYWlsIjoiemFjaGFyaWFzemhpa2FpLndvbmdAbnR0ZGF0YS5jb20iLCJjcmVkZW50aWFsSWQiOiI2OGI2YmY5ZGQ4OThhNTRhZGJjNDNlYTMiLCJmaXJzdE5hbWUiOiJaYWNoYXJpYXMiLCJsYXN0TmFtZSI6IldvbmciLCJ0ZWFtX2lkIjoiNjhhZWE1YzE3NDM0ZDU1ODE2OTgwOGYwIiwicm9sZV9hY3Rpb25zIjpbMSwyLDMsNCw1LDYsNyw4LDldLCJpc19kZWZhdWx0X3RlYW0iOnRydWUsImNoYW5uZWwiOjEwMDAwLCJmcm9tIjoidG9PIiwidHlwZSI6InVzZXIiLCJpYXQiOjE3NTY4NzI2NTEsImV4cCI6MjA2NzkxMjY1MX0.kxrrzoMDGhvMLCddNyaNaWifjtoV5TXDseQrZoIQDaU",it=10,[ot,_t]=Rt.useState(null),ft=Rt.useRef(null);Rt.useEffect(()=>{_t(new Dit(j,q))},[j,q]);const{cameraEnabled:lt,localVideoTrack:kt,cleanup:At}=lct(),{isJoined:qt,connected:vt,remoteStats:xt,startStreaming:Ot,closeStreaming:zt}=dct(z,Z,it,C,k,O,y,v,M,ot,kt,ft.current||void 0);return Rt.useEffect(()=>{vt||(r&&h(),lt&&At())},[vt,r,lt,h,At]),Rt.useEffect(()=>()=>{h(),At()},[h,At]),ht.jsxs(ht.Fragment,{children:[ht.jsx("button",{className:`sidebar-toggle ${f?"collapsed":""}`,onClick:()=>g(!f),title:f?"Show Settings":"Hide Settings",children:ht.jsx("span",{className:"material-icons",children:f?"menu":"close"})}),ht.jsx("div",{className:`sidebar ${f?"collapsed":""}`,children:ht.jsx(Pit,{api:ot,isJoined:qt,startStreaming:Ot,closeStreaming:zt,avatarId:z,setAvatarId:Y,setAvatarVideoUrl:K})}),ht.jsx("div",{className:"main-content",children:ht.jsx("div",{className:"right-side",children:ht.jsx("div",{className:"video-chat-container",children:ht.jsxs("div",{className:"video-section",children:[ht.jsx(nct,{isJoined:qt,avatarVideoUrl:H,localVideoTrack:kt,cameraEnabled:lt}),ht.jsx("div",{children:qt&&xt&&ht.jsx(Jat,{stats:xt})})]})})})}),ht.jsxs("div",{className:"chat-section",children:[ht.jsx("div",{className:"chat-content",children:"Chat with Avatar"}),ht.jsx("div",{className:"chat-interface",children:ht.jsx(oct,{client:s,connected:vt,micEnabled:r,setMicEnabled:a,toggleMic:d,onSystemMessageCallback:Se=>{ft.current=Se}})})]})]})}IC.createRoot(document.getElementById("root")).render(ht.jsx(Lb.StrictMode,{children:ht.jsx(Zat,{children:ht.jsx(uct,{})})}));
